import{j as jsxRuntimeExports}from"./AboutSimple-Cf8x2fCZ.js";import{r as reactExports}from"./index-BH53Isel.js";import{R as ReactModal}from"./PaymentModal-lELjrGc2.js";import{H as HtmlContent}from"./HtmlContent-FTivcJrM.js";import{N as Number2Currency}from"./Number2Currency-e57Tgsuk.js";import{B as ButtonPrimary,a as ButtonSecondary,D as DeliveryPricesRest,A as AsyncSelect$1,O as OptionCard,b as DiscountRulesRest,C as CouponsRest,I as Info}from"./OptionCard-D9TmqCXj.js";import{P as Package}from"./package-BqGEawLR.js";import{T as Trash2}from"./trash-2-DK1wnsDn.js";import{M as Minus}from"./CartItemRow-aLzOG3-9.js";import{P as Plus}from"./plus-Bot15Khs.js";import{m as mainExports}from"./main-Byrjfx4U.js";import{t as toast}from"./index-BJa4kPFi.js";import{I as InputForm}from"./InputForm-ZnsQvLid.js";import{s as server_browserExports}from"./server.browser-Bf4gQIc7.js";import{l as lodashExports}from"./ShippingStep-je273HZY.js";import{S as StateManagedSelect$1}from"./react-select.esm-B3xLOHUE.js";import{G as General}from"./General-BmbBKdsB.js";import{U as UploadVoucherModalYape,a as UploadVoucherModalBancs}from"./ShippingStepSF-Mf87M-oW.js";import{C as CircleX}from"./circle-x-p-TkKhsF.js";import{T as TriangleAlert}from"./triangle-alert-vFMqKi4t.js";import{C as CircleCheckBig}from"./circle-check-big-D6DM3vPb.js";import{G as Global}from"./Global-D6eBBAMK.js";import"./ProductNavigation-CwO_kLuA.js";import"./ProductCard-B4Ag8Mdr.js";/* empty css              */import"./BlogCarousel-BcMdR14t.js";/* empty css               */import"./BlogCarrusel-B3SD0Iql.js";import{X}from"./x-DBMwyD6F.js";import"./index-yBjzXJbu.js";import"./index-B6ujFmsw.js";import"./index-Chjiymov.js";import"./createLucideIcon-Cy5Ya80P.js";import"./loader-circle-CrvBvIt1.js";import"./index-NIGUFBhG.js";import"./useStateManager-7e1e8489.esm-CxwdjZvi.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-kbdZbs82.js";import"./index-fRpqIG3j.js";import"./floating-ui.dom-DKqDEs6p.js";import"./tippy-react.esm-_w2ZiBvC.js";import"./proxy-BdCOtp7i.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./VoucherUpload-Ba_Eyt6G.js";import"./filepond-plugin-image-preview-B-c8xYdh.js";import"./SalesRest-DJlXIR9t.js";import"./BasicRest-DByHAxxD.js";import"./chevron-up-D78jyEhP.js";import"./chevron-down-DS-mdh9v.js";import"./ItemsRest-DmQAXZCN.js";import"./HeaderSearch-BLPm48RP.js";import"./index-CDbJJs-a.js";import"./eye-CKCH9ORv.js";const CardItemSF=({setCart:c,...o})=>{const e=()=>{c(n=>n.filter(a=>a.id!==o.id))},s=()=>{c(n=>n.map(a=>a.id===o.id?{...a,quantity:(a.quantity||1)+1}:a))},t=()=>{c(n=>n.map(a=>{if(a.id===o.id){const l=(a.quantity||1)-1;return l<=0?(e(o.id),null):{...a,quantity:l}}return a}).filter(Boolean))},r=o.price>o.final_price?Math.round((o.price-o.final_price)/o.price*100):0;return console.log(o),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("tr",{className:"hidden md:table-row border-b hover:bg-gray-50 transition-colors duration-200 font-font-general",children:[jsxRuntimeExports.jsx("td",{className:"px-6 py-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsxs("div",{className:"relative group",children:[jsxRuntimeExports.jsx("img",{src:`/storage/images/item/${o.image}`,alt:o.name,className:"w-20 h-20 object-cover rounded-xl shadow-md group-hover:shadow-lg transition-shadow duration-200"}),r>0&&jsxRuntimeExports.jsxs("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow",children:["-",r,"%"]})]}),jsxRuntimeExports.jsxs("div",{className:"ml-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm 2xl:text-base font-bold customtext-neutral-dark leading-tight",children:o.name}),jsxRuntimeExports.jsx("div",{className:"text-xs 2xl:text-sm customtext-neutral-dark mt-1 space-y-1",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[jsxRuntimeExports.jsx(Package,{size:12}),jsxRuntimeExports.jsxs("span",{children:["SKU: ",o.sku||o.id]})]})}),jsxRuntimeExports.jsxs("button",{onClick:e,className:"mt-2 inline-flex items-center gap-1 text-red-500 hover:text-red-700 transition-colors duration-200 text-xs font-medium","aria-label":"Remove item",children:[jsxRuntimeExports.jsx(Trash2,{size:14}),"Eliminar"]})]})]})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-4",children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center bg-white border-2 border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:t,className:"p-2 text-gray-600 hover:bg-gray-50 hover:text-gray-800 transition-colors duration-200","aria-label":"Decrease quantity",children:jsxRuntimeExports.jsx(Minus,{size:16})}),jsxRuntimeExports.jsx("div",{className:"w-10 h-10 flex justify-center items-center bg-gray-50 border-x border-gray-200",children:jsxRuntimeExports.jsx("span",{className:"font-bold text-base",children:o.quantity||1})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:s,className:"p-2 text-gray-600 hover:bg-gray-50 hover:text-gray-800 transition-colors duration-200","aria-label":"Increase quantity",children:jsxRuntimeExports.jsx(Plus,{size:16})})]})})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-4 text-center",children:jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[r>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number2Currency(o.price)]}),jsxRuntimeExports.jsxs("div",{className:"font-bold text-base text-gray-900",children:["S/ ",Number2Currency(o.final_price)]}),r>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["Ahorras S/ ",Number2Currency(o.price-o.final_price)]})]})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-4 text-center",children:jsxRuntimeExports.jsxs("div",{className:"font-bold text-lg text-gray-900",children:["S/ ",Number2Currency(o.final_price*o.quantity)]})})]},o.id),jsxRuntimeExports.jsx("div",{className:"md:hidden bg-white border border-gray-200 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-4 mb-4 w-full font-font-general",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3 relative",children:[jsxRuntimeExports.jsxs("div",{className:"relative group",children:[jsxRuntimeExports.jsx("img",{src:`/storage/images/item/${o.image}`,alt:o.name,className:"w-20 h-20 object-cover rounded-xl shadow-md group-hover:shadow-lg transition-shadow duration-200"}),r>0&&jsxRuntimeExports.jsxs("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow",children:["-",r,"%"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-base mb-2 leading-tight customtext-neutral-dark",children:o.name}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-gray-300 bg-gray-100"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-gray-600",children:["Color: ",o.color||"Personalizado"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[jsxRuntimeExports.jsx(Package,{size:12}),jsxRuntimeExports.jsxs("span",{className:"text-xs",children:["SKU: ",o.sku||o.id]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center bg-white border-2 border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 text-gray-600 hover:bg-gray-50 hover:text-gray-800 transition-colors duration-200",children:jsxRuntimeExports.jsx(Minus,{size:14})}),jsxRuntimeExports.jsx("div",{className:"w-8 h-8 flex justify-center items-center bg-gray-50 border-x border-gray-200",children:jsxRuntimeExports.jsx("span",{className:"font-bold text-sm",children:o.quantity||1})}),jsxRuntimeExports.jsx("button",{onClick:s,className:"p-2 text-gray-600 hover:bg-gray-50 hover:text-gray-800 transition-colors duration-200",children:jsxRuntimeExports.jsx(Plus,{size:14})})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[r>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number2Currency(o.price)]}),jsxRuntimeExports.jsxs("div",{className:"font-bold text-base text-gray-900",children:["S/ ",Number2Currency(o.final_price)]}),r>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["Ahorras S/ ",Number2Currency(o.price-o.final_price)]})]})]}),jsxRuntimeExports.jsx("div",{className:"pt-3 border-t border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-lg text-gray-900",children:["S/ ",Number2Currency(o.final_price*o.quantity)]})]})})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"absolute -top-2 -right-2 bg-red-500 text-white p-1.5 rounded-full shadow-lg hover:bg-red-600 transition-colors duration-200","aria-label":"Remove item",children:jsxRuntimeExports.jsx(Trash2,{size:14})})]})})]})};function CartStepSF({cart:c,setCart:o,onContinue:e,subTotal:s,envio:t,igv:r,totalFinal:n,openModal:a}){return!c||c.length===0?jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md w-full text-center",children:[jsxRuntimeExports.jsx("div",{className:"mb-8",children:jsxRuntimeExports.jsx("div",{className:"mx-auto w-32 h-32 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center shadow-lg",children:jsxRuntimeExports.jsx("svg",{className:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0h7M17 13v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6"})})})}),jsxRuntimeExports.jsx("h2",{className:"text-3xl font-bold customtext-neutral-dark mb-4",children:"Tu carrito est√° vac√≠o"}),jsxRuntimeExports.jsx("p",{className:"text-base text-gray-600 mb-8 leading-relaxed",children:"¬°Descubre nuestros incre√≠bles productos y comienza a llenar tu carrito con tus favoritos!"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:jsxRuntimeExports.jsxs(ButtonPrimary,{className:"rounded-2xl xl:rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300 w-full",href:"/",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"Explorar productos"]})})]})}):jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-y-8 md:gap-8",children:[jsxRuntimeExports.jsxs("div",{className:"lg:col-span-3 flex flex-row w-full",children:[jsxRuntimeExports.jsx("div",{className:"hidden md:block overflow-x-auto rounded-2xl shadow-lg border border-gray-200 w-full",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full divide-y divide-gray-200 bg-white",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:jsxRuntimeExports.jsxs("tr",{className:"!font-font-general",children:[jsxRuntimeExports.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-sm 2xl:text-base font-bold customtext-neutral-dark",children:"Producto"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"px-6 py-4 text-center text-sm 2xl:text-base font-bold customtext-neutral-dark",children:"Cantidad"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"px-6 py-4 text-center text-sm 2xl:text-base font-bold customtext-neutral-dark",children:"Precio"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"px-6 py-4 text-center text-sm 2xl:text-base font-bold customtext-neutral-dark",children:"Subtotal"})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:c.map((l,i)=>jsxRuntimeExports.jsx(CardItemSF,{...l,setCart:o},i))})]})}),jsxRuntimeExports.jsx("div",{className:"md:hidden space-y-4 w-full",children:c.map((l,i)=>jsxRuntimeExports.jsx(CardItemSF,{...l,setCart:o},i))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl border border-gray-200 p-8 col-span-2 h-max font-font-general",children:[jsxRuntimeExports.jsxs("h3",{className:"text-2xl 2xl:text-3xl font-bold pb-6 customtext-neutral-dark flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-primary rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),"Resumen de compra"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 py-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-1",children:[jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark text-base 2xl:text-base",children:["Subtotal (",c.length," ",c.length===1?"producto":"productos",")"]}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-base 2xl:text-xl",children:["S/ ",Number2Currency(s)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-1",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark text-base 2xl:text-base",children:"IGV (18%)"}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-base 2xl:text-xl",children:["S/ ",Number2Currency(r)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-1",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark text-base 2xl:text-base",children:"Env√≠o"})}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-base 2xl:text-xl",children:["S/ ",Number2Currency(t)]})]})]}),jsxRuntimeExports.jsx("div",{className:"py-4 border-y-2 border-primary/20 bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg ",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-2xl 2xl:text-2xl items-center",children:[jsxRuntimeExports.jsx("span",{className:"customtext-primary",children:"Total"}),jsxRuntimeExports.jsxs("span",{className:"customtext-primary",children:["S/ ",Number2Currency(n)]})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 pt-6",children:[jsxRuntimeExports.jsx(ButtonPrimary,{className:"rounded-2xl py-4 xl:rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300",onClick:e,children:"Continuar compra"}),jsxRuntimeExports.jsx(ButtonSecondary,{className:"rounded-2xl py-4 xl:rounded-3xl",href:"/",children:"Seguir comprando"})]}),jsxRuntimeExports.jsx("div",{className:"pt-4",children:jsxRuntimeExports.jsx("div",{className:"  rounded-xl ",children:jsxRuntimeExports.jsx("div",{className:"flex items-start gap-3",children:jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-dark leading-relaxed",children:["Al realizar tu pedido, aceptas los"," ",jsxRuntimeExports.jsx("button",{onClick:()=>a&&a(1),className:"customtext-primary font-bold hover:underline cursor-pointer",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos tus datos personales de acuerdo con nuestra"," ",jsxRuntimeExports.jsx("button",{onClick:()=>a&&a(0),className:"customtext-primary font-bold hover:underline cursor-pointer",children:"Pol√≠tica de Privacidad"}),"."]})})})})})]})]})}const processMercadoPagoPayment=c=>new Promise(async(o,e)=>{try{console.log("Datos para MercadoPago:",c);const{status:s,result:t}=await mainExports.Fetch("./api/mercadopago/preference",{method:"POST",body:JSON.stringify(c)});if(!s||!t.preference_id){mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(t==null?void 0:t.message)||"Error al crear la preferencia de pago",type:"danger"}),e((t==null?void 0:t.message)||"Error al crear la preferencia de pago");return}console.log("‚úÖ Preferencia creada:",t);const r=new window.MercadoPago(t.public_key,{locale:"es-PE"});setTimeout(()=>{window.location.href=t.redirect_url},500),o(t)}catch(s){console.error("Error en processMercadoPagoPayment:",s),mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:s.message||"Error en la integraci√≥n con MercadoPago",type:"danger"}),e(s.message||"Error en la integraci√≥n con MercadoPago")}});function PaymentModal({isOpen:c,onClose:o,onPaymentComplete:e,contacts:s}){const[t,r]=reactExports.useState(null),[n,a]=reactExports.useState(!1);reactExports.useEffect(()=>{c||(a(!1),r(null))},[c]);const l=()=>{t&&(a(!0),e(t))},i=n||!t,x=s.find(h=>h.correlative==="checkout_mercadopago");return jsxRuntimeExports.jsx(ReactModal,{isOpen:c,onRequestClose:o,className:"absolute left-1/2 -translate-x-1/2 bg-white rounded-2xl shadow-lg w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[jsxRuntimeExports.jsx("div",{className:"hidden md:block bg-[#f8f5f2] h-full",children:jsxRuntimeExports.jsx("img",{src:"/assets/bananalab_app/portadapagos.png",alt:"M√©todos de pago",className:"h-full w-full object-cover"})}),jsxRuntimeExports.jsxs("div",{className:"p-6 max-h-[90vh] md:max-h-[100vh] flex flex-col justify-center ",children:[jsxRuntimeExports.jsxs("div",{className:"mb-0 md:mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl md:text-2xl 2xl:text-3xl font-bold customtext-primary",children:"¬øC√≥mo deseas pagar tu pedido?"}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm 2xl:text-base",children:"Elige una de las opciones disponibles para completar tu pago de forma segura."})]}),(x==null?void 0:x.description)!=="true"&&General.get("checkout_dwallet")!=="true"&&General.get("checkout_transfer")!=="true"?jsxRuntimeExports.jsx("div",{className:"text-gray-500 text-center py-4",children:"Sin opciones de pago"}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"mt-3 space-y-3",children:[(x==null?void 0:x.description)=="true"&&jsxRuntimeExports.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${t==="tarjeta"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>r("tarjeta"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"tarjeta",name:"paymentMethod",checked:t==="tarjeta",onChange:()=>r("tarjeta"),className:"h-5 w-5 customtext-primary focus:ring-primary hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"tarjeta",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta"}),jsxRuntimeExports.jsx("p",{className:"customtext-primary text-sm 2xl:text-base ml-7 mt-1",children:"Renueva tus espacios con estilo: Fundas exclusivas para cada temporada."})]}),jsxRuntimeExports.jsx("div",{className:"min-w-5 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${t==="tarjeta"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:jsxRuntimeExports.jsx("div",{className:`h-2 w-2 rounded-full ${t==="tarjeta"?"bg-white":""}`})})})]})}),General.get("checkout_dwallet")=="true"&&jsxRuntimeExports.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${t==="yape"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>r("yape"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"yape",name:"paymentMethod",checked:t==="yape",onChange:()=>r("yape"),className:"h-5 w-5 customtext-primary focus:ring-primary hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"yape",className:"font-medium text-base 2xl:text-lg",children:"Yape / Plin"}),jsxRuntimeExports.jsx("p",{className:"customtext-primary text-sm 2xl:text-base ml-7 mt-1",children:"Realiza el pago desde tu celular sin comisiones."})]}),jsxRuntimeExports.jsx("div",{className:"min-w-5 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${t==="yape"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:jsxRuntimeExports.jsx("div",{className:`h-2 w-2 rounded-full ${t==="yape"?"bg-white":""}`})})})]})}),General.get("checkout_transfer")=="true"&&jsxRuntimeExports.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${t==="transferencia"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>r("transferencia"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"transferencia",name:"paymentMethod",checked:t==="transferencia",onChange:()=>r("transferencia"),className:"h-5 w-5 customtext-primary focus:ring-primary hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"transferencia",className:"font-medium text-base 2xl:text-lg",children:"Pago por Transferencia"}),jsxRuntimeExports.jsx("p",{className:"customtext-primary text-sm 2xl:text-base ml-7 mt-1",children:"Haz una transferencia bancaria desde tu app o banca por internet."})]}),jsxRuntimeExports.jsx("div",{className:"min-w-5 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${t==="transferencia"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:jsxRuntimeExports.jsx("div",{className:`h-2 w-2 rounded-full ${t==="transferencia"?"bg-white":""}`})})})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-4 space-y-3",children:[((x==null?void 0:x.description)==="true"||General.get("checkout_dwallet")==="true"||General.get("checkout_transfer")==="true")&&jsxRuntimeExports.jsx("button",{className:`w-full bg-primary hover:bg-primary hover:scale-105 transition-all duration-300 text-white py-3 rounded-3xl text-base 2xl:text-lg leading-normal font-medium 
                            ${i?"opacity-70 cursor-not-allowed":""}`,onClick:l,disabled:n,children:n?"Procesando...":"Confirmar pago"}),jsxRuntimeExports.jsx("button",{className:"w-full border border-primary text-primary hover:bg-[#f8f5f2] py-3 text-base 2xl:text-lg leading-normal rounded-3xl font-medium transition-colors",onClick:o,disabled:n,children:"Volver"})]})]})]})})}function ShippingStepSF({cart,setSale,setCode,setDelivery,setCart,onContinue,noContinue,subTotal,igv,totalFinal,user,setEnvio,envio,prefixes,ubigeos=[],contacts,totalPrice,descuentofinal,setDescuentoFinal,data,openModal,setCouponDiscount:setParentCouponDiscount,setCouponCode:setParentCouponCode,automaticDiscounts=[],automaticDiscountTotal=0,totalWithoutDiscounts,conversionScripts,setConversionScripts,onPurchaseComplete}){var c,o;const formatPhoneNumber=(e,s)=>s?s.startsWith(e)?s:`${e}${s}`:"",cleanPhoneNumber=(e,s)=>e?e.startsWith(s)?e.substring(s.length):e:"";reactExports.useRef(null);const[coupon,setCoupon]=reactExports.useState(null),[selectedUbigeo,setSelectedUbigeo]=reactExports.useState(null),[defaultUbigeoOption,setDefaultUbigeoOption]=reactExports.useState(null),[autoDiscounts,setAutoDiscounts]=reactExports.useState([]),[autoDiscountTotal,setAutoDiscountTotal]=reactExports.useState(0);autoDiscounts.reduce((e,s)=>s.free_items&&Array.isArray(s.free_items)?e.concat(s.free_items):e,[]);const calculateAutomaticDiscounts=async(e,s)=>{if(!e||e.length===0)return{discounts:[],total:0};try{console.log("üîÑ ShippingStepSF: Calculating automatic discounts...",{cart:e,totalWithoutDiscounts});const t=await DiscountRulesRest.applyToCart(e,totalWithoutDiscounts);if(t.success&&t.data){const r=DiscountRulesRest.formatDiscounts(t.data.applied_discounts),n=t.data.total_discount||0;return console.log("‚úÖ ShippingStepSF: Automatic discounts calculated",{discounts:r,discountAmount:n,freeItems:t.data.free_items}),{discounts:t.data.applied_discounts,total:n}}}catch(t){console.error("‚ùå Error calculating automatic discounts:",t)}return{discounts:[],total:0}};reactExports.useEffect(()=>{cart&&cart.length>0&&totalWithoutDiscounts?calculateAutomaticDiscounts(cart).then(e=>{setAutoDiscounts(e.discounts),setAutoDiscountTotal(e.total)}):(setAutoDiscounts([]),setAutoDiscountTotal(0))},[cart,automaticDiscounts,totalWithoutDiscounts]);const[formData,setFormData]=reactExports.useState(()=>{var t;const e=(user==null?void 0:user.phone_prefix)||"51",s=cleanPhoneNumber((user==null?void 0:user.phone)||"",e);return{name:(user==null?void 0:user.name)||"",lastname:(user==null?void 0:user.lastname)||"",email:(user==null?void 0:user.email)||"",phone_prefix:e,phone:s,documentType:((t=user==null?void 0:user.document_type)==null?void 0:t.toLowerCase())||"dni",document:(user==null?void 0:user.document_number)||"",department:(user==null?void 0:user.department)||"",province:(user==null?void 0:user.province)||"",district:(user==null?void 0:user.district)||"",address:(user==null?void 0:user.address)||"",number:(user==null?void 0:user.number)||"",comment:(user==null?void 0:user.comment)||"",reference:(user==null?void 0:user.reference)||"",shippingOption:"delivery",ubigeo:(user==null?void 0:user.ubigeo)||null,invoiceType:(user==null?void 0:user.invoiceType)||"boleta",businessName:(user==null?void 0:user.businessName)||""}});reactExports.useEffect(()=>{if(user){const e=user.phone_prefix||"51",s=cleanPhoneNumber(user.phone||"",e);setFormData(t=>{var r;return{...t,name:user.name||"",lastname:user.lastname||"",email:user.email||"",phone_prefix:e,phone:s,documentType:((r=user.document_type)==null?void 0:r.toLowerCase())||"dni",document:user.document_number||"",department:user.department||"",province:user.province||"",district:user.district||"",address:user.address||"",number:user.number||"",comment:user.comment||"",reference:user.reference||"",ubigeo:user.ubigeo||null,invoiceType:user.invoiceType||"boleta",businessName:user.businessName||""}})}},[user]),reactExports.useEffect(()=>{if(user!=null&&user.ubigeo&&(user!=null&&user.district)&&(user!=null&&user.province)&&(user!=null&&user.department)){const e={value:user.ubigeo,label:`${user.district}, ${user.province}, ${user.department}`,data:{reniec:user.ubigeo,departamento:user.department,provincia:user.province,distrito:user.district}};setDefaultUbigeoOption(e),setSelectedUbigeo(e),handleUbigeoChange(e)}},[user]);const getContact=e=>{var s;return((s=contacts.find(t=>t.correlative===e))==null?void 0:s.description)||""},handleChange=e=>{const{name:s,value:t}=e.target;setFormData(r=>({...r,[s]:t})),s==="invoiceType"&&setFormData(r=>({...r,documentType:t==="factura"?"ruc":"dni",document:"",businessName:t==="factura"?r.businessName:""}))},[loading,setLoading]=reactExports.useState(!1),[paymentLoading,setPaymentLoading]=reactExports.useState(!1),[shippingOptions,setShippingOptions]=reactExports.useState([]),[selectedOption,setSelectedOption]=reactExports.useState(null),[costsGet,setCostsGet]=reactExports.useState(null),[errors,setErrors]=reactExports.useState({}),[searchInput,setSearchInput]=reactExports.useState(""),[expandedCharacteristics,setExpandedCharacteristics]=reactExports.useState(!1),[couponCode,setCouponCode]=reactExports.useState(""),[appliedCoupon,setAppliedCoupon]=reactExports.useState(null),[couponDiscount,setCouponDiscount]=reactExports.useState(0),[couponLoading,setCouponLoading]=reactExports.useState(!1),[couponError,setCouponError]=reactExports.useState(""),[selectedStore,setSelectedStore]=reactExports.useState(null),[showStoreSelector,setShowStoreSelector]=reactExports.useState(!1),[showLoginModal,setShowLoginModal]=reactExports.useState(!1),numericSubTotal=typeof subTotal=="number"?subTotal:parseFloat(subTotal)||0,numericIgv=typeof igv=="number"?igv:parseFloat(igv)||0,hasShippingFree=parseFloat(getContact("shipping_free")),subFinal=numericSubTotal+numericIgv-descuentofinal-autoDiscountTotal,validateForm=()=>{const e={};return formData.name||(e.name="Nombre es requerido"),formData.lastname||(e.lastname="Apellido es requerido"),formData.email||(e.email="Email es requerido"),formData.phone||(e.phone="Tel√©fono es requerido"),formData.ubigeo||(e.ubigeo="Ubicaci√≥n es requerida"),formData.address||(e.address="Direcci√≥n es requerida"),formData.number||(e.number="N√∫mero es requerido"),formData.document||(e.document="Documento es requerido"),formData.email&&!/\S+@\S+\.\S+/.test(formData.email)&&(e.email="Email inv√°lido"),formData.document&&(formData.documentType==="dni"&&formData.document.length!==8?e.document="DNI debe tener 8 d√≠gitos":formData.documentType==="ruc"&&formData.document.length!==11&&(e.document="RUC debe tener 11 d√≠gitos")),formData.invoiceType==="factura"&&!formData.businessName&&(e.businessName="Raz√≥n social es requerida para factura"),setErrors(e),Object.keys(e).length===0},focusFirstError=e=>{const s=Object.keys(e)[0];setTimeout(()=>{var r;let t=null;s==="ubigeo"?t=document.getElementById("ubigeo-select-container"):s==="phone_prefix"?t=(r=document.querySelector(".select2-prefix-selector"))==null?void 0:r.parentElement:t=document.querySelector(`[name="${s}"]`),t&&(highlightElement(t),t.scrollIntoView({behavior:"smooth",block:"center"}),["INPUT","SELECT","TEXTAREA"].includes(t.tagName)&&t.focus())},100)},highlightElement=e=>{e.classList.add("highlight-error"),setTimeout(()=>e.classList.remove("highlight-error"),2e3)},handleUbigeoChange=async e=>{var t;if(!e)return;setErrors(r=>({...r,ubigeo:""}));const{data:s}=e;console.log("data",s),setFormData(r=>({...r,department:s.departamento,province:s.provincia,district:s.distrito,ubigeo:s.reniec||s.inei})),setLoading(!0);try{const r=await DeliveryPricesRest.getShippingCost({ubigeo:s.reniec||s.inei}),n=[],a=subFinal>=hasShippingFree;if(a?n.push({type:"free",price:0,description:`Compra mayor a S/ ${hasShippingFree}`,deliveryType:"Env√≠o gratuito"}):r.data.is_free?n.push({type:"free",price:0,description:r.data.standard.description,deliveryType:r.data.standard.type,characteristics:r.data.standard.characteristics}):r.data.is_agency?n.push({type:"agency",price:0,description:r.data.agency.description,deliveryType:r.data.agency.type,characteristics:r.data.agency.characteristics}):n.push({type:"standard",price:r.data.standard.price,description:r.data.standard.description,deliveryType:r.data.standard.type,characteristics:r.data.standard.characteristics}),((t=r.data.express)==null?void 0:t.price)>0&&r.data.is_free&&!a&&n.push({type:"express",price:r.data.express.price,description:r.data.express.description,deliveryType:r.data.express.type,characteristics:r.data.express.characteristics}),n.length===0)throw new Error("No hay opciones de env√≠o disponibles");setShippingOptions(n),setSelectedOption(n[0].type),setEnvio(n[0].price)}catch(r){console.error("Error al obtener precios de env√≠o:",r),toast.success("Sin cobertura",{description:"No realizamos env√≠os a esta ubicaci√≥n",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"}),setShippingOptions([]),setSelectedOption(null),setEnvio(0)}setLoading(!1)};reactExports.useEffect(()=>{selectedUbigeo&&handleUbigeoChange(selectedUbigeo)},[cart,subTotal,descuentofinal]);const loadOptions=reactExports.useCallback(lodashExports.debounce((e,s)=>{if(e.length<3){s([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(e)}`).then(t=>{if(!t.ok)throw new Error("Error en la respuesta");return t.json()}).then(t=>{const r=t.map(n=>({value:n.reniec,label:`${n.distrito}, ${n.provincia}, ${n.departamento}`,data:{inei:n.inei,reniec:n.reniec,departamento:n.departamento,provincia:n.provincia,distrito:n.distrito}}));s(r)}).catch(t=>{console.error("Error:",t),s([])})},300),[]);reactExports.useEffect(()=>{const e=s=>{const t=s.element.dataset.code,r=s.element.dataset.flag;return server_browserExports.renderToString(jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("span",{className:"inline-block w-8 font-emoji text-center",children:r}),jsxRuntimeExports.jsx("b",{className:"me-1",children:s.text}),jsxRuntimeExports.jsx("span",{className:"text-sm text-opacity-20",children:t})]}))};$(".select2-prefix-selector").select2({dropdownCssClass:"py-1",containerCssClass:"!border !border-gray-300 !rounded p-2 !h-[42px]",arrowCssClass:'!text-primary top-1/2 -translate-y-1/2"',templateResult:function(s){if(!s.id)return s.text;var t=$(e(s));return t},templateSelection:function(s){if(!s.id)return s.text;var t=$(e(s));return t},matcher:function(s,t){if(!s.term||!t.element)return t;const r=t.element.dataset.country||"",n=t.text||"";return r.toLowerCase().includes(s.term.toLowerCase())||n.toLowerCase().includes(s.term.toLowerCase())?t:null}})},[formData.phone_prefix]);const[showPaymentModal,setShowPaymentModal]=reactExports.useState(!1),[showVoucherModal,setShowVoucherModal]=reactExports.useState(!1),[showVoucherModalBancs,setShowVoucherModalBancs]=reactExports.useState(!1),[currentPaymentMethod,setCurrentPaymentMethod]=reactExports.useState(null),[paymentRequest,setPaymentRequest]=reactExports.useState(null),handleContinueClick=e=>{if(e.preventDefault(),e&&e.preventDefault&&e.preventDefault(),!user){setShowLoginModal(!0);return}if(!validateForm()){focusFirstError(errors);return}if(!selectedOption){toast.error("Seleccione env√≠o",{description:"Debe elegir un m√©todo de env√≠o",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"});return}setShowPaymentModal(!0)},handlePaymentComplete=async paymentMethod=>{try{if(setShowPaymentModal(!1),setCurrentPaymentMethod(paymentMethod),paymentMethod==="tarjeta"){if(console.log("üõí ShippingStepSF: Sending cart to MercadoPago:",cart),!window.MercadoPago){console.error("‚ùå MercadoPago a√∫n no se ha cargado.");return}const selectedShippingOption=shippingOptions.find(e=>e.type===selectedOption),deliveryType=selectedShippingOption?selectedShippingOption.deliveryType:"domicilio",request={user_id:(user==null?void 0:user.id)||"",name:(formData==null?void 0:formData.name)||"",lastname:(formData==null?void 0:formData.lastname)||"",fullname:`${formData==null?void 0:formData.name} ${formData==null?void 0:formData.lastname}`,phone_prefix:(formData==null?void 0:formData.phone_prefix)||"51",email:(formData==null?void 0:formData.email)||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"Per√∫",department:(formData==null?void 0:formData.department)||"",province:(formData==null?void 0:formData.province)||"",district:(formData==null?void 0:formData.district)||"",ubigeo:(formData==null?void 0:formData.ubigeo)||"",address:(formData==null?void 0:formData.address)||"",number:(formData==null?void 0:formData.number)||"",comment:(formData==null?void 0:formData.comment)||"",reference:(formData==null?void 0:formData.reference)||"",amount:totalPrice||0,delivery:envio,delivery_type:deliveryType,cart,invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,total_amount:finalTotalWithCoupon||0};try{const response=await processMercadoPagoPayment(request),data=response;data.status?(setSale(data.sale),setDelivery(data.delivery),setCode(data.code),conversionScripts&&Array.isArray(conversionScripts)&&conversionScripts.forEach(script=>{try{eval(script)}catch(e){console.error("Error executing conversion script:",e)}}),onPurchaseComplete&&onPurchaseComplete(data)):toast.error("Error en el Pago",{description:"El pago ha sido rechazado",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(e){console.log(e),toast.error("Error en el Pago",{description:"No se lleg√≥ a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}}else if(paymentMethod==="yape"){console.log("üõí ShippingStepSF: Sending cart details for Yape:",cart),console.log("üîç Cart items with project data:",cart.map(r=>({id:r.id,name:r.name,has_project_id:!!r.project_id,has_canvas_project_id:!!r.canvas_project_id,project_id:r.project_id,canvas_project_id:r.canvas_project_id})));const e=shippingOptions.find(r=>r.type===selectedOption),s=e?e.deliveryType:"domicilio",t={user_id:(user==null?void 0:user.id)||"",name:(formData==null?void 0:formData.name)||"",lastname:(formData==null?void 0:formData.lastname)||"",fullname:`${formData==null?void 0:formData.name} ${formData==null?void 0:formData.lastname}`,phone_prefix:(formData==null?void 0:formData.phone_prefix)||"51",email:(formData==null?void 0:formData.email)||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"Per√∫",department:(formData==null?void 0:formData.department)||"",province:(formData==null?void 0:formData.province)||"",district:(formData==null?void 0:formData.district)||"",ubigeo:(formData==null?void 0:formData.ubigeo)||"",address:(formData==null?void 0:formData.address)||"",number:(formData==null?void 0:formData.number)||"",comment:(formData==null?void 0:formData.comment)||"",reference:(formData==null?void 0:formData.reference)||"",amount:totalPrice||0,delivery:envio,delivery_type:s,details:JSON.stringify(cart.map(r=>({id:r.id,quantity:r.quantity,project_id:r.project_id||null,canvas_project_id:r.canvas_project_id||null}))),invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,payment_proof:null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,total_amount:finalTotalWithCoupon||0};console.log("üì§ Request creado para Yape:",t),console.log("üìù Details en request:",t.details),setPaymentRequest(t),setShowVoucherModal(!0)}else if(paymentMethod==="transferencia"){console.log("üõí ShippingStepSF: Sending cart details for transferencia:",cart);const e=shippingOptions.find(r=>r.type===selectedOption),s=e?e.deliveryType:"domicilio",t={user_id:(user==null?void 0:user.id)||"",name:(formData==null?void 0:formData.name)||"",lastname:(formData==null?void 0:formData.lastname)||"",fullname:`${formData==null?void 0:formData.name} ${formData==null?void 0:formData.lastname}`,phone_prefix:(formData==null?void 0:formData.phone_prefix)||"51",email:(formData==null?void 0:formData.email)||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"Per√∫",department:(formData==null?void 0:formData.department)||"",province:(formData==null?void 0:formData.province)||"",district:(formData==null?void 0:formData.district)||"",ubigeo:(formData==null?void 0:formData.ubigeo)||"",address:(formData==null?void 0:formData.address)||"",number:(formData==null?void 0:formData.number)||"",comment:(formData==null?void 0:formData.comment)||"",reference:(formData==null?void 0:formData.reference)||"",amount:totalPrice||0,delivery:envio,delivery_type:s,details:JSON.stringify(cart.map(r=>({id:r.id,quantity:r.quantity,project_id:r.project_id||null,canvas_project_id:r.canvas_project_id||null}))),invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,payment_proof:null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,total_amount:finalTotalWithCoupon||0};setPaymentRequest(t),setShowVoucherModalBancs(!0)}}catch(e){console.error("Error en el pago:",e),toast.error("Error en el Pago",{description:"No se lleg√≥ a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}};reactExports.useEffect(()=>{setErrors(e=>{const s={...e};return Object.keys(formData).forEach(t=>{formData[t]&&delete s[t]}),s})},[formData]);const validateCoupon=async()=>{var e,s;if(!couponCode.trim()){setCouponError("Ingrese un c√≥digo de cup√≥n");return}setCouponLoading(!0),setCouponError("");try{couponCode.toUpperCase()==="TEST50"&&subTotal<100&&toast.warning("Informaci√≥n importante",{description:`El cup√≥n TEST50 requiere un monto m√≠nimo de S/ 100.00. Tu carrito actual: S/ ${Number2Currency(subTotal)}`,icon:jsxRuntimeExports.jsx(TriangleAlert,{className:"h-5 w-5 text-yellow-500"}),duration:5e3,position:"bottom-center"});const t=[...new Set(cart.map(l=>l.category_id).filter(Boolean))],r=[...new Set(cart.map(l=>l.id||l.item_id).filter(Boolean))];console.log("Validando cup√≥n:",{code:couponCode.trim(),cart_total:subTotal,category_ids:t,product_ids:r});const n=await CouponsRest.validateCoupon({code:couponCode.trim(),cart_total:subTotal,category_ids:t,product_ids:r});console.log("Respuesta del cup√≥n:",n);const a=n.data||n;if(a&&a.valid){setAppliedCoupon(a.coupon);const l=Math.round(a.discount*100)/100;setCouponDiscount(l),setCouponCode(""),setParentCouponCode&&setParentCouponCode(a.coupon.code),setParentCouponDiscount&&setParentCouponDiscount(l),toast.success("Cup√≥n aplicado",{description:`Descuento de S/ ${Number2Currency(l)} aplicado`,icon:jsxRuntimeExports.jsx(CircleCheckBig,{className:"h-5 w-5 text-green-500"}),duration:3e3,position:"bottom-center"})}else{const l=(a==null?void 0:a.message)||"Cup√≥n inv√°lido o no aplicable a estos productos";setCouponError(l);let i=l;l.includes("monto m√≠nimo")&&(i=`${l} Tu carrito actual: S/ ${Number2Currency(subTotal)}`),toast.error("Cup√≥n inv√°lido",{description:i,icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"bottom-center"})}}catch(t){console.error("Error validating coupon:",t);const r=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Error al validar el cup√≥n";setCouponError(r),toast.error("Error de validaci√≥n",{description:r,icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{setCouponLoading(!1)}},removeCoupon=()=>{setAppliedCoupon(null),setCouponCode(""),setCouponDiscount(0),setCouponError(""),setParentCouponCode&&setParentCouponCode(""),setParentCouponDiscount&&setParentCouponDiscount(0),toast.success("Cup√≥n removido",{description:"El cup√≥n ha sido removido del pedido",icon:jsxRuntimeExports.jsx(Info,{className:"h-5 w-5 text-blue-500"}),duration:2e3,position:"bottom-center"})},roundToTwoDecimals=e=>Math.round((parseFloat(e)+Number.EPSILON)*100)/100,totalBase=roundToTwoDecimals(subTotal)+roundToTwoDecimals(igv)+roundToTwoDecimals(envio)-roundToTwoDecimals(autoDiscountTotal);let calculatedCouponDiscount=couponDiscount||0;reactExports.useEffect(()=>{setParentCouponDiscount&&setParentCouponDiscount(calculatedCouponDiscount)},[appliedCoupon,couponDiscount,setParentCouponDiscount]);const finalTotalWithCoupon=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),LoginModal=()=>jsxRuntimeExports.jsx(ReactModal,{isOpen:showLoginModal,onRequestClose:()=>setShowLoginModal(!1),className:"modal-content max-w-md mx-auto mt-20 bg-white rounded-lg p-6",overlayClassName:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Iniciar Sesi√≥n Requerido"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"Debe iniciar sesi√≥n para continuar con su compra"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4 justify-center",children:[jsxRuntimeExports.jsx("button",{onClick:()=>setShowLoginModal(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancelar"}),jsxRuntimeExports.jsx("button",{onClick:()=>{setShowLoginModal(!1),window.location.href="/login"},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Iniciar Sesi√≥n"})]})]})}),selectStyles=e=>({control:s=>({...s,border:`1px solid ${e?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:e?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:s=>({...s,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:s=>({...s,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})});return reactExports.useEffect(()=>{if(coupon){let e=0;coupon.type==="percentage"?e=totalPrice*(coupon.amount/100):e=coupon.amount,setDescuentoFinal(e)}else setDescuentoFinal(0)},[totalPrice,coupon]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{jsx:!0,children:`
                .highlight-error {
                    animation: highlight 2s ease-in-out;
                    border: 2px solid #ef4444 !important;
                    box-shadow: 0 0 10px rgba(239, 68, 68, 0.3) !important;
                }
                
                @keyframes highlight {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.02); }
                    100% { transform: scale(1); }
                }
                
                .modal-overlay {
                    z-index: 9999;
                }
                
                .modal-content {
                    max-height: 90vh;
                    overflow-y: auto;
                }
            `}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-y-8 lg:gap-8 ",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-3",children:jsxRuntimeExports.jsxs("form",{className:"space-y-6 bg-[#f9f9f9] py-6 px-4 sm:px-6 rounded-2xl font-font-general",onSubmit:e=>e.preventDefault(),children:[jsxRuntimeExports.jsxs("div",{className:"sectionInformation space-y-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark ",children:"Informaci√≥n del contacto"}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(InputForm,{type:"text",label:"Nombres",name:"name",value:formData.name,error:errors.name,onChange:handleChange,placeholder:"Nombres",required:!0}),jsxRuntimeExports.jsx(InputForm,{label:"Apellidos",type:"text",name:"lastname",value:formData.lastname,error:errors.lastname,onChange:handleChange,placeholder:"Apellidos",required:!0})]}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 ",children:[jsxRuntimeExports.jsx(InputForm,{label:"Correo electr√≥nico",type:"email",name:"email",value:formData.email,error:errors.email,onChange:handleChange,placeholder:"Ej. hola@gmail.com",required:!0}),jsxRuntimeExports.jsxs("div",{className:"w-full",children:[jsxRuntimeExports.jsxs("label",{htmlFor:"phone",className:"block text-sm 2xl:text-base mb-1 customtext-neutral-dark",children:["Celular ",jsxRuntimeExports.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 w-full",children:[jsxRuntimeExports.jsx("div",{className:"max-w-[120px]",children:jsxRuntimeExports.jsx(StateManagedSelect$1,{name:"phone_prefix",value:prefixes.find(e=>e.realCode===formData.phone_prefix)?{value:prefixes.find(e=>e.realCode===formData.phone_prefix).realCode,label:`${prefixes.find(e=>e.realCode===formData.phone_prefix).beautyCode}`,flag:prefixes.find(e=>e.realCode===formData.phone_prefix).flag,code:prefixes.find(e=>e.realCode===formData.phone_prefix).beautyCode,country:prefixes.find(e=>e.realCode===formData.phone_prefix).country}:null,onChange:e=>setFormData(s=>({...s,phone_prefix:(e==null?void 0:e.value)||""})),options:prefixes.sort((e,s)=>e.country.localeCompare(s.country)).map(e=>({value:e.realCode,label:e.beautyCode,flag:e.flag,code:e.beautyCode,country:e.country})),formatOptionLabel:({flag:e,code:s,country:t})=>{var x,h;const r=prefixes.find(j=>j.country===t),n=((h=(x=r==null?void 0:r.isoCode)==null?void 0:x.ISO1)==null?void 0:h.toLowerCase())||t.toLowerCase().substring(0,2),a=[`https://flagsapi.com/${n.toUpperCase()}/flat/24.png`,`https://flagcdn.com/${n}.svg`,`https://purecatamphetamine.github.io/country-flag-icons/3x2/${n.toUpperCase()}.svg`,`https://cdn.jsdelivr.net/gh/hampusborgos/country-flags@main/svg/${n}.svg`,`https://raw.githubusercontent.com/lipis/flag-icons/main/flags/4x3/${n}.svg`];let l=0;const i=j=>{if(l++,l<a.length)j.target.src=a[l];else{j.target.style.display="none";const m=j.target.nextElementSibling;m&&m.classList.contains("flag-fallback")&&(m.style.display="flex")}};return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("img",{src:a[0],alt:`Bandera de ${t}`,className:"w-6 h-4 object-cover rounded-sm flex-shrink-0 border border-gray-200",onError:i,style:{minWidth:"24px",minHeight:"16px"}}),jsxRuntimeExports.jsx("div",{className:"flag-fallback w-6 h-4 bg-gray-200 rounded-sm flex items-center justify-center flex-shrink-0 border border-gray-300",style:{display:"none",minWidth:"24px",minHeight:"16px"},children:jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-500",children:n.toUpperCase()})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-sm",children:s})]})},placeholder:"Pa√≠s",isClearable:!1,isSearchable:!0,styles:{control:e=>({...e,minHeight:"48px",border:"1px solid #d1d5db",borderRadius:"0.75rem",fontSize:"14px","&:hover":{borderColor:"#9ca3af"},"&:focus-within":{borderColor:"#3b82f6",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.1)"}}),option:(e,s)=>({...e,backgroundColor:s.isSelected?"#3b82f6":s.isFocused?"#f3f4f6":"white",color:s.isSelected?"white":"#374151",padding:"8px 12px"}),singleValue:e=>({...e,display:"flex",alignItems:"center",gap:"6px"}),menu:e=>({...e,zIndex:9999})},filterOption:(e,s)=>e.data.country.toLowerCase().includes(s.toLowerCase())||e.data.code.toLowerCase().includes(s.toLowerCase())})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx(InputForm,{type:"text",id:"phone",name:"phone",value:formData.phone,error:errors.phone,onChange:handleChange,placeholder:"000 000 000"})})]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),jsxRuntimeExports.jsxs("div",{className:"sectionDelivery space-y-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark",children:"Direcci√≥n de env√≠o"}),jsxRuntimeExports.jsxs("div",{id:"ubigeo-select-container",className:"form-group",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm 2xl:text-base mb-1 customtext-neutral-dark ",children:"Ubicaci√≥n de entrega (Distrito)"}),jsxRuntimeExports.jsx(AsyncSelect$1,{name:"ubigeo",cacheOptions:!0,value:selectedUbigeo,loadOptions,onChange:e=>{setSelectedUbigeo(e),handleUbigeoChange(e)},placeholder:"Buscar por distrito | provincia | departamento ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:e})=>e.length<3?"Ingrese al menos 3 caracteres...":"No se encontraron resultados",isLoading:loading,styles:selectStyles(!!errors.ubigeo),formatOptionLabel:({data:e})=>jsxRuntimeExports.jsxs("div",{className:"text-sm py-1",children:[jsxRuntimeExports.jsx("div",{className:"font-medium",children:e.distrito}),jsxRuntimeExports.jsxs("div",{className:"text-gray-500",children:[e.provincia,", ",e.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0,components:{ClearIndicator:e=>jsxRuntimeExports.jsx("div",{...e.innerProps,className:"p-1 cursor-pointer",children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-400 hover:text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}}),errors.ubigeo&&jsxRuntimeExports.jsx("div",{className:"text-red-500 text-sm mt-1",children:errors.ubigeo})]}),jsxRuntimeExports.jsx(InputForm,{label:"Avenida / Calle / Jir√≥n",type:"text",name:"address",value:formData.address,error:errors.address,onChange:handleChange,placeholder:"Ingresa el nombre de la calle",required:!0}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(InputForm,{label:"N√∫mero",type:"text",name:"number",value:formData.number,error:errors.number,onChange:handleChange,placeholder:"Ingresa el n√∫mero de la calle",required:!0}),jsxRuntimeExports.jsx(InputForm,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque",type:"text",name:"comment",value:formData.comment,onChange:handleChange,placeholder:"Ej. Casa 3, Dpto 101"})]}),shippingOptions.length>0&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark",children:"M√©todo de env√≠o"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-4",children:shippingOptions.map(e=>jsxRuntimeExports.jsx(OptionCard,{title:(e.type==="free"||e.type==="express"||e.type==="agency",e.deliveryType),price:e.price,description:e.description,selected:selectedOption===e.type,onSelect:()=>{setSelectedOption(e.type),setEnvio(e.price)}},e.type))}),console.log(shippingOptions.find(e=>e.type===selectedOption)),selectedOption&&shippingOptions.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-4 mt-4",children:(o=(c=shippingOptions.find(e=>e.type===selectedOption))==null?void 0:c.characteristics)==null?void 0:o.map((e,s)=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4 bg-[#F7F9FB] p-4 rounded-xl",children:[jsxRuntimeExports.jsx("div",{className:"w-5 flex-shrink-0",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-info customtext-primary",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("path",{d:"M12 16v-4"}),jsxRuntimeExports.jsx("path",{d:"M12 8h.01"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:e})})]},`char-${s}`))})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"Tipo de comprobante"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"radio",className:"sr-only",name:"invoiceType",value:"boleta",checked:formData.invoiceType==="boleta",onChange:handleChange}),jsxRuntimeExports.jsx("div",{className:`w-5 h-5 border-2 rounded-full transition-all duration-200 ${formData.invoiceType==="boleta"?"border-primary bg-primary":"border-gray-300 bg-white group-hover:border-gray-400"}`,children:formData.invoiceType==="boleta"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})})]}),jsxRuntimeExports.jsx("span",{className:"ml-3 text-sm font-medium customtext-neutral-dark",children:"Boleta"})]}),jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"radio",className:"sr-only",name:"invoiceType",value:"factura",checked:formData.invoiceType==="factura",onChange:handleChange}),jsxRuntimeExports.jsx("div",{className:`w-5 h-5 border-2 rounded-full transition-all duration-200 ${formData.invoiceType==="factura"?"border-primary bg-primary":"border-gray-300 bg-white group-hover:border-gray-400"}`,children:formData.invoiceType==="factura"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})})]}),jsxRuntimeExports.jsx("span",{className:"ml-3 text-sm font-medium customtext-neutral-dark",children:"Factura"})]})]})]}),jsxRuntimeExports.jsx(InputForm,{label:formData.documentType==="dni"?"DNI":"RUC",type:"text",name:"document",value:formData.document,error:errors.document,onChange:handleChange,placeholder:`Ingrese su ${formData.documentType==="dni"?"DNI":"RUC"}`,maxLength:formData.documentType==="dni"?"8":"11",required:!0}),formData.invoiceType==="factura"&&jsxRuntimeExports.jsx(InputForm,{label:"Raz√≥n Social",type:"text",name:"businessName",value:formData.businessName,onChange:handleChange,placeholder:"Ingrese la raz√≥n social"})]})}),jsxRuntimeExports.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max font-font-general",children:[jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold pb-6 customtext-neutral-dark",children:"Resumen de compra"}),jsxRuntimeExports.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:cart.map((e,s)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white p-0 rounded-xl",children:jsxRuntimeExports.jsx("img",{src:`/storage/images/item/${e.image}`,alt:e.name,className:"w-20 h-20 object-cover rounded  "})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold customtext-neutral-dark text-base 2xl:text-lg mb-2",children:e.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark",children:[e.quantity," "]})]})]})]})},e.id))}),jsxRuntimeExports.jsx("div",{className:"mt-6",children:appliedCoupon?jsxRuntimeExports.jsx("div",{className:"bg-secondary border  rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium customtext-neutral-dark   ",children:["Cup√≥n aplicado: ",appliedCoupon.code]}),jsxRuntimeExports.jsxs("p",{className:"text-xs customtext-neutral-light",children:["Descuento: ",appliedCoupon.type==="percentage"?`${appliedCoupon.value}%`:`S/ ${Number2Currency(appliedCoupon.value)}`]})]})]}),jsxRuntimeExports.jsx("button",{onClick:removeCoupon,className:"text-red-600 hover:text-red-700 transition-colors",title:"Remover cup√≥n",children:jsxRuntimeExports.jsx(CircleX,{})})]})}):jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"C√≥digo de cup√≥n",className:`w-full rounded-l-md border py-3 px-4 text-sm outline-none uppercase focus:border-[#C5B8D4] ${couponError?"border-red-500":"border-gray-300"}`,value:couponCode,onChange:e=>{setCouponCode(e.target.value),setCouponError("")},onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),validateCoupon())},disabled:couponLoading}),jsxRuntimeExports.jsx("button",{className:`rounded-r-md px-4 py-2 text-sm text-white transition-all duration-300 hover:opacity-90 ${couponLoading?"bg-gray-400 cursor-not-allowed":data!=null&&data.gradient?"bg-gradient":"bg-primary"}`,type:"button",onClick:validateCoupon,disabled:couponLoading,children:couponLoading?"...":"Aplicar"})]})})}),couponError&&jsxRuntimeExports.jsx("div",{className:"mt-2 text-red-500 text-sm",children:couponError}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["S/ ",Number2Currency(subTotal)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["S/ ",Number2Currency(igv)]})]}),autoDiscountTotal>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-green-600",children:[jsxRuntimeExports.jsx("span",{children:"Descuentos autom√°ticos"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["-S/ ",Number2Currency(autoDiscountTotal)]})]}),appliedCoupon&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-blue-600",children:[jsxRuntimeExports.jsxs("span",{children:["Descuento cup√≥n (",appliedCoupon.code,")"]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["-S/ ",Number2Currency(calculatedCouponDiscount)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),jsxRuntimeExports.jsx("span",{className:"font-semibold",children:hasShippingFree!=null&&subFinal>=hasShippingFree?jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark",children:["Gratis (Compra mayor a S/",hasShippingFree,")"]}):`S/ ${Number2Currency(envio)}`})]}),jsxRuntimeExports.jsx("div",{className:"py-3 border-y-2 mt-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:["S/ ",Number2Currency(appliedCoupon?finalTotalWithCoupon:totalFinal)]})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 pt-4",children:[jsxRuntimeExports.jsx("button",{className:`w-full py-3 px-6 rounded-full font-semibold text-lg transition-all duration-300 hover:opacity-90 bg-primary ${(data==null?void 0:data.class_button)||" text-white"}`,onClick:handleContinueClick,children:"Continuar"}),jsxRuntimeExports.jsx("div",{id:"mercadopago-button-container"}),jsxRuntimeExports.jsx(ButtonSecondary,{className:"!rounded-full",onClick:noContinue,children:"Cancelar"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>openModal&&openModal(1),className:"customtext-primary font-bold",children:" T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>openModal&&openModal(0),className:"customtext-primary font-bold",children:" Pol√≠tica de Privacidad"}),"."]})})]})]})]}),jsxRuntimeExports.jsx(PaymentModal,{isOpen:showPaymentModal,contacts,onClose:()=>setShowPaymentModal(!1),onPaymentComplete:handlePaymentComplete}),jsxRuntimeExports.jsx(UploadVoucherModalYape,{isOpen:showVoucherModal,cart,subTotal,igv,totalFinal:appliedCoupon?finalTotalWithCoupon:totalFinal,envio,request:paymentRequest,onClose:()=>setShowVoucherModal(!1),paymentMethod:currentPaymentMethod,coupon:appliedCoupon,descuentofinal:calculatedCouponDiscount,autoDiscounts,autoDiscountTotal}),jsxRuntimeExports.jsx(UploadVoucherModalBancs,{isOpen:showVoucherModalBancs,cart,subTotal,igv,totalFinal:appliedCoupon?finalTotalWithCoupon:totalFinal,envio,contacts,request:paymentRequest,onClose:()=>setShowVoucherModalBancs(!1),paymentMethod:currentPaymentMethod,coupon:appliedCoupon,descuentofinal:calculatedCouponDiscount,autoDiscounts,autoDiscountTotal}),jsxRuntimeExports.jsx(LoginModal,{})]})}const recoveryOrderData=({code:c})=>new Promise(async(o,e)=>{try{console.log("Codigo de venta:",c);const{status:s,result:t}=await mainExports.Fetch("./api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:c})});if(!s||!t.order){mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(t==null?void 0:t.message)||"Error no se pudo cargar la orden",type:"danger"}),e((t==null?void 0:t.message)||"Error no se pudo cargar la orde");return}o(t)}catch(s){console.error("Error en processMercadoPagoPayment:",s),mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:s.message||"Error en la integraci√≥n con MercadoPago",type:"danger"}),e(s.message||"Error en la integraci√≥n con MercadoPago")}});function ConfirmationStepSF({setCart:c,cart:o,code:e,delivery:s,data:t,automaticDiscounts:r=[],automaticDiscountTotal:n=0,couponDiscount:a=0,couponCode:l=null}){var R;const[i,x]=reactExports.useState(null),[h,j]=reactExports.useState(!0),[m,E]=reactExports.useState(null);if(reactExports.useEffect(()=>{e&&((async()=>{try{const u=await recoveryOrderData({code:e});x(u.order)}catch(u){E(u.message)}finally{j(!1)}})(),mainExports.Local.delete(`${Global.APP_CORRELATIVE}_cart`),mainExports.Local.set(`${Global.APP_CORRELATIVE}_cart`,[]))},[e]),h)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center",children:jsxRuntimeExports.jsx("p",{children:"Cargando detalles de la orden..."})})});if(m)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center text-red-500",children:jsxRuntimeExports.jsxs("p",{children:["Error al cargar la orden: ",m]})})});if(!i)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center",children:jsxRuntimeExports.jsx("p",{children:"No se encontraron datos de la orden"})})});const N=((R=i==null?void 0:i.items)==null?void 0:R.reduce((d,u)=>{const y=u.price||0,w=u.quantity||0;return d+y*w},0))||0,g=parseFloat((N/1.18).toFixed(2)),b=parseFloat((N-g).toFixed(2)),C=parseFloat(i.delivery||0),_=parseFloat(i.coupon_discount||0),T=parseFloat(i.automatic_discount_total||0),v=parseFloat(g)+parseFloat(b)+C-_-T;return console.log(i.delivery,"order.coupon_discount"),jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general",children:jsxRuntimeExports.jsxs("div",{className:"text-center space-y-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-base xl:text-xl customtext-neutral-light",children:"Gracias por tu compra üéâ"}),jsxRuntimeExports.jsx("p",{className:"customtext-neutral-dark text-2xl xl:text-5xl font-semibold",children:"Tu orden ha sido recibida"}),jsxRuntimeExports.jsxs("div",{className:"py-4",children:[jsxRuntimeExports.jsx("div",{className:" customtext-neutral-light",children:"C√≥digo de pedido"}),jsxRuntimeExports.jsxs("div",{className:"customtext-neutral-dark text-lg font-semibold",children:["#",i.code]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 max-w-lg bg-[#F7F9FB] mx-auto p-8 rounded-xl",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-6 border-b-2 pb-6",children:[i.items.map((d,u)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white rounded-xl w-max",children:jsxRuntimeExports.jsx("img",{src:d.image?`/storage/images/item/${d.image}`:"/assets/img/noimage/no_img.jpg",alt:d.name,className:"w-20 h-20 object-cover rounded",onError:y=>y.target.src="/assets/img/noimage/no_img.jpg"})}),jsxRuntimeExports.jsxs("div",{className:"text-start",children:[jsxRuntimeExports.jsxs("h3",{className:"font-medium text-lg",children:[d.name,d.is_free&&jsxRuntimeExports.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"¬°GRATIS!"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:parseInt(d.quantity)})," - Precio: ",jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark",children:[" S/ ",Number2Currency(d.price)]}),d.is_free&&jsxRuntimeExports.jsx("span",{className:"ml-1 text-green-600 font-semibold",children:"(Promoci√≥n)"})]})]})]})},u)),i.free_items&&i.free_items.length>0&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"pt-4 border-t border-dashed border-green-300",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-green-600 mb-3",children:"üéÅ Productos gratuitos por promociones:"}),i.free_items.map((d,u)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white rounded-xl w-max border-2 border-green-200",children:jsxRuntimeExports.jsx("img",{src:d.image?`/storage/images/item/${d.image}`:"/assets/img/noimage/no_img.jpg",alt:d.name,className:"w-20 h-20 object-cover rounded",onError:y=>y.target.src="/assets/img/noimage/no_img.jpg"})}),jsxRuntimeExports.jsxs("div",{className:"text-start",children:[jsxRuntimeExports.jsxs("h3",{className:"font-medium text-lg",children:[d.name,jsxRuntimeExports.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"¬°GRATIS!"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:parseInt(d.quantity)}),jsxRuntimeExports.jsx("span",{className:"ml-1 text-green-600 font-semibold",children:'- Por promoci√≥n "Compra X Lleva Y"'})]})]})]})},`free-${u}`))]})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["S/ ",Number2Currency(g)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["S/ ",Number2Currency(b)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["S/ ",Number2Currency(i.delivery)]})]}),i.coupon_id&&jsxRuntimeExports.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[jsxRuntimeExports.jsxs("span",{children:["Cup√≥n aplicado"," "]}),jsxRuntimeExports.jsxs("span",{children:["S/ -",Number2Currency(i.coupon_discount)]})]}),i.automatic_discounts&&i.automatic_discounts.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-2 mt-2 border-b pb-2",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-bold text-green-600 mb-1",children:"Descuentos autom√°ticos aplicados:"}),i.automatic_discounts.map((d,u)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-green-700",children:[d.rule_name||d.name||"Descuento autom√°tico",jsxRuntimeExports.jsx("small",{className:"block text-xs font-light text-gray-600",children:d.description||"Promoci√≥n especial"})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-green-600",children:["S/ -",Number2Currency(d.discount_amount||d.amount||0)]})]},u)),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm font-bold text-green-600 mt-1 pt-1 border-t",children:[jsxRuntimeExports.jsx("span",{children:"Total descuentos autom√°ticos:"}),jsxRuntimeExports.jsxs("span",{children:["S/ -",Number2Currency(i.automatic_discount_total||0)]})]})]}),jsxRuntimeExports.jsx("div",{className:"py-3 border-y-2 mt-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:["S/ ",Number2Currency(v)]})]})})]}),jsxRuntimeExports.jsx("div",{className:"pt-3",children:jsxRuntimeExports.jsx(ButtonPrimary,{href:"/catalogo",className:` !rounded-full ${t==null?void 0:t.class_button} `,children:"  Seguir Comprando"})})]})]})})})}function CheckoutStepsSF({cart:c,setCart:o,user:e,prefixes:s,ubigeos:t,items:r,contacts:n,data:a,generals:l=[]}){const[i,x]=reactExports.useState(1),[h,j]=reactExports.useState(0),m=c.reduce((f,p)=>{const S=p.final_price;return f+S*p.quantity},0),[E,N]=reactExports.useState(0),g=parseFloat((m/1.18).toFixed(2)),b=parseFloat((m-g).toFixed(2)),[C,_]=reactExports.useState(0),[T,L]=reactExports.useState(null),[v,R]=reactExports.useState([]),[d,u]=reactExports.useState(0),[y,w]=reactExports.useState(null),O=f=>w(f),k=()=>w(null),I={privacy_policy:"Pol√≠ticas de privacidad",terms_conditions:"T√©rminos y condiciones",saleback_policy:"Pol√≠ticas de devolucion y cambio"},D=g+b+parseFloat(E),B=C+d+h,P=Math.max(0,D-B),[U,z]=reactExports.useState([]),[M,q]=reactExports.useState([]),[V,W]=reactExports.useState([]);reactExports.useEffect(()=>{const p=new URLSearchParams(window.location.search).get("code");p&&(q(p),x(3))},[window.location.search]),reactExports.useEffect(()=>{M&&mainExports.Local.delete(`${Global.APP_CORRELATIVE}_cart`)},[M]),reactExports.useEffect(()=>{(()=>{const p=document.createElement("script");p.src="https://sdk.mercadopago.com/js/v2",p.async=!0,document.body.appendChild(p)})()},[]);const F=f=>{x(f),window.scrollTo({top:0,behavior:"smooth"})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:"mb-4 md:mb-8",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${i>=1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[jsxRuntimeExports.jsx("span",{className:"w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm bg-primary text-white border-primary",children:"1"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),jsxRuntimeExports.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:jsxRuntimeExports.jsx("div",{className:"absolute inset-0 transition-all duration-500 bg-primary",style:{width:i>1?"100%":"0%"}})}),jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${i>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[jsxRuntimeExports.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${i>1?"bg-primary text-white border-transparent":"bg-primary text-white border-primary"}`,children:"2"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Env√≠o"})]}),jsxRuntimeExports.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:jsxRuntimeExports.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${a!=null&&a.gradient?"bg-gradient":"bg-primary"}`,style:{width:i>2?"100%":"0%"}})}),jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${i===3?`${a!=null&&a.gradient?"customtext-gradient":"customtext-primary"} font-medium`:"customtext-neutral-dark"}`,children:[jsxRuntimeExports.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${i===3?a!=null&&a.gradient?"bg-gradient text-white border-transparent":"bg-primary text-white border-primary":a!=null&&a.gradient?"bg-white customtext-gradient border-gradient":"bg-white customtext-primary border-primary"}`,children:"3"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmaci√≥n"})]})]})}),i===1&&jsxRuntimeExports.jsx(CartStepSF,{data:a,cart:c,setCart:o,onContinue:()=>F(2),subTotal:g,totalPrice:m,envio:E,igv:b,totalFinal:P,openModal:O,automaticDiscounts:v,setAutomaticDiscounts:R,automaticDiscountTotal:d,setAutomaticDiscountTotal:u,totalWithoutDiscounts:D}),i===2&&jsxRuntimeExports.jsx(ShippingStepSF,{data:a,setCode:q,setDelivery:W,cart:c,setSale:z,setCart:o,onContinue:()=>F(3),noContinue:()=>F(1),subTotal:g,totalPrice:m,envio:E,setEnvio:N,igv:b,totalFinal:P,user:e,prefixes:s,contacts:n,ubigeos:t,items:r,descuentofinal:h,setDescuentoFinal:j,openModal:O,setCouponDiscount:_,setCouponCode:L,automaticDiscounts:v,setAutomaticDiscounts:R,automaticDiscountTotal:d,setAutomaticDiscountTotal:u,totalWithoutDiscounts:D}),i===3&&jsxRuntimeExports.jsx(ConfirmationStepSF,{data:a,code:M,setCart:o,delivery:V,cart:U,subTotal:g,totalPrice:m,envio:E,igv:b,totalFinal:P,descuentofinal:h,setDescuentoFinal:j,couponDiscount:C,couponCode:T,automaticDiscounts:v,automaticDiscountTotal:d,totalWithoutDiscounts:D})]}),Object.keys(I).map((f,p)=>{var A;const S=I[f],G=((A=l.find(H=>H.correlative==f))==null?void 0:A.description)??"";return jsxRuntimeExports.jsx(ReactModal,{isOpen:y===p,onRequestClose:k,contentLabel:S,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:S}),jsxRuntimeExports.jsx("button",{onClick:k,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:jsxRuntimeExports.jsx(X,{size:24,strokeWidth:2})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:jsxRuntimeExports.jsx("div",{className:"prose prose-gray max-w-none",children:jsxRuntimeExports.jsx(HtmlContent,{html:G})})}),jsxRuntimeExports.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:jsxRuntimeExports.jsx("button",{onClick:k,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},p)})]})}export{CheckoutStepsSF as default};
