const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-D3plwuQr.js","assets/index-BH53Isel.js","assets/index-yBjzXJbu.js","assets/preload-helper-BfFHrpNk.js","assets/typeof-QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{_ as qs}from"./preload-helper-BfFHrpNk.js";import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as g,R as Et}from"./index-BH53Isel.js";import{T as Ve,l as ce,i as Ts,a as Rs,D as Gs,H as Ks,U as vs,R as ws,B as Pe,F as Xs,E as js}from"./EditableCell-Cu-5czkC.js";import{h as Ns}from"./thumbnailGenerator-B4goYG9Y.js";import{L as Pt}from"./layers-6oegOx-p.js";import{C as zs}from"./chevron-down-DS-mdh9v.js";import{C as Js}from"./chevron-right-Ckt5D2ka.js";import{E as Ys}from"./eye-CKCH9ORv.js";import{c as V}from"./createLucideIcon-Cy5Ya80P.js";import{T as At}from"./trash-2-DK1wnsDn.js";import{S as Qs}from"./star-wPQTHY_n.js";import{I as Ae}from"./image-BEA0kkBS.js";import{F as Zs}from"./EditorLayout-CkCvwqGw.js";import"./jspdf.es.min-D3plwuQr.js";import{t as $,T as Ds}from"./index-BZYhE2TF.js";import{m as ks}from"./main-6DCdASTx.js";import{X as ea}from"./x-DBMwyD6F.js";import{P as ta}from"./palette-DV_Vpyg9.js";import{M as Cs}from"./minus-jyhodMPN.js";import{P as qe}from"./plus-Bot15Khs.js";import{B as sa}from"./V1Edit-CNtDxOEt.js";import{G as Ss}from"./Global-ErywZRdd.js";import{S as Os,F as aa}from"./save-BfW-kI1U.js";import{C as ra}from"./clock-BTrEpQej.js";import{C as Ms}from"./check-DQ7QoS0v.js";import{L as oa}from"./loader-circle-CrvBvIt1.js";import"./dom-to-image-more.min-BAoslaO8.js";import{C as Es}from"./chevron-left-B2s3ZsB7.js";import{U as na}from"./user-BvYmyGTY.js";import{F as ia}from"./filter-Ci9tsc_e.js";import{C as la}from"./copy-6OEekgvq.js";import{C as ca}from"./circle-check-big-D6DM3vPb.js";import{u as da}from"./useDrag-BaORhKlM.js";import"./index-yBjzXJbu.js";import"./sparkles-DeLUn6av.js";import"./sliders-vertical-C5ts4taK.js";import"./settings-BSPs3Zt8.js";import"./chevron-up-D78jyEhP.js";import"./TextElement-_pvTHO57.js";import"./upload-qgEr5bIl.js";import"./typeof-QjJsDpFa.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./PaymentModal-Bxx5p2o_.js";import"./index-Chjiymov.js";import"./download-Dh5rRDOT.js";import"./index-BSWw-p5k.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=V("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=V("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=V("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=V("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=V("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=V("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=V("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=V("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=V("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=V("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=V("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=V("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=V("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=V("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=V("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=V("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=V("Heading3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=V("Heading4",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17 10v4h4",key:"13sv97"}],["path",{d:"M21 10v8",key:"1kdml4"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=V("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=V("IndentDecrease",[["polyline",{points:"7 8 3 12 7 16",key:"2j60jr"}],["line",{x1:"21",x2:"11",y1:"12",y2:"12",key:"1fxxak"}],["line",{x1:"21",x2:"11",y1:"6",y2:"6",key:"asgu94"}],["line",{x1:"21",x2:"11",y1:"18",y2:"18",key:"13dsj7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=V("IndentIncrease",[["polyline",{points:"3 8 7 12 3 16",key:"f3rxhf"}],["line",{x1:"21",x2:"11",y1:"12",y2:"12",key:"1fxxak"}],["line",{x1:"21",x2:"11",y1:"6",y2:"6",key:"asgu94"}],["line",{x1:"21",x2:"11",y1:"18",y2:"18",key:"13dsj7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=V("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=V("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=V("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=V("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=V("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=V("PaintBucket",[["path",{d:"m19 11-8-8-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0L19 11Z",key:"irua1i"}],["path",{d:"m5 2 5 5",key:"1lls2c"}],["path",{d:"M2 13h15",key:"1hkzvu"}],["path",{d:"M22 20a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4 .3 1.6 2 2.4 2 4Z",key:"xk76lq"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=V("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=V("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=V("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=V("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=V("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=V("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=V("Sticker",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M14 3v4a2 2 0 0 0 2 2h4",key:"36rjfy"}],["path",{d:"M8 13h.01",key:"1sbv64"}],["path",{d:"M16 13h.01",key:"wip0gl"}],["path",{d:"M10 16s.8 1 2 1c1.3 0 2-1 2-1",key:"1vvgv3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=V("Strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=V("Subscript",[["path",{d:"m4 5 8 8",key:"1eunvl"}],["path",{d:"m12 5-8 8",key:"1ah0jp"}],["path",{d:"M20 19h-4c0-1.5.44-2 1.5-2.5S20 15.33 20 14c0-.47-.17-.93-.48-1.29a2.11 2.11 0 0 0-2.62-.44c-.42.24-.74.62-.9 1.07",key:"e8ta8j"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=V("Superscript",[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=V("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=V("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=V("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=V("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),Ka=({pages:s,currentPage:m,selectedCell:l,selectedElement:k,onSelectCell:o,onSelectElement:h,onUpdateElement:y,onDeleteElement:v,onMoveElement:T})=>{var K;if(!s||!s[m])return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Pt,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No page data available"})]});const S=s[m],P=((K=S==null?void 0:S.cells)==null?void 0:K.filter(E=>E.elements&&E.elements.length>0))||[],[I,W]=g.useState(()=>{const E={};return P.forEach(j=>{E[j.id]=!0}),E}),X=E=>{W(j=>({...j,[E]:!j[E]}))},n=E=>{switch(E){case"image":return e.jsx(Ae,{className:"h-4 w-4"});case"text":return e.jsx(Ve,{className:"h-4 w-4"});case"shape":return e.jsx($s,{className:"h-4 w-4"});case"sticker":return e.jsx(Qs,{className:"h-4 w-4"});default:return e.jsx(va,{className:"h-4 w-4"})}},_=(E,j)=>{switch(E.type){case"text":return E.content?E.content.substring(0,20)+"...":"Text Layer";case"image":return`Image ${j+1}`;case"shape":return E.shape||"Shape";case"sticker":return`Sticker ${j+1}`;default:return`Element ${j+1}`}},d=(E,j,ee)=>{y(E,j,{visible:ee})},L=(E,j)=>{o(E),h(j)};return e.jsx("div",{className:"space-y-2",children:P.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Pt,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No elements yet"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Add elements to see them here"})]}):P.map(E=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center p-3 cursor-pointer transition-colors ${l===E.id?"bg-purple-50 border-purple-200":"hover:bg-gray-50"}`,onClick:()=>{X(E.id),o(E.id)},children:[e.jsx("button",{className:"mr-2 text-gray-500 hover:text-gray-700",children:I[E.id]?e.jsx(zs,{className:"h-4 w-4"}):e.jsx(Js,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm text-gray-800",children:["Cell ",E.id]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[E.elements.length," element",E.elements.length!==1?"s":""]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[E.x,", ",E.y]})]}),I[E.id]&&e.jsx("div",{className:"border-t border-gray-100",children:E.elements.map((j,ee)=>e.jsxs("div",{className:`flex items-center p-2 mx-2 mb-2 rounded cursor-pointer transition-colors ${k===j.id?"bg-purple-100 border border-purple-200":"hover:bg-gray-50"}`,onClick:()=>L(E.id,j.id),children:[e.jsx("div",{className:"mr-2 text-gray-500",children:n(j.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm truncate",children:_(j,ee)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[j.type," • Layer ",ee+1]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:M=>{M.stopPropagation(),d(E.id,j.id,!j.visible)},className:"p-1 hover:bg-gray-200 rounded",title:j.visible?"Hide element":"Show element",children:j.visible!==!1?e.jsx(Ys,{className:"h-3 w-3 text-gray-500"}):e.jsx(Na,{className:"h-3 w-3 text-gray-400"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),T(E.id,j.id,"up")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer up",disabled:ee===E.elements.length-1,children:e.jsx(xa,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),T(E.id,j.id,"down")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer down",disabled:ee===0,children:e.jsx(pa,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),v(E.id,j.id)},className:"p-1 hover:bg-red-100 rounded text-red-500",title:"Delete element",children:e.jsx(At,{className:"h-3 w-3"})})]})]},j.id))})]},E.id))})};function Xa({currentLayoutId:s,onLayoutChange:m}){const[l,k]=g.useState("all"),o={all:{name:"Todos",layouts:ce},hero:{name:"Hero",layouts:ce.filter(h=>h.category==="hero")},editorial:{name:"Editorial",layouts:ce.filter(h=>h.category==="editorial")},storytelling:{name:"Historia",layouts:ce.filter(h=>h.category==="storytelling")},minimal:{name:"Minimal",layouts:ce.filter(h=>h.category==="minimal")},creative:{name:"Creativo",layouts:ce.filter(h=>h.category==="creative")},classic:{name:"Clásico",layouts:ce.filter(h=>h.category==="classic")}};return Object.keys(o).filter(h=>h==="all"||o[h].layouts.length>0),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"grid grid-cols-2  gap-3 overflow-x-hidden custom-scroll",children:o[l].layouts.map(h=>e.jsxs("div",{className:`relative group cursor-pointer transition-all duration-200 
                                 hover:shadow-md hover:scale-102
                        `,onClick:()=>m(h.id),children:[e.jsxs("div",{className:"aspect-square relative bg-white rounded-lg p-2 border border-gray-200",children:[e.jsx("div",{className:`w-full h-full grid ${h.template}`,style:{gap:"2px",padding:"4px"},children:Array.from({length:h.cells}).map((y,v)=>{var T,S;return e.jsx("div",{className:`bg-gradient-to-br from-purple-100 to-purple-200 ${(S=(T=h.cellStyles)==null?void 0:T[v])!=null&&S.includes("rounded")?"rounded":"rounded-sm"}`,style:{minHeight:"8px"}},v)})}),s===h.id&&e.jsx("div",{className:"absolute top-1/2 right-1/2 translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-900 truncate",children:h.name}),h.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:h.description}),e.jsx("div",{className:"flex items-center justify-center mt-1 space-x-2",children:e.jsxs("span",{className:"text-xs text-gray-400",children:[h.cells," ",h.cells===1?"celda":"celdas"]})})]})]},h.id))}),o[l].layouts.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"No hay layouts disponibles en esta categoría."})})]})}const Ja=({selectedMask:s,onSelect:m,availableMasks:l=[],selectedImage:k})=>{var v,T;const[o,h]=g.useState("Básicas"),y={};return Ts.forEach(S=>{y[S.category]||(y[S.category]=[]),(l.includes(S.id)||S.id==="none")&&y[S.category].push(S)}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-1 bg-gray-100 p-1 rounded-lg",children:Object.keys(y).slice(0,2).map(S=>y[S].length>0&&e.jsx("button",{onClick:()=>h(S),className:`py-1.5 px-2 text-xs rounded-md transition font-medium ${o===S?"bg-white text-purple-700 shadow-sm":"text-gray-600 hover:text-purple-600"}`,children:S},S))}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(v=y[o])==null?void 0:v.slice(0,6).map(S=>e.jsxs("div",{onClick:()=>m(S.id),className:`cursor-pointer border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all ${s===S.id?"ring-2 ring-purple-500 border-purple-300":"border-gray-200"}`,children:[e.jsx("div",{className:"aspect-square bg-white flex items-center justify-center p-1",children:k!=null&&k.content?e.jsx("img",{src:k.content,alt:S.name,className:`w-full h-full object-cover ${S.class}`}):e.jsx("div",{className:`w-full h-full bg-gray-200 ${S.class}`})}),e.jsx("p",{className:"text-center text-[10px] text-gray-700 p-1 truncate",children:S.name})]},S.id))}),((T=y[o])==null?void 0:T.length)>6&&e.jsxs("button",{className:"w-full py-2 text-xs text-purple-600 hover:text-purple-700 border border-purple-200 rounded-lg hover:bg-purple-50 transition",children:["Ver más máscaras (",y[o].length-6," más)"]})]})},Ya=[{name:"Arial",value:"Arial"},{name:"Times New Roman",value:"'Times New Roman'"},{name:"Helvetica",value:"Helvetica"},{name:"Courier New",value:"'Courier New'"},{name:"Georgia",value:"Georgia"},{name:"Verdana",value:"Verdana"},{name:"Impact",value:"Impact"},{name:"Roboto",value:"'Roboto', sans-serif"},{name:"Open Sans",value:"'Open Sans', sans-serif"},{name:"Lato",value:"'Lato', sans-serif"},{name:"Pacifico (Cursiva)",value:"'Pacifico', cursive"},{name:"Lobster (Estilo Poster)",value:"'Lobster', cursive"},{name:"Indie Flower (Manuscrita)",value:"'Indie Flower', cursive"},{name:"Permanent Marker (Rotulador)",value:"'Permanent Marker', cursive"},{name:"Dancing Script (Elegante)",value:"'Dancing Script', cursive"},{name:"Shadows Into Light (Dibujada)",value:"'Shadows Into Light', cursive"},{name:"Amatic SC (Minimalista)",value:"'Amatic SC', cursive"},{name:"Handlee (Natural)",value:"'Handlee', cursive"},{name:"Caveat (Caligráfica)",value:"'Caveat', cursive"},{name:"Kalam (Pincel)",value:"'Kalam', cursive"}],Qa=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","32px","36px","42px","48px","64px","72px"],Za=[{label:"Normal",value:"none"},{label:"MAYÚSCULAS",value:"uppercase"},{label:"minúsculas",value:"lowercase"},{label:"Capitalizado",value:"capitalize"}],Da=[{color:"#000000",name:"Negro"},{color:"#ffffff",name:"Blanco"},{color:"#f43f5e",name:"Rojo"},{color:"#22c55e",name:"Verde"},{color:"#3b82f6",name:"Azul"},{color:"#eab308",name:"Amarillo"},{color:"#06b6d4",name:"Cian"},{color:"#d946ef",name:"Magenta"},{color:"#6b7280",name:"Gris"},{color:"#a855f7",name:"Púrpura"},{color:"#ec4899",name:"Rosa"},{color:"#f97316",name:"Naranja"},{color:"#0f172a",name:"Azul oscuro"},{color:"#7c2d12",name:"Marrón"},{color:"#14532d",name:"Verde oscuro"},{color:"#4c1d95",name:"Violeta"},{color:"#1e293b",name:"Gris oscuro"},{color:"#fef3c7",name:"Crema"}],er=[{color:"transparent",name:"Transparente"},{color:"#ffffff",name:"Blanco"},{color:"#f8fafc",name:"Gris claro"},{color:"#f1f5f9",name:"Plata"},{color:"#fef3c7",name:"Crema"},{color:"#ffedd5",name:"Melocotón"},{color:"#fee2e2",name:"Rosa claro"},{color:"#dbeafe",name:"Azul claro"},{color:"#dcfce7",name:"Verde claro"},{color:"#f3e8ff",name:"Lavanda"}],tr=[{label:"Ninguno",value:"none"},{label:"Sólido",value:"solid"},{label:"Punteado",value:"dotted"},{label:"Discontinuo",value:"dashed"},{label:"Doble",value:"double"},{label:"Acanalado",value:"groove"}],sr=({element:s,onUpdate:m,onClose:l})=>{var le,be,me,ve,Fe,We,Ge,Oe,rt,we,Ke,F,Xe,He,Ne,Be,xe,Je,ye,Me,Ye,ot,nt,Ie,Qe,it,lt,Ze,ct,De,dt,mt,Ue,gt,ht,et,ut,tt,Te,pt,Ce;const[k,o]=g.useState(!1),[h,y]=g.useState(!1),[v,T]=g.useState(!1),[S,P]=g.useState(!1),[I,W]=g.useState(!1),[X,n]=g.useState(!1),[_,d]=g.useState(!1),[L,K]=g.useState(!1),[E,j]=g.useState("basic"),[ee,M]=g.useState(((le=s==null?void 0:s.style)==null?void 0:le.color)||"#000000"),[Y,B]=g.useState(((be=s==null?void 0:s.style)==null?void 0:be.backgroundColor)||"transparent"),de=g.useRef(null),ue=g.useRef(null),fe=g.useRef(null),re=g.useRef(null),pe=g.useRef(null),te=g.useRef(null),ie=g.useRef(null);g.useEffect(()=>{function x(J){de.current&&!de.current.contains(J.target)&&o(!1),ue.current&&!ue.current.contains(J.target)&&y(!1),fe.current&&!fe.current.contains(J.target)&&P(!1),re.current&&!re.current.contains(J.target)&&W(!1),pe.current&&!pe.current.contains(J.target)&&n(!1),te.current&&!te.current.contains(J.target)&&T(!1),ie.current&&!ie.current.contains(J.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[]);const w=(x,J)=>{m({style:{...s==null?void 0:s.style,[x]:J}})},Z=(x,J,je)=>{var Se;m({style:{...s==null?void 0:s.style,[x]:((Se=s==null?void 0:s.style)==null?void 0:Se[x])===J?je:J}})},oe=(x,J)=>{w(x,J)};if(!s)return null;const D=({active:x,onClick:J,icon:je,title:Se,className:$e=""})=>e.jsx("button",{type:"button",className:`p-1.5 rounded-sm transition-colors ${x?"bg-gray-200 text-gray-900":"text-gray-700 hover:bg-gray-100"} ${$e}`,onClick:J,title:Se,children:je}),se=({onClick:x,icon:J,text:je,isOpen:Se,title:$e})=>e.jsxs("button",{type:"button",className:`flex items-center gap-1 px-2 py-1.5 rounded-md border ${Se?"bg-gray-100 border-gray-300":"border-gray-200 hover:bg-gray-50"}`,onClick:x,title:$e,children:[J&&e.jsx("span",{className:"flex-shrink-0",children:J}),je&&e.jsx("span",{className:"text-sm truncate",children:je}),e.jsx(zs,{className:"h-3.5 w-3.5 opacity-70"})]});return e.jsx("div",{className:"  bg-white  rounded-lg shadow-sm px-4  border-gray-200  z-50 transition-all duration-200",children:e.jsxs("div",{className:"w-full ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center gap-1.5",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Formato de texto"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 rounded-md hover:bg-gray-100",onClick:()=>K(!L),title:L?"Modo compacto":"Modo expandido",children:L?e.jsx(Ma,{className:"h-4 w-4"}):e.jsx(Oa,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-1 rounded-md hover:bg-gray-100",onClick:l,title:"Cerrar",children:e.jsx(ea,{className:"h-4 w-4"})})]})]}),L&&e.jsxs("div",{className:"flex border-b mb-2",children:[e.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${E==="basic"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>j("basic"),children:"Básico"}),e.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${E==="paragraph"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>j("paragraph"),children:"Párrafo"}),e.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${E==="advanced"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>j("advanced"),children:"Avanzado"})]}),(E==="basic"||!L)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 items-center",children:[e.jsx("div",{className:"relative",ref:fe,children:e.jsx("select",{className:"px-2 py-1 border rounded-md text-sm",value:((me=s.style)==null?void 0:me.fontFamily)||"Arial",onChange:x=>{w("fontFamily",x.target.value)},children:Ya.map(x=>e.jsx("option",{value:x.value,style:{fontFamily:x.value},children:x.name},x.value))})}),e.jsxs("div",{className:"relative",ref:re,children:[e.jsx(se,{onClick:()=>W(!I),text:((ve=s.style)==null?void 0:ve.fontSize)||"16px",isOpen:I,title:"Tamaño de fuente"}),I&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] max-h-60 overflow-y-auto w-24",children:Qa.map(x=>e.jsx("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm",onClick:()=>{w("fontSize",x),W(!1)},children:x},x))})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((Fe=s.style)==null?void 0:Fe.fontWeight)==="bold",onClick:()=>Z("fontWeight","bold","normal"),icon:e.jsx(fa,{className:"h-4 w-4"}),title:"Negrita"}),e.jsx(D,{active:((We=s.style)==null?void 0:We.fontStyle)==="italic",onClick:()=>Z("fontStyle","italic","normal"),icon:e.jsx(Ta,{className:"h-4 w-4"}),title:"Cursiva"}),e.jsx(D,{active:((Ge=s.style)==null?void 0:Ge.textDecoration)==="underline",onClick:()=>Z("textDecoration","underline","none"),icon:e.jsx(qa,{className:"h-4 w-4"}),title:"Subrayado"}),e.jsx(D,{active:((Oe=s.style)==null?void 0:Oe.textDecoration)==="line-through",onClick:()=>Z("textDecoration","line-through","none"),icon:e.jsx(Ba,{className:"h-4 w-4"}),title:"Tachado"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((rt=s.style)==null?void 0:rt.textAlign)==="left",onClick:()=>w("textAlign","left"),icon:e.jsx(ha,{className:"h-4 w-4"}),title:"Alinear a la izquierda"}),e.jsx(D,{active:((we=s.style)==null?void 0:we.textAlign)==="center",onClick:()=>w("textAlign","center"),icon:e.jsx(ma,{className:"h-4 w-4"}),title:"Centrar"}),e.jsx(D,{active:((Ke=s.style)==null?void 0:Ke.textAlign)==="right",onClick:()=>w("textAlign","right"),icon:e.jsx(ua,{className:"h-4 w-4"}),title:"Alinear a la derecha"}),e.jsx(D,{active:((F=s.style)==null?void 0:F.textAlign)==="justify",onClick:()=>w("textAlign","justify"),icon:e.jsx(ga,{className:"h-4 w-4"}),title:"Justificar"})]}),e.jsxs("div",{className:"relative",ref:de,children:[e.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>o(!k),title:"Color de texto",children:[e.jsx("div",{className:"w-4 h-4 rounded-sm border",style:{backgroundColor:ee}}),e.jsx(ta,{className:"h-4 w-4"})]}),k&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium",children:"Color personalizado"}),e.jsx("div",{className:"w-6 h-6 rounded-md border",style:{backgroundColor:ee}})]}),e.jsx("input",{type:"color",value:ee,onChange:x=>{M(x.target.value),w("color",x.target.value)},className:"w-full h-8 cursor-pointer"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1.5",children:"Colores predefinidos"}),e.jsx("div",{className:"grid grid-cols-6 gap-1.5",children:Da.map(x=>e.jsx("button",{type:"button",className:`w-8 h-8 rounded-md cursor-pointer border transition-all hover:scale-110 ${ee===x.color?"ring-2 ring-offset-1 ring-blue-500":""}`,style:{backgroundColor:x.color},onClick:()=>{M(x.color),w("color",x.color)},title:x.name},x.color))})]})]})})]}),e.jsxs("div",{className:"relative",ref:ue,children:[e.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>y(!h),title:"Color de fondo",children:[e.jsx("div",{className:"w-4 h-4 rounded-sm border",style:{backgroundColor:Y,backgroundImage:Y==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"}}),e.jsx($a,{className:"h-4 w-4"})]}),h&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium",children:"Color de fondo personalizado"}),e.jsx("div",{className:"w-6 h-6 rounded-md border",style:{backgroundColor:Y,backgroundImage:Y==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"}})]}),e.jsx("input",{type:"color",value:Y==="transparent"?"#ffffff":Y,onChange:x=>{B(x.target.value),w("backgroundColor",x.target.value)},className:"w-full h-8 cursor-pointer"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1.5",children:"Fondos predefinidos"}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:er.map(x=>e.jsx("button",{type:"button",className:`w-10 h-10 rounded-md cursor-pointer border transition-all hover:scale-110 ${Y===x.color?"ring-2 ring-offset-1 ring-blue-500":""}`,style:{backgroundColor:x.color,backgroundImage:x.color==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"},onClick:()=>{B(x.color),w("backgroundColor",x.color)},title:x.name},x.color))})]})]})})]}),e.jsxs("div",{className:"relative",ref:pe,children:[e.jsx("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>n(!X),title:"Transformación de texto",children:e.jsx(ba,{className:"h-4 w-4"})}),X&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] w-48",children:Za.map(x=>{var J;return e.jsx("button",{className:`w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm ${((J=s.style)==null?void 0:J.textTransform)===x.value?"bg-gray-100":""}`,style:{textTransform:x.value},onClick:()=>{w("textTransform",x.value),n(!1)},children:x.label},x.value)})})]}),e.jsxs("div",{className:"relative",ref:ie,children:[e.jsx("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>d(!_),title:"Encabezados",children:e.jsx(Ve,{className:"h-4 w-4"})}),_&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-10 w-48",children:[e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{w("fontSize","32px"),w("fontWeight","bold"),d(!1)},children:[e.jsx(ka,{className:"h-4 w-4"})," ","Encabezado 1"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{w("fontSize","24px"),w("fontWeight","bold"),d(!1)},children:[e.jsx(Ca,{className:"h-4 w-4"})," ","Encabezado 2"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{w("fontSize","20px"),w("fontWeight","bold"),d(!1)},children:[e.jsx(Sa,{className:"h-4 w-4"})," ","Encabezado 3"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{w("fontSize","16px"),w("fontWeight","bold"),d(!1)},children:[e.jsx(Ea,{className:"h-4 w-4"})," ","Encabezado 4"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{w("fontSize","16px"),w("fontWeight","normal"),d(!1)},children:[e.jsx(Ve,{className:"h-4 w-4"})," Párrafo normal"]})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((Xe=s.style)==null?void 0:Xe.verticalAlign)==="super",onClick:()=>Z("verticalAlign","super","baseline"),icon:e.jsx(Va,{className:"h-4 w-4"}),title:"Superíndice"}),e.jsx(D,{active:((He=s.style)==null?void 0:He.verticalAlign)==="sub",onClick:()=>Z("verticalAlign","sub","baseline"),icon:e.jsx(Ua,{className:"h-4 w-4"}),title:"Subíndice"})]})]}),L&&E==="paragraph"&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((Ne=s.style)==null?void 0:Ne.listStyleType)==="disc",onClick:()=>{var x;return w("listStyleType",((x=s.style)==null?void 0:x.listStyleType)==="disc"?"none":"disc")},icon:e.jsx(za,{className:"h-4 w-4"}),title:"Lista con viñetas"}),e.jsx(D,{active:((Be=s.style)==null?void 0:Be.listStyleType)==="decimal",onClick:()=>{var x;return w("listStyleType",((x=s.style)==null?void 0:x.listStyleType)==="decimal"?"none":"decimal")},icon:e.jsx(Ra,{className:"h-4 w-4"}),title:"Lista numerada"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{onClick:()=>{var J;const x=Number.parseInt(((J=s.style)==null?void 0:J.textIndent)||"0");w("textIndent",`${x+20}px`)},icon:e.jsx(Ia,{className:"h-4 w-4"}),title:"Aumentar sangría"}),e.jsx(D,{onClick:()=>{var J;const x=Number.parseInt(((J=s.style)==null?void 0:J.textIndent)||"0");x>=20&&w("textIndent",`${x-20}px`)},icon:e.jsx(Aa,{className:"h-4 w-4"}),title:"Disminuir sangría"})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Altura de línea:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cs,{className:"h-3 w-3 text-gray-500"}),e.jsx("input",{type:"range",min:"1",max:"3",step:"0.1",value:Number.parseFloat(((xe=s.style)==null?void 0:xe.lineHeight)||"1.5"),onChange:x=>oe("lineHeight",x.target.value),className:"w-24"}),e.jsx(qe,{className:"h-3 w-3 text-gray-500"})]}),e.jsx("span",{className:"text-xs",children:((Je=s.style)==null?void 0:Je.lineHeight)||"1.5"})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Espaciado:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cs,{className:"h-3 w-3 text-gray-500"}),e.jsx("input",{type:"range",min:"-2",max:"10",step:"1",value:Number.parseInt(((ye=s.style)==null?void 0:ye.letterSpacing)||"0"),onChange:x=>oe("letterSpacing",`${x.target.value}px`),className:"w-24"}),e.jsx(qe,{className:"h-3 w-3 text-gray-500"})]}),e.jsx("span",{className:"text-xs",children:((Me=s.style)==null?void 0:Me.letterSpacing)||"0px"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((Ye=s.style)==null?void 0:Ye.fontStyle)==="italic"&&((ot=s.style)==null?void 0:ot.paddingLeft)==="20px"&&((nt=s.style)==null?void 0:nt.borderLeft)==="4px solid #ccc",onClick:()=>{var x,J,je;((x=s.style)==null?void 0:x.fontStyle)==="italic"&&((J=s.style)==null?void 0:J.paddingLeft)==="20px"&&((je=s.style)==null?void 0:je.borderLeft)==="4px solid #ccc"?(w("fontStyle","normal"),w("paddingLeft","0"),w("borderLeft","none")):(w("fontStyle","italic"),w("paddingLeft","20px"),w("borderLeft","4px solid #ccc"))},icon:e.jsx(_a,{className:"h-4 w-4"}),title:"Formato de cita"}),e.jsx(D,{active:((Ie=s.style)==null?void 0:Ie.fontFamily)==="'Courier New', monospace"&&((Qe=s.style)==null?void 0:Qe.backgroundColor)==="#f5f5f5"&&((it=s.style)==null?void 0:it.padding)==="2px 4px",onClick:()=>{var x,J;((x=s.style)==null?void 0:x.fontFamily)==="'Courier New', monospace"&&((J=s.style)==null?void 0:J.backgroundColor)==="#f5f5f5"?(w("fontFamily","Arial, sans-serif"),w("backgroundColor","transparent"),w("padding","0")):(w("fontFamily","'Courier New', monospace"),w("backgroundColor","#f5f5f5"),w("padding","2px 4px"))},icon:e.jsx(wa,{className:"h-4 w-4"}),title:"Formato de código"})]})]}),L&&E==="advanced"&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-2",children:[e.jsxs("div",{className:"relative",ref:te,children:[e.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>T(!v),title:"Opciones de borde",children:[e.jsx($s,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Bordes"})]}),v&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Estilo de borde"}),e.jsx("select",{className:"w-full p-1.5 border rounded-md text-sm",value:((lt=s.style)==null?void 0:lt.borderStyle)||"none",onChange:x=>w("borderStyle",x.target.value),children:tr.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),((Ze=s.style)==null?void 0:Ze.borderStyle)&&((ct=s.style)==null?void 0:ct.borderStyle)!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Ancho de borde"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:Number.parseInt(((De=s.style)==null?void 0:De.borderWidth)||"1"),onChange:x=>w("borderWidth",`${x.target.value}px`),className:"flex-1"}),e.jsx("span",{className:"text-xs",children:((dt=s.style)==null?void 0:dt.borderWidth)||"1px"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Color de borde"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((mt=s.style)==null?void 0:mt.borderColor)||"#000000",onChange:x=>w("borderColor",x.target.value),className:"w-8 h-8"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 flex-1",children:["#000000","#cccccc","#ff0000","#0000ff","#00ff00"].map(x=>e.jsx("button",{type:"button",className:"w-6 h-6 rounded-sm border",style:{backgroundColor:x},onClick:()=>w("borderColor",x)},x))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Radio de borde"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:Number.parseInt(((Ue=s.style)==null?void 0:Ue.borderRadius)||"0"),onChange:x=>w("borderRadius",`${x.target.value}px`),className:"flex-1"}),e.jsx("span",{className:"text-xs",children:((gt=s.style)==null?void 0:gt.borderRadius)||"0px"})]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Sombra:"}),e.jsx("button",{className:`px-2 py-1 text-xs rounded ${(ht=s.style)!=null&&ht.textShadow?"bg-blue-100 text-blue-700":"bg-gray-100"}`,onClick:()=>{var x;(x=s.style)!=null&&x.textShadow?w("textShadow",""):w("textShadow","1px 1px 2px rgba(0,0,0,0.3)")},children:(et=s.style)!=null&&et.textShadow?"Quitar":"Añadir"}),((ut=s.style)==null?void 0:ut.textShadow)&&e.jsxs("select",{className:"text-xs p-1 border rounded",value:(tt=s.style)==null?void 0:tt.textShadow,onChange:x=>w("textShadow",x.target.value),children:[e.jsx("option",{value:"1px 1px 2px rgba(0,0,0,0.3)",children:"Suave"}),e.jsx("option",{value:"2px 2px 4px rgba(0,0,0,0.4)",children:"Medio"}),e.jsx("option",{value:"3px 3px 6px rgba(0,0,0,0.5)",children:"Fuerte"}),e.jsx("option",{value:"0 0 5px rgba(0,0,255,0.5)",children:"Resplandor azul"}),e.jsx("option",{value:"0 0 5px rgba(255,0,0,0.5)",children:"Resplandor rojo"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Opacidad:"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:Number.parseFloat(((Te=s.style)==null?void 0:Te.opacity)||"1"),onChange:x=>oe("opacity",x.target.value),className:"w-24"})}),e.jsxs("span",{className:"text-xs",children:[Math.round(Number.parseFloat(((pt=s.style)==null?void 0:pt.opacity)||"1")*100),"%"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("button",{className:`flex items-center gap-1 px-2 py-1.5 rounded-md border ${((Ce=s.style)==null?void 0:Ce.backgroundColor)==="#ffff00"?"bg-yellow-100":"bg-white hover:bg-gray-50"}`,onClick:()=>{var x;((x=s.style)==null?void 0:x.backgroundColor)==="#ffff00"?w("backgroundColor","transparent"):w("backgroundColor","#ffff00")},title:"Resaltar texto",children:[e.jsx(Pa,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Resaltar"})]})}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md ml-auto",children:[e.jsx(D,{onClick:()=>{alert("Función deshacer (implementar)")},icon:e.jsx(Rs,{className:"h-4 w-4"}),title:"Deshacer"}),e.jsx(D,{onClick:()=>{alert("Función rehacer (implementar)")},icon:e.jsx(Fa,{className:"h-4 w-4"}),title:"Rehacer"})]})]})]})})},ar=({currentSize:s,onSizeChange:m,presetData:l,workspaceDimensions:k})=>((()=>{if(l!=null&&l.canvas_config){const h=typeof l.canvas_config=="string"?JSON.parse(l.canvas_config):l.canvas_config;let y=h.width,v=h.height;return{width:y,height:v,unit:"cm"}}return null})(),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 h-full items-center",children:k&&e.jsx("div",{className:"text-sm customtext-neutral-dark font-medium ml-2",children:k.originalWidth&&e.jsxs("div",{children:["Dimensiones: ",k.originalWidth," cm x",k.originalHeight," cm"]})})}));function rr(s,m){var I,W,X,n;const l=parseInt((W=(I=s.style)==null?void 0:I.gap)==null?void 0:W.replace("px",""))||16,k=parseInt((n=(X=s.style)==null?void 0:X.padding)==null?void 0:n.replace("px",""))||16,o=_=>{const d=_.match(/grid-cols-(\d+)/),L=_.match(/grid-rows-(\d+)/),K=d?parseInt(d[1]):1,E=L?parseInt(L[1]):1;return{cols:K,rows:E}},{cols:h,rows:y}=o(s.template),v=m.width-2*k,T=m.height-2*k,S=(v-l*(h-1))/h,P=(T-l*(y-1))/y;return console.log("🎯 [WORKSPACE REPLICA] Grid simulation:",{template:s.template,cols:h,rows:y,gap:l,padding:k,workspace:m,cellSize:{width:S,height:P}}),{cols:h,rows:y,gap:l,padding:k,cellWidth:S,cellHeight:P,contentX:k,contentY:k}}function _s(s,m,l,k,o,h){if(!m||!s||o<=0||h<=0)return;const y=m.width/m.height,v=o/h;let T,S,P,I;y>v?(I=m.height,P=I*v,T=(m.width-P)/2,S=0):(P=m.width,I=P/v,T=0,S=(m.height-I)/2),s.save(),s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high";try{s.drawImage(m,Math.max(0,T),Math.max(0,S),Math.min(P,m.width-Math.max(0,T)),Math.min(I,m.height-Math.max(0,S)),l,k,o,h)}catch(W){console.error("Error dibujando imagen:",W)}s.restore()}function or(s,m,l,k,o,h){return new Promise(async y=>{try{const v=new Image;v.crossOrigin="anonymous",v.onload=()=>{var d,L,K,E;const T=((d=m.position)==null?void 0:d.x)||0,S=((L=m.position)==null?void 0:L.y)||0,P=T>=0&&T<=1,I=S>=0&&S<=1,W=l+(P?T*o:T),X=k+(I?S*h:S),n=(K=m.size)!=null&&K.width?m.size.width<=1?m.size.width*o:m.size.width:o,_=(E=m.size)!=null&&E.height?m.size.height<=1?m.size.height*h:m.size.height:h;console.log("🖼️ [WORKSPACE REPLICA] Imagen:",{id:m.id,cellPos:{x:l,y:k,width:o,height:h},elementPos:{x:W,y:X,width:n,height:_},originalPos:{x:T,y:S},isRelative:{x:P,y:I}}),m.filters&&(s.filter=`
                        brightness(${(m.filters.brightness||100)/100})
                        contrast(${(m.filters.contrast||100)/100})
                        saturate(${(m.filters.saturation||100)/100})
                        blur(${m.filters.blur||0}px)
                        opacity(${(m.filters.opacity||100)/100})
                    `),_s(s,v,W,X,n,_),s.filter="none",y()},v.onerror=()=>{console.error("Error cargando imagen:",m.content),y()},v.src=m.content}catch(v){console.error("Error en renderImageElement:",v),y()}})}function nr(s,m,l,k,o,h){var y,v,T,S;try{const P=((y=m.position)==null?void 0:y.x)||0,I=((v=m.position)==null?void 0:v.y)||0,W=P>=0&&P<=1,X=I>=0&&I<=1,n=l+(W?P*o:P),_=k+(X?I*h:I),d=(T=m.size)!=null&&T.width?m.size.width<=1?m.size.width*o:m.size.width:o*.8,L=(S=m.size)!=null&&S.height?m.size.height<=1?m.size.height*h:m.size.height:h*.2;console.log("📝 [WORKSPACE REPLICA] Texto:",{id:m.id,content:m.content,cellPos:{x:l,y:k,width:o,height:h},elementPos:{x:n,y:_,width:d,height:L}});const K=m.style||{},E=parseInt(K.fontSize)||16,j=K.fontFamily||"Arial, sans-serif",ee=K.fontWeight||"normal",M=K.fontStyle||"normal",Y=K.color||"#000000",B=K.textAlign||"left",de=K.backgroundColor,ue=parseInt(K.padding)||8;s.save(),s.font=`${ee} ${M} ${E}px ${j}`,s.fillStyle=Y,s.textBaseline="top",de&&de!=="transparent"&&(s.fillStyle=de,s.fillRect(n,_,d,L),s.fillStyle=Y);const fe=m.content.split(`
`),re=E*1.2;fe.forEach((pe,te)=>{if(pe.trim()){let ie=n+ue;const w=_+ue+te*re;B==="center"?(ie=n+d/2,s.textAlign="center"):B==="right"?(ie=n+d-ue,s.textAlign="right"):s.textAlign="left",ie>=0&&w>=0&&ie<s.canvas.width&&w<s.canvas.height&&s.fillText(pe,ie,w)}}),s.restore()}catch(P){console.error("Error en renderTextElement:",P)}}async function ir({pages:s,workspaceDimensions:m,presetData:l}){var o;const k={};console.log("🎯 [WORKSPACE REPLICA] Iniciando generación IDÉNTICA al workspace..."),console.log("📐 [WORKSPACE REPLICA] Dimensiones:",m);for(const h of s)try{console.log(`🔄 [WORKSPACE REPLICA] Procesando página: ${h.id} (${h.type})`);const y=document.createElement("canvas"),v=y.getContext("2d",{willReadFrequently:!0});y.width=m.width,y.height=m.height,v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.textRendering="geometricPrecision",console.log("🎨 [WORKSPACE REPLICA] Renderizando background...");const T=h.backgroundColor||"#ffffff";if(v.fillStyle=T,v.fillRect(0,0,y.width,y.height),console.log("🎨 [WORKSPACE REPLICA] Background color aplicado:",T),h.backgroundImage)try{console.log("🖼️ [WORKSPACE REPLICA] Cargando background image:",h.backgroundImage);const _=new Image;_.crossOrigin="anonymous",await new Promise((d,L)=>{_.onload=d,_.onerror=L,_.src=h.backgroundImage}),_s(v,_,0,0,y.width,y.height),console.log("✅ [WORKSPACE REPLICA] Background image aplicada")}catch(_){console.error("❌ [WORKSPACE REPLICA] Error con background image:",_)}console.log("🗂️ [WORKSPACE REPLICA] Renderizando grid layout...");const S=ce.find(_=>_.id===h.layout)||ce[0];console.log("📋 [WORKSPACE REPLICA] Layout actual:",S.name,S.template);const P=rr(S,m);if(h.cells&&Array.isArray(h.cells)){console.log(`📦 [WORKSPACE REPLICA] Renderizando ${h.cells.length} celdas...`);const _=[...h.cells].sort((d,L)=>{const K=h.cells.indexOf(d),E=h.cells.indexOf(L);return K-E});for(let d=0;d<_.length;d++){const L=_[d],K=Math.floor(d/P.cols),E=d%P.cols,j=P.contentX+E*(P.cellWidth+P.gap),ee=P.contentY+K*(P.cellHeight+P.gap);if(console.log(`📦 [WORKSPACE REPLICA] Celda ${d} (${L.id}):`,{gridPos:{row:K,col:E},realPos:{x:j,y:ee,width:P.cellWidth,height:P.cellHeight}}),v.save(),v.fillStyle="transparent",v.fillRect(j,ee,P.cellWidth,P.cellHeight),v.restore(),L.elements&&Array.isArray(L.elements)){const M=[...L.elements].sort((Y,B)=>(Y.zIndex||0)-(B.zIndex||0));console.log(`🔹 [WORKSPACE REPLICA] Renderizando ${M.length} elementos en celda ${L.id}`);for(const Y of M){if(Y.id==="cover-base"||Y.id==="final-base"||(o=Y.id)!=null&&o.startsWith("content-base-")){console.log("⏭️ [WORKSPACE REPLICA] Saltando elemento base:",Y.id);continue}console.log(`🔸 [WORKSPACE REPLICA] Renderizando elemento: ${Y.id} (${Y.type})`),Y.type==="image"&&Y.content?await or(v,Y,j,ee,P.cellWidth,P.cellHeight):Y.type==="text"&&Y.content&&nr(v,Y,j,ee,P.cellWidth,P.cellHeight)}}}}console.log("🖼️ [WORKSPACE REPLICA] Generando thumbnail final...");const I=document.createElement("canvas"),W=I.getContext("2d"),X=1200,n=Math.min(X/y.width,X/y.height);I.width=Math.round(y.width*n),I.height=Math.round(y.height*n),W.imageSmoothingEnabled=!0,W.imageSmoothingQuality="high",W.drawImage(y,0,0,y.width,y.height,0,0,I.width,I.height),k[h.id]=I.toDataURL("image/png",.9),console.log(`✅ [WORKSPACE REPLICA] Thumbnail generado para ${h.id} (${h.type}): ${I.width}x${I.height}`),console.log(`📋 [WORKSPACE REPLICA] ID de la página: ${h.id}, Tipo: ${h.type}`)}catch(y){console.error(`❌ [WORKSPACE REPLICA] Error generando thumbnail para página ${h.id}:`,y),k[h.id]=null}return console.log("🎯 [WORKSPACE REPLICA] ¡Generación COMPLETADA! Thumbnails idénticos al workspace."),console.log("📋 [WORKSPACE REPLICA] Thumbnails generados:",Object.keys(k)),console.log("📊 [WORKSPACE REPLICA] Total de thumbnails:",Object.keys(k).length),k}const lr=async(s,m,l)=>{var k;try{console.log("📤 [SAVE] Subiendo imagen al backend:",m);const[o,h]=s.split(","),y=((k=o.match(/data:image\/(\w+)/))==null?void 0:k[1])||"png",v=new FormData,T=atob(h),S=new Array(T.length);for(let n=0;n<T.length;n++)S[n]=T.charCodeAt(n);const P=new Uint8Array(S),I=new Blob([P],{type:`image/${y}`});v.append("image",I,`element_${m}.${y}`),v.append("project_id",l),v.append("element_id",m);const W=await fetch("/api/canvas/projects/upload-image",{method:"POST",headers:{Accept:"application/json"},credentials:"include",body:v});if(!W.ok)throw new Error("Error al subir imagen al servidor");const X=await W.json();return console.log("✅ [SAVE] Imagen subida exitosamente:",X.url),X.url}catch(o){throw console.error("❌ [SAVE] Error subiendo imagen:",o),o}},cr=async(s,m)=>{var h,y;console.log("🔄 [SAVE] Procesando imágenes para guardado...");const l=[];let k=0,o=0;for(const v of s)for(const T of v.cells||[])for(const S of T.elements||[])S.type==="image"&&((h=S.content)!=null&&h.startsWith("data:image/"))&&k++;console.log(`📊 [SAVE] Total de imágenes base64 a procesar: ${k}`);for(const v of s){const T={...v};T.cells=[];for(const S of v.cells||[]){const P={...S};P.elements=[];for(const I of S.elements||[]){const W={...I};if(I.type==="image"&&((y=I.content)!=null&&y.startsWith("data:image/")))try{const X=await lr(I.content,I.id,m);W.content=X,W.isUploaded=!0,o++,console.log(`✅ [SAVE] Imagen ${o}/${k} procesada`)}catch(X){console.error("❌ [SAVE] Error procesando imagen:",I.id,X),W.uploadError=X.message}P.elements.push(W)}T.cells.push(P)}l.push(T)}return console.log(`✅ [SAVE] Procesamiento completado: ${o}/${k} imágenes subidas`),l},dr=async(s,m)=>{var l;try{console.log("🔍 [DEBUG] saveThumbnailsAsFiles llamada con:",{projectId:s,thumbnailsCount:Object.keys(m).length});const k=[];for(const[y,v]of Object.entries(m))console.log(`🔍 [DEBUG] Procesando thumbnail para página ${y}:`,{hasData:!!v,isBase64:v&&v.startsWith("data:image/"),dataLength:v?v.length:0}),v&&v.startsWith("data:image/")&&k.push({page_id:y,thumbnail_data:v});if(k.length===0){console.log("ℹ️ [THUMBNAILS] No hay thumbnails base64 para guardar");return}console.log(`🖼️ [THUMBNAILS] Guardando ${k.length} thumbnails como archivos...`),console.log(`🔍 [DEBUG] URL del endpoint: /api/thumbnails/${s}/save-as-files`);const o=await fetch(`/api/thumbnails/${s}/save-as-files`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)||""},credentials:"include",body:JSON.stringify({thumbnails:k})});if(console.log("🔍 [DEBUG] Respuesta del servidor:",{status:o.status,statusText:o.statusText,ok:o.ok}),!o.ok){const y=await o.text();throw console.error("❌ [THUMBNAILS] Error respuesta del servidor:",y),new Error(`Error al guardar thumbnails: ${o.status} ${o.statusText}`)}const h=await o.json();return console.log("✅ [THUMBNAILS] Thumbnails guardados como archivos:",h),h}catch(k){throw console.error("❌ [THUMBNAILS] Error guardando thumbnails:",k),k}},Is=async(s,m,l,k,o,h,y=!1)=>{try{if(!(m!=null&&m.id))throw new Error("No se encontró el ID del proyecto");console.log(`💾 [SAVE] Iniciando ${y?"auto-guardado":"guardado manual"}...`);let v=s;y||(v=await cr(s,m.id));const T={pages:v,projectInfo:{id:m.id,item_id:l==null?void 0:l.id,title:l==null?void 0:l.title,preset_id:k==null?void 0:k.id},workspace:{width:o.width,height:o.height,scale:o.scale},meta:{savedAt:new Date().toISOString(),version:"2.0",isAutoSave:y,totalPages:s.length}},S=y?"save-progress":"save",P=await fetch(`/api/canvas/projects/${m.id}/${S}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({design_data:T,thumbnails:h})});if(!P.ok){const W=await P.json().catch(()=>({}));throw new Error(W.message||"Error al guardar el proyecto")}const I=await P.json();if(console.log(`✅ [SAVE] ${y?"Auto-guardado":"Guardado"} exitoso:`,I),!y&&h&&Object.keys(h).length>0){console.log("🖼️ [SAVE] Guardando thumbnails como archivos...");try{await dr(m.id,h),console.log("✅ [SAVE] Thumbnails guardados como archivos")}catch(W){console.warn("⚠️ [SAVE] Error guardando thumbnails como archivos:",W)}}return{success:!0,data:I}}catch(v){return console.error(`❌ [SAVE] Error en ${y?"auto-guardado":"guardado"}:`,v),{success:!1,error:v.message}}},mr=(s,m,l,k,o,h)=>{const[y,v]=g.useState("saved"),[T,S]=g.useState(null),[P,I]=g.useState(null),[W,X]=g.useState(null),[n,_]=g.useState(!1),[d,L]=g.useState(navigator.onLine),K=g.useRef(null),E=g.useRef(null),j=g.useRef(null),ee=g.useRef(!1),M=g.useRef(null),Y=15e3,B=2e3,de=5e3,ue=g.useCallback((w,Z)=>{try{const oe={pages:w.map(D=>{var se;return{id:D.id,layout:D.layout,cells:((se=D.cells)==null?void 0:se.map(le=>{var be;return{id:le.id,elements:((be=le.elements)==null?void 0:be.map(me=>{var ve;return{id:me.id,type:me.type,content:me.type==="image"&&((ve=me.content)!=null&&ve.startsWith("data:image/"))?`[IMAGE_${me.content.length}]`:me.content,position:me.position,size:me.size,style:me.style,filters:me.filters,rotation:me.rotation}}))||[]}}))||[]}})||[],workspace:{width:Z==null?void 0:Z.width,height:Z==null?void 0:Z.height}};return btoa(JSON.stringify(oe)).substring(0,32)}catch(oe){return console.warn("⚠️ [AUTO-SAVE] Error generando hash:",oe),Date.now().toString()}},[]),fe=g.useCallback(()=>`album_editor_autosave_${(m==null?void 0:m.id)||"draft"}`,[m==null?void 0:m.id]),re=g.useCallback(w=>{try{const Z=fe(),oe={...w,savedAt:Date.now(),version:"2.1"};return localStorage.setItem(Z,JSON.stringify(oe)),console.log("💾 [AUTO-SAVE] Guardado en localStorage"),!0}catch(Z){return console.error("❌ [AUTO-SAVE] Error guardando en localStorage:",Z),!1}},[fe]),pe=g.useCallback(()=>{var w;try{const Z=fe(),oe=localStorage.getItem(Z);if(oe){const D=JSON.parse(oe);return console.log("📂 [AUTO-SAVE] Datos encontrados en localStorage:",{pages:(w=D.pages)==null?void 0:w.length,savedAt:new Date(D.savedAt).toLocaleString()}),D}}catch(Z){console.error("❌ [AUTO-SAVE] Error cargando desde localStorage:",Z)}return null},[fe]),te=g.useCallback(async(w=!1)=>{if(ee.current&&!w){console.log("⏳ [AUTO-SAVE] Guardado en progreso, saltando...");return}if(!(m!=null&&m.id)||!s||s.length===0){console.log("⚠️ [AUTO-SAVE] Datos insuficientes para guardar");return}const Z=ue(s,o);if(!w&&Z===j.current){console.log("📊 [AUTO-SAVE] Sin cambios detectados, saltando guardado");return}try{ee.current=!0,v("saving"),X(null);const oe={pages:s,projectInfo:{id:m.id,item_id:l==null?void 0:l.id,title:l==null?void 0:l.title,preset_id:k==null?void 0:k.id},workspace:o,meta:{savedAt:new Date().toISOString(),version:"2.1",contentHash:Z}};if(re(oe),d){const D=await Is(s,m,l,k,o,h,!0);if(D.success)j.current=Z,I(new Date),v("saved"),_(!1),console.log("✅ [AUTO-SAVE] Guardado exitoso en base de datos");else throw new Error(D.error)}else console.log("� [AUTO-SAVE] Sin conexión, solo guardado en localStorage"),v("pending"),_(!0)}catch(oe){console.error("❌ [AUTO-SAVE] Error:",oe),X(oe.message),v("error"),d&&(M.current=setTimeout(()=>{console.log("🔄 [AUTO-SAVE] Reintentando guardado..."),te(!0)},de))}finally{ee.current=!1}},[s,m,l,k,o,h,ue,re,d]),ie=g.useCallback(async()=>{try{v("saving");const w=await Is(s,m,l,k,o,h,!1);if(w.success){const Z=ue(s,o);j.current=Z,S(new Date),v("saved"),_(!1),$.success("💾 Proyecto guardado exitosamente"),console.log("✅ [MANUAL-SAVE] Guardado manual exitoso")}else X(w.error),v("error"),$.error(`❌ Error al guardar: ${w.error}`);return w.success}catch(w){return console.error("❌ [MANUAL-SAVE] Error:",w),X(w.message),v("error"),$.error(`❌ Error inesperado: ${w.message}`),!1}},[s,m,l,k,o,h,ue]);return g.useEffect(()=>{if(!(m!=null&&m.id)||!s||s.length===0)return;const w=ue(s,o);return j.current&&w!==j.current?(console.log("🔄 [AUTO-SAVE] Cambios detectados, programando guardado..."),_(!0),v("pending"),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{te()},B)):j.current||(j.current=w),()=>{E.current&&clearTimeout(E.current)}},[s,o,m==null?void 0:m.id,ue,te]),g.useEffect(()=>{if(m!=null&&m.id)return K.current&&clearInterval(K.current),K.current=setInterval(()=>{n&&(console.log("⏰ [AUTO-SAVE] Auto-save periódico activado"),te())},Y),()=>{K.current&&clearInterval(K.current)}},[m==null?void 0:m.id,n,te]),g.useEffect(()=>{const w=()=>{console.log("🌐 [AUTO-SAVE] Conexión restaurada"),L(!0),n&&setTimeout(()=>te(!0),1e3)},Z=()=>{console.log("📴 [AUTO-SAVE] Conexión perdida"),L(!1)};return window.addEventListener("online",w),window.addEventListener("offline",Z),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",Z)}},[n,te]),g.useEffect(()=>{const w=Z=>{if(n){const oe={pages:s,projectInfo:{id:m.id},workspace:o,meta:{savedAt:new Date().toISOString()}};return re(oe),Z.preventDefault(),Z.returnValue="¿Estás seguro de salir? Hay cambios sin guardar.","¿Estás seguro de salir? Hay cambios sin guardar."}};return window.addEventListener("beforeunload",w),()=>window.removeEventListener("beforeunload",w)},[n,s,m==null?void 0:m.id,o,re]),g.useEffect(()=>()=>{E.current&&clearTimeout(E.current),K.current&&clearInterval(K.current),M.current&&clearTimeout(M.current)},[]),g.useEffect(()=>{W&&(W.includes("max_allowed_packet")||W.includes("data_too_large")?$.error("❌ El proyecto es demasiado grande para guardar automáticamente. Reduce el número o tamaño de imágenes."):$.error(`❌ Error de auto-guardado: ${W}`))},[W]),{saveStatus:y,lastSaved:T,lastAutoSaved:P,saveError:W,hasUnsavedChanges:n,isOnline:d,saveManually:ie,performAutoSave:()=>te(!0),loadFromLocalStorage:pe,getStorageKey:fe,autoSaveInterval:Y,debounceDelay:B}},gr=({saveStatus:s,lastSaved:m,lastAutoSaved:l,hasUnsavedChanges:k,isOnline:o,saveError:h,onManualSave:y,className:v=""})=>{const T=I=>{if(!I)return null;const X=new Date-I,n=Math.floor(X/(1e3*60)),_=Math.floor(X/1e3);if(_<30)return"hace unos segundos";if(n<1)return`hace ${_}s`;if(n<60)return`hace ${n}m`;const d=Math.floor(n/60);return d<24?`hace ${d}h`:I.toLocaleDateString()},P=(()=>{if(!o)return{icon:e.jsx(As,{className:"w-4 h-4"}),color:"text-orange-500",bg:"bg-orange-50 border-orange-200",text:"Sin conexión",detail:"Guardado local activo"};switch(s){case"saving":return{icon:e.jsx(oa,{className:"w-4 h-4 animate-spin"}),color:"text-blue-500",bg:"bg-blue-50 border-blue-200",text:"Guardando...",detail:"Sincronizando cambios"};case"saved":return{icon:e.jsx(Ms,{className:"w-4 h-4"}),color:"text-green-500",bg:"bg-green-50 border-green-200",text:"Guardado",detail:l?`Auto-guardado ${T(l)}`:"Todo sincronizado"};case"error":return{icon:e.jsx(Ls,{className:"w-4 h-4"}),color:"text-red-500",bg:"bg-red-50 border-red-200",text:"Error al guardar",detail:h||"Error desconocido"};case"pending":return{icon:e.jsx(ra,{className:"w-4 h-4"}),color:"text-yellow-600",bg:"bg-yellow-50 border-yellow-200",text:k?"Cambios pendientes":"Pendiente",detail:"Esperando a guardar..."};default:return{icon:e.jsx(Os,{className:"w-4 h-4"}),color:"text-gray-500",bg:"bg-gray-50 border-gray-200",text:"Listo",detail:"Sistema de guardado activo"}}})();return e.jsxs("div",{className:`relative group ${v}`,children:[e.jsxs("div",{className:`
                    inline-flex items-center gap-2 px-3 py-2 rounded-lg border-2 
                    transition-all duration-200 cursor-pointer
                    ${P.bg} ${P.color}
                    hover:shadow-md
                `,onClick:()=>s!=="saving"&&(y==null?void 0:y()),children:[P.icon,e.jsx("span",{className:"text-sm font-medium",children:P.text}),k&&s!=="saving"&&e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),e.jsx("div",{className:"flex items-center",children:o?e.jsx(Ga,{className:"w-3 h-3 text-green-500"}):e.jsx(As,{className:"w-3 h-3 text-orange-500"})})]}),e.jsxs("div",{className:`
                absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2
                bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg
                opacity-0 group-hover:opacity-100 pointer-events-none
                transition-opacity duration-200 z-50 whitespace-nowrap
            `,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:P.text}),e.jsx("div",{className:"text-gray-300",children:P.detail}),m&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Último guardado manual: ",T(m)]}),e.jsxs("div",{className:"text-gray-400 text-xs",children:[o?"🌐 En línea":"📴 Sin conexión",s!=="saving"&&" • Click para guardar"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]}),s==="saving"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-blue-200 rounded-b-lg overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 animate-pulse"})})]})},hr=({isOpen:s,onClose:m,savedProgress:l,onLoadProgress:k,onDiscardProgress:o})=>{var P;const[h,y]=g.useState(!1);if(!s||!l)return null;const v=async()=>{y(!0);try{await k(l),m()}catch(I){console.error("Error cargando progreso:",I)}finally{y(!1)}},T=async()=>{y(!0);try{await o(),m()}catch(I){console.error("Error descartando progreso:",I)}finally{y(!1)}},S=I=>{const W=new Date(I),n=new Date-W,_=Math.floor(n/(1e3*60)),d=Math.floor(_/60),L=Math.floor(d/24);return _<1?"hace unos segundos":_<60?`hace ${_} minutos`:d<24?`hace ${d} horas`:L===1?"ayer":L<7?`hace ${L} días`:W.toLocaleDateString()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 p-6 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Rs,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progreso Guardado Encontrado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Se encontró un trabajo sin finalizar"})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ya,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Guardado automáticamente"}),e.jsx("div",{className:"text-xs text-gray-500",children:S(l.savedAt)})]})]}),l.pages&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(aa,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[l.pages.length," páginas en progreso"]}),e.jsx("div",{className:"text-xs text-gray-500",children:((P=l.meta)==null?void 0:P.version)||"Versión no especificada"})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ls,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"¿Qué te gustaría hacer?"}),e.jsx("div",{className:"text-amber-700",children:"Puedes continuar desde donde lo dejaste o comenzar un nuevo diseño."})]})]})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[e.jsxs("button",{onClick:v,disabled:h,className:`flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[h?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(Ms,{className:"w-4 h-4"}),"Continuar Editando"]}),e.jsxs("button",{onClick:T,disabled:h,className:`flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[e.jsx(At,{className:"w-4 h-4"}),"Comenzar de Nuevo"]})]}),e.jsx("button",{onClick:m,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",disabled:h,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},St=Et.memo(({pageId:s,thumbnail:m,altText:l,type:k})=>m?e.jsx("img",{src:m,alt:l,className:"w-full h-full object-contain",loading:"lazy",style:{transition:"opacity 0.2s ease-in-out",imageRendering:"optimizeQuality"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center"})),ur=Et.memo(({images:s,onImageSelect:m,isLoading:l})=>{const k=Et.memo(({image:o})=>{const[h,y]=g.useState(!1),[v,T]=g.useState(!1),[{isDragging:S},P]=da(()=>({type:"PROJECT_IMAGE",item:{type:"PROJECT_IMAGE",imageUrl:o.url},collect:X=>({isDragging:!!X.isDragging()})})),I=o.thumbnail_url||o.url,W=o.url;return e.jsxs("div",{ref:P,className:`relative group cursor-pointer bg-gray-50 rounded-lg overflow-hidden border-2 border-transparent hover:border-[#af5cb8] transition-all duration-200 ${S?"opacity-50 scale-95":""}`,onClick:()=>m(W),children:[e.jsxs("div",{className:"aspect-square relative",children:[!h&&!v&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 animate-pulse flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[#af5cb8] border-t-transparent rounded-full animate-spin"})}),v?e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(Ae,{className:"h-6 w-6 mx-auto mb-1"}),e.jsx("p",{className:"text-xs",children:"Error al cargar"})]})}):e.jsx("img",{src:I,alt:o.filename||"Project image",className:`w-full h-full object-cover transition-opacity duration-300 ${h?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>y(!0),onError:()=>T(!0)})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("div",{className:"bg-white rounded-full p-2 shadow-md",children:e.jsx(qe,{className:"h-4 w-4 text-[#af5cb8]"})})})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:o.has_thumbnail?"Optimizada":"Arrastra o haz clic"}),o.has_thumbnail&&e.jsx("div",{className:"absolute top-2 left-2 bg-green-500 rounded-full w-2 h-2"})]})});return l?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:6}).map((o,h)=>e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg animate-pulse"},h))}):s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"No hay imágenes en este proyecto"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sube una imagen para empezar"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.map((o,h)=>e.jsx(k,{image:o},`${o.id||o.url}-${h}`))}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:[s.filter(o=>o.has_thumbnail).length," de ",s.length," imágenes optimizadas"]})})]})});function mo(){var Ot,Mt,$t,Lt,_t,Ft,Wt,Ht,Bt,Ut,Vt,qt,Gt,Kt,Xt,Jt,Yt,Qt,Zt,Dt,es,ts,ss,as,rs,os,ns,is,ls,cs,ds,ms,gs,hs,us,ps,xs,fs;const[s,m]=g.useState(null),[l,k]=g.useState(null),[o,h]=g.useState(null),[y,v]=g.useState(null),[T,S]=g.useState(!0),[P,I]=g.useState(null);g.useEffect(()=>{(async()=>{var a;try{const i=new URLSearchParams(window.location.search).get("project");if(!i){I("No se encontró el ID del proyecto en la URL"),S(!1);return}const c=await fetch(`/api/canvas/projects/${i}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)||"","X-Requested-With":"XMLHttpRequest"}});if(!c.ok)throw new Error("Error al cargar el proyecto");const p=await c.json();m(p.project),k(p.item),h(p.canvasPreset),v(p.initialProject),S(!1)}catch(r){console.error("❌ Error cargando proyecto:",r),I(r.message),S(!1)}})()},[]);const[W,X]=g.useState(ks.Local.get(`${Ss.APP_CORRELATIVE}_cart`)??[]);g.useEffect(()=>{ks.Local.set(`${Ss.APP_CORRELATIVE}_cart`,W)},[W]);const[n,_]=g.useState([]),[d,L]=g.useState(0),[K,E]=g.useState("preset"),[j,ee]=g.useState(null),[M,Y]=g.useState(null),[B,de]=g.useState("elements"),[ue,fe]=g.useState("basic"),[re,pe]=g.useState([JSON.stringify(n)]),[te,ie]=g.useState(0),[w,Z]=g.useState(!1),[oe,D]=g.useState(null),[se,le]=g.useState({}),[be,me]=g.useState(!1),[ve,Fe]=g.useState([]),[We,Ge]=g.useState(!1),[Oe,rt]=g.useState(new Map),we=g.useRef(null),Ke=g.useRef(),[F,Xe]=g.useState({width:800,height:600}),He=g.useCallback(async()=>{if(s!=null&&s.id)try{const t=await fetch(`/api/thumbnails/${s.id}`);if(t.ok){const a=await t.json();if(a.success&&a.thumbnails&&a.thumbnails.length>0){const r={};a.thumbnails.forEach(i=>{i.page_id&&i.thumbnail_url&&(r[i.page_id]=i.thumbnail_url)}),Object.keys(r).length>0?(le(i=>({...i,...r})),console.log("✅ Thumbnails cargados desde storage:",Object.keys(r).length)):console.log("ℹ️ No hay thumbnails guardados, usando generación local")}else console.log("ℹ️ No hay thumbnails guardados para este proyecto")}}catch(t){console.warn("⚠️ Error cargando thumbnails guardados (usando locales):",t)}},[s==null?void 0:s.id]),Ne=g.useCallback(async()=>{if(!(!(n!=null&&n.length)||!F||!o))try{const t=await ir({pages:n,workspaceDimensions:F,presetData:o});t&&Object.keys(t).length>0&&(le(a=>({...a,...t})),console.log("✅ Thumbnails locales generados:",Object.keys(t).length))}catch(t){console.warn("⚠️ Error generando thumbnails locales:",t)}},[n,F,o]),Be=g.useCallback(async()=>{var t;if(!(!(s!=null&&s.id)||!(n!=null&&n.length)))try{const a=await fetch(`/api/thumbnails/${s.id}/existing`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({pages:n})});if(a.ok){const r=await a.json();r&&Object.keys(r).length>0?(le(i=>({...i,...r})),console.log("✅ Thumbnails existentes cargados:",Object.keys(r).length)):(console.log("📸 No hay thumbnails existentes, generando nuevos..."),await Ne())}}catch(a){console.warn("⚠️ Error cargando thumbnails existentes:",a),await Ne()}},[s==null?void 0:s.id,n,Ne]);g.useCallback(async()=>{if(!(!(s!=null&&s.id)||!(n!=null&&n.length)))try{const t=n[d];if(!t)return;const a=await fetch(`/api/thumbnails/${s.id}/generate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({pages:[t],width:F.width,height:F.height,quality:95,scale:4,dpi:300})});if(a.ok){const r=await a.json();if(r.success&&r.thumbnails){const i={};r.thumbnails.forEach(c=>{c.page_id&&c.thumbnail_url&&(i[c.page_id]=c.thumbnail_url)}),le(c=>({...c,...i})),console.log("✅ Thumbnail generado y guardado en storage para página actual:",r.thumbnails.length)}}}catch(t){console.warn("⚠️ Error generando thumbnail:",t)}},[s==null?void 0:s.id,n,d,F]),g.useCallback(async()=>{if(!(!(s!=null&&s.id)||!(n!=null&&n.length)))try{const t=await fetch(`/api/thumbnails/${s.id}/generate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({pages:n,width:F.width,height:F.height,quality:95,scale:4,dpi:300})});if(t.ok){const a=await t.json();if(a.success&&a.thumbnails){const r={};a.thumbnails.forEach(i=>{i.page_id&&i.thumbnail_url&&(r[i.page_id]=i.thumbnail_url)}),le(i=>({...i,...r})),console.log("✅ Todos los thumbnails generados y guardados en storage:",a.thumbnails.length)}}}catch(t){console.warn("⚠️ Error generando todos los thumbnails:",t)}},[s==null?void 0:s.id,n,F]),g.useEffect(()=>{if(y&&l&&o){if(y.pages&&Array.isArray(y.pages)){const t=y.pages.map(a=>{let r=null,i=o.background_color||"#ffffff";return a.type==="cover"?l.cover_image&&(r=`/storage/images/item/${l.cover_image}`):a.type==="content"?l.content_image&&(r=`/storage/images/item/${l.content_image}`):(a.type==="final"||a.type==="contraportada")&&l.back_cover_image&&(r=`/storage/images/item/${l.back_cover_image}`),{...a,backgroundImage:r,backgroundColor:i}});_(t),pe([JSON.stringify(t)]),ie(0),setTimeout(()=>{He()},100)}else{const t=Se(o,l);_(t),pe([JSON.stringify(t)]),ie(0),setTimeout(()=>{He()},100)}typeof y.currentPage=="number"&&L(y.currentPage),y.workspaceSize&&E(y.workspaceSize)}},[y,l,o,He]);const xe=mr(n,s,l,o,F,se),Je=()=>{if(o!=null&&o.width&&(o!=null&&o.height)){let f=o.width,b=o.height,N=f*37.8,z=b*37.8;if(N&&z){const R=window.innerWidth*.6,H=window.innerHeight*.7,C=R/N,A=H/z,O=Math.min(C,A,1);return{width:Math.round(N*O),height:Math.round(z*O),originalWidth:f,originalHeight:b,scale:O,unit:"cm",originalWidthPx:Math.round(N),originalHeightPx:Math.round(z)}}}if(o!=null&&o.extra_settings)try{const f=typeof o.extra_settings=="string"?JSON.parse(o.extra_settings):o.extra_settings;if(f!=null&&f.canvas_config){const b=f.canvas_config;let N=b.width,z=b.height,R=N*37.8,H=z*37.8;if(R&&H){const C=window.innerWidth*.6,A=window.innerHeight*.7,O=C/R,U=A/H,ae=Math.min(O,U,1);return{width:Math.round(R*ae),height:Math.round(H*ae),originalWidth:N,originalHeight:z,scale:ae,unit:"cm",originalWidthPx:Math.round(R),originalHeightPx:Math.round(H)}}}}catch(f){console.warn("Error parsing extra_settings:",f)}const t={square:{width:600,height:600},landscape:{width:1280,height:720},portrait:{width:600,height:800},wide:{width:1200,height:600},tall:{width:540,height:960},preset:{width:800,height:600}},a=t[K]||t.preset,r=window.innerWidth*.6,i=window.innerHeight*.7,c=r/a.width,p=i/a.height,u=Math.min(c,p,1);return{width:Math.round(a.width*u),height:Math.round(a.height*u),originalWidth:a.width,originalHeight:a.height,scale:u,unit:"px"}},ye=g.useCallback(async(t={type:"thumbnail"})=>{if(!n[d])return null;try{let a=document.querySelector(`#page-${n[d].id}`);if(!a)return console.warn("❌ THUMBNAIL: No se encontró el elemento de página específico"),null;const r=n[d],i=t.type==="pdf",c=i?11.81:3,p=1,u=getComputedStyle(a);let f=(r==null?void 0:r.backgroundColor)||"#ffffff";u.backgroundColor&&u.backgroundColor!=="rgba(0, 0, 0, 0)"&&(f=u.backgroundColor);const b={scale:c,useCORS:!0,allowTaint:!1,backgroundColor:f,width:F.width,height:F.height,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!!i,removeContainer:!1,logging:!1,imageTimeout:i?6e4:15e3,pixelRatio:i?3:window.devicePixelRatio||1,canvas:i?document.createElement("canvas"):null,windowWidth:i?F.width*c:null,windowHeight:i?F.height*c:null,onclone:async R=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(C=>{try{R.querySelectorAll(C).forEach(O=>O.remove())}catch(A){console.warn("Error removing selector:",C,A)}});try{const C=R.querySelector(`#page-${n[d].id}`);C&&(C.style.width=F.width+"px",C.style.height=F.height+"px",C.style.position="relative",C.style.overflow="hidden",r!=null&&r.backgroundImage&&(C.style.backgroundImage=`url(${r.backgroundImage})`,C.style.backgroundSize="cover",C.style.backgroundPosition="center",C.style.backgroundRepeat="no-repeat"),r!=null&&r.backgroundColor&&(C.style.backgroundColor=r.backgroundColor))}catch(C){console.error("❌ [THUMBNAIL-FIX] Error configurando elemento de página:",C)}try{const C=new Map;a.querySelectorAll('[data-element-type="image"] img, .workspace-image, img').forEach((G,Ee)=>{if(G.complete&&G.naturalWidth>0){const he=(G.closest('[data-element-type="image"]')||G.parentElement).getBoundingClientRect(),ke=G.getBoundingClientRect();C.set(G.src,{src:G.src,naturalWidth:G.naturalWidth,naturalHeight:G.naturalHeight,containerWidth:he.width,containerHeight:he.height,objectFit:getComputedStyle(G).objectFit||"cover",objectPosition:getComputedStyle(G).objectPosition||"center",crossOrigin:G.crossOrigin})}});const O=async(G,Ee,ge,he,ke)=>new Promise(Le=>{try{const _e=Ee/ge,wt=he/ke;let yt,bt,jt,Nt,ys,bs;wt>_e?(bs=ge,ys=ge*wt,bt=ke,yt=ke*_e,jt=(he-yt)/2,Nt=0):(ys=Ee,bs=Ee/wt,yt=he,bt=he/_e,jt=0,Nt=(ke-bt)/2);const vt=R.createElement("canvas");vt.width=Ee,vt.height=ge;const Vs=vt.getContext("2d"),at=new Image;at.crossOrigin="anonymous",at.onload=()=>{try{Vs.drawImage(at,jt,Nt,yt,bt,0,0,Ee,ge);const kt=vt.toDataURL("image/png",1);G.src=kt,G.style.objectFit="fill",G.style.objectPosition="center",G.style.width="100%",G.style.height="100%",Le()}catch(kt){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en canvas processing:",kt),Le()}},at.onerror=()=>{console.warn("⚠️ [ADVANCED-THUMBNAIL] Error cargando imagen temporal"),Le()},at.src=G.src}catch(_e){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en simulateObjectFitCover:",_e),Le()}}),U=R.querySelectorAll('[data-element-type="image"] img, .workspace-image, img'),ae=[];U.forEach((G,Ee)=>{if(G.src&&C.has(G.src)){const ge=C.get(G.src),he=G.closest('[data-element-type="image"]')||G.parentElement;if(he&&(he.style.overflow="hidden",he.style.position="relative"),ge.objectFit==="cover"||G.classList.contains("object-cover")||G.classList.contains("workspace-image")){const ke=O(G,ge.containerWidth,ge.containerHeight,ge.naturalWidth,ge.naturalHeight);ae.push(ke)}else G.style.width="100%",G.style.height="100%",G.style.objectFit="fill"}}),ae.length>0&&await Promise.all(ae);const q=R.createElement("style");q.textContent=`
                            /* CORRECCIÓN THUMBNAIL: Estructura del elemento de página */
                            #page-${n[d].id} {
                                width: ${F.width}px !important;
                                height: ${F.height}px !important;
                                position: relative !important;
                                overflow: hidden !important;
                                box-sizing: border-box !important;
                            }
                            
                            /* 🖨️ IMÁGENES PROFESIONALES: Optimizada para PDF vs Thumbnails */
                            img {
                                width: 100% !important;
                                height: 100% !important;
                                object-fit: fill !important; /* fill porque ya están recortadas */
                                object-position: center !important;
                                display: block !important;
                                ${i?`
                                /* 🖨️ IMPRESIÓN PROFESIONAL 300 DPI */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: -webkit-crisp-edges !important;
                                image-rendering: -moz-crisp-edges !important;
                                image-rendering: pixelated !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: optimizeQuality !important;
                                backface-visibility: hidden !important;
                                transform: translateZ(0) scale(1) !important;
                                will-change: transform !important;
                                filter: contrast(1.02) saturate(1.05) !important;
                                `:`
                                /* Thumbnails optimizados */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: high-quality !important;
                                `}
                            }
                            
                            /* Contenedores de imagen */
                            [data-element-type="image"] {
                                overflow: hidden !important;
                                position: relative !important;
                            }
                            
                            [data-element-type="image"] > div {
                                width: 100% !important;
                                height: 100% !important;
                                overflow: hidden !important;
                            }
                            
                            /* Backgrounds de página */
                            #page-${n[d].id} {
                                background-size: cover !important;
                                background-position: center !important;
                                background-repeat: no-repeat !important;
                            }
                            
                            /* 🖨️ OPTIMIZACIONES GENERALES PARA PDF DE IMPRESIÓN */
                            ${i?`
                            * {
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                text-rendering: optimizeLegibility !important;
                                -webkit-backface-visibility: hidden !important;
                                backface-visibility: hidden !important;
                                -webkit-transform: translateZ(0) !important;
                                transform: translateZ(0) !important;
                            }
                            
                            /* Elementos de texto de alta calidad */
                            p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable] {
                                text-rendering: optimizeLegibility !important;
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                font-smooth: always !important;
                            }
                            
                            /* Elementos vectoriales de alta calidad */
                            svg, path, circle, rect, line {
                                shape-rendering: geometricPrecision !important;
                                vector-effect: non-scaling-stroke !important;
                            }
                            `:""}
                            
                            /* Resetear estilos que puedan interferir */
                            img {
                                max-width: none !important;
                                max-height: none !important;
                                border: none !important;
                                outline: none !important;
                            }
                        `,R.head.appendChild(q)}catch(C){console.error("❌ [ADVANCED-THUMBNAIL] Error en pre-procesamiento avanzado:",C);const A=R.createElement("style");A.textContent=`
                            img { object-fit: cover !important; object-position: center !important; }
                            [data-element-type="image"] { overflow: hidden !important; }
                        `,R.head.appendChild(A)}}},N=await Ns(a,b);if(i&&N){const R=N.getContext("2d");if(R){R.imageSmoothingEnabled=!1,R.imageSmoothingQuality="high";const H=R.getImageData(0,0,N.width,N.height),C=H.data;for(let A=0;A<C.length;A+=4)C[A]=Math.min(255,C[A]*1.05),C[A+1]=Math.min(255,C[A+1]*1.05),C[A+2]=Math.min(255,C[A+2]*1.05);R.putImageData(H,0,0)}}if(!N)throw new Error("html2canvas no devolvió un canvas válido para el elemento de página");if(N.width===0||N.height===0)throw new Error("Canvas del elemento de página tiene dimensiones inválidas");const z=N.toDataURL("image/png",p);if(!z||z==="data:,")throw new Error("No se pudo generar dataURL del elemento de página");return i?N:z}catch(a){console.error("❌ [THUMBNAIL-FIX] Error capturando elemento de página:",a);try{const r=document.createElement("canvas"),i=t.type==="pdf"?11.81:1;r.width=F.width*i,r.height=F.height*i;const c=r.getContext("2d"),p=workspaceBackground||(currentPageData==null?void 0:currentPageData.backgroundColor)||"#ffffff";return c.fillStyle=p,c.fillRect(0,0,r.width,r.height),c.fillStyle=p==="#ffffff"||p.includes("white")?"#374151":"#666666",c.font=`${14*i}px Arial`,c.textAlign="center",c.fillText("Página "+(d+1),r.width/2,r.height/2),t.type==="pdf"?r:r.toDataURL("image/png",1)}catch{return null}}},[d,n]),Me=g.useCallback(async()=>{if(!n[d])return;const t=await ye({type:"thumbnail"});t&&le(a=>({...a,[n[d].id]:t}))},[ye,d,n]);g.useCallback(()=>{clearTimeout(Ke.current),Ke.current=setTimeout(()=>{n[d]&&!se[n[d].id]&&Me()},1200)},[Me,n,d,se]);const Ye=g.useCallback(()=>{n[d]&&!se[n[d].id]&&setTimeout(()=>{Me()},300)},[Me,n,d,se]),ot=g.useCallback(async(t=d,a={width:800,height:600})=>{var r,i;if(!n[t])return null;try{const c=d;t!==d&&(L(t),await new Promise(b=>setTimeout(b,100)));const p=document.querySelector(`#page-${n[t].id}`);if(!p)return console.warn("Workspace element not found for page:",n[t].id),null;const u={scale:4,useCORS:!0,allowTaint:!1,backgroundColor:((r=n[t])==null?void 0:r.backgroundColor)||"#ffffff",width:p.offsetWidth,height:p.offsetHeight,removeContainer:!0,logging:!1,onclone:b=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(C=>{b.querySelectorAll(C).forEach(O=>O.remove())});const z=b.querySelector(`#page-${n[t].id}`);if(z){const C=n[t];C!=null&&C.backgroundImage&&(z.style.backgroundImage=`url(${C.backgroundImage})`,z.style.backgroundSize="cover",z.style.backgroundPosition="center",z.style.backgroundRepeat="no-repeat"),C!=null&&C.backgroundColor&&(z.style.backgroundColor=C.backgroundColor)}try{const C=p.querySelectorAll("img"),A=new Map;C.forEach((U,ae)=>{const q=getComputedStyle(U);A.set(ae,{objectFit:q.objectFit,objectPosition:q.objectPosition,width:q.width,height:q.height,borderRadius:q.borderRadius,transform:q.transform})}),b.querySelectorAll("img").forEach((U,ae)=>{const q=A.get(ae);q&&(U.style.objectFit=q.objectFit||"cover",U.style.objectPosition=q.objectPosition||"center",U.style.width=q.width,U.style.height=q.height,U.style.borderRadius=q.borderRadius,U.style.transform=q.transform)})}catch(C){console.warn("Error preservando estilos de imágenes:",C),b.querySelectorAll("img").forEach(O=>{O.style.objectFit="cover",O.style.objectPosition="center",O.style.width||(O.style.width="100%"),O.style.height||(O.style.height="100%")})}b.querySelectorAll('[class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable]').forEach(C=>{const A=C.className;A&&(C.className=A);const O=getComputedStyle?getComputedStyle(C):null;O&&(O.fontFamily&&O.fontFamily!=="Arial"&&(C.style.fontFamily=O.fontFamily),O.fontSize&&(C.style.fontSize=O.fontSize),O.fontWeight&&(C.style.fontWeight=O.fontWeight),O.fontStyle&&(C.style.fontStyle=O.fontStyle))});const H=b.createElement("style");H.textContent=`
                        /* Preservar fuentes originales y NO forzar Arial */
                        * { 
                            -webkit-font-smoothing: antialiased !important;
                            -moz-osx-font-smoothing: grayscale !important;
                        }
                        
                        /* CRÍTICO: Asegurar que las imágenes mantengan cover + CALIDAD HD */
                        img {
                            object-fit: cover !important;
                            object-position: center !important;
                            image-rendering: -webkit-optimize-contrast !important;
                            image-rendering: crisp-edges !important;
                            image-rendering: high-quality !important;
                        }
                        
                        /* CRÍTICO: Asegurar que los backgrounds de página se mantengan en cover */
                        [id^="page-"] {
                            background-size: cover !important;
                            background-position: center !important;
                            background-repeat: no-repeat !important;
                        }
                        
                        /* Asegurar que los elementos de texto mantengan sus fuentes */
                        [class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6 {
                            font-family: inherit !important;
                        }
                    `,b.head.appendChild(H)}},f=await Ns(p,u);if(a.width!==f.width||a.height!==f.height){const b=document.createElement("canvas");b.width=a.width,b.height=a.height;const N=b.getContext("2d"),z=f.width/f.height,R=a.width/a.height;let H,C,A=0,O=0;z>R?(H=a.width,C=a.width/z,O=(a.height-C)/2):(C=a.height,H=a.height*z,A=(a.width-H)/2),N.fillStyle=((i=n[t])==null?void 0:i.backgroundColor)||"#ffffff",N.fillRect(0,0,a.width,a.height),N.drawImage(f,A,O,H,C);const U=b.toDataURL("image/png",1);return t!==c&&L(c),U}return t!==c&&L(c),f.toDataURL("image/png",1)}catch(c){return console.error("❌ Error generando thumbnail de alta calidad:",c),null}},[n,d,L]);g.useEffect(()=>{const t=Je();Xe(t)},[o,K]),g.useEffect(()=>{const t=()=>{const a=Je();Xe(a)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[o,K]),g.useEffect(()=>{if(n[d]&&!se[n[d].id]){const t=setTimeout(()=>{Ye()},400);return()=>clearTimeout(t)}},[d]),g.useEffect(()=>{const t=`${F.width}x${F.height}`,a=sessionStorage.getItem("lastWorkspaceDimensions");a&&a!==t&&n.length>0&&(le({}),setTimeout(()=>{n[d]&&Ye()},800)),sessionStorage.setItem("lastWorkspaceDimensions",t)},[F.width,F.height]);const[nt,Ie]=g.useState(!1),[Qe,it]=g.useState({elementId:null,cellId:null}),[lt,Ze]=g.useState(!1),[ct,De]=g.useState(!1),[dt,mt]=g.useState(null),Ue=g.useRef(null),gt=async t=>{const a=t.target.files[0];if(!a||!(s!=null&&s.id))return;const r=new FormData;r.append("image",a),r.append("projectId",s.id);try{const c=await(await fetch("/api/canvas/editor/upload-image",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:r})).json();if(c.success){const p={id:Date.now(),filename:a.name,url:c.url,thumbnail_url:c.thumbnail_url,has_thumbnail:c.has_thumbnail,size:a.size,last_modified:Date.now()/1e3,created_at:new Date().toISOString()};Fe(u=>[p,...u]),ht(c.url),c.has_thumbnail?$.success("Imagen subida y optimizada correctamente"):$.success("Imagen subida correctamente"),we.current=setTimeout(()=>{et(!0)},1e3)}else $.error(c.message||"Error al subir la imagen")}catch(i){console.error("Error subiendo la imagen:",i),$.error("Error de red al subir la imagen")}},ht=t=>{var i,c,p,u;const a=M||((c=(i=n[d])==null?void 0:i.cells[0])==null?void 0:c.id);if(!a)return;const r={id:`image-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:t,position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:(((u=(p=n[d].cells.find(f=>f.id===a))==null?void 0:p.elements)==null?void 0:u.length)||0)+1};ze(a,r),$.success("Imagen añadida correctamente")},et=g.useCallback(async(t=!1)=>{if(s!=null&&s.id&&(we.current&&clearTimeout(we.current),!(!t&&Oe.has(s.id)&&ve.length>0)&&!(We&&!t))){Ge(!0);try{const r=await(await fetch(`/api/canvas/projects/${s.id}/images`,{method:"GET",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json"}})).json();if(r.success){const i=r.images||[];Fe(i),rt(c=>{const p=new Map(c);return p.set(s.id,i),p})}else console.error("Error cargando imágenes:",r.message)}catch(a){console.error("Error cargando imágenes del proyecto:",a)}finally{Ge(!1)}}},[s==null?void 0:s.id,Oe,ve.length,We]);g.useEffect(()=>{if(s!=null&&s.id){const t=Oe.get(s.id);if(t&&t.length>0){Fe(t);return}return we.current=setTimeout(()=>{et(!1)},150),()=>{we.current&&clearTimeout(we.current)}}},[s==null?void 0:s.id,Oe]),g.useEffect(()=>()=>{we.current&&clearTimeout(we.current)},[]);const ut=t=>{var i,c,p,u;const a=M||((c=(i=n[d])==null?void 0:i.cells[0])==null?void 0:c.id);if(!a)return;const r={id:`image-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:t,position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:(((u=(p=n[d].cells.find(f=>f.id===a))==null?void 0:p.elements)==null?void 0:u.length)||0)+1};ze(a,r),$.success("Imagen añadida desde la galería")},tt=g.useCallback(async(t,a)=>{var c,p;const r=[],i=[];for(const u of t){const f={...u};if(u.cells){f.cells=[];for(const b of u.cells){const N={...b};if(b.elements){N.elements=[];for(const z of b.elements)if(z.type==="image"&&((c=z.content)!=null&&c.startsWith("data:image/"))){const R=`${z.id}_${Date.now()}`,H=z.content.match(/^data:image\/([^;]+);base64,(.+)$/);if(H){const C=H[1],A=H[2],U=`${R}.${C==="jpeg"?"jpg":C}`;i.push({filename:U,data:A,type:C,elementId:z.id}),N.elements.push({...z,content:z.content,_wasBase64:!0,_originalSize:z.content.length,_elementId:z.id})}else N.elements.push(z)}else N.elements.push(z)}f.cells.push(N)}}r.push(f)}if(i.length>0)try{const u=await fetch(`/api/canvas/projects/${a}/upload-images`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((p=document.querySelector('meta[name="csrf-token"]'))==null?void 0:p.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({images:i})});if(u.ok){const f=await u.json();if(f.uploadedImages){const b=new Map;f.uploadedImages.forEach(N=>{b.set(N.elementId,N.url)});for(const N of r)if(N.cells){for(const z of N.cells)if(z.elements)for(const R of z.elements)R._wasBase64&&R._elementId&&b.has(R._elementId)&&(R.content=b.get(R._elementId),delete R._elementId)}}}else{const f=await u.json().catch(()=>({message:"Error desconocido en upload"}));return console.error("❌ [IMAGE-UPLOAD] Error subiendo imágenes:",f),t}}catch(u){return console.error("❌ [IMAGE-UPLOAD] Error de red subiendo imágenes:",u),t}return r},[]),Te=g.useCallback(async(t=n,a=!1)=>{var r;if(!(!(s!=null&&s.id)||!a&&t.length===0))try{const p={design_data:{pages:await tt(t,s.id),currentPage:d,workspaceDimensions:F,workspaceSize:K,selectedElement:j,selectedCell:M,history:re.slice(-5),historyIndex:Math.min(te,4),timestamp:new Date().toISOString(),version:"2.0",project:{id:s.id,name:(l==null?void 0:l.name)||"Álbum Personalizado",item_id:l==null?void 0:l.id,preset_id:o==null?void 0:o.id}},thumbnails:se},f=JSON.stringify(p).length/(1024*1024),b=await fetch(`/api/canvas/projects/${s.id}/save-progress`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},credentials:"include",body:JSON.stringify(p)});if(b.ok){const N=await b.json(),z=`editor_progress_project_${s.id}`;return localStorage.removeItem(z),n&&n.length>0&&Ne().catch(R=>{console.warn("⚠️ Error generando thumbnails locales:",R)}),!0}else{const N=await b.json().catch(()=>({message:"Error desconocido"}));return console.error("❌ [AUTO-SAVE] Error guardando en BD:",N),!1}}catch(i){return console.error("❌ [AUTO-SAVE] Error en auto-save con procesamiento de imágenes:",i),!1}},[n,d,F,K,j,M,re,te,s==null?void 0:s.id,l==null?void 0:l.name,l==null?void 0:l.id,o==null?void 0:o.id,se,tt,Ne]);g.useEffect(()=>{if(!(s!=null&&s.id))return;const t=setInterval(()=>{n.length>0&&Te(n,!1)},5*60*1e3);return()=>clearInterval(t)},[Te,n,s==null?void 0:s.id]),g.useCallback(async()=>{if(!n.length)return{};console.log("📸 [THUMBNAILS] Capturando thumbnails de todas las páginas...");const t={},a=d;try{for(let r=0;r<n.length;r++){const i=n[r];if(i!=null&&i.id)try{r!==d&&(L(r),await new Promise(p=>setTimeout(p,300)));const c=await ye({type:"thumbnail"});c&&(t[i.id]=c,console.log(`✅ [THUMBNAILS] Thumbnail capturado para página ${r+1}: ${i.id}`))}catch(c){console.warn(`⚠️ [THUMBNAILS] Error capturando thumbnail para página ${i.id}:`,c),se[i.id]&&(t[i.id]=se[i.id])}}return a!==d&&L(a),console.log(`✅ [THUMBNAILS] Capturados ${Object.keys(t).length} thumbnails de ${n.length} páginas`),t}catch(r){return console.error("❌ [THUMBNAILS] Error capturando thumbnails:",r),a!==d&&L(a),se}},[n,d,L,ye,se]);const pt=g.useCallback(async()=>{if(!(s!=null&&s.id)||n.length===0)return $.error("No hay datos para guardar"),!1;try{return console.log("📸 [SAVE] Generando thumbnails localmente..."),await Ne(),await Be(),await Te(n,!0)?($.success("Progreso guardado exitosamente"),!0):($.error("Error al guardar el progreso"),!1)}catch(t){return console.error("❌ [SAVE] Error al guardar el progreso:",t),$.error("Error al guardar el progreso"),!1}},[Te,n,s==null?void 0:s.id,F,o,Ne]),Ce=()=>`editor_progress_project_${s==null?void 0:s.id}`,x=g.useCallback(async()=>{var t,a,r,i;if(s!=null&&s.id)try{const c=xe.loadFromLocalStorage(),p=await fetch(`/api/canvas/projects/${s.id}/load-progress`,{headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});let u=null;if(p.ok){const b=await p.json();b.success&&((t=b.data)!=null&&t.design_data)&&(u=b.data)}let f=null;if(c&&u){const b=new Date(c.savedAt).getTime(),N=new Date(u.saved_at).getTime();f=b>N?c:u}else c?f=c:u&&(f=u);f&&(((a=f.pages)==null?void 0:a.length)>0||((i=(r=f.design_data)==null?void 0:r.pages)==null?void 0:i.length)>0)&&(mt(f),De(!0))}catch(c){console.error("❌ [RECOVERY] Error verificando progreso guardado:",c)}},[s==null?void 0:s.id,xe]),J=g.useCallback(async t=>{var a;try{let r=[];if(t.pages?r=t.pages:(a=t.design_data)!=null&&a.pages&&(r=t.design_data.pages),r.length>0){_(r);const i=[JSON.stringify(r)];pe(i),ie(0),setTimeout(()=>{le({})},100),$.success("✅ Progreso cargado exitosamente")}}catch(r){console.error("❌ [RECOVERY] Error cargando progreso:",r),$.error("Error al cargar el progreso guardado")}},[_,pe,ie,le]),je=g.useCallback(async()=>{try{const t=xe.getStorageKey();localStorage.removeItem(t),$.success("Progreso anterior eliminado")}catch(t){console.error("❌ [RECOVERY] Error descartando progreso:",t)}},[xe]);g.useEffect(()=>{s&&l&&o&&(!(y!=null&&y.pages)||y.pages.length===0)&&Se(o,l)},[s,l,o,y]),g.useEffect(()=>{s!=null&&s.id&&!T&&n.length===0&&setTimeout(()=>{x()},500)},[s==null?void 0:s.id,T,n.length,x]),g.useEffect(()=>{s!=null&&s.id&&n.length>0&&setTimeout(()=>{Be()},100)},[s==null?void 0:s.id,n.length,Be]);const Se=(t,a)=>{try{const r=[],i=a.pages||t.pages||20,c=a.cover_image?`/storage/images/item/${a.cover_image}`:null,p=a.cover_image?null:t.background_color||"#ffffff",u={id:"page-cover",type:"cover",layout:"layout-1",backgroundImage:c,backgroundColor:p,cells:[{id:"cell-cover-1",elements:[{id:"cover-title",type:"text",content:a.name||"Mi Álbum Personalizado",position:{x:10,y:20},size:{width:80,height:15},style:{fontSize:"28px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",textAlign:"center",backgroundColor:"transparent",padding:"8px"},zIndex:2},...a.image?[{id:"cover-image",type:"image",content:`/storage/images/item/${a.image}`,position:{x:25,y:40},size:{width:50,height:40},filters:{},mask:"none",zIndex:1}]:[]]}]};r.push(u);const f=a.content_image?`/storage/images/item/${a.content_image}`:null,b=a.content_image?null:t.background_color||"#ffffff";for(let H=1;H<=i;H++){const C={id:`page-content-${H}`,type:"content",pageNumber:H,layout:"layout-1",backgroundImage:f,backgroundColor:b,cells:[{id:`cell-content-${H}-1`,elements:[]}]};r.push(C)}const N=a.back_cover_image?`/storage/images/item/${a.back_cover_image}`:null,z=a.back_cover_image?null:t.background_color||"#ffffff",R={id:"page-final",type:"final",layout:"layout-1",backgroundImage:N,backgroundColor:z,cells:[{id:"cell-final-1",elements:[]}]};r.push(R),_(r),L(0),t.width&&t.height&&E("preset")}catch(r){console.error("❌ Error creating pages:",r),I(r.message)}},$e=g.useMemo(()=>({cover:n.filter(t=>t.type==="cover"),content:n.filter(t=>t.type==="content"),final:n.filter(t=>t.type==="final")}),[n]),Q=g.useCallback(()=>{if(!j||!M||n.length===0)return null;const t=n[d];if(!t)return null;const a=t.cells.find(r=>r.id===M);return a?a.elements.find(r=>r.id===j):null},[j,M,n,d]),It=(t,a)=>{if(a){const r=n[d].cells.find(c=>c.id===a),i=r==null?void 0:r.elements.find(c=>c.id===t);if(i!=null&&i.locked){const c=document.createElement("div");c.className="fixed top-4 right-4 bg-amber-100 border border-amber-400 text-amber-700 px-4 py-2 rounded-lg z-50",c.textContent="Este elemento es parte del diseño base y no se puede editar",document.body.appendChild(c),setTimeout(()=>{document.body.contains(c)&&document.body.removeChild(c)},3e3);return}}if(a&&Y(a),ee(t),t){const r=n[d].cells.find(c=>c.id===(a||M)),i=r==null?void 0:r.elements.find(c=>c.id===t);(i==null?void 0:i.type)==="image"?D(i):(i==null?void 0:i.type)==="text"?(Ie(!0),it({elementId:t,cellId:a||M})):Ie(!1)}else Ie(!1),D(null)},Re=()=>{if(n.length===0)return ce[0];const t=n[d];return t?ce.find(a=>a.id===t.layout)||ce[0]:ce[0]},st=g.useCallback(t=>{_(t);const a=[...re.slice(0,te+1),JSON.stringify(t)];pe(a),ie(a.length-1);try{const r=Ce(),i={pages:t,currentPage:d,savedAt:Date.now()},c=JSON.stringify(i),p=Math.round(c.length/1024);if(p<2048)localStorage.setItem(r,c);else{console.warn(`⚠️ Datos demasiado grandes para localStorage (${p} KB), saltando guardado local`);try{localStorage.removeItem(r)}catch(u){console.error("Error limpiando localStorage:",u)}}}catch(r){if(console.error("❌ Error guardando en localStorage:",r),r.name==="QuotaExceededError")try{const i=Ce();localStorage.removeItem(i)}catch(i){console.error("Error limpiando localStorage:",i)}}if(t[d]){const r=t[d].id;le(i=>{const c={...i};return delete c[r],c})}},[re,te,Ce,d]);g.useEffect(()=>{try{const t=Ce(),a={pages:n,currentPage:d,savedAt:Date.now()},r=JSON.stringify(a),i=Math.round(r.length/1024);i<2048?localStorage.setItem(t,r):console.warn(`⚠️ Datos demasiado grandes para localStorage (${i} KB), saltando guardado`)}catch(t){if(console.error("❌ Error guardando currentPage en localStorage:",t),t.name==="QuotaExceededError")try{const a=Ce();localStorage.removeItem(a)}catch(a){console.error("Error limpiando localStorage:",a)}}},[d,n,Ce]);const Fs=async()=>{var a;if(!(s!=null&&s.id)){$.error("No se ha cargado ningún proyecto.");return}if(be){$.warning("⏳ Ya se está generando un PDF. Por favor espera...");return}me(!0);const t=$.loading(`🖨️ Generando PDF de alta calidad (300 DPI)...
⏱️ Este proceso puede tomar varios minutos
📁 El archivo se descargará automáticamente`,{duration:0});try{if(!n||n.length===0){$.dismiss(t),$.error("El proyecto no tiene páginas para exportar.");return}const r=n.filter(b=>b.cells&&b.cells.length>0&&b.cells.some(N=>N.elements&&N.elements.length>0));if(r.length===0){$.dismiss(t),$.error("Las páginas del proyecto están vacías. Agrega contenido antes de generar el PDF.");return}const i=new AbortController,c=setTimeout(()=>{i.abort()},3e5),p={method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)||"",Accept:"application/pdf","X-Requested-With":"XMLHttpRequest","Cache-Control":"no-cache"},credentials:"same-origin",signal:i.signal,body:JSON.stringify({quality:"high",dpi:300,includeBackgrounds:!0,optimize:!0,pages:r,projectData:{id:s.id,name:s.name,design_data:{pages:r}}})};$.loading("📊 Procesando "+r.length+` páginas...
⏱️ Por favor mantén esta pestaña abierta`,{id:t});let u;const f=window.location.hostname==="localhost"&&window.location.port==="5174"?"http://127.0.0.1:8000":"";try{u=await fetch(`${f}/api/test/projects/${s.id}/export/pdf`,p)}catch(b){if(console.error("🚨 [PDF-EXPORT] Error de red:",{error:b,message:b.message,name:b.name}),b.name==="AbortError")throw new Error("Timeout: El PDF está tardando demasiado en generarse. Intenta con menos páginas.");console.warn("⚠️ [PDF-EXPORT] Error en ruta de test, intentando ruta autenticada...");try{u=await fetch(`${f}/api/customer/projects/${s.id}/export/pdf`,p)}catch(N){throw N.name==="AbortError"?new Error("Timeout: El PDF está tardando demasiado en generarse. Intenta con menos páginas."):(console.error("❌ [PDF-EXPORT] Todas las rutas fallaron:",N),new Error(`Error de conexión al generar el PDF: ${N.message}`))}}if(clearTimeout(c),!u.ok&&(u.status===401||u.status===404)){console.warn("⚠️ [PDF-EXPORT] Ruta de test falló, intentando ruta autenticada...");try{const b={...p};delete b.signal,u=await fetch(`${f}/api/customer/projects/${s.id}/export/pdf`,b)}catch(b){throw console.error("❌ [PDF-EXPORT] Ruta autenticada también falló:",b),new Error("Error de conexión al generar el PDF. Verifica tu conexión a internet.")}}if(u.ok){const b=u.headers.get("content-type");if(b&&b.includes("application/pdf")){$.loading(`📦 Descargando PDF...
⏬ Preparando archivo`,{id:t});try{const N=await u.blob();if(N.size>0){const z=`${s.name||"proyecto"}_${new Date().toISOString().split("T")[0]}.pdf`,R=(N.size/(1024*1024)).toFixed(2);Zs.saveAs(N,z),$.dismiss(t),$.success(`✅ PDF descargado exitosamente!
📄 Archivo: ${z}
📦 Tamaño: ${R} MB
📁 Ubicación: Carpeta de Descargas`,{duration:8e3})}else console.error("❌ [PDF-EXPORT] PDF blob está vacío"),$.dismiss(t),$.error("El PDF generado está vacío. Verifica que el proyecto tenga contenido.")}catch(N){console.error("❌ [PDF-EXPORT] Error al procesar blob:",N),$.dismiss(t),$.error(`Error al procesar el PDF: ${N.message}`)}}else{const N=await u.json(),z=N.message||"Error desconocido al generar el PDF.";$.dismiss(t),$.error(`❌ ${z}`),console.error("❌ [PDF-EXPORT] Error del servidor:",N)}}else try{const b=await u.json(),N=b.message||`Error HTTP ${u.status}`;$.dismiss(t),u.status===401?$.error("❌ Sesión expirada. Por favor, inicia sesión nuevamente."):u.status===403?$.error("❌ No tienes permisos para exportar este proyecto."):u.status===404?$.error("❌ Proyecto no encontrado. Verifica que el proyecto exista."):u.status===413?$.error("❌ El proyecto es demasiado grande para generar PDF. Intenta reducir el número de páginas o imágenes."):u.status===500?$.error("❌ Error del servidor. El proyecto puede ser demasiado complejo o grande."):$.error(`❌ ${N}`),console.error("❌ [PDF-EXPORT] Error HTTP:",{status:u.status,error:b})}catch(b){$.dismiss(t),u.status===404?$.error("❌ Endpoint de PDF no encontrado. Verifica la configuración del servidor."):u.status===401?$.error("❌ Sesión expirada. Por favor, inicia sesión nuevamente."):u.status===413?$.error("❌ El proyecto es demasiado grande. Intenta reducir el contenido."):$.error(`❌ Error del servidor (${u.status}). El proyecto puede ser demasiado grande o complejo.`),console.error("❌ [PDF-EXPORT] Error parseando respuesta de error:",b)}}catch(r){$.dismiss(t),console.error("❌ [PDF-EXPORT] Error de red:",r),r.message.includes("Timeout")?$.error("⏱️ "+r.message):r.name==="AbortError"?$.error("❌ Operación cancelada. El PDF tardó demasiado en generarse."):$.error("❌ Error de conexión al generar el PDF. Verifica tu conexión a internet.")}finally{me(!1)}},Ws=t=>{const a=ce.find(p=>p.id===t);if(!a)return;const r=[...n],i=r[d],c=Array.from({length:a.cells}).map((p,u)=>i.cells[u]||{id:`cell-${i.id}-${u+1}`,elements:[]});r[d]={...i,layout:t,cells:c},st(r),ee(null),Y(null)},ze=(t,a)=>{const r=[...n];for(let i=0;i<r[d].cells.length;i++)r[d].cells[i].id===t&&r[d].cells[i].elements.push(a);st(r),ee(a.id),Y(t)},ne=(t,a,r,i=!1)=>{const c=[...n],p=c[d].cells.findIndex(u=>u.id===t);if(p!==-1){if(i)c[d].cells[p].elements.push({...c[d].cells[p].elements.find(u=>u.id===a),...r});else{const u=c[d].cells[p].elements.findIndex(f=>f.id===a);u!==-1&&(c[d].cells[p].elements[u]={...c[d].cells[p].elements[u],...r})}st(c)}},xt=(t,a)=>{const r=[...n],i=r[d].cells.findIndex(c=>c.id===t);i!==-1&&(r[d].cells[i].elements=r[d].cells[i].elements.filter(c=>c.id!==a),st(r),j===a&&ee(null))},Hs=(t,a,r)=>{const i=[...n],c=i[d].cells.findIndex(p=>p.id===t);if(c!==-1){const p=i[d].cells[c].elements,u=p.findIndex(f=>f.id===a);if(u!==-1){const f=r==="up"?u+1:u-1;if(f>=0&&f<p.length){const b=p[u];p[u]=p[f],p[f]=b,st(i)}}}},Tt=()=>{te>0&&(ie(te-1),_(JSON.parse(re[te-1])),ee(null),Y(null))},Rt=()=>{te<re.length-1&&(ie(te+1),_(JSON.parse(re[te+1])),ee(null),Y(null))},ft=(t="body")=>{const a=`text-${Date.now()}`,r={heading:{fontSize:"32px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"12px",borderRadius:"0px",border:"none",opacity:1},subheading:{fontSize:"24px",fontFamily:"Arial",color:"#333333",fontWeight:"600",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"10px",borderRadius:"0px",border:"none",opacity:1},body:{fontSize:"16px",fontFamily:"Arial",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1}},i={heading:"Título Principal",subheading:"Subtítulo",body:"Haz clic para editar"},c={heading:{width:.8,height:.2},subheading:{width:.6,height:.15},body:{width:.4,height:.15}},p={id:a,type:"text",content:i[t],position:{x:.05,y:.05},size:c[t],style:r[t]};M?ze(M,p):console.log("Selecciona una celda primero")},zt=g.useMemo(()=>{var c;const t=n[d];if(!t)return null;const a=((c=t.cells)==null?void 0:c.flatMap(p=>p.elements||[]))||[],r=a.map(p=>({id:p.id,type:p.type,position:p.position,size:p.size}));return{pageId:t.id,elementsCount:a.length,contentHash:JSON.stringify(r).substring(0,100),backgroundImage:t.backgroundImage,backgroundColor:t.backgroundColor,layout:t.layout}},[n,d]);g.useEffect(()=>{if(n.length===0||T||!zt)return;let t=!1;const a=async()=>{try{const i=n[d];if(!i||!i.id)return;const c=i.id;if(le(u=>{const f={...u};return delete f[c],f}),await new Promise(u=>setTimeout(u,100)),t)return;const p=await ye();p&&!t?le(u=>({...u,[c]:p})):console.warn("⚠️ [DEBUG] No se pudo generar miniatura para:",c)}catch(i){t||console.error("❌ [DEBUG] Error regenerando miniatura:",i)}},r=setTimeout(()=>{a()},500);return()=>{t=!0,clearTimeout(r)}},[d,zt,T,ye]),g.useEffect(()=>{if(n.length===0||T)return;const t=async()=>{const r=n.filter(i=>!se[i.id]);if(r.length!==0)for(const i of r)try{const c=document.createElement("canvas");c.width=200,c.height=150;const p=c.getContext("2d");if(p.fillStyle=i.backgroundColor||"#ffffff",p.fillRect(0,0,200,150),i.backgroundImage)try{const f=new Image;f.crossOrigin="anonymous",await new Promise((b,N)=>{f.onload=b,f.onerror=N,f.src=i.backgroundImage}),p.drawImage(f,0,0,200,150)}catch(f){console.warn("No se pudo cargar imagen de fondo para miniatura:",f)}i.cells&&i.cells.forEach(f=>{f.elements&&f.elements.forEach(b=>{var N;b.type==="text"&&b.content&&(p.fillStyle=((N=b.style)==null?void 0:N.color)||"#000000",p.font="12px Arial",p.fillText(b.content.substring(0,20)+(b.content.length>20?"...":""),10,30))})});const u=c.toDataURL("image/jpeg",.7);le(f=>({...f,[i.id]:u})),await new Promise(f=>setTimeout(f,300))}catch(c){console.error("❌ Error generando miniatura de fondo para:",i.id,c)}},a=setTimeout(()=>{t()},2e3);return()=>clearTimeout(a)},[n,se,T]);const Bs=async()=>{var t;try{if(!l||!o||!(s!=null&&s.id))return!1;await Te(n,!0)||console.warn("⚠️ No se pudo guardar el progreso, pero continuando...");const r={design_data:{id:s.id,title:(l==null?void 0:l.name)||"Álbum Personalizado",pages:n,workspace_dimensions:F,created_at:new Date().toISOString()},item_data:{id:l==null?void 0:l.id,name:(l==null?void 0:l.name)||(l==null?void 0:l.title),price:l==null?void 0:l.price,user_id:l==null?void 0:l.user_id,width:l==null?void 0:l.width,height:l==null?void 0:l.height},preset_data:{id:o==null?void 0:o.id,width:o==null?void 0:o.width,height:o==null?void 0:o.height,cover_image:o==null?void 0:o.cover_image,content_layer_image:o==null?void 0:o.content_layer_image,final_layer_image:o==null?void 0:o.final_layer_image},dimensions:{width_mm:(o==null?void 0:o.width)||(l==null?void 0:l.width)||210,height_mm:(o==null?void 0:o.height)||(l==null?void 0:l.height)||297,workspace_width:(F==null?void 0:F.width)||800,workspace_height:(F==null?void 0:F.height)||600}};try{const z=await fetch("/api/canvas-projects/save",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({id:s.id,status:"ready_for_pdf",pdf_data:r,completed_at:new Date().toISOString()})});if(z.ok){const R=await z.json()}else console.warn("⚠️ Error marcando proyecto como completado")}catch(z){console.warn("⚠️ Error en marcado de completado:",z)}const i=Date.now(),c=s.id;window.currentProjectId=c,window.albumProjectId=c;let p=o.cover_image;se&&se["page-cover"]&&(p=se["page-cover"]);let u=p;p&&p.startsWith("data:image/")&&p.length>1e5&&(u=o.cover_image||"/assets/img/default-album.jpg");const f={...l,project_id:c,canvas_project_id:s.id,quantity:1,type:"custom_album",pdf_metadata:{width_mm:o.width,height_mm:o.height,pages_count:n.length,workspace_dimensions:F,requires_pdf_generation:!0}},b=structuredClone(W),N=b.findIndex(z=>z.id==f.id);return N==-1?b.push({...f,quantity:1}):b[N].quantity++,X(b),$.success("Álbum agregado al carrito",{description:`${f.name} se ha añadido al carrito. El PDF se generará en el backend.`,icon:e.jsx(ca,{className:"h-5 w-5 text-green-500"}),duration:4e3,position:"bottom-center"}),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{cart:b,action:"add",product:f}})),!0}catch(a){return console.error("❌ === ERROR EN addAlbumToCart ==="),console.error("Error completo:",a),console.error("Stack trace:",a.stack),console.error("Mensaje del error:",a.message),$.error("Error al agregar al carrito",{description:`Error específico: ${a.message}`,duration:5e3,position:"bottom-center"}),!1}};window.finalizeAlbumDesign=async()=>{try{if(!n||n.length===0)throw new Error("No hay páginas para finalizar");const r={design_data:{pages:(R=>R.map(H=>({id:H.id,type:H.type,pageNumber:H.pageNumber,layout:H.layout,cells:H.cells.map(C=>({id:C.id,elements:C.elements.map(A=>{const O={id:A.id,type:A.type,position:A.position,zIndex:A.zIndex||1};if(A.type==="image"){if(A.content.startsWith("data:image/")){const U=btoa(A.content.substring(0,100)).substring(0,20);O.content=`[BASE64_IMAGE_${U}]`,O.contentType=A.content.split(";")[0].split(":")[1],O.originalSize=A.content.length}else O.content=A.content;if(A.filters){const U=Object.entries(A.filters).filter(([ae,q])=>q!==0&&q!==!1&&q!==null).reduce((ae,[q,G])=>(ae[q]=G,ae),{});Object.keys(U).length>0&&(O.filters=U)}A.mask&&A.mask!=="none"&&(O.mask=A.mask),A.size&&(O.size=A.size),A.locked&&(O.locked=A.locked)}else if(A.type==="text"&&(O.content=A.content,A.style)){const U=Object.entries(A.style).filter(([ae,q])=>!(ae==="fontSize"&&q==="16px"||ae==="color"&&q==="#000000"||ae==="fontFamily"&&q==="Arial")).reduce((ae,[q,G])=>(ae[q]=G,ae),{});Object.keys(U).length>0&&(O.style=U)}return O})}))})))(n),projectInfo:{id:s==null?void 0:s.id,item_id:l==null?void 0:l.id,title:l==null?void 0:l.title,preset_id:o==null?void 0:o.id},presetInfo:{id:o==null?void 0:o.id,name:o==null?void 0:o.name,cover_image:o==null?void 0:o.cover_image,content_image:o==null?void 0:o.content_image,back_cover_image:o==null?void 0:o.back_cover_image},workspace:{width:F.width,height:F.height,scale:F.scale},meta:{finalizedAt:new Date().toISOString(),version:"1.3"}},thumbnails:Object.fromEntries(Object.entries(se).map(([R,H])=>[R,H]))},i=JSON.stringify(r),c=Math.round(i.length/1024),p=Math.round(c/1024*100)/100;let u=0,f=0;n.forEach(R=>{var H;(H=R.cells)==null||H.forEach(C=>{var A;(A=C.elements)==null||A.forEach(O=>{O.type==="image"&&O.content&&O.content.startsWith("data:image/")&&(u++,f+=O.content.length)})})});const b=Math.round(f/(1024*1024)*100)/100;if(c>1024&&!confirm(`El diseño contiene ${u} imágenes (${b} MB en imágenes). Payload completo: ${p} MB. Esto podría causar problemas al guardarlo. ¿Desea continuar de todos modos?`))return!1;const N=await fetch(`/api/canvas/projects/${s.id}/save`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:i});if(!N.ok){let R="Error al finalizar el diseño";try{R=(await N.json()).message||R}catch{N.status===413?R="El diseño es demasiado grande para ser guardado. Intente simplificar las imágenes.":N.status>=500&&(R="Error del servidor. Intente nuevamente más tarde.")}throw new Error(R)}const z=await N.json();return!0}catch(t){console.error("Error al finalizar diseño:",t);let a=t.message;return t.message.includes("Failed to fetch")?a="Error de conexión. Verifique su conexión a internet e intente nuevamente.":(t.message.includes("NetworkError")||t.message.includes("net::"))&&(a="Error de red. Intente nuevamente más tarde."),alert("Error al finalizar el diseño: "+a),!1}};const Us=g.useCallback(async()=>{try{const{jsPDF:t}=await qs(async()=>{const{jsPDF:U}=await import("./jspdf.es.min-D3plwuQr.js").then(ae=>ae.j);return{jsPDF:U}},__vite__mapDeps([0,1,2,3,4]));let a=(o==null?void 0:o.width)||21,r=(o==null?void 0:o.height)||29.7;const i=.3,c=a+i*2,p=r+i*2,u=c*28.35,f=p*28.35,b=new t({orientation:u>f?"landscape":"portrait",unit:"pt",format:[u,f],compress:!1}),N=n.length;let z=0;const R=document.createElement("div");R.id="pdf-progress",R.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",R.innerHTML=`
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Generando PDF de alta calidad...</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="pdf-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                        <span id="current-page">0</span> de ${N} páginas procesadas
                    </p>
                </div>
            `,document.body.appendChild(R);const H=U=>{const ae=U/N*100;document.getElementById("pdf-progress-bar").style.width=`${ae}%`,document.getElementById("current-page").textContent=U},C=d;for(let U=0;U<n.length;U++){const ae=n[U];L(U),await new Promise(q=>setTimeout(q,500));try{const q=await ye({type:"pdf"});if(q){const G=q.width/q.height,Ee=u/f;let ge,he,ke=0,Le=0;G>Ee?(ge=u,he=u/G,Le=(f-he)/2):(he=f,ge=f*G,ke=(u-ge)/2);const _e=q.toDataURL("image/png",1);U>0&&b.addPage([u,f]),b.addImage(_e,"PNG",ke,Le,ge,he)}else console.warn(`⚠️ No se pudo capturar la página ${U+1}`),U>0&&b.addPage([u,f]),b.setFontSize(12),b.text(`Error al renderizar página ${U+1}`,u/2,f/2,{align:"center"})}catch(q){console.error(`❌ Error procesando página ${U+1}:`,q),U>0&&b.addPage([u,f]),b.setFontSize(12),b.text(`Error al procesar página ${U+1}`,u/2,f/2,{align:"center"})}z++,H(z),await new Promise(q=>setTimeout(q,200))}L(C);const A=`${(l==null?void 0:l.name)||"album"}_${new Date().toISOString().split("T")[0]}.pdf`;b.save(A),document.body.removeChild(R);const O=document.createElement("div");return O.className="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",O.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>PDF de alta calidad generado: ${A}</span>
                </div>
            `,document.body.appendChild(O),setTimeout(()=>{document.body.contains(O)&&document.body.removeChild(O)},5e3),A}catch(t){console.error("❌ Error generando PDF:",t);const a=document.getElementById("pdf-progress");a&&document.body.removeChild(a);const r=document.createElement("div");throw r.className="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",r.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Error al generar PDF: ${t.message}</span>
                </div>
            `,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},7e3),t}},[n,d,L,ye,o,l]);return window.generateAlbumPDF=Us,window.generateHighQualityThumbnail=ot,window.captureCurrentWorkspace=ye,e.jsxs(Gs,{backend:Ks,className:"!h-screen !w-screen overflow-hidden",children:[T?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Cargando Editor"}),e.jsx("p",{className:"customtext-neutral-dark",children:"Preparando tu álbum personalizado..."})]})}):P?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:P}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Reintentar"}),e.jsx("button",{onClick:()=>window.history.back(),className:"w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Volver"})]})]})}):n.length===0?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Inicializando Editor"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:"Generando páginas del álbum..."}),e.jsx("div",{className:"animate-pulse flex space-x-4",children:e.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-5/6"})]})]})})]})}):e.jsxs("div",{className:"h-screen w-screen overflow-hidden bg-[#141b34] font-sans",children:[e.jsx(sa,{isOpen:lt,onRequestClose:()=>Ze(!1),pages:n.map(t=>({...t,layout:ce.find(a=>a.id===t.layout)||ce[0]})),workspaceDimensions:F,getCurrentLayout:t=>t?ce.find(a=>a.id===t.layout)||ce[0]:ce[0],presetData:o,pageThumbnails:se,addAlbumToCart:Bs,projectData:s,itemData:l}),e.jsx("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white shadow-lg flex items-center px-6 z-20 border-b border-gray-200",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors text-[#040404]",children:[e.jsx(Es,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Volver"})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:Tt,disabled:te<=0,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(vs,{className:"h-4 w-4 text-[#040404]"})}),e.jsx("button",{onClick:Rt,disabled:te>=re.length-1,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(ws,{className:"h-4 w-4 text-[#040404]"})})]})]}),e.jsx("div",{className:"flex-1 max-w-md mx-8",children:e.jsx("input",{type:"text",value:(s==null?void 0:s.name)||"Álbum Sin Título",onChange:t=>m({...s,name:t.target.value}),className:"w-full text-center text-lg font-bold text-[#040404] bg-transparent border-0 focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:bg-white rounded-lg px-4 py-2 transition-all",placeholder:"Nombre del diseño"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(gr,{saveStatus:xe.saveStatus,lastSaved:xe.lastSaved,lastAutoSaved:xe.lastAutoSaved,hasUnsavedChanges:xe.hasUnsavedChanges,isOnline:xe.isOnline,saveError:xe.saveError,onManualSave:pt}),e.jsx(Pe,{variant:"secondary",size:"sm",onClick:()=>Ze(!0),icon:e.jsx(Ct,{className:"h-4 w-4"}),children:"Vista de Álbum"}),e.jsxs("button",{onClick:Fs,disabled:be,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${be?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#af5cb8] text-white hover:bg-[#5f2e61] shadow-md hover:shadow-lg"}`,children:[be?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-gray-500 border-t-transparent"}):e.jsx(Os,{className:"h-4 w-4"}),be?"Guardando...":"Guardar"]}),e.jsx("div",{className:"relative",children:e.jsx("button",{className:"h-8 w-8 rounded-full bg-[#af5cb8] flex items-center justify-center text-white font-medium",children:e.jsx(na,{className:"h-4 w-4"})})})]})]})}),e.jsxs("div",{className:`flex h-full ${j?"pt-[60px]":"pt-16"}`,children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-20 bg-[#f7edfa] border-r border-gray-200 flex flex-col items-center py-6 space-y-2",children:[e.jsxs("button",{onClick:()=>de("templates"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${B==="templates"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ps,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Templates"})]}),e.jsxs("button",{onClick:()=>de("images"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${B==="images"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ae,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Images"})]}),e.jsxs("button",{onClick:()=>de("text"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${B==="text"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ve,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Text"})]}),e.jsxs("button",{onClick:()=>de("shapes"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${B==="shapes"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Wa,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Shapes"})]}),e.jsxs("button",{onClick:()=>de("stickers"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${B==="stickers"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ha,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Stickers"})]}),e.jsxs("button",{onClick:()=>de("pages"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${B==="pages"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ct,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Pages"})]}),e.jsxs("button",{onClick:()=>de("panel"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${B==="panel"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Pt,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Panel"})]})]}),e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-[#040404] capitalize",children:[B==="templates"&&"Templates",B==="images"&&"Images",B==="text"&&"Text",B==="shapes"&&"Shapes",B==="stickers"&&"Stickers",B==="pages"&&"Pages",B==="panel"&&"Layers Panel"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[B==="templates"&&"Choose a template to get started",B==="images"&&"Search for images",B==="text"&&"Add and edit text",B==="shapes"&&"Add shapes and graphics",B==="stickers"&&"Add fun stickers",B==="pages"&&"Manage your pages",B==="panel"&&"Organize layers and z-index"]})]}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(ja,{className:"h-4 w-4 text-gray-500"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[B==="templates"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ps,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Page Layouts"})]}),e.jsx(Xa,{currentLayoutId:(Ot=n[d])==null?void 0:Ot.layout,onLayoutChange:Ws})]}),B==="images"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ae,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Imágenes del Proyecto"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[ve.length," imagen",ve.length!==1?"s":""]})]}),e.jsx(ur,{images:ve,onImageSelect:ut,isLoading:We})]}),B==="text"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>ft("heading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-2xl leading-tight",children:"Título Principal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"32px, Bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(qe,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>ft("subheading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-lg leading-tight",children:"Subtítulo"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"24px, Semi-bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(qe,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>ft("body"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-normal text-gray-900 text-base leading-tight",children:"Texto Normal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"16px, Normal"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(qe,{className:"h-4 w-4"})})]})})]}),B==="text"&&j&&((Mt=Q())==null?void 0:Mt.type)==="text"&&e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"h-10 w-10 bg-[#af5cb8] rounded-xl flex items-center justify-center",children:e.jsx(La,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-[#040404] text-lg",children:"Editar Texto"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Personaliza el formato y estilo"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Formato:"}),e.jsx("button",{onClick:()=>{const t=Q();ne(M,j,{style:{...t.style,fontWeight:t.style.fontWeight==="bold"?"normal":"bold"}})},className:`px-3 py-1.5 rounded-md text-sm font-bold transition-colors ${((Lt=($t=Q())==null?void 0:$t.style)==null?void 0:Lt.fontWeight)==="bold"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"B"}),e.jsx("button",{onClick:()=>{const t=Q();ne(M,j,{style:{...t.style,fontStyle:t.style.fontStyle==="italic"?"normal":"italic"}})},className:`px-3 py-1.5 rounded-md text-sm italic transition-colors ${((Ft=(_t=Q())==null?void 0:_t.style)==null?void 0:Ft.fontStyle)==="italic"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"I"}),e.jsx("button",{onClick:()=>{const t=Q();ne(M,j,{style:{...t.style,textDecoration:t.style.textDecoration==="underline"?"none":"underline"}})},className:`px-3 py-1.5 rounded-md text-sm underline transition-colors ${((Ht=(Wt=Q())==null?void 0:Wt.style)==null?void 0:Ht.textDecoration)==="underline"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"U"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tipografía:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((Ut=(Bt=Q())==null?void 0:Bt.style)==null?void 0:Ut.fontFamily)||"Arial",onChange:t=>{const a=Q();ne(M,j,{style:{...a.style,fontFamily:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Impact",children:"Impact"}),e.jsx("option",{value:"Comic Sans MS",children:"Comic Sans MS"}),e.jsx("option",{value:"Trebuchet MS",children:"Trebuchet MS"}),e.jsx("option",{value:"Tahoma",children:"Tahoma"}),e.jsx("option",{value:"Palatino",children:"Palatino"}),e.jsx("option",{value:"Garamond",children:"Garamond"}),e.jsx("option",{value:"Bookman",children:"Bookman"}),e.jsx("option",{value:"Avant Garde",children:"Avant Garde"}),e.jsx("option",{value:"Calibri",children:"Calibri"}),e.jsx("option",{value:"Cambria",children:"Cambria"}),e.jsx("option",{value:"Candara",children:"Candara"}),e.jsx("option",{value:"Century Gothic",children:"Century Gothic"}),e.jsx("option",{value:"Franklin Gothic",children:"Franklin Gothic"}),e.jsx("option",{value:"Futura",children:"Futura"}),e.jsx("option",{value:"Gill Sans",children:"Gill Sans"}),e.jsx("option",{value:"Lucida Grande",children:"Lucida Grande"}),e.jsx("option",{value:"Optima",children:"Optima"}),e.jsx("option",{value:"Segoe UI",children:"Segoe UI"}),e.jsx("option",{value:"Roboto",children:"Roboto"}),e.jsx("option",{value:"Open Sans",children:"Open Sans"}),e.jsx("option",{value:"Lato",children:"Lato"}),e.jsx("option",{value:"Montserrat",children:"Montserrat"}),e.jsx("option",{value:"Poppins",children:"Poppins"}),e.jsx("option",{value:"Nunito",children:"Nunito"}),e.jsx("option",{value:"Inter",children:"Inter"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tamaño:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((qt=(Vt=Q())==null?void 0:Vt.style)==null?void 0:qt.fontSize)||"16px",onChange:t=>{const a=Q();ne(M,j,{style:{...a.style,fontSize:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"8px",children:"8px"}),e.jsx("option",{value:"10px",children:"10px"}),e.jsx("option",{value:"12px",children:"12px"}),e.jsx("option",{value:"14px",children:"14px"}),e.jsx("option",{value:"16px",children:"16px"}),e.jsx("option",{value:"18px",children:"18px"}),e.jsx("option",{value:"20px",children:"20px"}),e.jsx("option",{value:"22px",children:"22px"}),e.jsx("option",{value:"24px",children:"24px"}),e.jsx("option",{value:"28px",children:"28px"}),e.jsx("option",{value:"32px",children:"32px"}),e.jsx("option",{value:"36px",children:"36px"}),e.jsx("option",{value:"40px",children:"40px"}),e.jsx("option",{value:"44px",children:"44px"}),e.jsx("option",{value:"48px",children:"48px"}),e.jsx("option",{value:"56px",children:"56px"}),e.jsx("option",{value:"64px",children:"64px"}),e.jsx("option",{value:"72px",children:"72px"}),e.jsx("option",{value:"80px",children:"80px"}),e.jsx("option",{value:"96px",children:"96px"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Color:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((Kt=(Gt=Q())==null?void 0:Gt.style)==null?void 0:Kt.color)||"#000000",onChange:t=>{const a=Q();ne(M,j,{style:{...a.style,color:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("span",{className:"text-xs text-gray-600 font-mono",children:((Jt=(Xt=Q())==null?void 0:Xt.style)==null?void 0:Jt.color)||"#000000"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Fondo:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((Qt=(Yt=Q())==null?void 0:Yt.style)==null?void 0:Qt.backgroundColor)||"#ffffff",onChange:t=>{const a=Q();ne(M,j,{style:{...a.style,backgroundColor:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("button",{onClick:()=>{const t=Q();ne(M,j,{style:{...t.style,backgroundColor:"transparent"}})},className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"🚫"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 w-20",children:"Alinear:"}),e.jsx("div",{className:"flex gap-1",children:["left","center","right","justify"].map(t=>{var a,r;return e.jsxs("button",{onClick:()=>{const i=Q();ne(M,j,{style:{...i.style,textAlign:t}})},className:`px-3 py-1.5 rounded-md text-sm transition-colors ${((r=(a=Q())==null?void 0:a.style)==null?void 0:r.textAlign)===t?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:[t==="left"&&"⬅",t==="center"&&"⬌",t==="right"&&"➡",t==="justify"&&"⬍"]},t)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Espaciado:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((Dt=(Zt=Q())==null?void 0:Zt.style)==null?void 0:Dt.lineHeight)||"1.5",onChange:t=>{const a=Q();ne(M,j,{style:{...a.style,lineHeight:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"1",children:"1.0"}),e.jsx("option",{value:"1.1",children:"1.1"}),e.jsx("option",{value:"1.2",children:"1.2"}),e.jsx("option",{value:"1.3",children:"1.3"}),e.jsx("option",{value:"1.4",children:"1.4"}),e.jsx("option",{value:"1.5",children:"1.5"}),e.jsx("option",{value:"1.6",children:"1.6"}),e.jsx("option",{value:"1.8",children:"1.8"}),e.jsx("option",{value:"2",children:"2.0"}),e.jsx("option",{value:"2.2",children:"2.2"}),e.jsx("option",{value:"2.5",children:"2.5"}),e.jsx("option",{value:"3",children:"3.0"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Letras:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((ts=(es=Q())==null?void 0:es.style)==null?void 0:ts.letterSpacing)||"normal",onChange:t=>{const a=Q();ne(M,j,{style:{...a.style,letterSpacing:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"-3px",children:"-3px"}),e.jsx("option",{value:"-2px",children:"-2px"}),e.jsx("option",{value:"-1px",children:"-1px"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"0.5px",children:"0.5px"}),e.jsx("option",{value:"1px",children:"1px"}),e.jsx("option",{value:"1.5px",children:"1.5px"}),e.jsx("option",{value:"2px",children:"2px"}),e.jsx("option",{value:"3px",children:"3px"}),e.jsx("option",{value:"4px",children:"4px"}),e.jsx("option",{value:"5px",children:"5px"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Efectos:"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>{const t=Q();ne(M,j,{style:{...t.style,textTransform:t.style.textTransform==="uppercase"?"none":"uppercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((as=(ss=Q())==null?void 0:ss.style)==null?void 0:as.textTransform)==="uppercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-black",children:"AA"}),"MAYÚS"]}),e.jsxs("button",{onClick:()=>{const t=Q();ne(M,j,{style:{...t.style,textTransform:t.style.textTransform==="lowercase"?"none":"lowercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((os=(rs=Q())==null?void 0:rs.style)==null?void 0:os.textTransform)==="lowercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-normal",children:"aa"}),"minús"]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Opacidad:"}),e.jsxs("span",{className:"text-sm font-bold text-[#af5cb8]",children:[Math.round((((is=(ns=Q())==null?void 0:ns.style)==null?void 0:is.opacity)||1)*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:((cs=(ls=Q())==null?void 0:ls.style)==null?void 0:cs.opacity)||"1",onChange:t=>{const a=Q();ne(M,j,{style:{...a.style,opacity:t.target.value}})},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#af5cb8] slider",style:{background:`linear-gradient(to right, #af5cb8 0%, #af5cb8 ${(((ms=(ds=Q())==null?void 0:ds.style)==null?void 0:ms.opacity)||1)*100}%, #e5e7eb ${(((hs=(gs=Q())==null?void 0:gs.style)==null?void 0:hs.opacity)||1)*100}%, #e5e7eb 100%)`}})]})]})]})]}),B==="shapes"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Array.from({length:9}).map((t,a)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#af5cb8] rounded-lg"})},a))})}),B==="stickers"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:6}).map((t,a)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#f6a4b2] rounded-full"})},a))})}),B==="pages"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ct,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Pages"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[n.length," total"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mr-1.5"}),"Cover"]}),$e.cover.map((t,a)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${d===n.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>L(n.indexOf(t)),children:e.jsxs("div",{className:"relative bg-purple-50 overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(St,{pageId:t.id,thumbnail:se[t.id],altText:"Cover",type:"cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Cover"})})]})},t.id))]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mr-1.5"}),"Content Pages"]}),e.jsx("div",{className:"space-y-2",children:$e.content.map((t,a)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                    ${d===n.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                    mb-1`,onClick:()=>L(n.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(St,{pageId:t.id,thumbnail:se[t.id],altText:`Page ${t.pageNumber}`,type:"content"}),e.jsx("div",{className:"absolute top-1 left-1 bg-white/90 rounded-full h-5 w-5 flex items-center justify-center text-[10px] font-bold shadow-sm",children:t.pageNumber}),e.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-[9px] px-1.5 py-0.5 rounded-full opacity-80 group-hover:opacity-100",children:"Editable"})]})},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mr-1.5"}),"Back Cover"]}),$e.final.map((t,a)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${d===n.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>L(n.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border mb-1 aspect-[4/3] rounded-lg",children:[e.jsx(St,{pageId:t.id,thumbnail:se[t.id],altText:"Back Cover",type:"final"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Back Cover"})})]})},t.id))]})]})]}),B==="panel"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Ka,{pages:n,currentPage:d,selectedCell:M,selectedElement:j,onSelectCell:Y,onSelectElement:ee,onUpdateElement:(t,a,r)=>{ne(t,a,r)},onDeleteElement:(t,a)=>{xt(t,a)},onMoveElement:(t,a,r)=>{Hs(t,a,r)}})}),B==="filters"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ia,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Filters"})]}),(()=>{const t=Q();return t?e.jsxs(e.Fragment,{children:[t.type==="image"&&e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-[#af5cb8]"}),e.jsx("span",{className:"text-sm font-medium",children:"Selected Image"})]}),e.jsx("div",{className:"w-full h-16 rounded-md overflow-hidden bg-gray-200",children:e.jsx("img",{src:t.content,alt:"",className:"w-full h-full object-cover"})})]}),t.type==="image"&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Masks"}),e.jsx(Ja,{selectedMask:t.mask||"none",onSelect:a=>{ne(M,j,{mask:a})},availableMasks:Ts.map(a=>a.id),selectedImage:t})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Filters & Effects"}),e.jsx(Xs,{filters:t.filters||{},onFilterChange:a=>{ne(M,j,{filters:a})},selectedElement:t})]})]}):e.jsxs("div",{className:"text-center py-8 px-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg mb-3 inline-block",children:e.jsx(Ae,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h4",{className:"text-sm font-medium text-[#040404] mb-2",children:"Select an element"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Choose an image or text element to apply filters and effects"})]})})()]})]})]})]}),e.jsxs("main",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"bg-white border-b px-4 py-2 flex items-center justify-between",children:nt?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{variant:"ghost",size:"sm",onClick:()=>Ie(!1),className:"h-8 px-2",icon:e.jsx(Es,{className:"h-4 w-4"}),children:"Volver"}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"})]}),e.jsx("div",{className:"flex-1 flex justify-start",children:e.jsx(sr,{element:Q(),onUpdate:t=>{ne(Qe.cellId,Qe.elementId,t)},onClose:()=>Ie(!1)})})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(Pe,{variant:"ghost",size:"sm",onClick:Tt,disabled:te<=0,className:"h-8 px-2",icon:e.jsx(vs,{className:"h-4 w-4"}),children:"Deshacer"}),e.jsx(Pe,{variant:"ghost",size:"sm",onClick:Rt,disabled:te>=re.length-1,className:"h-8 px-2",icon:e.jsx(ws,{className:"h-4 w-4"}),children:"Rehacer"})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(Pe,{variant:"ghost",size:"sm",onClick:()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=a=>{if(a.target.files&&a.target.files[0]){const i={id:`img-${Date.now()}`,type:"image",content:"",position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"},c=new FileReader;c.onload=p=>{var u,f;(u=p.target)!=null&&u.result&&(i.content=p.target.result,M?ze(M,i):(f=n[d])!=null&&f.cells[0]&&ze(n[d].cells[0].id,i))},c.readAsDataURL(a.target.files[0])}},t.click()},className:"h-8 px-2",icon:e.jsx(Ae,{className:"h-4 w-4"}),children:"Imagen"}),e.jsx(Pe,{variant:"ghost",tooltip:"Añadir Imagen",onClick:()=>Ue.current&&Ue.current.click(),children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",ref:Ue,onChange:gt,className:"hidden",accept:"image/*"}),e.jsx(Pe,{variant:"ghost",tooltip:"Añadir Texto",onClick:ft,children:e.jsx(Ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),j&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(Pe,{variant:"ghost",size:"sm",onClick:()=>{if(j&&M){const t=Q();if(t){const a={...t,id:`${t.type}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,position:{x:t.position.x+.05,y:t.position.y+.05}};ze(M,a)}}},className:"h-8 px-2",icon:e.jsx(la,{className:"h-4 w-4"}),children:"Duplicar"}),e.jsx(Pe,{variant:"ghost",size:"sm",onClick:()=>{j&&M&&xt(M,j)},className:"h-8 px-2 text-red-600 hover:text-white",icon:e.jsx(At,{className:"h-4 w-4"}),children:"Eliminar"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(ar,{currentSize:K,onSizeChange:E,presetData:o,workspaceDimensions:F})})]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 overflow-hidden bg-gray-100",children:w?e.jsx("div",{className:"bg-white rounded-lg shadow-lg",children:e.jsx("div",{className:"overflow-hidden",style:{width:F.width,height:F.height},children:e.jsx("div",{id:`page-${n[d].id}`,className:`grid ${Re().template} gap-6`,style:{width:"100%",height:"100%"},children:n[d].cells.map((t,a)=>{var r;return e.jsx(js,{id:t.id,elements:t.elements.filter(i=>!i.locked),workspaceSize:F,cellStyle:(r=Re().cellStyles)==null?void 0:r[n[d].cells.indexOf(t)],selectedElement:M===t.id?j:null,onSelectElement:It,onAddElement:(i,c)=>ze(c,i),onUpdateElement:(i,c,p)=>ne(t.id,i,c,p),onDeleteElement:i=>xt(t.id,i),availableMasks:Re().maskCategories.flatMap(i=>i.masks),projectData:s},t.id)})})})}):e.jsxs("div",{id:`page-${n[d].id}`,className:" shadow-xl overflow-hidden",style:{width:F.width,height:F.height,position:"relative",backgroundColor:((us=n[d])==null?void 0:us.backgroundColor)||"#ffffff",backgroundImage:(ps=n[d])!=null&&ps.backgroundImage?`url(${n[d].backgroundImage})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:["                                        ",(()=>{const t=n[d];return t!=null&&t.backgroundImage&&(window.location.origin+t.backgroundImage,fetch(t.backgroundImage,{method:"HEAD"}).then(a=>{a.ok?console.log("✅ [WORKSPACE] Imagen existe en el servidor"):console.error("❌ [WORKSPACE] Imagen NO existe en el servidor. Status:",a.status)}).catch(a=>{console.error("❌ [WORKSPACE] Error verificando imagen:",a)})),t!=null&&t.backgroundImage?e.jsx("img",{src:t.backgroundImage,alt:"background",className:"absolute inset-0 w-full h-full object-cover pointer-events-none",style:{zIndex:1}}):t!=null&&t.backgroundColor?e.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{backgroundColor:t.backgroundColor,zIndex:1}}):null})(),e.jsx("div",{className:`grid ${Re().template}`,style:{position:"relative",zIndex:10,width:"100%",height:"100%",boxSizing:"border-box",gap:((xs=Re().style)==null?void 0:xs.gap)||"16px",padding:((fs=Re().style)==null?void 0:fs.padding)||"16px"},children:n[d].cells.map(t=>{var a;return e.jsx(js,{id:t.id,elements:t.elements.filter(r=>!r.locked),workspaceSize:F,cellStyle:(a=Re().cellStyles)==null?void 0:a[n[d].cells.indexOf(t)],selectedElement:M===t.id?j:null,onSelectElement:It,onAddElement:(r,i)=>ze(i,r),onUpdateElement:(r,i,c)=>ne(t.id,r,i,c),onDeleteElement:r=>xt(t.id,r),availableMasks:Re().maskCategories.flatMap(r=>r.masks),projectData:s},t.id)})})]})})]})]})]}),e.jsx(Ds,{}),e.jsx(hr,{isOpen:ct,onClose:()=>De(!1),savedProgress:dt,onLoadProgress:J,onDiscardProgress:je})]})}export{mo as default};
