var _=Object.defineProperty;var T=(r,a,c)=>a in r?_(r,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[a]=c;var w=(r,a,c)=>T(r,typeof a!="symbol"?a+"":a,c);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{B as q}from"./Base-B2AngFVl.js";import{S as k}from"./SwitchFormGroup-CGYpv_4Q.js";import{T as A}from"./TextareaFormGroup-DVzYJtLM.js";import{I as y}from"./ImageFormGroup-BPR9pDAU.js";import{r as l}from"./index-BH53Isel.js";import{c as B}from"./ReactAppend-DTVVXReZ.js";import{S as m}from"./ProductCard-CRhBSmWZ.js";import{B as z}from"./BasicRest-C4m6wu80.js";import{I}from"./InputFormGroup-D5I6zpZc.js";import{M as P}from"./Modal-DYPPCNUR.js";import{T as O}from"./Table-DitbKwtZ.js";import{D}from"./DxButton-DV0H-ZcL.js";import{C as G}from"./CreateReactScript-DERNRfBB.js";import{R as x}from"./ReactAppend-D7S498fx.js";import{G as M}from"./Global-D6eBBAMK.js";import"./index-yBjzXJbu.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-TGKOqZqZ.js";import"./main-6DCdASTx.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-CY0sLPNq.js";import"./index.esm-POOiSFi2.js";import"./index-Dq7h7Pqt.js";import"./index-BZYhE2TF.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";class V extends z{constructor(){super(...arguments);w(this,"path","admin/tags");w(this,"hasFiles",!0)}}const g=new V,L=()=>{const r=l.useRef(),a=l.useRef(),c=l.useRef(),h=l.useRef(),j=l.useRef(),b=l.useRef(),v=l.useRef(),d=l.useRef(),p=l.useRef(),u=l.useRef(),f=l.useRef(),[C,N]=l.useState(!1),R=t=>{t!=null&&t.id?N(!0):N(!1),c.current.value=(t==null?void 0:t.id)??"",h.current.value=(t==null?void 0:t.name)??"",j.current.value=(t==null?void 0:t.description)??"",b.current.value=(t==null?void 0:t.background_color)??M.APP_COLOR_PRIMARY,v.current.value=(t==null?void 0:t.text_color)??"#ffffff",u.current.value=t!=null&&t.start_date?new Date(t.start_date).toISOString().slice(0,16):"",f.current.value=t!=null&&t.end_date?new Date(t.end_date).toISOString().slice(0,16):"",d.current&&(t!=null&&t.icon)&&(d.current.src=`/storage/images/tag/${t.icon}`),p.current&&(t!=null&&t.image)&&(p.current.src=`/storage/images/tag/${t.image}`),$(a.current).modal("show")},E=async t=>{t.preventDefault();const s=u.current.value,o=f.current.value;if(s&&o&&new Date(s)>=new Date(o)){await m.fire({title:"Error de Validaci√≥n",text:"La fecha de inicio debe ser anterior a la fecha de fin",icon:"error"});return}const i=new FormData;i.append("id",c.current.value||""),i.append("name",h.current.value),i.append("description",j.current.value),i.append("background_color",b.current.value),i.append("text_color",v.current.value),u.current.value&&i.append("start_date",u.current.value),f.current.value&&i.append("end_date",f.current.value),d.current.src&&d.current.src&&i.append("icon",d.current.files[0]),p.current.files&&p.current.files[0]&&i.append("image",p.current.files[0]),await g.save(i)&&($(r.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},S=async({id:t,value:s})=>{await g.boolean({id:t,field:"visible",value:s})&&$(r.current).dxDataGrid("instance").refresh()},F=async t=>{const{isConfirmed:s}=await m.fire({title:"Eliminar registro",text:"¬øEstas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!s||!await g.delete(t)||$(r.current).dxDataGrid("instance").refresh()};return e.jsxs(e.Fragment,{children:[e.jsx(O,{gridRef:r,title:"Etiquetas",rest:g,toolBar:t=>{t.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),t.unshift({widget:"dxButton",location:"after",options:{icon:"clock",text:"Actualizar Estados",hint:"Actualizar estados promocionales",onClick:async()=>{var o;const{isConfirmed:s}=await m.fire({title:"Actualizar Estados Promocionales",text:"¬øDeseas actualizar el estado de todas las etiquetas promocionales basado en sus fechas?",icon:"question",showCancelButton:!0,confirmButtonText:"S√≠, actualizar",cancelButtonText:"Cancelar"});if(s)try{m.fire({title:"Actualizando...",text:"Por favor espera mientras se actualizan los estados",allowOutsideClick:!1,didOpen:()=>m.showLoading()});const n=await(await fetch("/api/admin/tags/update-promotional-status",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).json();if(n.success)await m.fire({title:"¬°Actualizaci√≥n completada!",html:`
                      <div class="text-start">
                        <p><strong>üìä Estad√≠sticas:</strong></p>
                        <ul class="list-unstyled">
                          <li>üîÑ Permanentes: ${n.data.permanent||0}</li>
                          <li>‚úÖ Activos: ${n.data.active||0}</li>
                          <li>‚ùå Expirados: ${n.data.expired||0}</li>
                          <li>üìù Actualizados: ${n.data.updated||0}</li>
                        </ul>
                      </div>
                    `,icon:"success"}),$(r.current).dxDataGrid("instance").refresh();else throw new Error(n.message||"Error al actualizar estados")}catch(i){m.fire({title:"Error",text:i.message||"No se pudieron actualizar los estados",icon:"error"})}}}}),t.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>R()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Etiqueta",width:"25%"},{dataField:"description",caption:"Descripci√≥n",width:"20%"},{dataField:"promotional_status",caption:"Estado Promocional",width:"15%",allowSorting:!0,allowFiltering:!0,cellTemplate:(t,{data:s})=>{$(t).empty();const i={permanent:{text:"Permanente",class:"success",icon:"fas fa-infinity"},active:{text:"Activo",class:"primary",icon:"fas fa-play-circle"},expired:{text:"Expirado",class:"danger",icon:"fas fa-stop-circle"}}[s.promotional_status]||{text:"Desconocido",class:"secondary",icon:"fas fa-question-circle"},n=e.jsxs("span",{className:`badge bg-${i.class} d-flex align-items-center gap-1`,style:{fontSize:"11px"},children:[e.jsx("i",{className:i.icon}),i.text]});x(t,n)}},{dataField:"preview",caption:"Vista Previa",width:"20%",allowSorting:!1,allowFiltering:!1,cellTemplate:(t,{data:s})=>{$(t).empty();const o={backgroundColor:s.background_color||"#3b82f6",color:s.text_color||"#ffffff",padding:"4px 8px",borderRadius:"12px",fontSize:"12px",display:"inline-flex",alignItems:"center",gap:"4px",maxWidth:"150px"},i=e.jsxs("div",{children:[e.jsxs("span",{style:o,children:[s.icon&&e.jsx("img",{src:`/storage/images/tag/${s.icon}`,style:{width:"16px",height:"16px",borderRadius:"2px"},alt:"icon",onError:n=>n.target.src="/api/cover/thumbnail/null"}),e.jsx("span",{children:s.name})]}),(s.start_date||s.end_date)&&e.jsxs("div",{style:{fontSize:"10px",color:"#6c757d",marginTop:"2px"},children:[s.start_date&&e.jsxs("div",{children:["üìÖ Inicio: ",new Date(s.start_date).toLocaleDateString()]}),s.end_date&&e.jsxs("div",{children:["üèÅ Fin: ",new Date(s.end_date).toLocaleDateString()]})]})]});x(t,i)}},{dataField:"image",caption:"Imagen Principal",width:"15%",allowSorting:!1,allowFiltering:!1,cellTemplate:(t,{data:s})=>{if($(t).empty(),s.image){const o=e.jsx("img",{src:`/storage/images/tag/${s.image}`,style:{width:"40px",height:"24px",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"},alt:"imagen principal"});x(t,o)}else t.text("Sin imagen")}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(t,{data:s})=>{$(t).empty(),x(t,e.jsx(k,{checked:s.visible==1,onChange:()=>S({id:s.id,value:!s.visible})}))}},{caption:"Acciones",cellTemplate:(t,{data:s})=>{t.css("text-overflow","unset"),t.append(D({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>R(s)})),t.append(D({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>F(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(P,{modalRef:a,title:C?"Editar etiqueta":"Agregar etiqueta",onSubmit:E,size:"lg",children:e.jsxs("div",{className:"row",id:"tags-container",children:[e.jsx("input",{ref:c,type:"hidden"}),e.jsx(I,{eRef:h,label:"Nombre de la Etiqueta",col:"col-12",required:!0}),e.jsx(A,{eRef:j,label:"Descripci√≥n",col:"col-12",rows:2}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"alert alert-info mb-3",children:[e.jsxs("h6",{className:"alert-heading mb-2",children:[e.jsx("i",{className:"fas fa-calendar-alt me-2"}),"Configuraci√≥n Promocional"]}),e.jsxs("div",{className:"row small",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:"üîÑ Etiquetas Permanentes:"})}),e.jsx("p",{className:"mb-2",children:"Sin fechas ‚Üí Siempre visibles"}),e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:"üìÖ Etiquetas Promocionales:"})}),e.jsx("p",{className:"mb-0",children:"Con fechas ‚Üí Solo activas en el per√≠odo especificado"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:"Ejemplos de uso:"})}),e.jsxs("ul",{className:"mb-0 small",children:[e.jsx("li",{children:"Black Friday: 29/11/2024 - 02/12/2024"}),e.jsx("li",{children:"Cyber Monday: 02/12/2024 - 03/12/2024"}),e.jsx("li",{children:"Descuentos Navide√±os: 15/12/2024 - 25/12/2024"}),e.jsx("li",{children:"Ofertas de A√±o Nuevo: 26/12/2024 - 05/01/2025"})]})]})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group mb-2",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"fas fa-play-circle text-success me-1"}),"Fecha y Hora de Inicio"]}),e.jsx("input",{ref:u,type:"datetime-local",className:"form-control",placeholder:"Opcional: Fecha de inicio de la promoci√≥n"}),e.jsx("small",{className:"text-muted",children:"Opcional: Deja vac√≠o para etiqueta permanente"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group mb-2",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"fas fa-stop-circle text-danger me-1"}),"Fecha y Hora de Fin"]}),e.jsx("input",{ref:f,type:"datetime-local",className:"form-control",placeholder:"Opcional: Fecha de fin de la promoci√≥n"}),e.jsx("small",{className:"text-muted",children:"Opcional: Deja vac√≠o para etiqueta permanente"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group mb-2",children:[e.jsx("label",{className:"form-label",children:"Color de Fondo"}),e.jsx("input",{ref:b,type:"color",className:"form-control form-control-color",defaultValue:"#3b82f6"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group mb-2",children:[e.jsx("label",{className:"form-label",children:"Color de Texto"}),e.jsx("input",{ref:v,type:"color",className:"form-control form-control-color",defaultValue:"#ffffff"})]})}),e.jsx(y,{eRef:d,label:"Icono (imagen peque√±a que aparece al lado del texto)",col:"col-md-6",aspect:"1/1"}),e.jsx(y,{eRef:p,label:"Imagen Principal (para otros fines)",col:"col-md-6",aspect:"16/9"})]})})]})};G((r,a)=>{B.createRoot(r).render(e.jsx(q,{...a,title:"Etiquetas",children:e.jsx(L,{...a})}))});
