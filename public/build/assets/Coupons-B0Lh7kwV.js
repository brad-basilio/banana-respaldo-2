import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as V}from"./Base-Dl9oddLU.js";import{S as z}from"./SwitchFormGroup-CGYpv_4Q.js";import{T as H}from"./TextareaFormGroup-DVzYJtLM.js";import{r as s}from"./index-BH53Isel.js";import{c as J}from"./ReactAppend-DTVVXReZ.js";import{s as m}from"./server.browser-Bf4gQIc7.js";import{S as W}from"./ProductCard-CRhBSmWZ.js";import{B as Y}from"./BasicRest-C4m6wu80.js";import{t as S}from"./index-BZYhE2TF.js";import{m as k}from"./main-6DCdASTx.js";import{M as K}from"./Modal-DYPPCNUR.js";import{T as Q}from"./Table-DitbKwtZ.js";import{I as o}from"./InputFormGroup-D5I6zpZc.js";import{S as X}from"./SelectFormGroup-BmhC2uob.js";import{D as M}from"./DxButton-DV0H-ZcL.js";import{C as Z}from"./CreateReactScript-NWc2tE6o.js";import{N as B}from"./Number2Currency-e57Tgsuk.js";import{R as ee}from"./ReactAppend-D7S498fx.js";import"./index-yBjzXJbu.js";import"./Global-ErywZRdd.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-TGKOqZqZ.js";import"./MenuItemContainer-CY0sLPNq.js";import"./index.esm-POOiSFi2.js";import"./index-Dq7h7Pqt.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";class re extends Y{constructor(){super(),this.path="admin/coupons"}async validate(c,l={}){try{const{status:a,result:i}=await k.Fetch(`/api/${this.path}/validate`,{method:"POST",body:JSON.stringify({code:c,cart_total:l.total||0,category_ids:l.category_ids||[],product_ids:l.product_ids||[]}),headers:{"Content-Type":"application/json"}});return i.valid?(S.success("¡Excelente!",{description:i.message,duration:3e3,position:"bottom-center",richColors:!0}),i):(S.error("¡Error!",{description:i.message,duration:3e3,position:"bottom-center",richColors:!0}),null)}catch(a){return S.error("¡Error!",{description:a.message||"Error al validar el cupón",duration:3e3,position:"bottom-center",richColors:!0}),null}}async generateCode(){var c;try{const{status:l,result:a}=await k.Fetch(`/api/${this.path}/generate-code`);return l?((c=a.data)==null?void 0:c.code)||a.code:null}catch{return S.error("¡Error!",{description:"Error al generar código",duration:3e3,position:"bottom-center",richColors:!0}),null}}}const p=new re,te=({categories:C,products:c})=>{const[l,a]=s.useState(!1),i=s.useRef(),N=s.useRef(),d=s.useRef(),u=s.useRef(),f=s.useRef(),h=s.useRef(),x=s.useRef(),g=s.useRef(),v=s.useRef(),b=s.useRef(),j=s.useRef(),y=s.useRef(),R=s.useRef(),w=s.useRef(),_=s.useRef(),[se,E]=s.useState(!1),F=e=>{e!=null&&e.id?a(!0):a(!1),$(N.current).modal("show"),setTimeout(()=>{d.current&&(d.current.value=(e==null?void 0:e.id)??""),u.current&&(u.current.value=(e==null?void 0:e.code)??""),f.current&&(f.current.value=(e==null?void 0:e.name)??""),h.current&&(h.current.value=(e==null?void 0:e.description)??""),g.current&&(g.current.value=(e==null?void 0:e.value)??""),v.current&&(v.current.value=(e==null?void 0:e.minimum_amount)??""),b.current&&(b.current.value=(e==null?void 0:e.usage_limit)??""),j.current&&(j.current.value=(e==null?void 0:e.usage_limit_per_user)??1),w.current&&(w.current.value=(e==null?void 0:e.maximum_discount)??""),y.current&&(y.current.value=e!=null&&e.starts_at?D(new Date(e.starts_at)):""),R.current&&(R.current.value=e!=null&&e.expires_at?D(new Date(e.expires_at)):""),_.current&&(_.current.checked=(e==null?void 0:e.first_purchase_only)??!1);const t=(e==null?void 0:e.type)||"percentage";x.current&&($(x.current).val(t).trigger("change"),E(t==="percentage"))},100)},D=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),T=String(e.getDate()).padStart(2,"0"),L=String(e.getHours()).padStart(2,"0"),U=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${T}T${L}:${U}`},A=async e=>{e.preventDefault();const t={id:d.current.value||void 0,code:u.current.value,name:f.current.value,description:h.current.value,type:x.current.value,value:g.current.value,minimum_amount:v.current.value||0,usage_limit:b.current.value||null,usage_limit_per_user:j.current.value,starts_at:y.current.value,expires_at:R.current.value,maximum_discount:w.current.value||null,first_purchase_only:_.current.checked?1:0};await p.save(t)&&($(i.current).dxDataGrid("instance").refresh(),$(N.current).modal("hide"))},G=async({id:e,value:t})=>{await p.boolean({id:e,field:"active",value:t})&&$(i.current).dxDataGrid("instance").refresh()},q=async e=>{const{isConfirmed:t}=await W.fire({title:"Eliminar cupón",text:"¿Estás seguro de eliminar este cupón?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await p.delete(e)||$(i.current).dxDataGrid("instance").refresh()},O=e=>{E(e.target.value==="percentage")},P=async()=>{const e=await p.generateCode();e&&u.current&&(u.current.value=e)},I=e=>({active:"badge-success",expired:"badge-danger",pending:"badge-warning",exhausted:"badge-secondary",inactive:"badge-dark"})[e]||"badge-secondary";return r.jsxs(r.Fragment,{children:[r.jsx(Q,{gridRef:i,title:"Cupones",rest:p,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar cupón",onClick:()=>F()}})},exportable:!0,exportableName:"Cupones",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Código",width:"120px",cellTemplate:(e,{data:t})=>{e.html(m.renderToString(r.jsxs("div",{children:[r.jsx("strong",{className:"font-monospace",children:t.code}),r.jsx("br",{}),r.jsx("span",{className:`badge ${I(t.status)} badge-sm`,children:t.status_text})]})))}},{dataField:"name",caption:"Nombre",minWidth:"200px",cellTemplate:(e,{data:t})=>{e.html(m.renderToString(r.jsxs("div",{children:[r.jsx("strong",{children:t.name}),t.description&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),r.jsx("small",{className:"text-muted",children:t.description.length>50?t.description.substring(0,50)+"...":t.description})]})]})))}},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:t})=>{const n=t.type==="percentage"?"Porcentaje":"Monto Fijo",T=t.type==="percentage"?"badge-info":"badge-primary";e.html(m.renderToString(r.jsx("span",{className:`badge ${T}`,children:n})))}},{dataField:"value",caption:"Valor",width:"100px",cellTemplate:(e,{data:t})=>{const n=t.type==="percentage"?`${t.value}%`:`S/. ${B(t.value)}`;e.html(m.renderToString(r.jsx("strong",{children:n})))}},{dataField:"minimum_amount",caption:"Mín. Compra",width:"110px",cellTemplate:(e,{data:t})=>{e.html(m.renderToString(r.jsxs("span",{children:["S/. ",B(t.minimum_amount)]})))}},{dataField:"usage_limit",caption:"Usos",width:"80px",cellTemplate:(e,{data:t})=>{const n=t.usage_limit?`${t.used_count}/${t.usage_limit}`:`${t.used_count}/∞`;e.html(m.renderToString(r.jsx("span",{children:n})))}},{dataField:"starts_at",caption:"Inicio",dataType:"datetime",width:"110px",format:"dd/MM/yyyy"},{dataField:"expires_at",caption:"Expiración",dataType:"datetime",width:"110px",format:"dd/MM/yyyy"},{dataField:"active",caption:"Activo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{ee(e,r.jsx(z,{checked:t.active,onChange:n=>G({id:t.id,value:n.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(M({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>F(t)})),e.append(M({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>q(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsx(K,{modalRef:N,title:l?"Editar cupón":"Agregar cupón",onSubmit:A,size:"xl",children:r.jsxs("div",{className:"row",id:"coupons-form",children:[r.jsx("input",{ref:d,type:"hidden"}),r.jsxs("div",{className:"col-md-6",children:[r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-8",children:r.jsx(o,{eRef:u,label:"Código del cupón",required:!0,placeholder:"Ej: DESCUENTO20"})}),r.jsxs("div",{className:"col-md-4",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary d-block",onClick:P,children:"Generar"})]})]}),r.jsx(o,{eRef:f,label:"Nombre",required:!0,placeholder:"Nombre descriptivo del cupón"}),r.jsx(H,{eRef:h,label:"Descripción",rows:3,placeholder:"Descripción del cupón"}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsxs(X,{eRef:x,label:"Tipo de descuento",required:!0,onChange:O,dropdownParent:"#coupons-form",children:[r.jsx("option",{value:"percentage",children:"Porcentaje"}),r.jsx("option",{value:"fixed",children:"Monto fijo"})]})}),r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:g,label:"Valor",type:"number",step:"0.01",min:"0",required:!0,placeholder:"Ej: 20 o 50.00"})})]}),r.jsx(o,{eRef:w,label:"Descuento máximo (S/.)",type:"number",step:"0.01",min:"0",placeholder:"Opcional - límite máximo de descuento"}),r.jsx(o,{eRef:v,label:"Monto mínimo de compra (S/.)",type:"number",step:"0.01",min:"0",placeholder:"0.00"})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:b,label:"Límite de usos",type:"number",min:"1",placeholder:"Dejar vacío para ilimitado"})}),r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:j,label:"Usos por usuario",type:"number",min:"1",defaultValue:"1",required:!0})})]}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:y,label:"Fecha de inicio",type:"datetime-local",required:!0})}),r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:R,label:"Fecha de expiración",type:"datetime-local",required:!0})})]}),r.jsxs("div",{className:"form-check mb-3",children:[r.jsx("input",{ref:_,className:"form-check-input",type:"checkbox",id:"firstPurchaseOnly"}),r.jsx("label",{className:"form-check-label",htmlFor:"firstPurchaseOnly",children:"Solo primera compra"})]})]})]})})]})};Z((C,c)=>{J.createRoot(C).render(r.jsx(V,{...c,title:"Cupones",children:r.jsx(te,{...c})}))});
