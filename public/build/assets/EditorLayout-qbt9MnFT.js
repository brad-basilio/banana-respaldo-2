import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{B as j,U as V,R as B,T as I,l as N,F as _,E as W,D as X,H as Y}from"./EditableCell-Cu-5czkC.js";import{r as h}from"./index-BH53Isel.js";import{C as G}from"./chevron-left-B2s3ZsB7.js";import{E as q}from"./eye-CKCH9ORv.js";import{D as K}from"./download-Dh5rRDOT.js";import{I as M}from"./image-BEA0kkBS.js";import{T as D}from"./trash-2-DK1wnsDn.js";import{C as Q}from"./copy-6OEekgvq.js";import{P as Z}from"./plus-Bot15Khs.js";import{h as ee}from"./thumbnailGenerator-B4goYG9Y.js";import{F as te}from"./EditorLayout-CkCvwqGw.js";import"./index-yBjzXJbu.js";import"./createLucideIcon-Cy5Ya80P.js";import"./useDrag-BaORhKlM.js";import"./index-BSWw-p5k.js";import"./sparkles-DeLUn6av.js";import"./sliders-vertical-C5ts4taK.js";import"./palette-DV_Vpyg9.js";import"./settings-BSPs3Zt8.js";import"./chevron-up-D78jyEhP.js";import"./chevron-down-DS-mdh9v.js";import"./index-BZYhE2TF.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./TextElement-_pvTHO57.js";import"./upload-qgEr5bIl.js";function se({onExport:e,onPreviewToggle:s,previewMode:n}){return t.jsxs("header",{className:"border-b bg-white p-4 flex items-center justify-between shadow-sm",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(j,{variant:"ghost",size:"sm",children:[t.jsx(G,{className:"h-5 w-5 mr-1"}),"Regresar"]})}),t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Editor de Fotos Profesional"}),t.jsx("h2",{className:"text-lg text-gray-600",children:"Crea collages y diseños impresionantes"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(j,{variant:"secondary",onClick:s,icon:t.jsx(q,{className:"h-4 w-4"}),children:n?"Editar":"Vista previa"}),t.jsx(j,{className:"bg-purple-600 hover:bg-purple-700",icon:t.jsx(K,{className:"h-4 w-4"}),onClick:e,children:"Exportar"})]})]})}function ae({onUndo:e,onRedo:s,onAddImage:n,onAddText:a,onDeleteElement:r,canUndo:i,canRedo:o,hasSelectedElement:d}){return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 flex items-center gap-4",children:[t.jsx(j,{variant:"ghost",size:"icon",onClick:e,disabled:!i,children:t.jsx(V,{className:"h-5 w-5"})}),t.jsx(j,{variant:"ghost",size:"icon",onClick:s,disabled:!o,children:t.jsx(B,{className:"h-5 w-5"})}),t.jsx("div",{className:"h-6 border-l"}),t.jsx(j,{variant:"ghost",size:"icon",onClick:n,children:t.jsx(M,{className:"h-5 w-5"})}),t.jsx(j,{variant:"ghost",size:"icon",onClick:a,children:t.jsx(I,{className:"h-5 w-5"})}),t.jsx("div",{className:"h-6 border-l"}),t.jsx(j,{variant:"ghost",size:"icon",onClick:r,disabled:!d,children:t.jsx(D,{className:"h-5 w-5"})})]})}function ne({selectedLayout:e,onSelect:s}){return t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-2",children:"Layouts"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:N.map(n=>t.jsxs("div",{className:`border rounded-md p-1 cursor-pointer hover:border-purple-500 ${e===n.id?"border-purple-500 ring-1 ring-purple-200":""}`,onClick:()=>s(n.id),children:[t.jsx("div",{className:`grid ${n.template} gap-1 h-20`,children:Array.from({length:n.cells}).map((a,r)=>t.jsx("div",{className:"bg-gray-100 rounded-sm flex items-center justify-center",children:t.jsx("span",{className:"text-xs text-gray-400",children:r+1})},r))}),t.jsx("p",{className:"text-xs text-center mt-1 truncate",children:n.name})]},n.id))})]})}function re({onAddImage:e,onAddText:s}){const n=()=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=r=>{r.target.files&&r.target.files[0]&&e(r.target.files[0])},a.click()};return t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-2",children:"Añadir"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(j,{variant:"outline",size:"sm",icon:t.jsx(M,{className:"h-4 w-4"}),onClick:n,children:"Imagen"}),t.jsx(j,{variant:"outline",size:"sm",icon:t.jsx(I,{className:"h-4 w-4"}),onClick:s,children:"Texto"})]})]})}function ie({tabs:e,activeTab:s,onChange:n}){return t.jsx("div",{className:"flex border-b pb-4",children:e.map(a=>t.jsx("button",{className:`flex-1 py-2 text-sm font-medium ${s===a.id?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"}`,onClick:()=>n(a.id),children:a.label},a.id))})}function oe({activeTab:e,onTabChange:s,selectedLayout:n,onLayoutChange:a,onAddImage:r,onAddText:i,selectedElement:o,onFilterChange:d,getSelectedElement:p,getCurrentLayout:f}){const[x,u]=h.useState("basic");return t.jsx("aside",{className:"w-64 border-r bg-white p-4 overflow-y-auto shadow-sm",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(ie,{tabs:[{id:"elements",label:"Elementos"},{id:"filters",label:"Filtros"}],activeTab:e,onChange:s}),e==="elements"?t.jsxs(t.Fragment,{children:[t.jsx(ne,{selectedLayout:n,onSelect:a}),t.jsx(re,{onAddImage:r,onAddText:i})]}):o?t.jsx(_,{element:p(),filterTab:x,onFilterTabChange:u,onFilterChange:d,availableMasks:f().maskCategories.flatMap(l=>l.masks)}):t.jsx("div",{className:"text-center py-8 text-gray-500",children:"Selecciona un elemento para editar sus filtros"})]})})}function le({page:e,layout:s}){return t.jsx("div",{className:"bg-white p-8 rounded-lg shadow-lg page-preview",children:t.jsx("div",{className:`grid ${s.template} gap-6 aspect-[4/3]`,children:e.cells.map(n=>t.jsx("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden",children:n.elements.map(a=>a.type==="image"?t.jsx(ce,{element:a},a.id):t.jsx(de,{element:a},a.id))},n.id))})})}function ce({element:e}){var n,a,r,i,o,d,p,f,x,u,l,c;const s=imageMasks.find(m=>m.id===e.mask)||imageMasks[0];return t.jsx("div",{className:`absolute ${s.class}`,style:{left:`${e.position.x}px`,top:`${e.position.y}px`,width:"100%",height:"100%"},children:t.jsx("img",{src:e.content,alt:"",className:"w-full h-full object-cover",style:{filter:`
              brightness(${(((n=e.filters)==null?void 0:n.brightness)||100)/100})
              contrast(${(((a=e.filters)==null?void 0:a.contrast)||100)/100})
              saturate(${(((r=e.filters)==null?void 0:r.saturation)||100)/100})
              sepia(${(((i=e.filters)==null?void 0:i.tint)||0)/100})
              hue-rotate(${(((o=e.filters)==null?void 0:o.hue)||0)*3.6}deg)
              blur(${((d=e.filters)==null?void 0:d.blur)||0}px)
            `,transform:`scale(${((p=e.filters)==null?void 0:p.scale)||1}) rotate(${((f=e.filters)==null?void 0:f.rotate)||0}deg) ${(x=e.filters)!=null&&x.flipHorizontal?"scaleX(-1)":""} ${(u=e.filters)!=null&&u.flipVertical?"scaleY(-1)":""}`,mixBlendMode:((l=e.filters)==null?void 0:l.blendMode)||"normal",opacity:(((c=e.filters)==null?void 0:c.opacity)||100)/100}})})}function de({element:e}){var s,n,a,r,i,o,d,p,f,x,u,l;return t.jsx("div",{className:"absolute",style:{left:`${e.position.x}px`,top:`${e.position.y}px`,fontFamily:(s=e.style)==null?void 0:s.fontFamily,fontSize:(n=e.style)==null?void 0:n.fontSize,fontWeight:(a=e.style)==null?void 0:a.fontWeight,fontStyle:(r=e.style)==null?void 0:r.fontStyle,textDecoration:(i=e.style)==null?void 0:i.textDecoration,color:(o=e.style)==null?void 0:o.color,textAlign:(d=e.style)==null?void 0:d.textAlign,backgroundColor:((p=e.style)==null?void 0:p.backgroundColor)||"transparent",padding:((f=e.style)==null?void 0:f.padding)||"8px",borderRadius:((x=e.style)==null?void 0:x.borderRadius)||"0px",border:((u=e.style)==null?void 0:u.border)||"none",opacity:((l=e.style)==null?void 0:l.opacity)||1},children:e.content})}function me({page:e,layout:s,selectedElement:n,selectedCell:a,onSelectElement:r,onSelectCell:i,onAddElement:o,onUpdateElement:d,onDeleteElement:p,onUndo:f,onRedo:x,canUndo:u,canRedo:l,onAddImage:c,onAddText:m}){return t.jsxs("div",{className:"space-y-6",children:[t.jsx(ae,{onUndo:f,onRedo:x,onAddImage:c,onAddText:m,onDeleteElement:()=>{n&&a&&p(a,n)},canUndo:u,canRedo:l,hasSelectedElement:!!n}),t.jsx("div",{className:`bg-white rounded-lg shadow-lg overflow-hidden page-preview ${s.cells<=4?"aspect-[4/3]":""}`,children:t.jsx("div",{className:`grid ${s.template} gap-4 h-full p-4`,children:e.cells.map(g=>t.jsx(W,{id:g.id,elements:g.elements,selectedElement:a===g.id?n:null,onSelectElement:y=>{r(y),i(g.id)},onAddElement:o,onUpdateElement:(y,C,E)=>{d(g.id,y,C,E)},onDeleteElement:y=>{p(g.id,y)},availableMasks:s.maskCategories.flatMap(y=>y.masks)},g.id))})})]})}function ue({currentPage:e,pages:s,selectedElement:n,selectedCell:a,onSelectElement:r,onSelectCell:i,onAddElement:o,onUpdateElement:d,onDeleteElement:p,getCurrentLayout:f,previewMode:x}){return t.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-6",children:t.jsx("div",{className:"max-w-4xl mx-auto",children:x?t.jsx(le,{page:s[e],layout:f()}):t.jsx(me,{page:s[e],layout:f(),selectedElement:n,selectedCell:a,onSelectElement:r,onSelectCell:i,onAddElement:o,onUpdateElement:d,onDeleteElement:p})})})}function ge({pages:e,currentPage:s,onPageChange:n,onAddPage:a,onDuplicatePage:r,onDeletePage:i}){return t.jsx("aside",{className:"w-56 border-l bg-white p-4 overflow-y-auto shadow-sm",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"font-medium",children:"Páginas"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(j,{variant:"ghost",size:"icon-sm",onClick:r,children:t.jsx(Q,{})}),t.jsx(j,{variant:"ghost",size:"icon-sm",onClick:i,disabled:e.length<=1,children:t.jsx(D,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"grid gap-3",children:[e.map((o,d)=>t.jsx(pe,{page:o,index:d,isActive:s===d,onClick:()=>n(d)},o.id)),t.jsx(j,{variant:"outline",size:"sm",icon:t.jsx(Z,{className:"h-4 w-4"}),onClick:a,children:"Añadir página"})]})]})})}function pe({page:e,index:s,isActive:n,onClick:a}){return t.jsx("div",{className:`border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors ${n?"border-purple-500 ring-2 ring-purple-200":""}`,onClick:a,children:t.jsxs("div",{className:"bg-gray-100 aspect-[4/3] rounded-sm flex items-center justify-center text-xs text-gray-500 relative",children:["Pág. ",s+1,e.cells.some(r=>r.elements.some(i=>i.type==="image"&&i.content))&&t.jsx("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 gap-1 p-1",children:Array.from({length:4}).map((r,i)=>{const o=e.cells[i],d=o==null?void 0:o.elements.find(p=>p.type==="image"&&p.content);return t.jsx("div",{className:"bg-gray-200 rounded-sm overflow-hidden",children:d&&t.jsx("img",{src:d.content,alt:"",className:"w-full h-full object-cover"})},i)})})]})})}function xe(e){const[s,n]=h.useState([JSON.stringify(e)]),[a,r]=h.useState(0),i=x=>{const u=[...s.slice(0,a+1),JSON.stringify(x)];n(u),r(u.length-1)},o=()=>a>0?(r(a-1),JSON.parse(s[a-1])):null,d=()=>a<s.length-1?(r(a+1),JSON.parse(s[a+1])):null,p=a>0,f=a<s.length-1;return{currentState:JSON.parse(s[a]),addToHistory:i,undo:o,redo:d,canUndo:p,canRedo:f}}var $,fe=new Uint8Array(16);function he(){if(!$&&($=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!$))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $(fe)}const ye=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function be(e){return typeof e=="string"&&ye.test(e)}var b=[];for(var z=0;z<256;++z)b.push((z+256).toString(16).substr(1));function je(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(b[e[s+0]]+b[e[s+1]]+b[e[s+2]]+b[e[s+3]]+"-"+b[e[s+4]]+b[e[s+5]]+"-"+b[e[s+6]]+b[e[s+7]]+"-"+b[e[s+8]]+b[e[s+9]]+"-"+b[e[s+10]]+b[e[s+11]]+b[e[s+12]]+b[e[s+13]]+b[e[s+14]]+b[e[s+15]]).toLowerCase();if(!be(n))throw TypeError("Stringified UUID is invalid");return n}function w(e,s,n){e=e||{};var a=e.random||(e.rng||he)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,je(a)}function ve(e=[]){const s=h.useCallback((u=N[0].id)=>{const l=N.find(c=>c.id===u)||N[0];return{id:w(),layout:l.id,cells:Array.from({length:l.cells}).map(()=>({id:w(),elements:[]}))}},[]),[n,a]=h.useState(e.length?e:[s()]),[r,i]=h.useState(0),o=h.useCallback(u=>{const l=s(u);return a(c=>[...c,l]),i(c=>c+1),l},[s]),d=h.useCallback(u=>{const l=n[u],c={...JSON.parse(JSON.stringify(l)),id:w(),cells:l.cells.map(m=>({...m,id:w(),elements:m.elements.map(g=>({...g,id:w()}))}))};return a(m=>[...m,c]),i(n.length),c},[n]),p=h.useCallback(u=>{n.length<=1||(a(l=>l.filter((c,m)=>m!==u)),i(l=>Math.min(l,n.length-2)))},[n.length]),f=h.useCallback((u,l)=>{const c=N.find(m=>m.id===l);c&&a(m=>m.map((g,y)=>y!==u?g:{...g,layout:l,cells:Array.from({length:c.cells}).map((C,E)=>g.cells[E]||{id:w(),elements:[]})}))},[]),x=h.useCallback(()=>N.find(u=>{var l;return u.id===((l=n[r])==null?void 0:l.layout)})||N[0],[r,n]);return{pages:n,currentPageIndex:r,setCurrentPageIndex:i,addPage:o,duplicatePage:d,deletePage:p,changeLayout:f,currentPage:n[r],getCurrentLayout:x}}function we(e=[]){const[s,n]=h.useState(e),[a,r]=h.useState(null),[i,o]=h.useState(null),d=(c,m={x:10,y:10})=>{const g=c==="image"?u(m):l(m);return n([...s,g]),r(g.id),g},p=(c,m)=>{n(s.map(g=>g.id===c?{...g,...m}:g))},f=c=>{n(s.filter(m=>m.id!==c)),a===c&&r(null)},x=c=>{const m=s.find(y=>y.id===c);if(!m)return;const g={...JSON.parse(JSON.stringify(m)),id:w(),position:{x:m.position.x+10,y:m.position.y+10}};return n([...s,g]),r(g.id),g},u=c=>({id:w(),type:"image",content:"",position:c,filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal",flipHorizontal:!1,flipVertical:!1},mask:"none"}),l=c=>({id:w(),type:"text",content:"Haz clic para editar",position:c,style:{fontSize:"16px",fontFamily:"Arial, sans-serif",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1,textShadow:"none",textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"rgba(0,0,0,0.5)"}});return{elements:s,selectedElement:a,selectedCell:i,setSelectedElement:r,setSelectedCell:o,addElement:d,updateElement:p,deleteElement:f,duplicateElement:x}}const Ne=async(e,s="diseño-pagina")=>{const n=document.getElementById(e);if(!n)return;const a=document.createElement("canvas"),r=n.offsetWidth,i=n.offsetHeight;a.width=r*2,a.height=i*2;const o=a.getContext("2d");o.scale(2,2),o.fillStyle="white",o.fillRect(0,0,r,i);try{(await ee(n,{scale:2,backgroundColor:null,canvas:a,logging:!1,useCORS:!0})).toBlob(p=>{te.saveAs(p,`${s}.png`)})}catch(d){console.error("Error al exportar la página:",d)}};function Ze(){const{pages:e,currentPageIndex:s,setCurrentPageIndex:n,addPage:a,duplicatePage:r,deletePage:i,changeLayout:o,currentPage:d,getCurrentLayout:p}=ve(),{elements:f,selectedElement:x,selectedCell:u,setSelectedElement:l,setSelectedCell:c,addElement:m,deleteElement:g}=we(),{addToHistory:y}=xe(e),[C,E]=h.useState(!1),[H,L]=h.useState("elements"),[Ce,Ee]=h.useState("basic"),O=h.useCallback(()=>{Ne("page-preview",`diseño-pagina-${s+1}`)},[s]),U=h.useCallback(()=>{E(v=>!v)},[]),F=h.useCallback((v,k,P)=>{const S=e.map((A,J)=>J!==s?A:{...A,cells:A.cells.map(T=>T.id!==v?T:{...T,elements:T.elements.map(R=>R.id!==k?R:{...R,...P})})});setPages(S),y(S)},[e,s,y]);return t.jsx(X,{backend:Y,children:t.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 mx-auto max-w-7xl",children:[t.jsx(se,{onExport:O,onPreviewToggle:U,previewMode:C}),t.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[t.jsx(oe,{activeTab:H,onTabChange:L,selectedLayout:d.layout,onLayoutChange:v=>{o(s,v),y(e)},onAddImage:v=>{const k=new FileReader;k.onload=P=>{var S;(S=P.target)!=null&&S.result&&m("image",{content:P.target.result})},k.readAsDataURL(v)},onAddText:()=>{m("text")},selectedElement:x,onFilterChange:F,getSelectedElement:()=>f.find(v=>v.id===x),getCurrentLayout:p}),t.jsx(ue,{currentPage:s,pages:e,selectedElement:x,selectedCell:u,onSelectElement:l,onSelectCell:c,onAddElement:m,onUpdateElement:F,onDeleteElement:g,getCurrentLayout:p,previewMode:C}),t.jsx(ge,{pages:e,currentPage:s,onPageChange:n,onAddPage:()=>{a(),y(e)},onDuplicatePage:()=>{r(s),y(e)},onDeletePage:()=>{i(s),y(e)}})]})]})})}export{Ze as default};
