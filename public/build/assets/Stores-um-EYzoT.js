import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BH53Isel.js";import{c as U}from"./ReactAppend-DTVVXReZ.js";import{s as f}from"./server.browser-Bf4gQIc7.js";import{S as J}from"./StoresRest-DHuUYjEd.js";import{C as z}from"./CreateReactScript-NWc2tE6o.js";import{B as Q}from"./Base-Dl9oddLU.js";import{T as K}from"./Table-DitbKwtZ.js";import{M as W}from"./Modal-DYPPCNUR.js";import{I as c}from"./InputFormGroup-D5I6zpZc.js";import{T as X}from"./TextareaFormGroup-DVzYJtLM.js";import{I as Y}from"./ImageFormGroup-BPR9pDAU.js";import{S as Z}from"./SwitchFormGroup-CGYpv_4Q.js";import{S as P}from"./SelectFormGroup-BmhC2uob.js";import{D as q}from"./DxButton-DV0H-ZcL.js";import{S as h}from"./ProductCard-CRhBSmWZ.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./BasicRest-C4m6wu80.js";import"./main-6DCdASTx.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index-BZYhE2TF.js";import"./index-rimy3MAc.js";import"./index.esm-POOiSFi2.js";import"./index-Dq7h7Pqt.js";import"./Global-ErywZRdd.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./tippy-react.esm-BWiGTO87.js";import"./Logout-TGKOqZqZ.js";import"./MenuItemContainer-CY0sLPNq.js";const B=new J,ee=({ubigeos:p=[]})=>{const d=i.useRef(),b=i.useRef(),m=i.useRef(),v=i.useRef(),R=i.useRef(),y=i.useRef(),N=i.useRef(),w=i.useRef(),g=i.useRef(),S=i.useRef(),E=i.useRef(),u=i.useRef(),x=i.useRef();i.useRef();const T=i.useRef(),D=i.useRef(),F=i.useRef(),[O,G]=i.useState(!1),[C,k]=i.useState([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]),M=e=>{if(console.log(e),e!=null&&e.id?G(!0):G(!1),m.current.value=(e==null?void 0:e.id)??"",v.current.value=(e==null?void 0:e.name)??"",R.current.value=(e==null?void 0:e.address)??"",y.current.value=(e==null?void 0:e.phone)??"",N.current.value=(e==null?void 0:e.email)??"",w.current.value=(e==null?void 0:e.description)??"",S.current.value=(e==null?void 0:e.latitude)??"",E.current.value=(e==null?void 0:e.longitude)??"",T.current.value=(e==null?void 0:e.manager)??"",D.current.value=(e==null?void 0:e.capacity)??"",u.current&&(u.image.src=`/storage/images/store/${(e==null?void 0:e.image)??"undefined"}`),$(g.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),$(F.current).val((e==null?void 0:e.type)??"tienda").trigger("change"),x.current&&(x.current.checked=(e==null?void 0:e.status)??!0),e!=null&&e.business_hours)try{const o=typeof e.business_hours=="string"?JSON.parse(e.business_hours):e.business_hours;k(o)}catch(o){console.error("Error parsing business hours:",o)}else k([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]);$(b.current).modal("show")},_=async e=>{e.preventDefault();const o=S.current.value.trim(),r=E.current.value.trim();let n=null,t=null;if(o){if(n=parseFloat(o),console.log("Latitud procesada:",n,"desde:",o),n<-18.5||n>-.1){h.fire({title:"Error de validación",text:"La latitud debe estar entre -18.5 y -0.1 para ubicaciones en Perú",icon:"error"});return}if(!V(n,10,8)){h.fire({title:"Error de validación",text:"La latitud excede el formato permitido (máximo 10 dígitos con 8 decimales)",icon:"error"});return}n=Math.round(n*1e8)/1e8,console.log("Latitud truncada:",n)}if(r){if(t=parseFloat(r),console.log("Longitud procesada:",t,"desde:",r),t<-81.5||t>-68.5){h.fire({title:"Error de validación",text:"La longitud debe estar entre -81.5 y -68.5 para ubicaciones en Perú",icon:"error"});return}if(!V(t,11,8)){h.fire({title:"Error de validación",text:"La longitud excede el formato permitido (máximo 11 dígitos con 8 decimales)",icon:"error"});return}t=Math.round(t*1e8)/1e8,console.log("Longitud truncada:",t)}p.find(j=>j.reniec==g.current.value);const l=new FormData,a=m.current.value;console.log("DEBUG ID - Valor del ID a enviar:",a,"Tipo:",typeof a,"Vacío?:",!a),m.current.value?(l.append("id",m.current.value),console.log("DEBUG ID - ID agregado al FormData:",m.current.value)):console.log("DEBUG ID - No se agrega ID al FormData (valor vacío)"),l.append("name",v.current.value),l.append("address",R.current.value),l.append("phone",y.current.value),l.append("email",N.current.value),l.append("description",w.current.value),l.append("ubigeo",g.current.value),l.append("latitude",n!==null?n.toString():""),l.append("longitude",t!==null?t.toString():""),l.append("manager",T.current.value),l.append("capacity",D.current.value),l.append("type",F.current.value),l.append("status",x.current.checked?1:0),l.append("business_hours",JSON.stringify(C)),u.current&&u.current.files[0]&&l.append("image",u.current.files[0]),console.log("Datos a enviar:"),console.log("- Latitud:",n),console.log("- Longitud:",t);for(let j of l.entries())console.log(j[0]+": "+j[1]);await B.save(l)&&($(d.current).dxDataGrid("instance").refresh(),$(b.current).modal("hide"))},H=async e=>{const{isConfirmed:o}=await h.fire({title:"Eliminar tienda",text:"¿Estás seguro de eliminar esta tienda?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!o||!await B.delete(e)||$(d.current).dxDataGrid("instance").refresh()},I=(e,o,r)=>{const n=[...C];n[e][o]=r,k(n)},V=(e,o,r)=>{if(e==null||isNaN(e))return!1;const t=Math.abs(e).toString().split("."),l=t[0],a=t[1]||"";console.log(`Validando coordenada: ${e}`),console.log(`Parte entera: ${l} (${l.length} dígitos)`),console.log(`Parte decimal: ${a} (${a.length} dígitos)`),console.log(`Total permitido: ${o}, decimales permitidos: ${r}`),a.length>r&&console.log(`Advertencia: Truncando decimales de ${a.length} a ${r} dígitos`);const L=o-r;return l.length>L?(console.log(`Error: Excede dígitos enteros permitidos (${l.length} > ${L})`),!1):(console.log("Coordenada válida (se truncará automáticamente si es necesario)"),!0)},A=e=>$(f.renderToString(s.jsxs("span",{children:[s.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),s.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]})));return s.jsxs(s.Fragment,{children:[s.jsx(K,{gridRef:d,title:"Tiendas / Sucursales",rest:B,exportable:!0,exportableName:"stores",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nueva tienda",hint:"Nueva tienda",onClick:()=>M()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"80px",cellTemplate:(e,{data:o})=>{o.image?e.html(f.renderToString(s.jsx("img",{src:`/storage/images/store/${o.image}`,alt:o.name,className:"img-thumbnail",style:{width:"50px",height:"50px",objectFit:"cover"}}))):e.html(f.renderToString(s.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"},children:s.jsx("i",{className:"fas fa-store text-muted"})})))},allowExporting:!1},{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:o})=>{const r={tienda:"Tienda",oficina:"Oficina",almacen:"Almacén",showroom:"Showroom",otro:"Otro"},n={tienda:"success",oficina:"primary",almacen:"warning",showroom:"info",otro:"secondary"},t=r[o.type]||"No especificado",l=n[o.type]||"secondary";e.append(`<span class="badge bg-${l}">${t}</span>`)}},{dataField:"address",caption:"Dirección",width:"250px"},{dataField:"phone",caption:"Teléfono",width:"120px"},{dataField:"email",caption:"Email",width:"180px"},{dataField:"manager",caption:"Encargado",width:"150px"},{dataField:"ubigeo",caption:"Ubicación",width:"150px",cellTemplate:(e,{data:o})=>{const r=p.find(n=>n.reniec==o.ubigeo);r?e.html(f.renderToString(s.jsxs("div",{children:[s.jsx("small",{className:"d-block",children:r.distrito}),s.jsxs("small",{className:"text-muted",children:[r.provincia,", ",r.departamento]})]}))):e.text(o.ubigeo||"Sin ubicación")}},{dataField:"status",caption:"Estado",width:"100px",cellTemplate:(e,{data:o})=>{e.html(f.renderToString(s.jsx("span",{className:`badge ${o.status?"bg-success":"bg-danger"}`,children:o.status?"Activa":"Inactiva"})))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:o})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>M(o)})),e.append(q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>H(o.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsxs(W,{modalRef:b,title:O?"Editar Tienda":"Agregar Tienda",onSubmit:_,size:"lg",children:[s.jsx("input",{ref:m,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsx(c,{eRef:v,label:"Nombre de la tienda",col:"col-12",required:!0})}),s.jsx("div",{className:"col-md-6",children:s.jsxs(P,{eRef:F,label:"Tipo de establecimiento",col:"col-12",required:!0,dropdownParent:"#form-container",children:[s.jsx("option",{value:"tienda",children:"Tienda"}),s.jsx("option",{value:"oficina",children:"Oficina"}),s.jsx("option",{value:"almacen",children:"Almacén"}),s.jsx("option",{value:"showroom",children:"Showroom"}),s.jsx("option",{value:"otro",children:"Otro"})]})}),s.jsx("div",{className:"col-md-6",children:s.jsx(c,{eRef:T,label:"Encargado",col:"col-12"})}),s.jsx("div",{className:"col-12",children:s.jsx(c,{eRef:R,label:"Dirección completa",col:"col-12",required:!0})}),s.jsx("div",{className:"col-12",children:s.jsx(P,{eRef:g,label:"Distrito/Ubigeo",col:"col-12",templateResult:A,templateSelection:A,dropdownParent:"#form-container",required:!0,children:p.map((e,o)=>s.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},o))})}),s.jsx("div",{className:"col-md-6",children:s.jsx(c,{eRef:y,label:"Teléfono",col:"col-12",type:"tel"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(c,{eRef:N,label:"Email",col:"col-12",type:"email"})}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"alert alert-info",children:[s.jsxs("h6",{children:[s.jsx("i",{className:"fas fa-map-marker-alt"})," Cómo obtener coordenadas exactas:"]}),s.jsxs("ol",{className:"mb-2",children:[s.jsxs("li",{children:["Ve a ",s.jsx("a",{href:"https://www.google.com/maps",target:"_blank",rel:"noopener noreferrer",children:"Google Maps"})]}),s.jsx("li",{children:"Busca la dirección exacta de tu tienda"}),s.jsx("li",{children:"Haz clic derecho en el marcador del lugar"}),s.jsx("li",{children:'Selecciona "¿Qué hay aquí?" o haz clic en las coordenadas que aparecen'}),s.jsx("li",{children:"Copia los valores que aparecen (ej: -12.0464, -77.0428)"})]}),s.jsxs("small",{children:[s.jsx("strong",{children:"Importante:"})," Las coordenadas deben estar en formato decimal, no en grados/minutos/segundos. Para Lima, la latitud típica es alrededor de -12 y la longitud alrededor de -77."]})]})}),s.jsxs("div",{className:"col-md-6",children:[s.jsx(c,{eRef:S,label:"Latitud (Google Maps)",col:"col-12",type:"number",step:"0.000000000000001",min:"-18.5",max:"-0.1",placeholder:"Ej: -12.042626777544823"}),s.jsxs("small",{className:"text-muted",children:["Rango válido para Perú: -18.5 a -0.1",s.jsx("br",{}),"Acepta hasta 15 dígitos decimales de precisión"]})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx(c,{eRef:E,label:"Longitud (Google Maps)",col:"col-12",type:"number",step:"0.000000000000001",min:"-81.5",max:"-68.5",placeholder:"Ej: -77.04753389161506"}),s.jsxs("small",{className:"text-muted",children:["Rango válido para Perú: -81.5 a -68.5",s.jsx("br",{}),"Acepta hasta 15 dígitos decimales de precisión"]})]}),s.jsx("div",{className:"col-md-6",children:s.jsx(c,{eRef:D,label:"Capacidad de atención (personas/día)",col:"col-12",type:"number",placeholder:"Ej: 50"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(Z,{eRef:x,label:"Tienda activa",col:"col-12"})}),s.jsx("div",{className:"col-12",children:s.jsx(Y,{eRef:u,label:"Imagen de la tienda",col:"col-12",accept:"image/*"})}),s.jsx("div",{className:"col-12",children:s.jsx(X,{eRef:w,label:"Descripción",rows:3})}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Horarios de atención"}),s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table table-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Día"}),s.jsx("th",{children:"Apertura"}),s.jsx("th",{children:"Cierre"}),s.jsx("th",{children:"Cerrado"})]})}),s.jsx("tbody",{children:C.map((e,o)=>s.jsxs("tr",{children:[s.jsx("td",{className:"align-middle",children:s.jsx("strong",{children:e.day})}),s.jsx("td",{children:s.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.open,onChange:r=>I(o,"open",r.target.value),disabled:e.closed})}),s.jsx("td",{children:s.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.close,onChange:r=>I(o,"close",r.target.value),disabled:e.closed})}),s.jsx("td",{children:s.jsxs("div",{className:"form-check",children:[s.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.closed,onChange:r=>I(o,"closed",r.target.checked)}),s.jsx("label",{className:"form-check-label",children:"Cerrado"})]})})]},o))})]})})]})})]})]})]})};z((p,d)=>{U.createRoot(p).render(s.jsx(Q,{...d,title:"Tiendas / Sucursales",children:s.jsx(ee,{...d})}))});
