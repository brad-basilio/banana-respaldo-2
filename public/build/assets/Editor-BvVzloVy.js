const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-CHaihsQY.js","assets/index-BH53Isel.js","assets/index-yBjzXJbu.js","assets/preload-helper-BfFHrpNk.js","assets/typeof-QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{_ as jo}from"./preload-helper-BfFHrpNk.js";import{j as l}from"./AboutSimple-Cf8x2fCZ.js";import{R as fe,r as y}from"./index-BH53Isel.js";import{b as An,c as Ro,a as To,d as Oo,T as Mr,l as Ce,i as va,e as ha,D as Bo,H as Mo,B as Je,F as Lo,U as Fo,R as zo,E as Pn}from"./EditableCell-C5XVralC.js";import{h as Dn}from"./thumbnailGenerator-B4goYG9Y.js";import{a as Go,b as lt,_ as Y}from"./objectWithoutPropertiesLoose-CoVnHxV7.js";import{h as kn}from"./hoist-non-react-statics.cjs-kbdZbs82.js";import{r as Uo,R as $o}from"./index-rimy3MAc.js";import{c as ie}from"./createLucideIcon-Cy5Ya80P.js";import{I as Br,C as Ho}from"./image-cwhXnF8c.js";import"./EditorLayout-B4bUL1bb.js";import"./jspdf.es.min-CHaihsQY.js";import{t as Pe,T as Wo}from"./index-CMHsc23u.js";import{m as jn}from"./main-BvVILmTO.js";import{X as Vo}from"./x-DBMwyD6F.js";import{P as qo}from"./palette-DV_Vpyg9.js";import{M as Rn}from"./minus-jyhodMPN.js";import{P as Tn}from"./plus-Bot15Khs.js";import{C as Ko}from"./chevron-down-DS-mdh9v.js";import{B as Yo}from"./V1Edit--5Nt1a9Y.js";import{G as Pt}from"./Global-ErywZRdd.js";import{S as Xo,F as Jo}from"./save-BfW-kI1U.js";import{C as _o}from"./clock-BTrEpQej.js";import{C as ba}from"./check-DQ7QoS0v.js";import{L as Qo}from"./loader-circle-CrvBvIt1.js";import{T as xa}from"./trash-2-DK1wnsDn.js";import{B as $t}from"./dom-to-image-more.min-Cey65QPP.js";import{C as Zo}from"./chevron-left-B2s3ZsB7.js";import{C as ei}from"./circle-check-big-D6DM3vPb.js";import"./index-yBjzXJbu.js";import"./objectSpread2-8ZRf701l.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./sparkles-DeLUn6av.js";import"./sliders-vertical-C5ts4taK.js";import"./settings-BSPs3Zt8.js";import"./chevron-up-D78jyEhP.js";import"./index-BSWw-p5k.js";import"./EditorMain-_pvTHO57.js";import"./upload-qgEr5bIl.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./PaymentModal-Bxx5p2o_.js";import"./index-Chjiymov.js";import"./chevron-right-Ckt5D2ka.js";import"./download-Dh5rRDOT.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=ie("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ti=ie("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=ie("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=ie("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=ie("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=ie("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const si=ie("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=ie("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ci=ie("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const di=ie("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=ie("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=ie("Heading3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=ie("Heading4",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17 10v4h4",key:"13sv97"}],["path",{d:"M21 10v8",key:"1kdml4"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fi=ie("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=ie("IndentDecrease",[["polyline",{points:"7 8 3 12 7 16",key:"2j60jr"}],["line",{x1:"21",x2:"11",y1:"12",y2:"12",key:"1fxxak"}],["line",{x1:"21",x2:"11",y1:"6",y2:"6",key:"asgu94"}],["line",{x1:"21",x2:"11",y1:"18",y2:"18",key:"13dsj7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vi=ie("IndentIncrease",[["polyline",{points:"3 8 7 12 3 16",key:"f3rxhf"}],["line",{x1:"21",x2:"11",y1:"12",y2:"12",key:"1fxxak"}],["line",{x1:"21",x2:"11",y1:"6",y2:"6",key:"asgu94"}],["line",{x1:"21",x2:"11",y1:"18",y2:"18",key:"13dsj7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hi=ie("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bi=ie("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xi=ie("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yi=ie("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wi=ie("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ci=ie("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Si=ie("PaintBucket",[["path",{d:"m19 11-8-8-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0L19 11Z",key:"irua1i"}],["path",{d:"m5 2 5 5",key:"1lls2c"}],["path",{d:"M2 13h15",key:"1hkzvu"}],["path",{d:"M22 20a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4 .3 1.6 2 2.4 2 4Z",key:"xk76lq"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ei=ie("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ii=ie("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ni=ie("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=ie("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pi=ie("Strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=ie("Subscript",[["path",{d:"m4 5 8 8",key:"1eunvl"}],["path",{d:"m12 5-8 8",key:"1ah0jp"}],["path",{d:"M20 19h-4c0-1.5.44-2 1.5-2.5S20 15.33 20 14c0-.47-.17-.93-.48-1.29a2.11 2.11 0 0 0-2.62-.44c-.42.24-.74.62-.9 1.07",key:"e8ta8j"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ki=ie("Superscript",[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=ie("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ji=ie("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=ie("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ri=ie("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);function wa(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,Go(e,r)}var Ca=fe.createContext(null);function Ti(e){e()}var Sa=Ti,Oi=function(r){return Sa=r},Bi=function(){return Sa};function Mi(){var e=Bi(),r=null,t=null;return{clear:function(){r=null,t=null},notify:function(){e(function(){for(var a=r;a;)a.callback(),a=a.next})},get:function(){for(var a=[],o=r;o;)a.push(o),o=o.next;return a},subscribe:function(a){var o=!0,i=t={callback:a,next:null,prev:t};return i.prev?i.prev.next=i:r=i,function(){!o||r===null||(o=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:r=i.next)}}}}var Bn={notify:function(){},get:function(){return[]}};function Ea(e,r){var t,n=Bn;function a(d){return c(),n.subscribe(d)}function o(){n.notify()}function i(){f.onStateChange&&f.onStateChange()}function s(){return!!t}function c(){t||(t=r?r.addNestedSub(i):e.subscribe(i),n=Mi())}function p(){t&&(t(),t=void 0,n.clear(),n=Bn)}var f={addNestedSub:a,notifyNestedSubs:o,handleChangeWrapper:i,isSubscribed:s,trySubscribe:c,tryUnsubscribe:p,getListeners:function(){return n}};return f}var Ia=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?y.useLayoutEffect:y.useEffect;function Li(e){var r=e.store,t=e.context,n=e.children,a=y.useMemo(function(){var s=Ea(r);return{store:r,subscription:s}},[r]),o=y.useMemo(function(){return r.getState()},[r]);Ia(function(){var s=a.subscription;return s.onStateChange=s.notifyNestedSubs,s.trySubscribe(),o!==r.getState()&&s.notifyNestedSubs(),function(){s.tryUnsubscribe(),s.onStateChange=null}},[a,o]);var i=t||Ca;return fe.createElement(i.Provider,{value:a},n)}var Dt={exports:{}},ge={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mn;function Fi(){if(Mn)return ge;Mn=1;var e=60103,r=60106,t=60107,n=60108,a=60114,o=60109,i=60110,s=60112,c=60113,p=60120,f=60115,d=60116,u=60121,v=60122,g=60117,S=60129,h=60131;if(typeof Symbol=="function"&&Symbol.for){var C=Symbol.for;e=C("react.element"),r=C("react.portal"),t=C("react.fragment"),n=C("react.strict_mode"),a=C("react.profiler"),o=C("react.provider"),i=C("react.context"),s=C("react.forward_ref"),c=C("react.suspense"),p=C("react.suspense_list"),f=C("react.memo"),d=C("react.lazy"),u=C("react.block"),v=C("react.server.block"),g=C("react.fundamental"),S=C("react.debug_trace_mode"),h=C("react.legacy_hidden")}function I(O){if(typeof O=="object"&&O!==null){var V=O.$$typeof;switch(V){case e:switch(O=O.type,O){case t:case a:case n:case c:case p:return O;default:switch(O=O&&O.$$typeof,O){case i:case s:case d:case f:case o:return O;default:return V}}case r:return V}}}var D=o,N=e,F=s,T=t,K=d,te=f,J=r,ne=a,_=n,le=c;return ge.ContextConsumer=i,ge.ContextProvider=D,ge.Element=N,ge.ForwardRef=F,ge.Fragment=T,ge.Lazy=K,ge.Memo=te,ge.Portal=J,ge.Profiler=ne,ge.StrictMode=_,ge.Suspense=le,ge.isAsyncMode=function(){return!1},ge.isConcurrentMode=function(){return!1},ge.isContextConsumer=function(O){return I(O)===i},ge.isContextProvider=function(O){return I(O)===o},ge.isElement=function(O){return typeof O=="object"&&O!==null&&O.$$typeof===e},ge.isForwardRef=function(O){return I(O)===s},ge.isFragment=function(O){return I(O)===t},ge.isLazy=function(O){return I(O)===d},ge.isMemo=function(O){return I(O)===f},ge.isPortal=function(O){return I(O)===r},ge.isProfiler=function(O){return I(O)===a},ge.isStrictMode=function(O){return I(O)===n},ge.isSuspense=function(O){return I(O)===c},ge.isValidElementType=function(O){return typeof O=="string"||typeof O=="function"||O===t||O===a||O===S||O===n||O===c||O===p||O===h||typeof O=="object"&&O!==null&&(O.$$typeof===d||O.$$typeof===f||O.$$typeof===o||O.$$typeof===i||O.$$typeof===s||O.$$typeof===g||O.$$typeof===u||O[0]===v)},ge.typeOf=I,ge}var Ln;function zi(){return Ln||(Ln=1,Dt.exports=Fi()),Dt.exports}var Gi=zi(),Ui=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],$i=["reactReduxForwardedRef"],Hi=[],Wi=[null,null];function Vi(e,r){var t=e[1];return[r.payload,t+1]}function Fn(e,r,t){Ia(function(){return e.apply(void 0,r)},t)}function qi(e,r,t,n,a,o,i){e.current=n,r.current=a,t.current=!1,o.current&&(o.current=null,i())}function Ki(e,r,t,n,a,o,i,s,c,p){if(e){var f=!1,d=null,u=function(){if(!f){var S=r.getState(),h,C;try{h=n(S,a.current)}catch(I){C=I,d=I}C||(d=null),h===o.current?i.current||c():(o.current=h,s.current=h,i.current=!0,p({type:"STORE_UPDATED",payload:{error:C}}))}};t.onStateChange=u,t.trySubscribe(),u();var v=function(){if(f=!0,t.tryUnsubscribe(),t.onStateChange=null,d)throw d};return v}}var Yi=function(){return[null,0]};function Xi(e,r){r===void 0&&(r={});var t=r,n=t.getDisplayName,a=n===void 0?function(D){return"ConnectAdvanced("+D+")"}:n,o=t.methodName,i=o===void 0?"connectAdvanced":o,s=t.renderCountProp,c=s===void 0?void 0:s,p=t.shouldHandleStateChanges,f=p===void 0?!0:p,d=t.storeKey,u=d===void 0?"store":d;t.withRef;var v=t.forwardRef,g=v===void 0?!1:v,S=t.context,h=S===void 0?Ca:S,C=lt(t,Ui),I=h;return function(N){var F=N.displayName||N.name||"Component",T=a(F),K=Y({},C,{getDisplayName:a,methodName:i,renderCountProp:c,shouldHandleStateChanges:f,storeKey:u,displayName:T,wrappedComponentName:F,WrappedComponent:N}),te=C.pure;function J(V){return e(V.dispatch,K)}var ne=te?y.useMemo:function(V){return V()};function _(V){var pe=y.useMemo(function(){var $e=V.reactReduxForwardedRef,Ze=lt(V,$i);return[V.context,$e,Ze]},[V]),k=pe[0],Q=pe[1],ue=pe[2],Z=y.useMemo(function(){return k&&k.Consumer&&Gi.isContextConsumer(fe.createElement(k.Consumer,null))?k:I},[k,I]),oe=y.useContext(Z),me=!!V.store&&!!V.store.getState&&!!V.store.dispatch;oe&&oe.store;var he=me?V.store:oe.store,G=y.useMemo(function(){return J(he)},[he]),Ae=y.useMemo(function(){if(!f)return Wi;var $e=Ea(he,me?null:oe.subscription),Ze=$e.notifyNestedSubs.bind($e);return[$e,Ze]},[he,me,oe]),ve=Ae[0],Ue=Ae[1],ye=y.useMemo(function(){return me?oe:Y({},oe,{subscription:ve})},[me,oe,ve]),Ne=y.useReducer(Vi,Hi,Yi),Ve=Ne[0],Be=Ve[0],_e=Ne[1];if(Be&&Be.error)throw Be.error;var Me=y.useRef(),qe=y.useRef(ue),Ke=y.useRef(),cr=y.useRef(!1),Ye=ne(function(){return Ke.current&&ue===qe.current?Ke.current:G(he.getState(),ue)},[he,Be,ue]);Fn(qi,[qe,Me,cr,ue,Ye,Ke,Ue]),Fn(Ki,[f,he,ve,G,qe,Me,cr,Ke,Ue,_e],[he,ve,G]);var Qe=y.useMemo(function(){return fe.createElement(N,Y({},Ye,{ref:Q}))},[Q,N,Ye]),dr=y.useMemo(function(){return f?fe.createElement(Z.Provider,{value:ye},Qe):Qe},[Z,Qe,ye]);return dr}var le=te?fe.memo(_):_;if(le.WrappedComponent=N,le.displayName=_.displayName=T,g){var O=fe.forwardRef(function(pe,k){return fe.createElement(le,Y({},pe,{reactReduxForwardedRef:k}))});return O.displayName=T,O.WrappedComponent=N,kn(O,N)}return kn(le,N)}}function zn(e,r){return e===r?e!==0||r!==0||1/e===1/r:e!==e&&r!==r}function kt(e,r){if(zn(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var t=Object.keys(e),n=Object.keys(r);if(t.length!==n.length)return!1;for(var a=0;a<t.length;a++)if(!Object.prototype.hasOwnProperty.call(r,t[a])||!zn(e[t[a]],r[t[a]]))return!1;return!0}function Ji(e,r){var t={},n=function(i){var s=e[i];typeof s=="function"&&(t[i]=function(){return r(s.apply(void 0,arguments))})};for(var a in e)n(a);return t}function Xt(e){return function(t,n){var a=e(t,n);function o(){return a}return o.dependsOnOwnProps=!1,o}}function Gn(e){return e.dependsOnOwnProps!==null&&e.dependsOnOwnProps!==void 0?!!e.dependsOnOwnProps:e.length!==1}function Na(e,r){return function(n,a){a.displayName;var o=function(s,c){return o.dependsOnOwnProps?o.mapToProps(s,c):o.mapToProps(s)};return o.dependsOnOwnProps=!0,o.mapToProps=function(s,c){o.mapToProps=e,o.dependsOnOwnProps=Gn(e);var p=o(s,c);return typeof p=="function"&&(o.mapToProps=p,o.dependsOnOwnProps=Gn(p),p=o(s,c)),p},o}}function _i(e){return typeof e=="function"?Na(e):void 0}function Qi(e){return e?void 0:Xt(function(r){return{dispatch:r}})}function Zi(e){return e&&typeof e=="object"?Xt(function(r){return Ji(e,r)}):void 0}const es=[_i,Qi,Zi];function rs(e){return typeof e=="function"?Na(e):void 0}function ts(e){return e?void 0:Xt(function(){return{}})}const ns=[rs,ts];function as(e,r,t){return Y({},t,e,r)}function os(e){return function(t,n){n.displayName;var a=n.pure,o=n.areMergedPropsEqual,i=!1,s;return function(p,f,d){var u=e(p,f,d);return i?(!a||!o(u,s))&&(s=u):(i=!0,s=u),s}}}function is(e){return typeof e=="function"?os(e):void 0}function ss(e){return e?void 0:function(){return as}}const ls=[is,ss];var cs=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function ds(e,r,t,n){return function(o,i){return t(e(o,i),r(n,i),i)}}function us(e,r,t,n,a){var o=a.areStatesEqual,i=a.areOwnPropsEqual,s=a.areStatePropsEqual,c=!1,p,f,d,u,v;function g(D,N){return p=D,f=N,d=e(p,f),u=r(n,f),v=t(d,u,f),c=!0,v}function S(){return d=e(p,f),r.dependsOnOwnProps&&(u=r(n,f)),v=t(d,u,f),v}function h(){return e.dependsOnOwnProps&&(d=e(p,f)),r.dependsOnOwnProps&&(u=r(n,f)),v=t(d,u,f),v}function C(){var D=e(p,f),N=!s(D,d);return d=D,N&&(v=t(d,u,f)),v}function I(D,N){var F=!i(N,f),T=!o(D,p,N,f);return p=D,f=N,F&&T?S():F?h():T?C():v}return function(N,F){return c?I(N,F):g(N,F)}}function gs(e,r){var t=r.initMapStateToProps,n=r.initMapDispatchToProps,a=r.initMergeProps,o=lt(r,cs),i=t(e,o),s=n(e,o),c=a(e,o),p=o.pure?us:ds;return p(i,s,c,e,o)}var ps=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function jt(e,r,t){for(var n=r.length-1;n>=0;n--){var a=r[n](e);if(a)return a}return function(o,i){throw new Error("Invalid value of type "+typeof e+" for "+t+" argument when connecting component "+i.wrappedComponentName+".")}}function fs(e,r){return e===r}function ms(e){var r=e===void 0?{}:e,t=r.connectHOC,n=t===void 0?Xi:t,a=r.mapStateToPropsFactories,o=a===void 0?ns:a,i=r.mapDispatchToPropsFactories,s=i===void 0?es:i,c=r.mergePropsFactories,p=c===void 0?ls:c,f=r.selectorFactory,d=f===void 0?gs:f;return function(v,g,S,h){h===void 0&&(h={});var C=h,I=C.pure,D=I===void 0?!0:I,N=C.areStatesEqual,F=N===void 0?fs:N,T=C.areOwnPropsEqual,K=T===void 0?kt:T,te=C.areStatePropsEqual,J=te===void 0?kt:te,ne=C.areMergedPropsEqual,_=ne===void 0?kt:ne,le=lt(C,ps),O=jt(v,o,"mapStateToProps"),V=jt(g,s,"mapDispatchToProps"),pe=jt(S,p,"mergeProps");return n(d,Y({methodName:"connect",getDisplayName:function(Q){return"Connect("+Q+")"},shouldHandleStateChanges:!!v,initMapStateToProps:O,initMapDispatchToProps:V,initMergeProps:pe,pure:D,areStatesEqual:F,areOwnPropsEqual:K,areStatePropsEqual:J,areMergedPropsEqual:_},le))}}const Aa=ms();Oi(Uo.unstable_batchedUpdates);function vs(e,r){if(e.length!==r.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==r[t])return!1;return!0}function Pa(e,r){var t=y.useState(function(){return{inputs:r,result:e()}})[0],n=y.useRef(!0),a=y.useRef(t),o=n.current||!!(r&&a.current.inputs&&vs(r,a.current.inputs)),i=o?a.current:{inputs:r,result:e()};return y.useEffect(function(){n.current=!1,a.current=i},[i]),i.result}function hs(e,r){return Pa(function(){return e},r)}var se=Pa,U=hs,bs="Invariant failed";function xs(e,r){throw new Error(bs)}var Ge=function(r){var t=r.top,n=r.right,a=r.bottom,o=r.left,i=n-o,s=a-t,c={top:t,right:n,bottom:a,left:o,width:i,height:s,x:o,y:t,center:{x:(n+o)/2,y:(a+t)/2}};return c},Jt=function(r,t){return{top:r.top-t.top,left:r.left-t.left,bottom:r.bottom+t.bottom,right:r.right+t.right}},Un=function(r,t){return{top:r.top+t.top,left:r.left+t.left,bottom:r.bottom-t.bottom,right:r.right-t.right}},ys=function(r,t){return{top:r.top+t.y,left:r.left+t.x,bottom:r.bottom+t.y,right:r.right+t.x}},Rt={top:0,right:0,bottom:0,left:0},_t=function(r){var t=r.borderBox,n=r.margin,a=n===void 0?Rt:n,o=r.border,i=o===void 0?Rt:o,s=r.padding,c=s===void 0?Rt:s,p=Ge(Jt(t,a)),f=Ge(Un(t,i)),d=Ge(Un(f,c));return{marginBox:p,borderBox:Ge(t),paddingBox:f,contentBox:d,margin:a,border:i,padding:c}},Re=function(r){var t=r.slice(0,-2),n=r.slice(-2);if(n!=="px")return 0;var a=Number(t);return isNaN(a)&&xs(),a},ws=function(){return{x:window.pageXOffset,y:window.pageYOffset}},ct=function(r,t){var n=r.borderBox,a=r.border,o=r.margin,i=r.padding,s=ys(n,t);return _t({borderBox:s,border:a,margin:o,padding:i})},dt=function(r,t){return t===void 0&&(t=ws()),ct(r,t)},Da=function(r,t){var n={top:Re(t.marginTop),right:Re(t.marginRight),bottom:Re(t.marginBottom),left:Re(t.marginLeft)},a={top:Re(t.paddingTop),right:Re(t.paddingRight),bottom:Re(t.paddingBottom),left:Re(t.paddingLeft)},o={top:Re(t.borderTopWidth),right:Re(t.borderRightWidth),bottom:Re(t.borderBottomWidth),left:Re(t.borderLeftWidth)};return _t({borderBox:r,margin:n,padding:a,border:o})},ka=function(r){var t=r.getBoundingClientRect(),n=window.getComputedStyle(r);return Da(t,n)},$n=Number.isNaN||function(r){return typeof r=="number"&&r!==r};function Cs(e,r){return!!(e===r||$n(e)&&$n(r))}function Ss(e,r){if(e.length!==r.length)return!1;for(var t=0;t<e.length;t++)if(!Cs(e[t],r[t]))return!1;return!0}function be(e,r){r===void 0&&(r=Ss);var t,n=[],a,o=!1;function i(){for(var s=[],c=0;c<arguments.length;c++)s[c]=arguments[c];return o&&t===this&&r(s,n)||(a=e.apply(this,s),o=!0,t=this,n=s),a}return i}var zr=function(r){var t=[],n=null,a=function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];t=s,!n&&(n=requestAnimationFrame(function(){n=null,r.apply(void 0,t)}))};return a.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},a};function ja(e,r){}ja.bind(null,"warn");ja.bind(null,"error");function ar(){}function Es(e,r){return Y({},e,{},r)}function Te(e,r,t){var n=r.map(function(a){var o=Es(t,a.options);return e.addEventListener(a.eventName,a.fn,o),function(){e.removeEventListener(a.eventName,a.fn,o)}});return function(){n.forEach(function(o){o()})}}var Is="Invariant failed";function ut(e){this.message=e}ut.prototype.toString=function(){return this.message};function R(e,r){throw new ut(Is)}var Ns=function(e){wa(r,e);function r(){for(var n,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.callbacks=null,n.unbind=ar,n.onWindowError=function(s){var c=n.getCallbacks();c.isDragging()&&c.tryAbort();var p=s.error;p instanceof ut&&s.preventDefault()},n.getCallbacks=function(){if(!n.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return n.callbacks},n.setCallbacks=function(s){n.callbacks=s},n}var t=r.prototype;return t.componentDidMount=function(){this.unbind=Te(window,[{eventName:"error",fn:this.onWindowError}])},t.componentDidCatch=function(a){if(a instanceof ut){this.setState({});return}throw a},t.componentWillUnmount=function(){this.unbind()},t.render=function(){return this.props.children(this.setCallbacks)},r}(fe.Component),As=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,gt=function(r){return r+1},Ps=function(r){return`
  You have lifted an item in position `+gt(r.source.index)+`
`},Ra=function(r,t){var n=r.droppableId===t.droppableId,a=gt(r.index),o=gt(t.index);return n?`
      You have moved the item from position `+a+`
      to position `+o+`
    `:`
    You have moved the item from position `+a+`
    in list `+r.droppableId+`
    to list `+t.droppableId+`
    in position `+o+`
  `},Ta=function(r,t,n){var a=t.droppableId===n.droppableId;return a?`
      The item `+r+`
      has been combined with `+n.draggableId:`
      The item `+r+`
      in list `+t.droppableId+`
      has been combined with `+n.draggableId+`
      in list `+n.droppableId+`
    `},Ds=function(r){var t=r.destination;if(t)return Ra(r.source,t);var n=r.combine;return n?Ta(r.draggableId,r.source,n):"You are over an area that cannot be dropped on"},Hn=function(r){return`
  The item has returned to its starting position
  of `+gt(r.index)+`
`},ks=function(r){if(r.reason==="CANCEL")return`
      Movement cancelled.
      `+Hn(r.source)+`
    `;var t=r.destination,n=r.combine;return t?`
      You have dropped the item.
      `+Ra(r.source,t)+`
    `:n?`
      You have dropped the item.
      `+Ta(r.draggableId,r.source,n)+`
    `:`
    The item has been dropped while not over a drop area.
    `+Hn(r.source)+`
  `},st={dragHandleUsageInstructions:As,onDragStart:Ps,onDragUpdate:Ds,onDragEnd:ks},xe={x:0,y:0},Se=function(r,t){return{x:r.x+t.x,y:r.y+t.y}},De=function(r,t){return{x:r.x-t.x,y:r.y-t.y}},or=function(r,t){return r.x===t.x&&r.y===t.y},Er=function(r){return{x:r.x!==0?-r.x:0,y:r.y!==0?-r.y:0}},mr=function(r,t,n){var a;return n===void 0&&(n=0),a={},a[r]=t,a[r==="x"?"y":"x"]=n,a},Gr=function(r,t){return Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))},Wn=function(r,t){return Math.min.apply(Math,t.map(function(n){return Gr(r,n)}))},Oa=function(r){return function(t){return{x:r(t.x),y:r(t.y)}}},js=function(e,r){var t=Ge({top:Math.max(r.top,e.top),right:Math.min(r.right,e.right),bottom:Math.min(r.bottom,e.bottom),left:Math.max(r.left,e.left)});return t.width<=0||t.height<=0?null:t},Wr=function(r,t){return{top:r.top+t.y,left:r.left+t.x,bottom:r.bottom+t.y,right:r.right+t.x}},Vn=function(r){return[{x:r.left,y:r.top},{x:r.right,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.bottom}]},Rs={top:0,right:0,bottom:0,left:0},Ts=function(r,t){return t?Wr(r,t.scroll.diff.displacement):r},Os=function(r,t,n){if(n&&n.increasedBy){var a;return Y({},r,(a={},a[t.end]=r[t.end]+n.increasedBy[t.line],a))}return r},Bs=function(r,t){return t&&t.shouldClipSubject?js(t.pageMarginBox,r):Ge(r)},wr=function(e){var r=e.page,t=e.withPlaceholder,n=e.axis,a=e.frame,o=Ts(r.marginBox,a),i=Os(o,n,t),s=Bs(i,a);return{page:r,withPlaceholder:t,active:s}},Qt=function(e,r){e.frame||R();var t=e.frame,n=De(r,t.scroll.initial),a=Er(n),o=Y({},t,{scroll:{initial:t.scroll.initial,current:r,diff:{value:n,displacement:a},max:t.scroll.max}}),i=wr({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:o}),s=Y({},e,{frame:o,subject:i});return s};function pt(e){return Object.values?Object.values(e):Object.keys(e).map(function(r){return e[r]})}function Zt(e,r){if(e.findIndex)return e.findIndex(r);for(var t=0;t<e.length;t++)if(r(e[t]))return t;return-1}function lr(e,r){if(e.find)return e.find(r);var t=Zt(e,r);if(t!==-1)return e[t]}function Ba(e){return Array.prototype.slice.call(e)}var Ma=be(function(e){return e.reduce(function(r,t){return r[t.descriptor.id]=t,r},{})}),La=be(function(e){return e.reduce(function(r,t){return r[t.descriptor.id]=t,r},{})}),ht=be(function(e){return pt(e)}),Ms=be(function(e){return pt(e)}),Ir=be(function(e,r){var t=Ms(r).filter(function(n){return e===n.descriptor.droppableId}).sort(function(n,a){return n.descriptor.index-a.descriptor.index});return t});function en(e){return e.at&&e.at.type==="REORDER"?e.at.destination:null}function bt(e){return e.at&&e.at.type==="COMBINE"?e.at.combine:null}var xt=be(function(e,r){return r.filter(function(t){return t.descriptor.id!==e.descriptor.id})}),Ls=function(e){var r=e.isMovingForward,t=e.draggable,n=e.destination,a=e.insideDestination,o=e.previousImpact;if(!n.isCombineEnabled)return null;var i=en(o);if(!i)return null;function s(S){var h={type:"COMBINE",combine:{draggableId:S,droppableId:n.descriptor.id}};return Y({},o,{at:h})}var c=o.displaced.all,p=c.length?c[0]:null;if(r)return p?s(p):null;var f=xt(t,a);if(!p){if(!f.length)return null;var d=f[f.length-1];return s(d.descriptor.id)}var u=Zt(f,function(S){return S.descriptor.id===p});u===-1&&R();var v=u-1;if(v<0)return null;var g=f[v];return s(g.descriptor.id)},Nr=function(e,r){return e.descriptor.droppableId===r.descriptor.id},Fa={point:xe,value:0},Ur={invisible:{},visible:{},all:[]},Fs={displaced:Ur,displacedBy:Fa,at:null},Oe=function(e,r){return function(t){return e<=t&&t<=r}},za=function(e){var r=Oe(e.top,e.bottom),t=Oe(e.left,e.right);return function(n){var a=r(n.top)&&r(n.bottom)&&t(n.left)&&t(n.right);if(a)return!0;var o=r(n.top)||r(n.bottom),i=t(n.left)||t(n.right),s=o&&i;if(s)return!0;var c=n.top<e.top&&n.bottom>e.bottom,p=n.left<e.left&&n.right>e.right,f=c&&p;if(f)return!0;var d=c&&i||p&&o;return d}},zs=function(e){var r=Oe(e.top,e.bottom),t=Oe(e.left,e.right);return function(n){var a=r(n.top)&&r(n.bottom)&&t(n.left)&&t(n.right);return a}},rn={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},Ga={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},Gs=function(e){return function(r){var t=Oe(r.top,r.bottom),n=Oe(r.left,r.right);return function(a){return e===rn?t(a.top)&&t(a.bottom):n(a.left)&&n(a.right)}}},Us=function(r,t){var n=t.frame?t.frame.scroll.diff.displacement:xe;return Wr(r,n)},$s=function(r,t,n){return t.subject.active?n(t.subject.active)(r):!1},Hs=function(r,t,n){return n(t)(r)},tn=function(r){var t=r.target,n=r.destination,a=r.viewport,o=r.withDroppableDisplacement,i=r.isVisibleThroughFrameFn,s=o?Us(t,n):t;return $s(s,n,i)&&Hs(s,a,i)},Ws=function(r){return tn(Y({},r,{isVisibleThroughFrameFn:za}))},Ua=function(r){return tn(Y({},r,{isVisibleThroughFrameFn:zs}))},Vs=function(r){return tn(Y({},r,{isVisibleThroughFrameFn:Gs(r.destination.axis)}))},qs=function(r,t,n){if(typeof n=="boolean")return n;if(!t)return!0;var a=t.invisible,o=t.visible;if(a[r])return!1;var i=o[r];return i?i.shouldAnimate:!0};function Ks(e,r){var t=e.page.marginBox,n={top:r.point.y,right:0,bottom:0,left:r.point.x};return Ge(Jt(t,n))}function $r(e){var r=e.afterDragging,t=e.destination,n=e.displacedBy,a=e.viewport,o=e.forceShouldAnimate,i=e.last;return r.reduce(function(c,p){var f=Ks(p,n),d=p.descriptor.id;c.all.push(d);var u=Ws({target:f,destination:t,viewport:a,withDroppableDisplacement:!0});if(!u)return c.invisible[p.descriptor.id]=!0,c;var v=qs(d,i,o),g={draggableId:d,shouldAnimate:v};return c.visible[d]=g,c},{all:[],visible:{},invisible:{}})}function Ys(e,r){if(!e.length)return 0;var t=e[e.length-1].descriptor.index;return r.inHomeList?t:t+1}function qn(e){var r=e.insideDestination,t=e.inHomeList,n=e.displacedBy,a=e.destination,o=Ys(r,{inHomeList:t});return{displaced:Ur,displacedBy:n,at:{type:"REORDER",destination:{droppableId:a.descriptor.id,index:o}}}}function ft(e){var r=e.draggable,t=e.insideDestination,n=e.destination,a=e.viewport,o=e.displacedBy,i=e.last,s=e.index,c=e.forceShouldAnimate,p=Nr(r,n);if(s==null)return qn({insideDestination:t,inHomeList:p,displacedBy:o,destination:n});var f=lr(t,function(S){return S.descriptor.index===s});if(!f)return qn({insideDestination:t,inHomeList:p,displacedBy:o,destination:n});var d=xt(r,t),u=t.indexOf(f),v=d.slice(u),g=$r({afterDragging:v,destination:n,displacedBy:o,last:i,viewport:a.frame,forceShouldAnimate:c});return{displaced:g,displacedBy:o,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:s}}}}function sr(e,r){return!!r.effected[e]}var Xs=function(e){var r=e.isMovingForward,t=e.destination,n=e.draggables,a=e.combine,o=e.afterCritical;if(!t.isCombineEnabled)return null;var i=a.draggableId,s=n[i],c=s.descriptor.index,p=sr(i,o);return p?r?c:c-1:r?c+1:c},Js=function(e){var r=e.isMovingForward,t=e.isInHomeList,n=e.insideDestination,a=e.location;if(!n.length)return null;var o=a.index,i=r?o+1:o-1,s=n[0].descriptor.index,c=n[n.length-1].descriptor.index,p=t?c:c+1;return i<s||i>p?null:i},_s=function(e){var r=e.isMovingForward,t=e.isInHomeList,n=e.draggable,a=e.draggables,o=e.destination,i=e.insideDestination,s=e.previousImpact,c=e.viewport,p=e.afterCritical,f=s.at;if(f||R(),f.type==="REORDER"){var d=Js({isMovingForward:r,isInHomeList:t,location:f.destination,insideDestination:i});return d==null?null:ft({draggable:n,insideDestination:i,destination:o,viewport:c,last:s.displaced,displacedBy:s.displacedBy,index:d})}var u=Xs({isMovingForward:r,destination:o,displaced:s.displaced,draggables:a,combine:f.combine,afterCritical:p});return u==null?null:ft({draggable:n,insideDestination:i,destination:o,viewport:c,last:s.displaced,displacedBy:s.displacedBy,index:u})},Qs=function(e){var r=e.displaced,t=e.afterCritical,n=e.combineWith,a=e.displacedBy,o=!!(r.visible[n]||r.invisible[n]);return sr(n,t)?o?xe:Er(a.point):o?a.point:xe},Zs=function(e){var r=e.afterCritical,t=e.impact,n=e.draggables,a=bt(t);a||R();var o=a.draggableId,i=n[o].page.borderBox.center,s=Qs({displaced:t.displaced,afterCritical:r,combineWith:o,displacedBy:t.displacedBy});return Se(i,s)},$a=function(r,t){return t.margin[r.start]+t.borderBox[r.size]/2},el=function(r,t){return t.margin[r.end]+t.borderBox[r.size]/2},nn=function(r,t,n){return t[r.crossAxisStart]+n.margin[r.crossAxisStart]+n.borderBox[r.crossAxisSize]/2},Kn=function(r){var t=r.axis,n=r.moveRelativeTo,a=r.isMoving;return mr(t.line,n.marginBox[t.end]+$a(t,a),nn(t,n.marginBox,a))},Yn=function(r){var t=r.axis,n=r.moveRelativeTo,a=r.isMoving;return mr(t.line,n.marginBox[t.start]-el(t,a),nn(t,n.marginBox,a))},rl=function(r){var t=r.axis,n=r.moveInto,a=r.isMoving;return mr(t.line,n.contentBox[t.start]+$a(t,a),nn(t,n.contentBox,a))},tl=function(e){var r=e.impact,t=e.draggable,n=e.draggables,a=e.droppable,o=e.afterCritical,i=Ir(a.descriptor.id,n),s=t.page,c=a.axis;if(!i.length)return rl({axis:c,moveInto:a.page,isMoving:s});var p=r.displaced,f=r.displacedBy,d=p.all[0];if(d){var u=n[d];if(sr(d,o))return Yn({axis:c,moveRelativeTo:u.page,isMoving:s});var v=ct(u.page,f.point);return Yn({axis:c,moveRelativeTo:v,isMoving:s})}var g=i[i.length-1];if(g.descriptor.id===t.descriptor.id)return s.borderBox.center;if(sr(g.descriptor.id,o)){var S=ct(g.page,Er(o.displacedBy.point));return Kn({axis:c,moveRelativeTo:S,isMoving:s})}return Kn({axis:c,moveRelativeTo:g.page,isMoving:s})},Ht=function(e,r){var t=e.frame;return t?Se(r,t.scroll.diff.displacement):r},nl=function(r){var t=r.impact,n=r.draggable,a=r.droppable,o=r.draggables,i=r.afterCritical,s=n.page.borderBox.center,c=t.at;return!a||!c?s:c.type==="REORDER"?tl({impact:t,draggable:n,draggables:o,droppable:a,afterCritical:i}):Zs({impact:t,draggables:o,afterCritical:i})},yt=function(e){var r=nl(e),t=e.droppable,n=t?Ht(t,r):r;return n},Ha=function(e,r){var t=De(r,e.scroll.initial),n=Er(t),a=Ge({top:r.y,bottom:r.y+e.frame.height,left:r.x,right:r.x+e.frame.width}),o={frame:a,scroll:{initial:e.scroll.initial,max:e.scroll.max,current:r,diff:{value:t,displacement:n}}};return o};function Xn(e,r){return e.map(function(t){return r[t]})}function al(e,r){for(var t=0;t<r.length;t++){var n=r[t].visible[e];if(n)return n}return null}var ol=function(e){var r=e.impact,t=e.viewport,n=e.destination,a=e.draggables,o=e.maxScrollChange,i=Ha(t,Se(t.scroll.current,o)),s=n.frame?Qt(n,Se(n.frame.scroll.current,o)):n,c=r.displaced,p=$r({afterDragging:Xn(c.all,a),destination:n,displacedBy:r.displacedBy,viewport:i.frame,last:c,forceShouldAnimate:!1}),f=$r({afterDragging:Xn(c.all,a),destination:s,displacedBy:r.displacedBy,viewport:t.frame,last:c,forceShouldAnimate:!1}),d={},u={},v=[c,p,f];c.all.forEach(function(S){var h=al(S,v);if(h){u[S]=h;return}d[S]=!0});var g=Y({},r,{displaced:{all:c.all,invisible:d,visible:u}});return g},il=function(e,r){return Se(e.scroll.diff.displacement,r)},an=function(e){var r=e.pageBorderBoxCenter,t=e.draggable,n=e.viewport,a=il(n,r),o=De(a,t.page.borderBox.center);return Se(t.client.borderBox.center,o)},Wa=function(e){var r=e.draggable,t=e.destination,n=e.newPageBorderBoxCenter,a=e.viewport,o=e.withDroppableDisplacement,i=e.onlyOnMainAxis,s=i===void 0?!1:i,c=De(n,r.page.borderBox.center),p=Wr(r.page.borderBox,c),f={target:p,destination:t,withDroppableDisplacement:o,viewport:a};return s?Vs(f):Ua(f)},sl=function(e){var r=e.isMovingForward,t=e.draggable,n=e.destination,a=e.draggables,o=e.previousImpact,i=e.viewport,s=e.previousPageBorderBoxCenter,c=e.previousClientSelection,p=e.afterCritical;if(!n.isEnabled)return null;var f=Ir(n.descriptor.id,a),d=Nr(t,n),u=Ls({isMovingForward:r,draggable:t,destination:n,insideDestination:f,previousImpact:o})||_s({isMovingForward:r,isInHomeList:d,draggable:t,draggables:a,destination:n,insideDestination:f,previousImpact:o,viewport:i,afterCritical:p});if(!u)return null;var v=yt({impact:u,draggable:t,droppable:n,draggables:a,afterCritical:p}),g=Wa({draggable:t,destination:n,newPageBorderBoxCenter:v,viewport:i.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});if(g){var S=an({pageBorderBoxCenter:v,draggable:t,viewport:i});return{clientSelection:S,impact:u,scrollJumpRequest:null}}var h=De(v,s),C=ol({impact:u,viewport:i,destination:n,draggables:a,maxScrollChange:h});return{clientSelection:c,impact:C,scrollJumpRequest:h}},Ie=function(r){var t=r.subject.active;return t||R(),t},ll=function(e){var r=e.isMovingForward,t=e.pageBorderBoxCenter,n=e.source,a=e.droppables,o=e.viewport,i=n.subject.active;if(!i)return null;var s=n.axis,c=Oe(i[s.start],i[s.end]),p=ht(a).filter(function(d){return d!==n}).filter(function(d){return d.isEnabled}).filter(function(d){return!!d.subject.active}).filter(function(d){return za(o.frame)(Ie(d))}).filter(function(d){var u=Ie(d);return r?i[s.crossAxisEnd]<u[s.crossAxisEnd]:u[s.crossAxisStart]<i[s.crossAxisStart]}).filter(function(d){var u=Ie(d),v=Oe(u[s.start],u[s.end]);return c(u[s.start])||c(u[s.end])||v(i[s.start])||v(i[s.end])}).sort(function(d,u){var v=Ie(d)[s.crossAxisStart],g=Ie(u)[s.crossAxisStart];return r?v-g:g-v}).filter(function(d,u,v){return Ie(d)[s.crossAxisStart]===Ie(v[0])[s.crossAxisStart]});if(!p.length)return null;if(p.length===1)return p[0];var f=p.filter(function(d){var u=Oe(Ie(d)[s.start],Ie(d)[s.end]);return u(t[s.line])});return f.length===1?f[0]:f.length>1?f.sort(function(d,u){return Ie(d)[s.start]-Ie(u)[s.start]})[0]:p.sort(function(d,u){var v=Wn(t,Vn(Ie(d))),g=Wn(t,Vn(Ie(u)));return v!==g?v-g:Ie(d)[s.start]-Ie(u)[s.start]})[0]},Jn=function(r,t){var n=r.page.borderBox.center;return sr(r.descriptor.id,t)?De(n,t.displacedBy.point):n},cl=function(r,t){var n=r.page.borderBox;return sr(r.descriptor.id,t)?Wr(n,Er(t.displacedBy.point)):n},dl=function(e){var r=e.pageBorderBoxCenter,t=e.viewport,n=e.destination,a=e.insideDestination,o=e.afterCritical,i=a.filter(function(s){return Ua({target:cl(s,o),destination:n,viewport:t.frame,withDroppableDisplacement:!0})}).sort(function(s,c){var p=Gr(r,Ht(n,Jn(s,o))),f=Gr(r,Ht(n,Jn(c,o)));return p<f?-1:f<p?1:s.descriptor.index-c.descriptor.index});return i[0]||null},Vr=be(function(r,t){var n=t[r.line];return{value:n,point:mr(r.line,n)}}),ul=function(r,t,n){var a=r.axis;if(r.descriptor.mode==="virtual")return mr(a.line,t[a.line]);var o=r.subject.page.contentBox[a.size],i=Ir(r.descriptor.id,n),s=i.reduce(function(f,d){return f+d.client.marginBox[a.size]},0),c=s+t[a.line],p=c-o;return p<=0?null:mr(a.line,p)},Va=function(r,t){return Y({},r,{scroll:Y({},r.scroll,{max:t})})},qa=function(r,t,n){var a=r.frame;Nr(t,r)&&R(),r.subject.withPlaceholder&&R();var o=Vr(r.axis,t.displaceBy).point,i=ul(r,o,n),s={placeholderSize:o,increasedBy:i,oldFrameMaxScroll:r.frame?r.frame.scroll.max:null};if(!a){var c=wr({page:r.subject.page,withPlaceholder:s,axis:r.axis,frame:r.frame});return Y({},r,{subject:c})}var p=i?Se(a.scroll.max,i):a.scroll.max,f=Va(a,p),d=wr({page:r.subject.page,withPlaceholder:s,axis:r.axis,frame:f});return Y({},r,{subject:d,frame:f})},gl=function(r){var t=r.subject.withPlaceholder;t||R();var n=r.frame;if(!n){var a=wr({page:r.subject.page,axis:r.axis,frame:null,withPlaceholder:null});return Y({},r,{subject:a})}var o=t.oldFrameMaxScroll;o||R();var i=Va(n,o),s=wr({page:r.subject.page,axis:r.axis,frame:i,withPlaceholder:null});return Y({},r,{subject:s,frame:i})},pl=function(e){var r=e.previousPageBorderBoxCenter,t=e.moveRelativeTo,n=e.insideDestination,a=e.draggable,o=e.draggables,i=e.destination,s=e.viewport,c=e.afterCritical;if(!t){if(n.length)return null;var p={displaced:Ur,displacedBy:Fa,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:0}}},f=yt({impact:p,draggable:a,droppable:i,draggables:o,afterCritical:c}),d=Nr(a,i)?i:qa(i,a,o),u=Wa({draggable:a,destination:d,newPageBorderBoxCenter:f,viewport:s.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});return u?p:null}var v=r[i.axis.line]<=t.page.borderBox.center[i.axis.line],g=function(){var h=t.descriptor.index;return t.descriptor.id===a.descriptor.id||v?h:h+1}(),S=Vr(i.axis,a.displaceBy);return ft({draggable:a,insideDestination:n,destination:i,viewport:s,displacedBy:S,last:Ur,index:g})},fl=function(e){var r=e.isMovingForward,t=e.previousPageBorderBoxCenter,n=e.draggable,a=e.isOver,o=e.draggables,i=e.droppables,s=e.viewport,c=e.afterCritical,p=ll({isMovingForward:r,pageBorderBoxCenter:t,source:a,droppables:i,viewport:s});if(!p)return null;var f=Ir(p.descriptor.id,o),d=dl({pageBorderBoxCenter:t,viewport:s,destination:p,insideDestination:f,afterCritical:c}),u=pl({previousPageBorderBoxCenter:t,destination:p,draggable:n,draggables:o,moveRelativeTo:d,insideDestination:f,viewport:s,afterCritical:c});if(!u)return null;var v=yt({impact:u,draggable:n,droppable:p,draggables:o,afterCritical:c}),g=an({pageBorderBoxCenter:v,draggable:n,viewport:s});return{clientSelection:g,impact:u,scrollJumpRequest:null}},ke=function(e){var r=e.at;return r?r.type==="REORDER"?r.destination.droppableId:r.combine.droppableId:null},ml=function(r,t){var n=ke(r);return n?t[n]:null},vl=function(e){var r=e.state,t=e.type,n=ml(r.impact,r.dimensions.droppables),a=!!n,o=r.dimensions.droppables[r.critical.droppable.id],i=n||o,s=i.axis.direction,c=s==="vertical"&&(t==="MOVE_UP"||t==="MOVE_DOWN")||s==="horizontal"&&(t==="MOVE_LEFT"||t==="MOVE_RIGHT");if(c&&!a)return null;var p=t==="MOVE_DOWN"||t==="MOVE_RIGHT",f=r.dimensions.draggables[r.critical.draggable.id],d=r.current.page.borderBoxCenter,u=r.dimensions,v=u.draggables,g=u.droppables;return c?sl({isMovingForward:p,previousPageBorderBoxCenter:d,draggable:f,destination:i,draggables:v,viewport:r.viewport,previousClientSelection:r.current.client.selection,previousImpact:r.impact,afterCritical:r.afterCritical}):fl({isMovingForward:p,previousPageBorderBoxCenter:d,draggable:f,isOver:i,draggables:v,droppables:g,viewport:r.viewport,afterCritical:r.afterCritical})};function fr(e){return e.phase==="DRAGGING"||e.phase==="COLLECTING"}function Ka(e){var r=Oe(e.top,e.bottom),t=Oe(e.left,e.right);return function(a){return r(a.y)&&t(a.x)}}function hl(e,r){return e.left<r.right&&e.right>r.left&&e.top<r.bottom&&e.bottom>r.top}function bl(e){var r=e.pageBorderBox,t=e.draggable,n=e.candidates,a=t.page.borderBox.center,o=n.map(function(i){var s=i.axis,c=mr(i.axis.line,r.center[s.line],i.page.borderBox.center[s.crossAxisLine]);return{id:i.descriptor.id,distance:Gr(a,c)}}).sort(function(i,s){return s.distance-i.distance});return o[0]?o[0].id:null}function xl(e){var r=e.pageBorderBox,t=e.draggable,n=e.droppables,a=ht(n).filter(function(o){if(!o.isEnabled)return!1;var i=o.subject.active;if(!i||!hl(r,i))return!1;if(Ka(i)(r.center))return!0;var s=o.axis,c=i.center[s.crossAxisLine],p=r[s.crossAxisStart],f=r[s.crossAxisEnd],d=Oe(i[s.crossAxisStart],i[s.crossAxisEnd]),u=d(p),v=d(f);return!u&&!v?!0:u?p<c:f>c});return a.length?a.length===1?a[0].descriptor.id:bl({pageBorderBox:r,draggable:t,candidates:a}):null}var Ya=function(r,t){return Ge(Wr(r,t))},yl=function(e,r){var t=e.frame;return t?Ya(r,t.scroll.diff.value):r};function Xa(e){var r=e.displaced,t=e.id;return!!(r.visible[t]||r.invisible[t])}function wl(e){var r=e.draggable,t=e.closest,n=e.inHomeList;return t?n&&t.descriptor.index>r.descriptor.index?t.descriptor.index-1:t.descriptor.index:null}var Cl=function(e){var r=e.pageBorderBoxWithDroppableScroll,t=e.draggable,n=e.destination,a=e.insideDestination,o=e.last,i=e.viewport,s=e.afterCritical,c=n.axis,p=Vr(n.axis,t.displaceBy),f=p.value,d=r[c.start],u=r[c.end],v=xt(t,a),g=lr(v,function(h){var C=h.descriptor.id,I=h.page.borderBox.center[c.line],D=sr(C,s),N=Xa({displaced:o,id:C});return D?N?u<=I:d<I-f:N?u<=I+f:d<I}),S=wl({draggable:t,closest:g,inHomeList:Nr(t,n)});return ft({draggable:t,insideDestination:a,destination:n,viewport:i,last:o,displacedBy:p,index:S})},Sl=4,El=function(e){var r=e.draggable,t=e.pageBorderBoxWithDroppableScroll,n=e.previousImpact,a=e.destination,o=e.insideDestination,i=e.afterCritical;if(!a.isCombineEnabled)return null;var s=a.axis,c=Vr(a.axis,r.displaceBy),p=c.value,f=t[s.start],d=t[s.end],u=xt(r,o),v=lr(u,function(S){var h=S.descriptor.id,C=S.page.borderBox,I=C[s.size],D=I/Sl,N=sr(h,i),F=Xa({displaced:n.displaced,id:h});return N?F?d>C[s.start]+D&&d<C[s.end]-D:f>C[s.start]-p+D&&f<C[s.end]-p-D:F?d>C[s.start]+p+D&&d<C[s.end]+p-D:f>C[s.start]+D&&f<C[s.end]-D});if(!v)return null;var g={displacedBy:c,displaced:n.displaced,at:{type:"COMBINE",combine:{draggableId:v.descriptor.id,droppableId:a.descriptor.id}}};return g},Ja=function(e){var r=e.pageOffset,t=e.draggable,n=e.draggables,a=e.droppables,o=e.previousImpact,i=e.viewport,s=e.afterCritical,c=Ya(t.page.borderBox,r),p=xl({pageBorderBox:c,draggable:t,droppables:a});if(!p)return Fs;var f=a[p],d=Ir(f.descriptor.id,n),u=yl(f,c);return El({pageBorderBoxWithDroppableScroll:u,draggable:t,previousImpact:o,destination:f,insideDestination:d,afterCritical:s})||Cl({pageBorderBoxWithDroppableScroll:u,draggable:t,destination:f,insideDestination:d,last:o.displaced,viewport:i,afterCritical:s})},on=function(e,r){var t;return Y({},e,(t={},t[r.descriptor.id]=r,t))},Il=function(r){var t=r.previousImpact,n=r.impact,a=r.droppables,o=ke(t),i=ke(n);if(!o||o===i)return a;var s=a[o];if(!s.subject.withPlaceholder)return a;var c=gl(s);return on(a,c)},Nl=function(e){var r=e.draggable,t=e.draggables,n=e.droppables,a=e.previousImpact,o=e.impact,i=Il({previousImpact:a,impact:o,droppables:n}),s=ke(o);if(!s)return i;var c=n[s];if(Nr(r,c)||c.subject.withPlaceholder)return i;var p=qa(c,r,t);return on(i,p)},Lr=function(e){var r=e.state,t=e.clientSelection,n=e.dimensions,a=e.viewport,o=e.impact,i=e.scrollJumpRequest,s=a||r.viewport,c=n||r.dimensions,p=t||r.current.client.selection,f=De(p,r.initial.client.selection),d={offset:f,selection:p,borderBoxCenter:Se(r.initial.client.borderBoxCenter,f)},u={selection:Se(d.selection,s.scroll.current),borderBoxCenter:Se(d.borderBoxCenter,s.scroll.current),offset:Se(d.offset,s.scroll.diff.value)},v={client:d,page:u};if(r.phase==="COLLECTING")return Y({phase:"COLLECTING"},r,{dimensions:c,viewport:s,current:v});var g=c.draggables[r.critical.draggable.id],S=o||Ja({pageOffset:u.offset,draggable:g,draggables:c.draggables,droppables:c.droppables,previousImpact:r.impact,viewport:s,afterCritical:r.afterCritical}),h=Nl({draggable:g,impact:S,previousImpact:r.impact,draggables:c.draggables,droppables:c.droppables}),C=Y({},r,{current:v,dimensions:{draggables:c.draggables,droppables:h},impact:S,viewport:s,scrollJumpRequest:i||null,forceShouldAnimate:i?!1:null});return C};function Al(e,r){return e.map(function(t){return r[t]})}var _a=function(e){var r=e.impact,t=e.viewport,n=e.draggables,a=e.destination,o=e.forceShouldAnimate,i=r.displaced,s=Al(i.all,n),c=$r({afterDragging:s,destination:a,displacedBy:r.displacedBy,viewport:t.frame,forceShouldAnimate:o,last:i});return Y({},r,{displaced:c})},Qa=function(e){var r=e.impact,t=e.draggable,n=e.droppable,a=e.draggables,o=e.viewport,i=e.afterCritical,s=yt({impact:r,draggable:t,draggables:a,droppable:n,afterCritical:i});return an({pageBorderBoxCenter:s,draggable:t,viewport:o})},Za=function(e){var r=e.state,t=e.dimensions,n=e.viewport;r.movementMode!=="SNAP"&&R();var a=r.impact,o=n||r.viewport,i=t||r.dimensions,s=i.draggables,c=i.droppables,p=s[r.critical.draggable.id],f=ke(a);f||R();var d=c[f],u=_a({impact:a,viewport:o,destination:d,draggables:s}),v=Qa({impact:u,draggable:p,droppable:d,draggables:s,viewport:o,afterCritical:r.afterCritical});return Lr({impact:u,clientSelection:v,state:r,dimensions:i,viewport:o})},Pl=function(e){return{index:e.index,droppableId:e.droppableId}},eo=function(e){var r=e.draggable,t=e.home,n=e.draggables,a=e.viewport,o=Vr(t.axis,r.displaceBy),i=Ir(t.descriptor.id,n),s=i.indexOf(r);s===-1&&R();var c=i.slice(s+1),p=c.reduce(function(v,g){return v[g.descriptor.id]=!0,v},{}),f={inVirtualList:t.descriptor.mode==="virtual",displacedBy:o,effected:p},d=$r({afterDragging:c,destination:t,displacedBy:o,last:null,viewport:a.frame,forceShouldAnimate:!1}),u={displaced:d,displacedBy:o,at:{type:"REORDER",destination:Pl(r.descriptor)}};return{impact:u,afterCritical:f}},Dl=function(e,r){return{draggables:e.draggables,droppables:on(e.droppables,r)}},kl=function(e){var r=e.draggable,t=e.offset,n=e.initialWindowScroll,a=ct(r.client,t),o=dt(a,n),i=Y({},r,{placeholder:Y({},r.placeholder,{client:a}),client:a,page:o});return i},jl=function(e){var r=e.frame;return r||R(),r},Rl=function(e){var r=e.additions,t=e.updatedDroppables,n=e.viewport,a=n.scroll.diff.value;return r.map(function(o){var i=o.descriptor.droppableId,s=t[i],c=jl(s),p=c.scroll.diff.value,f=Se(a,p),d=kl({draggable:o,offset:f,initialWindowScroll:n.scroll.initial});return d})},Tl=function(e){var r=e.state,t=e.published,n=t.modified.map(function(D){var N=r.dimensions.droppables[D.droppableId],F=Qt(N,D.scroll);return F}),a=Y({},r.dimensions.droppables,{},Ma(n)),o=La(Rl({additions:t.additions,updatedDroppables:a,viewport:r.viewport})),i=Y({},r.dimensions.draggables,{},o);t.removals.forEach(function(D){delete i[D]});var s={droppables:a,draggables:i},c=ke(r.impact),p=c?s.droppables[c]:null,f=s.draggables[r.critical.draggable.id],d=s.droppables[r.critical.droppable.id],u=eo({draggable:f,home:d,draggables:i,viewport:r.viewport}),v=u.impact,g=u.afterCritical,S=p&&p.isCombineEnabled?r.impact:v,h=Ja({pageOffset:r.current.page.offset,draggable:s.draggables[r.critical.draggable.id],draggables:s.draggables,droppables:s.droppables,previousImpact:S,viewport:r.viewport,afterCritical:g}),C=Y({phase:"DRAGGING"},r,{phase:"DRAGGING",impact:h,onLiftImpact:v,dimensions:s,afterCritical:g,forceShouldAnimate:!1});if(r.phase==="COLLECTING")return C;var I=Y({phase:"DROP_PENDING"},C,{phase:"DROP_PENDING",reason:r.reason,isWaiting:!1});return I},Wt=function(r){return r.movementMode==="SNAP"},Tt=function(r,t,n){var a=Dl(r.dimensions,t);return!Wt(r)||n?Lr({state:r,dimensions:a}):Za({state:r,dimensions:a})};function Ot(e){return e.isDragging&&e.movementMode==="SNAP"?Y({phase:"DRAGGING"},e,{scrollJumpRequest:null}):e}var _n={phase:"IDLE",completed:null,shouldFlush:!1},Ol=function(e,r){if(e===void 0&&(e=_n),r.type==="FLUSH")return Y({},_n,{shouldFlush:!0});if(r.type==="INITIAL_PUBLISH"){e.phase!=="IDLE"&&R();var t=r.payload,n=t.critical,a=t.clientSelection,o=t.viewport,i=t.dimensions,s=t.movementMode,c=i.draggables[n.draggable.id],p=i.droppables[n.droppable.id],f={selection:a,borderBoxCenter:c.client.borderBox.center,offset:xe},d={client:f,page:{selection:Se(f.selection,o.scroll.initial),borderBoxCenter:Se(f.selection,o.scroll.initial),offset:Se(f.selection,o.scroll.diff.value)}},u=ht(i.droppables).every(function(_e){return!_e.isFixedOnPage}),v=eo({draggable:c,home:p,draggables:i.draggables,viewport:o}),g=v.impact,S=v.afterCritical,h={phase:"DRAGGING",isDragging:!0,critical:n,movementMode:s,dimensions:i,initial:d,current:d,isWindowScrollAllowed:u,impact:g,afterCritical:S,onLiftImpact:g,viewport:o,scrollJumpRequest:null,forceShouldAnimate:null};return h}if(r.type==="COLLECTION_STARTING"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&R();var C=Y({phase:"COLLECTING"},e,{phase:"COLLECTING"});return C}if(r.type==="PUBLISH_WHILE_DRAGGING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"||R(),Tl({state:e,published:r.payload});if(r.type==="MOVE"){if(e.phase==="DROP_PENDING")return e;fr(e)||R();var I=r.payload.client;return or(I,e.current.client.selection)?e:Lr({state:e,clientSelection:I,impact:Wt(e)?e.impact:null})}if(r.type==="UPDATE_DROPPABLE_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="COLLECTING")return Ot(e);fr(e)||R();var D=r.payload,N=D.id,F=D.newScroll,T=e.dimensions.droppables[N];if(!T)return e;var K=Qt(T,F);return Tt(e,K,!1)}if(r.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(e.phase==="DROP_PENDING")return e;fr(e)||R();var te=r.payload,J=te.id,ne=te.isEnabled,_=e.dimensions.droppables[J];_||R(),_.isEnabled===ne&&R();var le=Y({},_,{isEnabled:ne});return Tt(e,le,!0)}if(r.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(e.phase==="DROP_PENDING")return e;fr(e)||R();var O=r.payload,V=O.id,pe=O.isCombineEnabled,k=e.dimensions.droppables[V];k||R(),k.isCombineEnabled===pe&&R();var Q=Y({},k,{isCombineEnabled:pe});return Tt(e,Q,!0)}if(r.type==="MOVE_BY_WINDOW_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="DROP_ANIMATING")return e;fr(e)||R(),e.isWindowScrollAllowed||R();var ue=r.payload.newScroll;if(or(e.viewport.scroll.current,ue))return Ot(e);var Z=Ha(e.viewport,ue);return Wt(e)?Za({state:e,viewport:Z}):Lr({state:e,viewport:Z})}if(r.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!fr(e))return e;var oe=r.payload.maxScroll;if(or(oe,e.viewport.scroll.max))return e;var me=Y({},e.viewport,{scroll:Y({},e.viewport.scroll,{max:oe})});return Y({phase:"DRAGGING"},e,{viewport:me})}if(r.type==="MOVE_UP"||r.type==="MOVE_DOWN"||r.type==="MOVE_LEFT"||r.type==="MOVE_RIGHT"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&R();var he=vl({state:e,type:r.type});return he?Lr({state:e,impact:he.impact,clientSelection:he.clientSelection,scrollJumpRequest:he.scrollJumpRequest}):e}if(r.type==="DROP_PENDING"){var G=r.payload.reason;e.phase!=="COLLECTING"&&R();var Ae=Y({phase:"DROP_PENDING"},e,{phase:"DROP_PENDING",isWaiting:!0,reason:G});return Ae}if(r.type==="DROP_ANIMATE"){var ve=r.payload,Ue=ve.completed,ye=ve.dropDuration,Ne=ve.newHomeClientOffset;e.phase==="DRAGGING"||e.phase==="DROP_PENDING"||R();var Ve={phase:"DROP_ANIMATING",completed:Ue,dropDuration:ye,newHomeClientOffset:Ne,dimensions:e.dimensions};return Ve}if(r.type==="DROP_COMPLETE"){var Be=r.payload.completed;return{phase:"IDLE",completed:Be,shouldFlush:!1}}return e},Bl=function(r){return{type:"BEFORE_INITIAL_CAPTURE",payload:r}},Ml=function(r){return{type:"LIFT",payload:r}},Ll=function(r){return{type:"INITIAL_PUBLISH",payload:r}},Fl=function(r){return{type:"PUBLISH_WHILE_DRAGGING",payload:r}},zl=function(){return{type:"COLLECTION_STARTING",payload:null}},Gl=function(r){return{type:"UPDATE_DROPPABLE_SCROLL",payload:r}},Ul=function(r){return{type:"UPDATE_DROPPABLE_IS_ENABLED",payload:r}},$l=function(r){return{type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:r}},ro=function(r){return{type:"MOVE",payload:r}},Hl=function(r){return{type:"MOVE_BY_WINDOW_SCROLL",payload:r}},Wl=function(r){return{type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:r}},Vl=function(){return{type:"MOVE_UP",payload:null}},ql=function(){return{type:"MOVE_DOWN",payload:null}},Kl=function(){return{type:"MOVE_RIGHT",payload:null}},Yl=function(){return{type:"MOVE_LEFT",payload:null}},sn=function(){return{type:"FLUSH",payload:null}},Xl=function(r){return{type:"DROP_ANIMATE",payload:r}},ln=function(r){return{type:"DROP_COMPLETE",payload:r}},to=function(r){return{type:"DROP",payload:r}},Jl=function(r){return{type:"DROP_PENDING",payload:r}},no=function(){return{type:"DROP_ANIMATION_FINISHED",payload:null}},_l=function(e){return function(r){var t=r.getState,n=r.dispatch;return function(a){return function(o){if(o.type!=="LIFT"){a(o);return}var i=o.payload,s=i.id,c=i.clientSelection,p=i.movementMode,f=t();f.phase==="DROP_ANIMATING"&&n(ln({completed:f.completed})),t().phase!=="IDLE"&&R(),n(sn()),n(Bl({draggableId:s,movementMode:p}));var d={shouldPublishImmediately:p==="SNAP"},u={draggableId:s,scrollOptions:d},v=e.startPublishing(u),g=v.critical,S=v.dimensions,h=v.viewport;n(Ll({critical:g,dimensions:S,clientSelection:c,movementMode:p,viewport:h}))}}}},Ql=function(e){return function(){return function(r){return function(t){t.type==="INITIAL_PUBLISH"&&e.dragging(),t.type==="DROP_ANIMATE"&&e.dropping(t.payload.completed.result.reason),(t.type==="FLUSH"||t.type==="DROP_COMPLETE")&&e.resting(),r(t)}}}},cn={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},Hr={opacity:{drop:0,combining:.7},scale:{drop:.75}},dn={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},pr=dn.outOfTheWay+"s "+cn.outOfTheWay,Fr={fluid:"opacity "+pr,snap:"transform "+pr+", opacity "+pr,drop:function(r){var t=r+"s "+cn.drop;return"transform "+t+", opacity "+t},outOfTheWay:"transform "+pr,placeholder:"height "+pr+", width "+pr+", margin "+pr},Qn=function(r){return or(r,xe)?null:"translate("+r.x+"px, "+r.y+"px)"},Vt={moveTo:Qn,drop:function(r,t){var n=Qn(r);return n?t?n+" scale("+Hr.scale.drop+")":n:null}},qt=dn.minDropTime,ao=dn.maxDropTime,Zl=ao-qt,Zn=1500,ec=.6,rc=function(e){var r=e.current,t=e.destination,n=e.reason,a=Gr(r,t);if(a<=0)return qt;if(a>=Zn)return ao;var o=a/Zn,i=qt+Zl*o,s=n==="CANCEL"?i*ec:i;return Number(s.toFixed(2))},tc=function(e){var r=e.impact,t=e.draggable,n=e.dimensions,a=e.viewport,o=e.afterCritical,i=n.draggables,s=n.droppables,c=ke(r),p=c?s[c]:null,f=s[t.descriptor.droppableId],d=Qa({impact:r,draggable:t,draggables:i,afterCritical:o,droppable:p||f,viewport:a}),u=De(d,t.client.borderBox.center);return u},nc=function(e){var r=e.draggables,t=e.reason,n=e.lastImpact,a=e.home,o=e.viewport,i=e.onLiftImpact;if(!n.at||t!=="DROP"){var s=_a({draggables:r,impact:i,destination:a,viewport:o,forceShouldAnimate:!0});return{impact:s,didDropInsideDroppable:!1}}if(n.at.type==="REORDER")return{impact:n,didDropInsideDroppable:!0};var c=Y({},n,{displaced:Ur});return{impact:c,didDropInsideDroppable:!0}},ac=function(e){var r=e.getState,t=e.dispatch;return function(n){return function(a){if(a.type!=="DROP"){n(a);return}var o=r(),i=a.payload.reason;if(o.phase==="COLLECTING"){t(Jl({reason:i}));return}if(o.phase!=="IDLE"){var s=o.phase==="DROP_PENDING"&&o.isWaiting;s&&R(),o.phase==="DRAGGING"||o.phase==="DROP_PENDING"||R();var c=o.critical,p=o.dimensions,f=p.draggables[o.critical.draggable.id],d=nc({reason:i,lastImpact:o.impact,afterCritical:o.afterCritical,onLiftImpact:o.onLiftImpact,home:o.dimensions.droppables[o.critical.droppable.id],viewport:o.viewport,draggables:o.dimensions.draggables}),u=d.impact,v=d.didDropInsideDroppable,g=v?en(u):null,S=v?bt(u):null,h={index:c.draggable.index,droppableId:c.droppable.id},C={draggableId:f.descriptor.id,type:f.descriptor.type,source:h,reason:i,mode:o.movementMode,destination:g,combine:S},I=tc({impact:u,draggable:f,dimensions:p,viewport:o.viewport,afterCritical:o.afterCritical}),D={critical:o.critical,afterCritical:o.afterCritical,result:C,impact:u},N=!or(o.current.client.offset,I)||!!C.combine;if(!N){t(ln({completed:D}));return}var F=rc({current:o.current.client.offset,destination:I,reason:i}),T={newHomeClientOffset:I,dropDuration:F,completed:D};t(Xl(T))}}}},oo=function(){return{x:window.pageXOffset,y:window.pageYOffset}};function oc(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(t){t.target!==window&&t.target!==window.document||e()}}}function ic(e){var r=e.onWindowScroll;function t(){r(oo())}var n=zr(t),a=oc(n),o=ar;function i(){return o!==ar}function s(){i()&&R(),o=Te(window,[a])}function c(){i()||R(),n.cancel(),o(),o=ar}return{start:s,stop:c,isActive:i}}var sc=function(r){return r.type==="DROP_COMPLETE"||r.type==="DROP_ANIMATE"||r.type==="FLUSH"},lc=function(e){var r=ic({onWindowScroll:function(n){e.dispatch(Hl({newScroll:n}))}});return function(t){return function(n){!r.isActive()&&n.type==="INITIAL_PUBLISH"&&r.start(),r.isActive()&&sc(n)&&r.stop(),t(n)}}},cc=function(e){var r=!1,t=!1,n=setTimeout(function(){t=!0}),a=function(i){r||t||(r=!0,e(i),clearTimeout(n))};return a.wasCalled=function(){return r},a},dc=function(){var e=[],r=function(o){var i=Zt(e,function(p){return p.timerId===o});i===-1&&R();var s=e.splice(i,1),c=s[0];c.callback()},t=function(o){var i=setTimeout(function(){return r(i)}),s={timerId:i,callback:o};e.push(s)},n=function(){if(e.length){var o=[].concat(e);e.length=0,o.forEach(function(i){clearTimeout(i.timerId),i.callback()})}};return{add:t,flush:n}},uc=function(r,t){return r==null&&t==null?!0:r==null||t==null?!1:r.droppableId===t.droppableId&&r.index===t.index},gc=function(r,t){return r==null&&t==null?!0:r==null||t==null?!1:r.draggableId===t.draggableId&&r.droppableId===t.droppableId},pc=function(r,t){if(r===t)return!0;var n=r.draggable.id===t.draggable.id&&r.draggable.droppableId===t.draggable.droppableId&&r.draggable.type===t.draggable.type&&r.draggable.index===t.draggable.index,a=r.droppable.id===t.droppable.id&&r.droppable.type===t.droppable.type;return n&&a},Rr=function(r,t){t()},nt=function(r,t){return{draggableId:r.draggable.id,type:r.droppable.type,source:{droppableId:r.droppable.id,index:r.draggable.index},mode:t}},Bt=function(r,t,n,a){if(!r){n(a(t));return}var o=cc(n),i={announce:o};r(t,i),o.wasCalled()||n(a(t))},fc=function(e,r){var t=dc(),n=null,a=function(u,v){n&&R(),Rr("onBeforeCapture",function(){var g=e().onBeforeCapture;if(g){var S={draggableId:u,mode:v};g(S)}})},o=function(u,v){n&&R(),Rr("onBeforeDragStart",function(){var g=e().onBeforeDragStart;g&&g(nt(u,v))})},i=function(u,v){n&&R();var g=nt(u,v);n={mode:v,lastCritical:u,lastLocation:g.source,lastCombine:null},t.add(function(){Rr("onDragStart",function(){return Bt(e().onDragStart,g,r,st.onDragStart)})})},s=function(u,v){var g=en(v),S=bt(v);n||R();var h=!pc(u,n.lastCritical);h&&(n.lastCritical=u);var C=!uc(n.lastLocation,g);C&&(n.lastLocation=g);var I=!gc(n.lastCombine,S);if(I&&(n.lastCombine=S),!(!h&&!C&&!I)){var D=Y({},nt(u,n.mode),{combine:S,destination:g});t.add(function(){Rr("onDragUpdate",function(){return Bt(e().onDragUpdate,D,r,st.onDragUpdate)})})}},c=function(){n||R(),t.flush()},p=function(u){n||R(),n=null,Rr("onDragEnd",function(){return Bt(e().onDragEnd,u,r,st.onDragEnd)})},f=function(){if(n){var u=Y({},nt(n.lastCritical,n.mode),{combine:null,destination:null,reason:"CANCEL"});p(u)}};return{beforeCapture:a,beforeStart:o,start:i,update:s,flush:c,drop:p,abort:f}},mc=function(e,r){var t=fc(e,r);return function(n){return function(a){return function(o){if(o.type==="BEFORE_INITIAL_CAPTURE"){t.beforeCapture(o.payload.draggableId,o.payload.movementMode);return}if(o.type==="INITIAL_PUBLISH"){var i=o.payload.critical;t.beforeStart(i,o.payload.movementMode),a(o),t.start(i,o.payload.movementMode);return}if(o.type==="DROP_COMPLETE"){var s=o.payload.completed.result;t.flush(),a(o),t.drop(s);return}if(a(o),o.type==="FLUSH"){t.abort();return}var c=n.getState();c.phase==="DRAGGING"&&t.update(c.critical,c.impact)}}}},vc=function(e){return function(r){return function(t){if(t.type!=="DROP_ANIMATION_FINISHED"){r(t);return}var n=e.getState();n.phase!=="DROP_ANIMATING"&&R(),e.dispatch(ln({completed:n.completed}))}}},hc=function(e){var r=null,t=null;function n(){t&&(cancelAnimationFrame(t),t=null),r&&(r(),r=null)}return function(a){return function(o){if((o.type==="FLUSH"||o.type==="DROP_COMPLETE"||o.type==="DROP_ANIMATION_FINISHED")&&n(),a(o),o.type==="DROP_ANIMATE"){var i={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){var c=e.getState();c.phase==="DROP_ANIMATING"&&e.dispatch(no())}};t=requestAnimationFrame(function(){t=null,r=Te(window,[i])})}}}},bc=function(e){return function(){return function(r){return function(t){(t.type==="DROP_COMPLETE"||t.type==="FLUSH"||t.type==="DROP_ANIMATE")&&e.stopPublishing(),r(t)}}}},xc=function(e){var r=!1;return function(){return function(t){return function(n){if(n.type==="INITIAL_PUBLISH"){r=!0,e.tryRecordFocus(n.payload.critical.draggable.id),t(n),e.tryRestoreFocusRecorded();return}if(t(n),!!r){if(n.type==="FLUSH"){r=!1,e.tryRestoreFocusRecorded();return}if(n.type==="DROP_COMPLETE"){r=!1;var a=n.payload.completed.result;a.combine&&e.tryShiftRecord(a.draggableId,a.combine.draggableId),e.tryRestoreFocusRecorded()}}}}}},yc=function(r){return r.type==="DROP_COMPLETE"||r.type==="DROP_ANIMATE"||r.type==="FLUSH"},wc=function(e){return function(r){return function(t){return function(n){if(yc(n)){e.stop(),t(n);return}if(n.type==="INITIAL_PUBLISH"){t(n);var a=r.getState();a.phase!=="DRAGGING"&&R(),e.start(a);return}t(n),e.scroll(r.getState())}}}},Cc=function(e){return function(r){return function(t){if(r(t),t.type==="PUBLISH_WHILE_DRAGGING"){var n=e.getState();n.phase==="DROP_PENDING"&&(n.isWaiting||e.dispatch(to({reason:n.reason})))}}}},Sc=To,Ec=function(e){var r=e.dimensionMarshal,t=e.focusMarshal,n=e.styleMarshal,a=e.getResponders,o=e.announce,i=e.autoScroller;return Ro(Ol,Sc(Oo(Ql(n),bc(r),_l(r),ac,vc,hc,Cc,wc(i),lc,xc(t),mc(a,o))))},Mt=function(){return{additions:{},removals:{},modified:{}}};function Ic(e){var r=e.registry,t=e.callbacks,n=Mt(),a=null,o=function(){a||(t.collectionStarting(),a=requestAnimationFrame(function(){a=null;var f=n,d=f.additions,u=f.removals,v=f.modified,g=Object.keys(d).map(function(C){return r.draggable.getById(C).getDimension(xe)}).sort(function(C,I){return C.descriptor.index-I.descriptor.index}),S=Object.keys(v).map(function(C){var I=r.droppable.getById(C),D=I.callbacks.getScrollWhileDragging();return{droppableId:C,scroll:D}}),h={additions:g,removals:Object.keys(u),modified:S};n=Mt(),t.publish(h)}))},i=function(f){var d=f.descriptor.id;n.additions[d]=f,n.modified[f.descriptor.droppableId]=!0,n.removals[d]&&delete n.removals[d],o()},s=function(f){var d=f.descriptor;n.removals[d.id]=!0,n.modified[d.droppableId]=!0,n.additions[d.id]&&delete n.additions[d.id],o()},c=function(){a&&(cancelAnimationFrame(a),a=null,n=Mt())};return{add:i,remove:s,stop:c}}var io=function(e){var r=e.scrollHeight,t=e.scrollWidth,n=e.height,a=e.width,o=De({x:t,y:r},{x:a,y:n}),i={x:Math.max(0,o.x),y:Math.max(0,o.y)};return i},so=function(){var e=document.documentElement;return e||R(),e},lo=function(){var e=so(),r=io({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight});return r},Nc=function(){var e=oo(),r=lo(),t=e.y,n=e.x,a=so(),o=a.clientWidth,i=a.clientHeight,s=n+o,c=t+i,p=Ge({top:t,left:n,right:s,bottom:c}),f={frame:p,scroll:{initial:e,current:e,max:r,diff:{value:xe,displacement:xe}}};return f},Ac=function(e){var r=e.critical,t=e.scrollOptions,n=e.registry,a=Nc(),o=a.scroll.current,i=r.droppable,s=n.droppable.getAllByType(i.type).map(function(d){return d.callbacks.getDimensionAndWatchScroll(o,t)}),c=n.draggable.getAllByType(r.draggable.type).map(function(d){return d.getDimension(o)}),p={draggables:La(c),droppables:Ma(s)},f={dimensions:p,critical:r,viewport:a};return f};function ea(e,r,t){if(t.descriptor.id===r.id||t.descriptor.type!==r.type)return!1;var n=e.droppable.getById(t.descriptor.droppableId);return n.descriptor.mode==="virtual"}var Pc=function(e,r){var t=null,n=Ic({callbacks:{publish:r.publishWhileDragging,collectionStarting:r.collectionStarting},registry:e}),a=function(v,g){e.droppable.exists(v)||R(),t&&r.updateDroppableIsEnabled({id:v,isEnabled:g})},o=function(v,g){t&&(e.droppable.exists(v)||R(),r.updateDroppableIsCombineEnabled({id:v,isCombineEnabled:g}))},i=function(v,g){t&&(e.droppable.exists(v)||R(),r.updateDroppableScroll({id:v,newScroll:g}))},s=function(v,g){t&&e.droppable.getById(v).callbacks.scroll(g)},c=function(){if(t){n.stop();var v=t.critical.droppable;e.droppable.getAllByType(v.type).forEach(function(g){return g.callbacks.dragStopped()}),t.unsubscribe(),t=null}},p=function(v){t||R();var g=t.critical.draggable;v.type==="ADDITION"&&ea(e,g,v.value)&&n.add(v.value),v.type==="REMOVAL"&&ea(e,g,v.value)&&n.remove(v.value)},f=function(v){t&&R();var g=e.draggable.getById(v.draggableId),S=e.droppable.getById(g.descriptor.droppableId),h={draggable:g.descriptor,droppable:S.descriptor},C=e.subscribe(p);return t={critical:h,unsubscribe:C},Ac({critical:h,registry:e,scrollOptions:v.scrollOptions})},d={updateDroppableIsEnabled:a,updateDroppableIsCombineEnabled:o,scrollDroppable:s,updateDroppableScroll:i,startPublishing:f,stopPublishing:c};return d},co=function(e,r){return e.phase==="IDLE"?!0:e.phase!=="DROP_ANIMATING"||e.completed.result.draggableId===r?!1:e.completed.result.reason==="DROP"},Dc=function(e){window.scrollBy(e.x,e.y)},kc=be(function(e){return ht(e).filter(function(r){return!(!r.isEnabled||!r.frame)})}),jc=function(r,t){var n=lr(kc(t),function(a){return a.frame||R(),Ka(a.frame.pageMarginBox)(r)});return n},Rc=function(e){var r=e.center,t=e.destination,n=e.droppables;if(t){var a=n[t];return a.frame?a:null}var o=jc(r,n);return o},ir={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:function(r){return Math.pow(r,2)},durationDampening:{stopDampeningAt:1200,accelerateAt:360}},Tc=function(e,r){var t=e[r.size]*ir.startFromPercentage,n=e[r.size]*ir.maxScrollAtPercentage,a={startScrollingFrom:t,maxScrollValueAt:n};return a},uo=function(e){var r=e.startOfRange,t=e.endOfRange,n=e.current,a=t-r;if(a===0)return 0;var o=n-r,i=o/a;return i},un=1,Oc=function(e,r){if(e>r.startScrollingFrom)return 0;if(e<=r.maxScrollValueAt)return ir.maxPixelScroll;if(e===r.startScrollingFrom)return un;var t=uo({startOfRange:r.maxScrollValueAt,endOfRange:r.startScrollingFrom,current:e}),n=1-t,a=ir.maxPixelScroll*ir.ease(n);return Math.ceil(a)},ra=ir.durationDampening.accelerateAt,ta=ir.durationDampening.stopDampeningAt,Bc=function(e,r){var t=r,n=ta,a=Date.now(),o=a-t;if(o>=ta)return e;if(o<ra)return un;var i=uo({startOfRange:ra,endOfRange:n,current:o}),s=e*ir.ease(i);return Math.ceil(s)},na=function(e){var r=e.distanceToEdge,t=e.thresholds,n=e.dragStartTime,a=e.shouldUseTimeDampening,o=Oc(r,t);return o===0?0:a?Math.max(Bc(o,n),un):o},aa=function(e){var r=e.container,t=e.distanceToEdges,n=e.dragStartTime,a=e.axis,o=e.shouldUseTimeDampening,i=Tc(r,a),s=t[a.end]<t[a.start];return s?na({distanceToEdge:t[a.end],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o}):-1*na({distanceToEdge:t[a.start],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o})},Mc=function(e){var r=e.container,t=e.subject,n=e.proposedScroll,a=t.height>r.height,o=t.width>r.width;return!o&&!a?n:o&&a?null:{x:o?0:n.x,y:a?0:n.y}},Lc=Oa(function(e){return e===0?0:e}),go=function(e){var r=e.dragStartTime,t=e.container,n=e.subject,a=e.center,o=e.shouldUseTimeDampening,i={top:a.y-t.top,right:t.right-a.x,bottom:t.bottom-a.y,left:a.x-t.left},s=aa({container:t,distanceToEdges:i,dragStartTime:r,axis:rn,shouldUseTimeDampening:o}),c=aa({container:t,distanceToEdges:i,dragStartTime:r,axis:Ga,shouldUseTimeDampening:o}),p=Lc({x:c,y:s});if(or(p,xe))return null;var f=Mc({container:t,subject:n,proposedScroll:p});return f?or(f,xe)?null:f:null},Fc=Oa(function(e){return e===0?0:e>0?1:-1}),gn=function(){var e=function(t,n){return t<0?t:t>n?t-n:0};return function(r){var t=r.current,n=r.max,a=r.change,o=Se(t,a),i={x:e(o.x,n.x),y:e(o.y,n.y)};return or(i,xe)?null:i}}(),po=function(r){var t=r.max,n=r.current,a=r.change,o={x:Math.max(n.x,t.x),y:Math.max(n.y,t.y)},i=Fc(a),s=gn({max:o,current:n,change:i});return!s||i.x!==0&&s.x===0||i.y!==0&&s.y===0},pn=function(r,t){return po({current:r.scroll.current,max:r.scroll.max,change:t})},zc=function(r,t){if(!pn(r,t))return null;var n=r.scroll.max,a=r.scroll.current;return gn({current:a,max:n,change:t})},fn=function(r,t){var n=r.frame;return n?po({current:n.scroll.current,max:n.scroll.max,change:t}):!1},Gc=function(r,t){var n=r.frame;return!n||!fn(r,t)?null:gn({current:n.scroll.current,max:n.scroll.max,change:t})},Uc=function(e){var r=e.viewport,t=e.subject,n=e.center,a=e.dragStartTime,o=e.shouldUseTimeDampening,i=go({dragStartTime:a,container:r.frame,subject:t,center:n,shouldUseTimeDampening:o});return i&&pn(r,i)?i:null},$c=function(e){var r=e.droppable,t=e.subject,n=e.center,a=e.dragStartTime,o=e.shouldUseTimeDampening,i=r.frame;if(!i)return null;var s=go({dragStartTime:a,container:i.pageMarginBox,subject:t,center:n,shouldUseTimeDampening:o});return s&&fn(r,s)?s:null},oa=function(e){var r=e.state,t=e.dragStartTime,n=e.shouldUseTimeDampening,a=e.scrollWindow,o=e.scrollDroppable,i=r.current.page.borderBoxCenter,s=r.dimensions.draggables[r.critical.draggable.id],c=s.page.marginBox;if(r.isWindowScrollAllowed){var p=r.viewport,f=Uc({dragStartTime:t,viewport:p,subject:c,center:i,shouldUseTimeDampening:n});if(f){a(f);return}}var d=Rc({center:i,destination:ke(r.impact),droppables:r.dimensions.droppables});if(d){var u=$c({dragStartTime:t,droppable:d,subject:c,center:i,shouldUseTimeDampening:n});u&&o(d.descriptor.id,u)}},Hc=function(e){var r=e.scrollWindow,t=e.scrollDroppable,n=zr(r),a=zr(t),o=null,i=function(f){o||R();var d=o,u=d.shouldUseTimeDampening,v=d.dragStartTime;oa({state:f,scrollWindow:n,scrollDroppable:a,dragStartTime:v,shouldUseTimeDampening:u})},s=function(f){o&&R();var d=Date.now(),u=!1,v=function(){u=!0};oa({state:f,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:v,scrollDroppable:v}),o={dragStartTime:d,shouldUseTimeDampening:u},u&&i(f)},c=function(){o&&(n.cancel(),a.cancel(),o=null)};return{start:s,stop:c,scroll:i}},Wc=function(e){var r=e.move,t=e.scrollDroppable,n=e.scrollWindow,a=function(p,f){var d=Se(p.current.client.selection,f);r({client:d})},o=function(p,f){if(!fn(p,f))return f;var d=Gc(p,f);if(!d)return t(p.descriptor.id,f),null;var u=De(f,d);t(p.descriptor.id,u);var v=De(f,u);return v},i=function(p,f,d){if(!p||!pn(f,d))return d;var u=zc(f,d);if(!u)return n(d),null;var v=De(d,u);n(v);var g=De(d,v);return g},s=function(p){var f=p.scrollJumpRequest;if(f){var d=ke(p.impact);d||R();var u=o(p.dimensions.droppables[d],f);if(u){var v=p.viewport,g=i(p.isWindowScrollAllowed,v,u);g&&a(p,g)}}};return s},Vc=function(e){var r=e.scrollDroppable,t=e.scrollWindow,n=e.move,a=Hc({scrollWindow:t,scrollDroppable:r}),o=Wc({move:n,scrollWindow:t,scrollDroppable:r}),i=function(p){if(p.phase==="DRAGGING"){if(p.movementMode==="FLUID"){a.scroll(p);return}p.scrollJumpRequest&&o(p)}},s={scroll:i,start:a.start,stop:a.stop};return s},Cr="data-rbd",Sr=function(){var e=Cr+"-drag-handle";return{base:e,draggableId:e+"-draggable-id",contextId:e+"-context-id"}}(),Kt=function(){var e=Cr+"-draggable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),qc=function(){var e=Cr+"-droppable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),ia={contextId:Cr+"-scroll-container-context-id"},Kc=function(r){return function(t){return"["+t+'="'+r+'"]'}},Tr=function(r,t){return r.map(function(n){var a=n.styles[t];return a?n.selector+" { "+a+" }":""}).join(" ")},Yc="pointer-events: none;",Xc=function(e){var r=Kc(e),t=function(){var s=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:r(Sr.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:s,dragging:Yc,dropAnimating:s}}}(),n=function(){var s=`
      transition: `+Fr.outOfTheWay+`;
    `;return{selector:r(Kt.contextId),styles:{dragging:s,dropAnimating:s,userCancel:s}}}(),a={selector:r(qc.contextId),styles:{always:"overflow-anchor: none;"}},o={selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}},i=[n,t,a,o];return{always:Tr(i,"always"),resting:Tr(i,"resting"),dragging:Tr(i,"dragging"),dropAnimating:Tr(i,"dropAnimating"),userCancel:Tr(i,"userCancel")}},je=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?y.useLayoutEffect:y.useEffect,Lt=function(){var r=document.querySelector("head");return r||R(),r},sa=function(r){var t=document.createElement("style");return r&&t.setAttribute("nonce",r),t.type="text/css",t};function Jc(e,r){var t=se(function(){return Xc(e)},[e]),n=y.useRef(null),a=y.useRef(null),o=U(be(function(d){var u=a.current;u||R(),u.textContent=d}),[]),i=U(function(d){var u=n.current;u||R(),u.textContent=d},[]);je(function(){!n.current&&!a.current||R();var d=sa(r),u=sa(r);return n.current=d,a.current=u,d.setAttribute(Cr+"-always",e),u.setAttribute(Cr+"-dynamic",e),Lt().appendChild(d),Lt().appendChild(u),i(t.always),o(t.resting),function(){var v=function(S){var h=S.current;h||R(),Lt().removeChild(h),S.current=null};v(n),v(a)}},[r,i,o,t.always,t.resting,e]);var s=U(function(){return o(t.dragging)},[o,t.dragging]),c=U(function(d){if(d==="DROP"){o(t.dropAnimating);return}o(t.userCancel)},[o,t.dropAnimating,t.userCancel]),p=U(function(){a.current&&o(t.resting)},[o,t.resting]),f=se(function(){return{dragging:s,dropping:c,resting:p}},[s,c,p]);return f}var fo=function(e){return e&&e.ownerDocument?e.ownerDocument.defaultView:window};function wt(e){return e instanceof fo(e).HTMLElement}function _c(e,r){var t="["+Sr.contextId+'="'+e+'"]',n=Ba(document.querySelectorAll(t));if(!n.length)return null;var a=lr(n,function(o){return o.getAttribute(Sr.draggableId)===r});return!a||!wt(a)?null:a}function Qc(e){var r=y.useRef({}),t=y.useRef(null),n=y.useRef(null),a=y.useRef(!1),o=U(function(u,v){var g={id:u,focus:v};return r.current[u]=g,function(){var h=r.current,C=h[u];C!==g&&delete h[u]}},[]),i=U(function(u){var v=_c(e,u);v&&v!==document.activeElement&&v.focus()},[e]),s=U(function(u,v){t.current===u&&(t.current=v)},[]),c=U(function(){n.current||a.current&&(n.current=requestAnimationFrame(function(){n.current=null;var u=t.current;u&&i(u)}))},[i]),p=U(function(u){t.current=null;var v=document.activeElement;v&&v.getAttribute(Sr.draggableId)===u&&(t.current=u)},[]);je(function(){return a.current=!0,function(){a.current=!1;var u=n.current;u&&cancelAnimationFrame(u)}},[]);var f=se(function(){return{register:o,tryRecordFocus:p,tryRestoreFocusRecorded:c,tryShiftRecord:s}},[o,p,c,s]);return f}function Zc(){var e={draggables:{},droppables:{}},r=[];function t(d){return r.push(d),function(){var v=r.indexOf(d);v!==-1&&r.splice(v,1)}}function n(d){r.length&&r.forEach(function(u){return u(d)})}function a(d){return e.draggables[d]||null}function o(d){var u=a(d);return u||R(),u}var i={register:function(u){e.draggables[u.descriptor.id]=u,n({type:"ADDITION",value:u})},update:function(u,v){var g=e.draggables[v.descriptor.id];g&&g.uniqueId===u.uniqueId&&(delete e.draggables[v.descriptor.id],e.draggables[u.descriptor.id]=u)},unregister:function(u){var v=u.descriptor.id,g=a(v);g&&u.uniqueId===g.uniqueId&&(delete e.draggables[v],n({type:"REMOVAL",value:u}))},getById:o,findById:a,exists:function(u){return!!a(u)},getAllByType:function(u){return pt(e.draggables).filter(function(v){return v.descriptor.type===u})}};function s(d){return e.droppables[d]||null}function c(d){var u=s(d);return u||R(),u}var p={register:function(u){e.droppables[u.descriptor.id]=u},unregister:function(u){var v=s(u.descriptor.id);v&&u.uniqueId===v.uniqueId&&delete e.droppables[u.descriptor.id]},getById:c,findById:s,exists:function(u){return!!s(u)},getAllByType:function(u){return pt(e.droppables).filter(function(v){return v.descriptor.type===u})}};function f(){e.draggables={},e.droppables={},r.length=0}return{draggable:i,droppable:p,subscribe:t,clean:f}}function ed(){var e=se(Zc,[]);return y.useEffect(function(){return function(){requestAnimationFrame(e.clean)}},[e]),e}var mn=fe.createContext(null),mt=function(){var e=document.body;return e||R(),e},rd={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},td=function(r){return"rbd-announcement-"+r};function nd(e){var r=se(function(){return td(e)},[e]),t=y.useRef(null);y.useEffect(function(){var o=document.createElement("div");return t.current=o,o.id=r,o.setAttribute("aria-live","assertive"),o.setAttribute("aria-atomic","true"),Y(o.style,rd),mt().appendChild(o),function(){setTimeout(function(){var c=mt();c.contains(o)&&c.removeChild(o),o===t.current&&(t.current=null)})}},[r]);var n=U(function(a){var o=t.current;if(o){o.textContent=a;return}},[]);return n}var ad=0,od={separator:"::"};function vn(e,r){return r===void 0&&(r=od),se(function(){return""+e+r.separator+ad++},[r.separator,e])}function id(e){var r=e.contextId,t=e.uniqueId;return"rbd-hidden-text-"+r+"-"+t}function sd(e){var r=e.contextId,t=e.text,n=vn("hidden-text",{separator:"-"}),a=se(function(){return id({contextId:r,uniqueId:n})},[n,r]);return y.useEffect(function(){var i=document.createElement("div");return i.id=a,i.textContent=t,i.style.display="none",mt().appendChild(i),function(){var c=mt();c.contains(i)&&c.removeChild(i)}},[a,t]),a}var Ct=fe.createContext(null);function mo(e){var r=y.useRef(e);return y.useEffect(function(){r.current=e}),r}function ld(){var e=null;function r(){return!!e}function t(i){return i===e}function n(i){e&&R();var s={abandon:i};return e=s,s}function a(){e||R(),e=null}function o(){e&&(e.abandon(),a())}return{isClaimed:r,isActive:t,claim:n,release:a,tryAbandon:o}}var cd=9,dd=13,hn=27,vo=32,ud=33,gd=34,pd=35,fd=36,md=37,vd=38,hd=39,bd=40,at,xd=(at={},at[dd]=!0,at[cd]=!0,at),ho=function(e){xd[e.keyCode]&&e.preventDefault()},St=function(){var e="visibilitychange";if(typeof document>"u")return e;var r=[e,"ms"+e,"webkit"+e,"moz"+e,"o"+e],t=lr(r,function(n){return"on"+n in document});return t||e}(),bo=0,la=5;function yd(e,r){return Math.abs(r.x-e.x)>=la||Math.abs(r.y-e.y)>=la}var ca={type:"IDLE"};function wd(e){var r=e.cancel,t=e.completed,n=e.getPhase,a=e.setPhase;return[{eventName:"mousemove",fn:function(i){var s=i.button,c=i.clientX,p=i.clientY;if(s===bo){var f={x:c,y:p},d=n();if(d.type==="DRAGGING"){i.preventDefault(),d.actions.move(f);return}d.type!=="PENDING"&&R();var u=d.point;if(yd(u,f)){i.preventDefault();var v=d.actions.fluidLift(f);a({type:"DRAGGING",actions:v})}}}},{eventName:"mouseup",fn:function(i){var s=n();if(s.type!=="DRAGGING"){r();return}i.preventDefault(),s.actions.drop({shouldBlockNextClick:!0}),t()}},{eventName:"mousedown",fn:function(i){n().type==="DRAGGING"&&i.preventDefault(),r()}},{eventName:"keydown",fn:function(i){var s=n();if(s.type==="PENDING"){r();return}if(i.keyCode===hn){i.preventDefault(),r();return}ho(i)}},{eventName:"resize",fn:r},{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(){n().type==="PENDING"&&r()}},{eventName:"webkitmouseforcedown",fn:function(i){var s=n();if(s.type==="IDLE"&&R(),s.actions.shouldRespectForcePress()){r();return}i.preventDefault()}},{eventName:St,fn:r}]}function Cd(e){var r=y.useRef(ca),t=y.useRef(ar),n=se(function(){return{eventName:"mousedown",fn:function(d){if(!d.defaultPrevented&&d.button===bo&&!(d.ctrlKey||d.metaKey||d.shiftKey||d.altKey)){var u=e.findClosestDraggableId(d);if(u){var v=e.tryGetLock(u,i,{sourceEvent:d});if(v){d.preventDefault();var g={x:d.clientX,y:d.clientY};t.current(),p(v,g)}}}}}},[e]),a=se(function(){return{eventName:"webkitmouseforcewillbegin",fn:function(d){if(!d.defaultPrevented){var u=e.findClosestDraggableId(d);if(u){var v=e.findOptionsForDraggable(u);v&&(v.shouldRespectForcePress||e.canGetLock(u)&&d.preventDefault())}}}}},[e]),o=U(function(){var d={passive:!1,capture:!0};t.current=Te(window,[a,n],d)},[a,n]),i=U(function(){var f=r.current;f.type!=="IDLE"&&(r.current=ca,t.current(),o())},[o]),s=U(function(){var f=r.current;i(),f.type==="DRAGGING"&&f.actions.cancel({shouldBlockNextClick:!0}),f.type==="PENDING"&&f.actions.abort()},[i]),c=U(function(){var d={capture:!0,passive:!1},u=wd({cancel:s,completed:i,getPhase:function(){return r.current},setPhase:function(g){r.current=g}});t.current=Te(window,u,d)},[s,i]),p=U(function(d,u){r.current.type!=="IDLE"&&R(),r.current={type:"PENDING",point:u,actions:d},c()},[c]);je(function(){return o(),function(){t.current()}},[o])}var yr;function Sd(){}var Ed=(yr={},yr[gd]=!0,yr[ud]=!0,yr[fd]=!0,yr[pd]=!0,yr);function Id(e,r){function t(){r(),e.cancel()}function n(){r(),e.drop()}return[{eventName:"keydown",fn:function(o){if(o.keyCode===hn){o.preventDefault(),t();return}if(o.keyCode===vo){o.preventDefault(),n();return}if(o.keyCode===bd){o.preventDefault(),e.moveDown();return}if(o.keyCode===vd){o.preventDefault(),e.moveUp();return}if(o.keyCode===hd){o.preventDefault(),e.moveRight();return}if(o.keyCode===md){o.preventDefault(),e.moveLeft();return}if(Ed[o.keyCode]){o.preventDefault();return}ho(o)}},{eventName:"mousedown",fn:t},{eventName:"mouseup",fn:t},{eventName:"click",fn:t},{eventName:"touchstart",fn:t},{eventName:"resize",fn:t},{eventName:"wheel",fn:t,options:{passive:!0}},{eventName:St,fn:t}]}function Nd(e){var r=y.useRef(Sd),t=se(function(){return{eventName:"keydown",fn:function(o){if(o.defaultPrevented||o.keyCode!==vo)return;var i=e.findClosestDraggableId(o);if(!i)return;var s=e.tryGetLock(i,f,{sourceEvent:o});if(!s)return;o.preventDefault();var c=!0,p=s.snapLift();r.current();function f(){c||R(),c=!1,r.current(),n()}r.current=Te(window,Id(p,f),{capture:!0,passive:!1})}}},[e]),n=U(function(){var o={passive:!1,capture:!0};r.current=Te(window,[t],o)},[t]);je(function(){return n(),function(){r.current()}},[n])}var Ft={type:"IDLE"},Ad=120,Pd=.15;function Dd(e){var r=e.cancel,t=e.getPhase;return[{eventName:"orientationchange",fn:r},{eventName:"resize",fn:r},{eventName:"contextmenu",fn:function(a){a.preventDefault()}},{eventName:"keydown",fn:function(a){if(t().type!=="DRAGGING"){r();return}a.keyCode===hn&&a.preventDefault(),r()}},{eventName:St,fn:r}]}function kd(e){var r=e.cancel,t=e.completed,n=e.getPhase;return[{eventName:"touchmove",options:{capture:!1},fn:function(o){var i=n();if(i.type!=="DRAGGING"){r();return}i.hasMoved=!0;var s=o.touches[0],c=s.clientX,p=s.clientY,f={x:c,y:p};o.preventDefault(),i.actions.move(f)}},{eventName:"touchend",fn:function(o){var i=n();if(i.type!=="DRAGGING"){r();return}o.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),t()}},{eventName:"touchcancel",fn:function(o){if(n().type!=="DRAGGING"){r();return}o.preventDefault(),r()}},{eventName:"touchforcechange",fn:function(o){var i=n();i.type==="IDLE"&&R();var s=o.touches[0];if(s){var c=s.force>=Pd;if(c){var p=i.actions.shouldRespectForcePress();if(i.type==="PENDING"){p&&r();return}if(p){if(i.hasMoved){o.preventDefault();return}r();return}o.preventDefault()}}}},{eventName:St,fn:r}]}function jd(e){var r=y.useRef(Ft),t=y.useRef(ar),n=U(function(){return r.current},[]),a=U(function(v){r.current=v},[]),o=se(function(){return{eventName:"touchstart",fn:function(v){if(!v.defaultPrevented){var g=e.findClosestDraggableId(v);if(g){var S=e.tryGetLock(g,s,{sourceEvent:v});if(S){var h=v.touches[0],C=h.clientX,I=h.clientY,D={x:C,y:I};t.current(),d(S,D)}}}}}},[e]),i=U(function(){var v={capture:!0,passive:!1};t.current=Te(window,[o],v)},[o]),s=U(function(){var u=r.current;u.type!=="IDLE"&&(u.type==="PENDING"&&clearTimeout(u.longPressTimerId),a(Ft),t.current(),i())},[i,a]),c=U(function(){var u=r.current;s(),u.type==="DRAGGING"&&u.actions.cancel({shouldBlockNextClick:!0}),u.type==="PENDING"&&u.actions.abort()},[s]),p=U(function(){var v={capture:!0,passive:!1},g={cancel:c,completed:s,getPhase:n},S=Te(window,kd(g),v),h=Te(window,Dd(g),v);t.current=function(){S(),h()}},[c,n,s]),f=U(function(){var v=n();v.type!=="PENDING"&&R();var g=v.actions.fluidLift(v.point);a({type:"DRAGGING",actions:g,hasMoved:!1})},[n,a]),d=U(function(v,g){n().type!=="IDLE"&&R();var S=setTimeout(f,Ad);a({type:"PENDING",point:g,actions:v,longPressTimerId:S}),p()},[p,n,a,f]);je(function(){return i(),function(){t.current();var g=n();g.type==="PENDING"&&(clearTimeout(g.longPressTimerId),a(Ft))}},[n,i,a]),je(function(){var v=Te(window,[{eventName:"touchmove",fn:function(){},options:{capture:!1,passive:!1}}]);return v},[])}var Rd={input:!0,button:!0,textarea:!0,select:!0,option:!0,optgroup:!0,video:!0,audio:!0};function xo(e,r){if(r==null)return!1;var t=!!Rd[r.tagName.toLowerCase()];if(t)return!0;var n=r.getAttribute("contenteditable");return n==="true"||n===""?!0:r===e?!1:xo(e,r.parentElement)}function Td(e,r){var t=r.target;return wt(t)?xo(e,t):!1}var Od=function(e){return Ge(e.getBoundingClientRect()).center};function Bd(e){return e instanceof fo(e).Element}var Md=function(){var e="matches";if(typeof document>"u")return e;var r=[e,"msMatchesSelector","webkitMatchesSelector"],t=lr(r,function(n){return n in Element.prototype});return t||e}();function yo(e,r){return e==null?null:e[Md](r)?e:yo(e.parentElement,r)}function Ld(e,r){return e.closest?e.closest(r):yo(e,r)}function Fd(e){return"["+Sr.contextId+'="'+e+'"]'}function zd(e,r){var t=r.target;if(!Bd(t))return null;var n=Fd(e),a=Ld(t,n);return!a||!wt(a)?null:a}function Gd(e,r){var t=zd(e,r);return t?t.getAttribute(Sr.draggableId):null}function Ud(e,r){var t="["+Kt.contextId+'="'+e+'"]',n=Ba(document.querySelectorAll(t)),a=lr(n,function(o){return o.getAttribute(Kt.id)===r});return!a||!wt(a)?null:a}function $d(e){e.preventDefault()}function ot(e){var r=e.expected,t=e.phase,n=e.isLockActive;return e.shouldWarn,!(!n()||r!==t)}function wo(e){var r=e.lockAPI,t=e.store,n=e.registry,a=e.draggableId;if(r.isClaimed())return!1;var o=n.draggable.findById(a);return!(!o||!o.options.isEnabled||!co(t.getState(),a))}function Hd(e){var r=e.lockAPI,t=e.contextId,n=e.store,a=e.registry,o=e.draggableId,i=e.forceSensorStop,s=e.sourceEvent,c=wo({lockAPI:r,store:n,registry:a,draggableId:o});if(!c)return null;var p=a.draggable.getById(o),f=Ud(t,p.descriptor.id);if(!f||s&&!p.options.canDragInteractiveElements&&Td(f,s))return null;var d=r.claim(i||ar),u="PRE_DRAG";function v(){return p.options.shouldRespectForcePress}function g(){return r.isActive(d)}function S(T,K){ot({expected:T,phase:u,isLockActive:g,shouldWarn:!0})&&n.dispatch(K())}var h=S.bind(null,"DRAGGING");function C(T){function K(){r.release(),u="COMPLETED"}u!=="PRE_DRAG"&&(K(),u!=="PRE_DRAG"&&R()),n.dispatch(Ml(T.liftActionArgs)),u="DRAGGING";function te(J,ne){if(ne===void 0&&(ne={shouldBlockNextClick:!1}),T.cleanup(),ne.shouldBlockNextClick){var _=Te(window,[{eventName:"click",fn:$d,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(_)}K(),n.dispatch(to({reason:J}))}return Y({isActive:function(){return ot({expected:"DRAGGING",phase:u,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:v,drop:function(ne){return te("DROP",ne)},cancel:function(ne){return te("CANCEL",ne)}},T.actions)}function I(T){var K=zr(function(J){h(function(){return ro({client:J})})}),te=C({liftActionArgs:{id:o,clientSelection:T,movementMode:"FLUID"},cleanup:function(){return K.cancel()},actions:{move:K}});return Y({},te,{move:K})}function D(){var T={moveUp:function(){return h(Vl)},moveRight:function(){return h(Kl)},moveDown:function(){return h(ql)},moveLeft:function(){return h(Yl)}};return C({liftActionArgs:{id:o,clientSelection:Od(f),movementMode:"SNAP"},cleanup:ar,actions:T})}function N(){var T=ot({expected:"PRE_DRAG",phase:u,isLockActive:g,shouldWarn:!0});T&&r.release()}var F={isActive:function(){return ot({expected:"PRE_DRAG",phase:u,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:v,fluidLift:I,snapLift:D,abort:N};return F}var Wd=[Cd,Nd,jd];function Vd(e){var r=e.contextId,t=e.store,n=e.registry,a=e.customSensors,o=e.enableDefaultSensors,i=[].concat(o?Wd:[],a||[]),s=y.useState(function(){return ld()})[0],c=U(function(I,D){I.isDragging&&!D.isDragging&&s.tryAbandon()},[s]);je(function(){var I=t.getState(),D=t.subscribe(function(){var N=t.getState();c(I,N),I=N});return D},[s,t,c]),je(function(){return s.tryAbandon},[s.tryAbandon]);for(var p=U(function(C){return wo({lockAPI:s,registry:n,store:t,draggableId:C})},[s,n,t]),f=U(function(C,I,D){return Hd({lockAPI:s,registry:n,contextId:r,store:t,draggableId:C,forceSensorStop:I,sourceEvent:D&&D.sourceEvent?D.sourceEvent:null})},[r,s,n,t]),d=U(function(C){return Gd(r,C)},[r]),u=U(function(C){var I=n.draggable.findById(C);return I?I.options:null},[n.draggable]),v=U(function(){s.isClaimed()&&(s.tryAbandon(),t.getState().phase!=="IDLE"&&t.dispatch(sn()))},[s,t]),g=U(s.isClaimed,[s]),S=se(function(){return{canGetLock:p,tryGetLock:f,findClosestDraggableId:d,findOptionsForDraggable:u,tryReleaseLock:v,isLockClaimed:g}},[p,f,d,u,v,g]),h=0;h<i.length;h++)i[h](S)}var qd=function(r){return{onBeforeCapture:r.onBeforeCapture,onBeforeDragStart:r.onBeforeDragStart,onDragStart:r.onDragStart,onDragEnd:r.onDragEnd,onDragUpdate:r.onDragUpdate}};function Or(e){return e.current||R(),e.current}function Kd(e){var r=e.contextId,t=e.setCallbacks,n=e.sensors,a=e.nonce,o=e.dragHandleUsageInstructions,i=y.useRef(null),s=mo(e),c=U(function(){return qd(s.current)},[s]),p=nd(r),f=sd({contextId:r,text:o}),d=Jc(r,a),u=U(function(J){Or(i).dispatch(J)},[]),v=se(function(){return An({publishWhileDragging:Fl,updateDroppableScroll:Gl,updateDroppableIsEnabled:Ul,updateDroppableIsCombineEnabled:$l,collectionStarting:zl},u)},[u]),g=ed(),S=se(function(){return Pc(g,v)},[g,v]),h=se(function(){return Vc(Y({scrollWindow:Dc,scrollDroppable:S.scrollDroppable},An({move:ro},u)))},[S.scrollDroppable,u]),C=Qc(r),I=se(function(){return Ec({announce:p,autoScroller:h,dimensionMarshal:S,focusMarshal:C,getResponders:c,styleMarshal:d})},[p,h,S,C,c,d]);i.current=I;var D=U(function(){var J=Or(i),ne=J.getState();ne.phase!=="IDLE"&&J.dispatch(sn())},[]),N=U(function(){var J=Or(i).getState();return J.isDragging||J.phase==="DROP_ANIMATING"},[]),F=se(function(){return{isDragging:N,tryAbort:D}},[N,D]);t(F);var T=U(function(J){return co(Or(i).getState(),J)},[]),K=U(function(){return fr(Or(i).getState())},[]),te=se(function(){return{marshal:S,focus:C,contextId:r,canLift:T,isMovementAllowed:K,dragHandleUsageInstructionsId:f,registry:g}},[r,S,f,C,T,K,g]);return Vd({contextId:r,store:I,registry:g,customSensors:n,enableDefaultSensors:e.enableDefaultSensors!==!1}),y.useEffect(function(){return D},[D]),fe.createElement(Ct.Provider,{value:te},fe.createElement(Li,{context:mn,store:I},e.children))}var Yd=0;function Xd(){return se(function(){return""+Yd++},[])}function Jd(e){var r=Xd(),t=e.dragHandleUsageInstructions||st.dragHandleUsageInstructions;return fe.createElement(Ns,null,function(n){return fe.createElement(Kd,{nonce:e.nonce,contextId:r,setCallbacks:n,dragHandleUsageInstructions:t,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd},e.children)})}var Co=function(r){return function(t){return r===t}},_d=Co("scroll"),Qd=Co("auto"),da=function(r,t){return t(r.overflowX)||t(r.overflowY)},Zd=function(r){var t=window.getComputedStyle(r),n={overflowX:t.overflowX,overflowY:t.overflowY};return da(n,_d)||da(n,Qd)},eu=function(){return!1},ru=function e(r){return r==null?null:r===document.body?eu()?r:null:r===document.documentElement?null:Zd(r)?r:e(r.parentElement)},Yt=function(e){return{x:e.scrollLeft,y:e.scrollTop}},tu=function e(r){if(!r)return!1;var t=window.getComputedStyle(r);return t.position==="fixed"?!0:e(r.parentElement)},nu=function(e){var r=ru(e),t=tu(e);return{closestScrollable:r,isFixedOnPage:t}},au=function(e){var r=e.descriptor,t=e.isEnabled,n=e.isCombineEnabled,a=e.isFixedOnPage,o=e.direction,i=e.client,s=e.page,c=e.closest,p=function(){if(!c)return null;var v=c.scrollSize,g=c.client,S=io({scrollHeight:v.scrollHeight,scrollWidth:v.scrollWidth,height:g.paddingBox.height,width:g.paddingBox.width});return{pageMarginBox:c.page.marginBox,frameClient:g,scrollSize:v,shouldClipSubject:c.shouldClipSubject,scroll:{initial:c.scroll,current:c.scroll,max:S,diff:{value:xe,displacement:xe}}}}(),f=o==="vertical"?rn:Ga,d=wr({page:s,withPlaceholder:null,axis:f,frame:p}),u={descriptor:r,isCombineEnabled:n,isFixedOnPage:a,axis:f,isEnabled:t,client:i,page:s,frame:p,subject:d};return u},ou=function(r,t){var n=ka(r);if(!t||r!==t)return n;var a=n.paddingBox.top-t.scrollTop,o=n.paddingBox.left-t.scrollLeft,i=a+t.scrollHeight,s=o+t.scrollWidth,c={top:a,right:s,bottom:i,left:o},p=Jt(c,n.border),f=_t({borderBox:p,margin:n.margin,border:n.border,padding:n.padding});return f},iu=function(e){var r=e.ref,t=e.descriptor,n=e.env,a=e.windowScroll,o=e.direction,i=e.isDropDisabled,s=e.isCombineEnabled,c=e.shouldClipSubject,p=n.closestScrollable,f=ou(r,p),d=dt(f,a),u=function(){if(!p)return null;var g=ka(p),S={scrollHeight:p.scrollHeight,scrollWidth:p.scrollWidth};return{client:g,page:dt(g,a),scroll:Yt(p),scrollSize:S,shouldClipSubject:c}}(),v=au({descriptor:t,isEnabled:!i,isCombineEnabled:s,isFixedOnPage:n.isFixedOnPage,direction:o,client:f,page:d,closest:u});return v},su={passive:!1},lu={passive:!0},ua=function(e){return e.shouldPublishImmediately?su:lu};function vt(e){var r=y.useContext(e);return r||R(),r}var it=function(r){return r&&r.env.closestScrollable||null};function cu(e){var r=y.useRef(null),t=vt(Ct),n=vn("droppable"),a=t.registry,o=t.marshal,i=mo(e),s=se(function(){return{id:e.droppableId,type:e.type,mode:e.mode}},[e.droppableId,e.mode,e.type]),c=y.useRef(s),p=se(function(){return be(function(N,F){r.current||R();var T={x:N,y:F};o.updateDroppableScroll(s.id,T)})},[s.id,o]),f=U(function(){var N=r.current;return!N||!N.env.closestScrollable?xe:Yt(N.env.closestScrollable)},[]),d=U(function(){var N=f();p(N.x,N.y)},[f,p]),u=se(function(){return zr(d)},[d]),v=U(function(){var N=r.current,F=it(N);N&&F||R();var T=N.scrollOptions;if(T.shouldPublishImmediately){d();return}u()},[u,d]),g=U(function(N,F){r.current&&R();var T=i.current,K=T.getDroppableRef();K||R();var te=nu(K),J={ref:K,descriptor:s,env:te,scrollOptions:F};r.current=J;var ne=iu({ref:K,descriptor:s,env:te,windowScroll:N,direction:T.direction,isDropDisabled:T.isDropDisabled,isCombineEnabled:T.isCombineEnabled,shouldClipSubject:!T.ignoreContainerClipping}),_=te.closestScrollable;return _&&(_.setAttribute(ia.contextId,t.contextId),_.addEventListener("scroll",v,ua(J.scrollOptions))),ne},[t.contextId,s,v,i]),S=U(function(){var N=r.current,F=it(N);return N&&F||R(),Yt(F)},[]),h=U(function(){var N=r.current;N||R();var F=it(N);r.current=null,F&&(u.cancel(),F.removeAttribute(ia.contextId),F.removeEventListener("scroll",v,ua(N.scrollOptions)))},[v,u]),C=U(function(N){var F=r.current;F||R();var T=it(F);T||R(),T.scrollTop+=N.y,T.scrollLeft+=N.x},[]),I=se(function(){return{getDimensionAndWatchScroll:g,getScrollWhileDragging:S,dragStopped:h,scroll:C}},[h,g,S,C]),D=se(function(){return{uniqueId:n,descriptor:s,callbacks:I}},[I,s,n]);je(function(){return c.current=D.descriptor,a.droppable.register(D),function(){r.current&&h(),a.droppable.unregister(D)}},[I,s,h,D,o,a.droppable]),je(function(){r.current&&o.updateDroppableIsEnabled(c.current.id,!e.isDropDisabled)},[e.isDropDisabled,o]),je(function(){r.current&&o.updateDroppableIsCombineEnabled(c.current.id,e.isCombineEnabled)},[e.isCombineEnabled,o])}function zt(){}var ga={width:0,height:0,margin:Rs},du=function(r){var t=r.isAnimatingOpenOnMount,n=r.placeholder,a=r.animate;return t||a==="close"?ga:{height:n.client.borderBox.height,width:n.client.borderBox.width,margin:n.client.margin}},uu=function(r){var t=r.isAnimatingOpenOnMount,n=r.placeholder,a=r.animate,o=du({isAnimatingOpenOnMount:t,placeholder:n,animate:a});return{display:n.display,boxSizing:"border-box",width:o.width,height:o.height,marginTop:o.margin.top,marginRight:o.margin.right,marginBottom:o.margin.bottom,marginLeft:o.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:a!=="none"?Fr.placeholder:null}};function gu(e){var r=y.useRef(null),t=U(function(){r.current&&(clearTimeout(r.current),r.current=null)},[]),n=e.animate,a=e.onTransitionEnd,o=e.onClose,i=e.contextId,s=y.useState(e.animate==="open"),c=s[0],p=s[1];y.useEffect(function(){return c?n!=="open"?(t(),p(!1),zt):r.current?zt:(r.current=setTimeout(function(){r.current=null,p(!1)}),t):zt},[n,c,t]);var f=U(function(u){u.propertyName==="height"&&(a(),n==="close"&&o())},[n,o,a]),d=uu({isAnimatingOpenOnMount:c,animate:e.animate,placeholder:e.placeholder});return fe.createElement(e.placeholder.tagName,{style:d,"data-rbd-placeholder-context-id":i,onTransitionEnd:f,ref:e.innerRef})}var pu=fe.memo(gu),bn=fe.createContext(null),fu=function(e){wa(r,e);function r(){for(var n,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.state={isVisible:!!n.props.on,data:n.props.on,animate:n.props.shouldAnimate&&n.props.on?"open":"none"},n.onClose=function(){n.state.animate==="close"&&n.setState({isVisible:!1})},n}r.getDerivedStateFromProps=function(a,o){return a.shouldAnimate?a.on?{isVisible:!0,data:a.on,animate:"open"}:o.isVisible?{isVisible:!0,data:o.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!a.on,data:a.on,animate:"none"}};var t=r.prototype;return t.render=function(){if(!this.state.isVisible)return null;var a={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(a)},r}(fe.PureComponent),pa={dragging:5e3,dropAnimating:4500},mu=function(r,t){return t?Fr.drop(t.duration):r?Fr.snap:Fr.fluid},vu=function(r,t){return r?t?Hr.opacity.drop:Hr.opacity.combining:null},hu=function(r){return r.forceShouldAnimate!=null?r.forceShouldAnimate:r.mode==="SNAP"};function bu(e){var r=e.dimension,t=r.client,n=e.offset,a=e.combineWith,o=e.dropping,i=!!a,s=hu(e),c=!!o,p=c?Vt.drop(n,i):Vt.moveTo(n),f={position:"fixed",top:t.marginBox.top,left:t.marginBox.left,boxSizing:"border-box",width:t.borderBox.width,height:t.borderBox.height,transition:mu(s,o),transform:p,opacity:vu(i,c),zIndex:c?pa.dropAnimating:pa.dragging,pointerEvents:"none"};return f}function xu(e){return{transform:Vt.moveTo(e.offset),transition:e.shouldAnimateDisplacement?null:"none"}}function yu(e){return e.type==="DRAGGING"?bu(e):xu(e)}function wu(e,r,t){t===void 0&&(t=xe);var n=window.getComputedStyle(r),a=r.getBoundingClientRect(),o=Da(a,n),i=dt(o,t),s={client:o,tagName:r.tagName.toLowerCase(),display:n.display},c={x:o.marginBox.width,y:o.marginBox.height},p={descriptor:e,placeholder:s,displaceBy:c,client:o,page:i};return p}function Cu(e){var r=vn("draggable"),t=e.descriptor,n=e.registry,a=e.getDraggableRef,o=e.canDragInteractiveElements,i=e.shouldRespectForcePress,s=e.isEnabled,c=se(function(){return{canDragInteractiveElements:o,shouldRespectForcePress:i,isEnabled:s}},[o,s,i]),p=U(function(v){var g=a();return g||R(),wu(t,g,v)},[t,a]),f=se(function(){return{uniqueId:r,descriptor:t,options:c,getDimension:p}},[t,p,c,r]),d=y.useRef(f),u=y.useRef(!0);je(function(){return n.draggable.register(d.current),function(){return n.draggable.unregister(d.current)}},[n.draggable]),je(function(){if(u.current){u.current=!1;return}var v=d.current;d.current=f,n.draggable.update(f,v)},[f,n.draggable])}function Su(e){e.preventDefault()}function Eu(e){var r=y.useRef(null),t=U(function(J){r.current=J},[]),n=U(function(){return r.current},[]),a=vt(Ct),o=a.contextId,i=a.dragHandleUsageInstructionsId,s=a.registry,c=vt(bn),p=c.type,f=c.droppableId,d=se(function(){return{id:e.draggableId,index:e.index,type:p,droppableId:f}},[e.draggableId,e.index,p,f]),u=e.children,v=e.draggableId,g=e.isEnabled,S=e.shouldRespectForcePress,h=e.canDragInteractiveElements,C=e.isClone,I=e.mapped,D=e.dropAnimationFinished;if(!C){var N=se(function(){return{descriptor:d,registry:s,getDraggableRef:n,canDragInteractiveElements:h,shouldRespectForcePress:S,isEnabled:g}},[d,s,n,h,S,g]);Cu(N)}var F=se(function(){return g?{tabIndex:0,role:"button","aria-describedby":i,"data-rbd-drag-handle-draggable-id":v,"data-rbd-drag-handle-context-id":o,draggable:!1,onDragStart:Su}:null},[o,i,v,g]),T=U(function(J){I.type==="DRAGGING"&&I.dropping&&J.propertyName==="transform"&&D()},[D,I]),K=se(function(){var J=yu(I),ne=I.type==="DRAGGING"&&I.dropping?T:null,_={innerRef:t,draggableProps:{"data-rbd-draggable-context-id":o,"data-rbd-draggable-id":v,style:J,onTransitionEnd:ne},dragHandleProps:F};return _},[o,F,v,I,T,t]),te=se(function(){return{draggableId:d.id,type:d.type,source:{index:d.index,droppableId:d.droppableId}}},[d.droppableId,d.id,d.index,d.type]);return u(K,I.snapshot,te)}var So=function(e,r){return e===r},Eo=function(e){var r=e.combine,t=e.destination;return t?t.droppableId:r?r.droppableId:null},Iu=function(r){return r.combine?r.combine.draggableId:null},Nu=function(r){return r.at&&r.at.type==="COMBINE"?r.at.combine.draggableId:null};function Au(){var e=be(function(a,o){return{x:a,y:o}}),r=be(function(a,o,i,s,c){return{isDragging:!0,isClone:o,isDropAnimating:!!c,dropAnimation:c,mode:a,draggingOver:i,combineWith:s,combineTargetFor:null}}),t=be(function(a,o,i,s,c,p,f){return{mapped:{type:"DRAGGING",dropping:null,draggingOver:c,combineWith:p,mode:o,offset:a,dimension:i,forceShouldAnimate:f,snapshot:r(o,s,c,p,null)}}}),n=function(o,i){if(o.isDragging){if(o.critical.draggable.id!==i.draggableId)return null;var s=o.current.client.offset,c=o.dimensions.draggables[i.draggableId],p=ke(o.impact),f=Nu(o.impact),d=o.forceShouldAnimate;return t(e(s.x,s.y),o.movementMode,c,i.isClone,p,f,d)}if(o.phase==="DROP_ANIMATING"){var u=o.completed;if(u.result.draggableId!==i.draggableId)return null;var v=i.isClone,g=o.dimensions.draggables[i.draggableId],S=u.result,h=S.mode,C=Eo(S),I=Iu(S),D=o.dropDuration,N={duration:D,curve:cn.drop,moveTo:o.newHomeClientOffset,opacity:I?Hr.opacity.drop:null,scale:I?Hr.scale.drop:null};return{mapped:{type:"DRAGGING",offset:o.newHomeClientOffset,dimension:g,dropping:N,draggingOver:C,combineWith:I,mode:h,forceShouldAnimate:null,snapshot:r(h,v,C,I,N)}}}return null};return n}function Io(e){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}var Pu={mapped:{type:"SECONDARY",offset:xe,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:Io(null)}};function Du(){var e=be(function(i,s){return{x:i,y:s}}),r=be(Io),t=be(function(i,s,c){return s===void 0&&(s=null),{mapped:{type:"SECONDARY",offset:i,combineTargetFor:s,shouldAnimateDisplacement:c,snapshot:r(s)}}}),n=function(s){return s?t(xe,s,!0):null},a=function(s,c,p,f){var d=p.displaced.visible[s],u=!!(f.inVirtualList&&f.effected[s]),v=bt(p),g=v&&v.draggableId===s?c:null;if(!d){if(!u)return n(g);if(p.displaced.invisible[s])return null;var S=Er(f.displacedBy.point),h=e(S.x,S.y);return t(h,g,!0)}if(u)return n(g);var C=p.displacedBy.point,I=e(C.x,C.y);return t(I,g,d.shouldAnimate)},o=function(s,c){if(s.isDragging)return s.critical.draggable.id===c.draggableId?null:a(c.draggableId,s.critical.draggable.id,s.impact,s.afterCritical);if(s.phase==="DROP_ANIMATING"){var p=s.completed;return p.result.draggableId===c.draggableId?null:a(c.draggableId,p.result.draggableId,p.impact,p.afterCritical)}return null};return o}var ku=function(){var r=Au(),t=Du(),n=function(o,i){return r(o,i)||t(o,i)||Pu};return n},ju={dropAnimationFinished:no},Ru=Aa(ku,ju,null,{context:mn,pure:!0,areStatePropsEqual:So})(Eu);function No(e){var r=vt(bn),t=r.isUsingCloneFor;return t===e.draggableId&&!e.isClone?null:fe.createElement(Ru,e)}function Tu(e){var r=typeof e.isDragDisabled=="boolean"?!e.isDragDisabled:!0,t=!!e.disableInteractiveElementBlocking,n=!!e.shouldRespectForcePress;return fe.createElement(No,Y({},e,{isClone:!1,isEnabled:r,canDragInteractiveElements:t,shouldRespectForcePress:n}))}function Ou(e){var r=y.useContext(Ct);r||R();var t=r.contextId,n=r.isMovementAllowed,a=y.useRef(null),o=y.useRef(null),i=e.children,s=e.droppableId,c=e.type,p=e.mode,f=e.direction,d=e.ignoreContainerClipping,u=e.isDropDisabled,v=e.isCombineEnabled,g=e.snapshot,S=e.useClone,h=e.updateViewportMaxScroll,C=e.getContainerForClone,I=U(function(){return a.current},[]),D=U(function(_){a.current=_},[]);U(function(){return o.current},[]);var N=U(function(_){o.current=_},[]),F=U(function(){n()&&h({maxScroll:lo()})},[n,h]);cu({droppableId:s,type:c,mode:p,direction:f,isDropDisabled:u,isCombineEnabled:v,ignoreContainerClipping:d,getDroppableRef:I});var T=fe.createElement(fu,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},function(_){var le=_.onClose,O=_.data,V=_.animate;return fe.createElement(pu,{placeholder:O,onClose:le,innerRef:N,animate:V,contextId:t,onTransitionEnd:F})}),K=se(function(){return{innerRef:D,placeholder:T,droppableProps:{"data-rbd-droppable-id":s,"data-rbd-droppable-context-id":t}}},[t,s,T,D]),te=S?S.dragging.draggableId:null,J=se(function(){return{droppableId:s,type:c,isUsingCloneFor:te}},[s,te,c]);function ne(){if(!S)return null;var _=S.dragging,le=S.render,O=fe.createElement(No,{draggableId:_.draggableId,index:_.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},function(V,pe){return le(V,pe,_)});return $o.createPortal(O,C())}return fe.createElement(bn.Provider,{value:J},i(K,g),ne())}var Gt=function(r,t){return r===t.droppable.type},fa=function(r,t){return t.draggables[r.draggable.id]},Bu=function(){var r={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},t=Y({},r,{shouldAnimatePlaceholder:!1}),n=be(function(i){return{draggableId:i.id,type:i.type,source:{index:i.index,droppableId:i.droppableId}}}),a=be(function(i,s,c,p,f,d){var u=f.descriptor.id,v=f.descriptor.droppableId===i;if(v){var g=d?{render:d,dragging:n(f.descriptor)}:null,S={isDraggingOver:c,draggingOverWith:c?u:null,draggingFromThisWith:u,isUsingPlaceholder:!0};return{placeholder:f.placeholder,shouldAnimatePlaceholder:!1,snapshot:S,useClone:g}}if(!s)return t;if(!p)return r;var h={isDraggingOver:c,draggingOverWith:u,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:f.placeholder,shouldAnimatePlaceholder:!0,snapshot:h,useClone:null}}),o=function(s,c){var p=c.droppableId,f=c.type,d=!c.isDropDisabled,u=c.renderClone;if(s.isDragging){var v=s.critical;if(!Gt(f,v))return t;var g=fa(v,s.dimensions),S=ke(s.impact)===p;return a(p,d,S,S,g,u)}if(s.phase==="DROP_ANIMATING"){var h=s.completed;if(!Gt(f,h.critical))return t;var C=fa(h.critical,s.dimensions);return a(p,d,Eo(h.result)===p,ke(h.impact)===p,C,u)}if(s.phase==="IDLE"&&s.completed&&!s.shouldFlush){var I=s.completed;if(!Gt(f,I.critical))return t;var D=ke(I.impact)===p,N=!!(I.impact.at&&I.impact.at.type==="COMBINE"),F=I.critical.droppable.id===p;return D?N?r:t:F?r:t}return t};return o},Mu={updateViewportMaxScroll:Wl};function Lu(){return document.body||R(),document.body}var Fu={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:Lu},Ao=Aa(Bu,Mu,null,{context:mn,pure:!0,areStatePropsEqual:So})(Ou);Ao.defaultProps=Fu;const zu=({elements:e,onReorder:r,onSelect:t,selectedElement:n})=>{const a=o=>{if(!o.destination)return;const i=Array.from(e),[s]=i.splice(o.source.index,1);i.splice(o.destination.index,0,s),r(i)};return l.jsx("div",{className:"bg-white ",children:l.jsx(Jd,{onDragEnd:a,children:l.jsx(Ao,{droppableId:"layers",children:o=>l.jsxs("div",{...o.droppableProps,ref:o.innerRef,className:"space-y-2",children:[e.map((i,s)=>l.jsx(Tu,{draggableId:i.id,index:s,children:c=>l.jsxs("div",{ref:c.innerRef,...c.draggableProps,className:`flex items-center p-2 rounded cursor-pointer ${n===i.id?"bg-purple-100":"hover:bg-gray-100"}`,onClick:()=>t(i.id),children:[l.jsx("div",{...c.dragHandleProps,className:"mr-2",children:l.jsx(ci,{size:16})}),i.type==="image"?l.jsx(Br,{size:16,className:"mr-2"}):l.jsx(Mr,{size:16,className:"mr-2"}),l.jsx("span",{className:"text-sm truncate",children:i.type==="text"?i.content.substring(0,20):`Imagen ${s+1}`})]})},i.id)),o.placeholder]})})})})};function Gu({currentLayoutId:e,onLayoutChange:r}){const[t,n]=y.useState("all"),a={all:{name:"Todos",layouts:Ce},hero:{name:"Hero",layouts:Ce.filter(o=>o.category==="hero")},editorial:{name:"Editorial",layouts:Ce.filter(o=>o.category==="editorial")},storytelling:{name:"Historia",layouts:Ce.filter(o=>o.category==="storytelling")},minimal:{name:"Minimal",layouts:Ce.filter(o=>o.category==="minimal")},creative:{name:"Creativo",layouts:Ce.filter(o=>o.category==="creative")},classic:{name:"Clsico",layouts:Ce.filter(o=>o.category==="classic")}};return Object.keys(a).filter(o=>o==="all"||a[o].layouts.length>0),l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"grid grid-cols-2  gap-3 overflow-x-hidden custom-scroll",children:a[t].layouts.map(o=>l.jsxs("div",{className:`relative group cursor-pointer transition-all duration-200 
                                 hover:shadow-md hover:scale-102
                        `,onClick:()=>r(o.id),children:[l.jsxs("div",{className:"aspect-square relative bg-white rounded-lg p-2 border border-gray-200",children:[l.jsx("div",{className:`w-full h-full grid ${o.template}`,style:{gap:"2px",padding:"4px"},children:Array.from({length:o.cells}).map((i,s)=>{var c,p;return l.jsx("div",{className:`bg-gradient-to-br from-purple-100 to-purple-200 ${(p=(c=o.cellStyles)==null?void 0:c[s])!=null&&p.includes("rounded")?"rounded":"rounded-sm"}`,style:{minHeight:"8px"}},s)})}),e===o.id&&l.jsx("div",{className:"absolute top-1/2 right-1/2 translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-purple-600 rounded-full flex items-center justify-center",children:l.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:l.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),l.jsxs("div",{className:"mt-2 text-center",children:[l.jsx("h4",{className:"text-xs font-medium text-gray-900 truncate",children:o.name}),o.description&&l.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:o.description}),l.jsx("div",{className:"flex items-center justify-center mt-1 space-x-2",children:l.jsxs("span",{className:"text-xs text-gray-400",children:[o.cells," ",o.cells===1?"celda":"celdas"]})})]})]},o.id))}),a[t].layouts.length===0&&l.jsx("div",{className:"text-center py-8 text-gray-500",children:l.jsx("p",{children:"No hay layouts disponibles en esta categora."})})]})}const Uu=({selectedMask:e,onSelect:r,availableMasks:t=[],selectedImage:n})=>{var s,c;const[a,o]=y.useState("Bsicas"),i={};return va.forEach(p=>{i[p.category]||(i[p.category]=[]),(t.includes(p.id)||p.id==="none")&&i[p.category].push(p)}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("div",{className:"grid grid-cols-2 gap-1 bg-gray-100 p-1 rounded-lg",children:Object.keys(i).slice(0,2).map(p=>i[p].length>0&&l.jsx("button",{onClick:()=>o(p),className:`py-1.5 px-2 text-xs rounded-md transition font-medium ${a===p?"bg-white text-purple-700 shadow-sm":"text-gray-600 hover:text-purple-600"}`,children:p},p))}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:(s=i[a])==null?void 0:s.slice(0,6).map(p=>l.jsxs("div",{onClick:()=>r(p.id),className:`cursor-pointer border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all ${e===p.id?"ring-2 ring-purple-500 border-purple-300":"border-gray-200"}`,children:[l.jsx("div",{className:"aspect-square bg-white flex items-center justify-center p-1",children:n!=null&&n.content?l.jsx("img",{src:n.content,alt:p.name,className:`w-full h-full object-cover ${p.class}`}):l.jsx("div",{className:`w-full h-full bg-gray-200 ${p.class}`})}),l.jsx("p",{className:"text-center text-[10px] text-gray-700 p-1 truncate",children:p.name})]},p.id))}),((c=i[a])==null?void 0:c.length)>6&&l.jsxs("button",{className:"w-full py-2 text-xs text-purple-600 hover:text-purple-700 border border-purple-200 rounded-lg hover:bg-purple-50 transition",children:["Ver ms mscaras (",i[a].length-6," ms)"]})]})},$u=[{name:"Arial",value:"Arial"},{name:"Times New Roman",value:"'Times New Roman'"},{name:"Helvetica",value:"Helvetica"},{name:"Courier New",value:"'Courier New'"},{name:"Georgia",value:"Georgia"},{name:"Verdana",value:"Verdana"},{name:"Impact",value:"Impact"},{name:"Roboto",value:"'Roboto', sans-serif"},{name:"Open Sans",value:"'Open Sans', sans-serif"},{name:"Lato",value:"'Lato', sans-serif"},{name:"Pacifico (Cursiva)",value:"'Pacifico', cursive"},{name:"Lobster (Estilo Poster)",value:"'Lobster', cursive"},{name:"Indie Flower (Manuscrita)",value:"'Indie Flower', cursive"},{name:"Permanent Marker (Rotulador)",value:"'Permanent Marker', cursive"},{name:"Dancing Script (Elegante)",value:"'Dancing Script', cursive"},{name:"Shadows Into Light (Dibujada)",value:"'Shadows Into Light', cursive"},{name:"Amatic SC (Minimalista)",value:"'Amatic SC', cursive"},{name:"Handlee (Natural)",value:"'Handlee', cursive"},{name:"Caveat (Caligrfica)",value:"'Caveat', cursive"},{name:"Kalam (Pincel)",value:"'Kalam', cursive"}],Hu=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","32px","36px","42px","48px","64px","72px"],Wu=[{label:"Normal",value:"none"},{label:"MAYSCULAS",value:"uppercase"},{label:"minsculas",value:"lowercase"},{label:"Capitalizado",value:"capitalize"}],Vu=[{color:"#000000",name:"Negro"},{color:"#ffffff",name:"Blanco"},{color:"#f43f5e",name:"Rojo"},{color:"#22c55e",name:"Verde"},{color:"#3b82f6",name:"Azul"},{color:"#eab308",name:"Amarillo"},{color:"#06b6d4",name:"Cian"},{color:"#d946ef",name:"Magenta"},{color:"#6b7280",name:"Gris"},{color:"#a855f7",name:"Prpura"},{color:"#ec4899",name:"Rosa"},{color:"#f97316",name:"Naranja"},{color:"#0f172a",name:"Azul oscuro"},{color:"#7c2d12",name:"Marrn"},{color:"#14532d",name:"Verde oscuro"},{color:"#4c1d95",name:"Violeta"},{color:"#1e293b",name:"Gris oscuro"},{color:"#fef3c7",name:"Crema"}],qu=[{color:"transparent",name:"Transparente"},{color:"#ffffff",name:"Blanco"},{color:"#f8fafc",name:"Gris claro"},{color:"#f1f5f9",name:"Plata"},{color:"#fef3c7",name:"Crema"},{color:"#ffedd5",name:"Melocotn"},{color:"#fee2e2",name:"Rosa claro"},{color:"#dbeafe",name:"Azul claro"},{color:"#dcfce7",name:"Verde claro"},{color:"#f3e8ff",name:"Lavanda"}],Ku=[{label:"Ninguno",value:"none"},{label:"Slido",value:"solid"},{label:"Punteado",value:"dotted"},{label:"Discontinuo",value:"dashed"},{label:"Doble",value:"double"},{label:"Acanalado",value:"groove"}],Yu=({element:e,onUpdate:r,onClose:t})=>{var me,he,G,Ae,ve,Ue,ye,Ne,Ve,Be,_e,Me,qe,Ke,cr,Ye,Qe,dr,$e,Ze,vr,qr,Kr,Yr,Ar,er,Pr,Xe,Dr,Xr,Jr,kr,_r,Qr,hr,br,xr,Le,He,Zr,rr;const[n,a]=y.useState(!1),[o,i]=y.useState(!1),[s,c]=y.useState(!1),[p,f]=y.useState(!1),[d,u]=y.useState(!1),[v,g]=y.useState(!1),[S,h]=y.useState(!1),[C,I]=y.useState(!1),[D,N]=y.useState("basic"),[F,T]=y.useState(((me=e==null?void 0:e.style)==null?void 0:me.color)||"#000000"),[K,te]=y.useState(((he=e==null?void 0:e.style)==null?void 0:he.backgroundColor)||"transparent"),J=y.useRef(null),ne=y.useRef(null),_=y.useRef(null),le=y.useRef(null),O=y.useRef(null),V=y.useRef(null),pe=y.useRef(null);y.useEffect(()=>{function A(ee){J.current&&!J.current.contains(ee.target)&&a(!1),ne.current&&!ne.current.contains(ee.target)&&i(!1),_.current&&!_.current.contains(ee.target)&&f(!1),le.current&&!le.current.contains(ee.target)&&u(!1),O.current&&!O.current.contains(ee.target)&&g(!1),V.current&&!V.current.contains(ee.target)&&c(!1),pe.current&&!pe.current.contains(ee.target)&&h(!1)}return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[]);const k=(A,ee)=>{r({style:{...e==null?void 0:e.style,[A]:ee}})},Q=(A,ee,Fe)=>{var tr;r({style:{...e==null?void 0:e.style,[A]:((tr=e==null?void 0:e.style)==null?void 0:tr[A])===ee?Fe:ee}})},ue=(A,ee)=>{k(A,ee)};if(!e)return null;const Z=({active:A,onClick:ee,icon:Fe,title:tr,className:nr=""})=>l.jsx("button",{type:"button",className:`p-1.5 rounded-sm transition-colors ${A?"bg-gray-200 text-gray-900":"text-gray-700 hover:bg-gray-100"} ${nr}`,onClick:ee,title:tr,children:Fe}),oe=({onClick:A,icon:ee,text:Fe,isOpen:tr,title:nr})=>l.jsxs("button",{type:"button",className:`flex items-center gap-1 px-2 py-1.5 rounded-md border ${tr?"bg-gray-100 border-gray-300":"border-gray-200 hover:bg-gray-50"}`,onClick:A,title:nr,children:[ee&&l.jsx("span",{className:"flex-shrink-0",children:ee}),Fe&&l.jsx("span",{className:"text-sm truncate",children:Fe}),l.jsx(Ko,{className:"h-3.5 w-3.5 opacity-70"})]});return l.jsx("div",{className:"  bg-white  rounded-lg shadow-sm px-4  border-gray-200  z-50 transition-all duration-200",children:l.jsxs("div",{className:"w-full ",children:[l.jsxs("div",{className:"flex items-center justify-between mb-1",children:[l.jsxs("h3",{className:"text-sm font-medium flex items-center gap-1.5",children:[l.jsx(Mr,{className:"h-4 w-4"}),"Formato de texto"]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("button",{className:"p-1 rounded-md hover:bg-gray-100",onClick:()=>I(!C),title:C?"Modo compacto":"Modo expandido",children:C?l.jsx(Ci,{className:"h-4 w-4"}):l.jsx(wi,{className:"h-4 w-4"})}),l.jsx("button",{className:"p-1 rounded-md hover:bg-gray-100",onClick:t,title:"Cerrar",children:l.jsx(Vo,{className:"h-4 w-4"})})]})]}),C&&l.jsxs("div",{className:"flex border-b mb-2",children:[l.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${D==="basic"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>N("basic"),children:"Bsico"}),l.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${D==="paragraph"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>N("paragraph"),children:"Prrafo"}),l.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${D==="advanced"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>N("advanced"),children:"Avanzado"})]}),(D==="basic"||!C)&&l.jsxs("div",{className:"flex flex-wrap gap-1.5 items-center",children:[l.jsx("div",{className:"relative",ref:_,children:l.jsx("select",{className:"px-2 py-1 border rounded-md text-sm",value:((G=e.style)==null?void 0:G.fontFamily)||"Arial",onChange:A=>{k("fontFamily",A.target.value)},children:$u.map(A=>l.jsx("option",{value:A.value,style:{fontFamily:A.value},children:A.name},A.value))})}),l.jsxs("div",{className:"relative",ref:le,children:[l.jsx(oe,{onClick:()=>u(!d),text:((Ae=e.style)==null?void 0:Ae.fontSize)||"16px",isOpen:d,title:"Tamao de fuente"}),d&&l.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] max-h-60 overflow-y-auto w-24",children:Hu.map(A=>l.jsx("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm",onClick:()=>{k("fontSize",A),u(!1)},children:A},A))})]}),l.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[l.jsx(Z,{active:((ve=e.style)==null?void 0:ve.fontWeight)==="bold",onClick:()=>Q("fontWeight","bold","normal"),icon:l.jsx(oi,{className:"h-4 w-4"}),title:"Negrita"}),l.jsx(Z,{active:((Ue=e.style)==null?void 0:Ue.fontStyle)==="italic",onClick:()=>Q("fontStyle","italic","normal"),icon:l.jsx(hi,{className:"h-4 w-4"}),title:"Cursiva"}),l.jsx(Z,{active:((ye=e.style)==null?void 0:ye.textDecoration)==="underline",onClick:()=>Q("textDecoration","underline","none"),icon:l.jsx(ji,{className:"h-4 w-4"}),title:"Subrayado"}),l.jsx(Z,{active:((Ne=e.style)==null?void 0:Ne.textDecoration)==="line-through",onClick:()=>Q("textDecoration","line-through","none"),icon:l.jsx(Pi,{className:"h-4 w-4"}),title:"Tachado"})]}),l.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[l.jsx(Z,{active:((Ve=e.style)==null?void 0:Ve.textAlign)==="left",onClick:()=>k("textAlign","left"),icon:l.jsx(ni,{className:"h-4 w-4"}),title:"Alinear a la izquierda"}),l.jsx(Z,{active:((Be=e.style)==null?void 0:Be.textAlign)==="center",onClick:()=>k("textAlign","center"),icon:l.jsx(ri,{className:"h-4 w-4"}),title:"Centrar"}),l.jsx(Z,{active:((_e=e.style)==null?void 0:_e.textAlign)==="right",onClick:()=>k("textAlign","right"),icon:l.jsx(ai,{className:"h-4 w-4"}),title:"Alinear a la derecha"}),l.jsx(Z,{active:((Me=e.style)==null?void 0:Me.textAlign)==="justify",onClick:()=>k("textAlign","justify"),icon:l.jsx(ti,{className:"h-4 w-4"}),title:"Justificar"})]}),l.jsxs("div",{className:"relative",ref:J,children:[l.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>a(!n),title:"Color de texto",children:[l.jsx("div",{className:"w-4 h-4 rounded-sm border",style:{backgroundColor:F}}),l.jsx(qo,{className:"h-4 w-4"})]}),n&&l.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-xs font-medium",children:"Color personalizado"}),l.jsx("div",{className:"w-6 h-6 rounded-md border",style:{backgroundColor:F}})]}),l.jsx("input",{type:"color",value:F,onChange:A=>{T(A.target.value),k("color",A.target.value)},className:"w-full h-8 cursor-pointer"}),l.jsxs("div",{children:[l.jsx("div",{className:"text-xs font-medium mb-1.5",children:"Colores predefinidos"}),l.jsx("div",{className:"grid grid-cols-6 gap-1.5",children:Vu.map(A=>l.jsx("button",{type:"button",className:`w-8 h-8 rounded-md cursor-pointer border transition-all hover:scale-110 ${F===A.color?"ring-2 ring-offset-1 ring-blue-500":""}`,style:{backgroundColor:A.color},onClick:()=>{T(A.color),k("color",A.color)},title:A.name},A.color))})]})]})})]}),l.jsxs("div",{className:"relative",ref:ne,children:[l.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>i(!o),title:"Color de fondo",children:[l.jsx("div",{className:"w-4 h-4 rounded-sm border",style:{backgroundColor:K,backgroundImage:K==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"}}),l.jsx(Si,{className:"h-4 w-4"})]}),o&&l.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-xs font-medium",children:"Color de fondo personalizado"}),l.jsx("div",{className:"w-6 h-6 rounded-md border",style:{backgroundColor:K,backgroundImage:K==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"}})]}),l.jsx("input",{type:"color",value:K==="transparent"?"#ffffff":K,onChange:A=>{te(A.target.value),k("backgroundColor",A.target.value)},className:"w-full h-8 cursor-pointer"}),l.jsxs("div",{children:[l.jsx("div",{className:"text-xs font-medium mb-1.5",children:"Fondos predefinidos"}),l.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:qu.map(A=>l.jsx("button",{type:"button",className:`w-10 h-10 rounded-md cursor-pointer border transition-all hover:scale-110 ${K===A.color?"ring-2 ring-offset-1 ring-blue-500":""}`,style:{backgroundColor:A.color,backgroundImage:A.color==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"},onClick:()=>{te(A.color),k("backgroundColor",A.color)},title:A.name},A.color))})]})]})})]}),l.jsxs("div",{className:"relative",ref:O,children:[l.jsx("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>g(!v),title:"Transformacin de texto",children:l.jsx(si,{className:"h-4 w-4"})}),v&&l.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] w-48",children:Wu.map(A=>{var ee;return l.jsx("button",{className:`w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm ${((ee=e.style)==null?void 0:ee.textTransform)===A.value?"bg-gray-100":""}`,style:{textTransform:A.value},onClick:()=>{k("textTransform",A.value),g(!1)},children:A.label},A.value)})})]}),l.jsxs("div",{className:"relative",ref:pe,children:[l.jsx("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>h(!S),title:"Encabezados",children:l.jsx(Mr,{className:"h-4 w-4"})}),S&&l.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-10 w-48",children:[l.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{k("fontSize","32px"),k("fontWeight","bold"),h(!1)},children:[l.jsx(di,{className:"h-4 w-4"})," ","Encabezado 1"]}),l.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{k("fontSize","24px"),k("fontWeight","bold"),h(!1)},children:[l.jsx(ui,{className:"h-4 w-4"})," ","Encabezado 2"]}),l.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{k("fontSize","20px"),k("fontWeight","bold"),h(!1)},children:[l.jsx(gi,{className:"h-4 w-4"})," ","Encabezado 3"]}),l.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{k("fontSize","16px"),k("fontWeight","bold"),h(!1)},children:[l.jsx(pi,{className:"h-4 w-4"})," ","Encabezado 4"]}),l.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{k("fontSize","16px"),k("fontWeight","normal"),h(!1)},children:[l.jsx(Mr,{className:"h-4 w-4"})," Prrafo normal"]})]})]}),l.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[l.jsx(Z,{active:((qe=e.style)==null?void 0:qe.verticalAlign)==="super",onClick:()=>Q("verticalAlign","super","baseline"),icon:l.jsx(ki,{className:"h-4 w-4"}),title:"Superndice"}),l.jsx(Z,{active:((Ke=e.style)==null?void 0:Ke.verticalAlign)==="sub",onClick:()=>Q("verticalAlign","sub","baseline"),icon:l.jsx(Di,{className:"h-4 w-4"}),title:"Subndice"})]})]}),C&&D==="paragraph"&&l.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-2",children:[l.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[l.jsx(Z,{active:((cr=e.style)==null?void 0:cr.listStyleType)==="disc",onClick:()=>{var A;return k("listStyleType",((A=e.style)==null?void 0:A.listStyleType)==="disc"?"none":"disc")},icon:l.jsx(xi,{className:"h-4 w-4"}),title:"Lista con vietas"}),l.jsx(Z,{active:((Ye=e.style)==null?void 0:Ye.listStyleType)==="decimal",onClick:()=>{var A;return k("listStyleType",((A=e.style)==null?void 0:A.listStyleType)==="decimal"?"none":"decimal")},icon:l.jsx(bi,{className:"h-4 w-4"}),title:"Lista numerada"})]}),l.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[l.jsx(Z,{onClick:()=>{var ee;const A=Number.parseInt(((ee=e.style)==null?void 0:ee.textIndent)||"0");k("textIndent",`${A+20}px`)},icon:l.jsx(vi,{className:"h-4 w-4"}),title:"Aumentar sangra"}),l.jsx(Z,{onClick:()=>{var ee;const A=Number.parseInt(((ee=e.style)==null?void 0:ee.textIndent)||"0");A>=20&&k("textIndent",`${A-20}px`)},icon:l.jsx(mi,{className:"h-4 w-4"}),title:"Disminuir sangra"})]}),l.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[l.jsx("span",{className:"text-xs font-medium",children:"Altura de lnea:"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(Rn,{className:"h-3 w-3 text-gray-500"}),l.jsx("input",{type:"range",min:"1",max:"3",step:"0.1",value:Number.parseFloat(((Qe=e.style)==null?void 0:Qe.lineHeight)||"1.5"),onChange:A=>ue("lineHeight",A.target.value),className:"w-24"}),l.jsx(Tn,{className:"h-3 w-3 text-gray-500"})]}),l.jsx("span",{className:"text-xs",children:((dr=e.style)==null?void 0:dr.lineHeight)||"1.5"})]}),l.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[l.jsx("span",{className:"text-xs font-medium",children:"Espaciado:"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(Rn,{className:"h-3 w-3 text-gray-500"}),l.jsx("input",{type:"range",min:"-2",max:"10",step:"1",value:Number.parseInt((($e=e.style)==null?void 0:$e.letterSpacing)||"0"),onChange:A=>ue("letterSpacing",`${A.target.value}px`),className:"w-24"}),l.jsx(Tn,{className:"h-3 w-3 text-gray-500"})]}),l.jsx("span",{className:"text-xs",children:((Ze=e.style)==null?void 0:Ze.letterSpacing)||"0px"})]}),l.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[l.jsx(Z,{active:((vr=e.style)==null?void 0:vr.fontStyle)==="italic"&&((qr=e.style)==null?void 0:qr.paddingLeft)==="20px"&&((Kr=e.style)==null?void 0:Kr.borderLeft)==="4px solid #ccc",onClick:()=>{var A,ee,Fe;((A=e.style)==null?void 0:A.fontStyle)==="italic"&&((ee=e.style)==null?void 0:ee.paddingLeft)==="20px"&&((Fe=e.style)==null?void 0:Fe.borderLeft)==="4px solid #ccc"?(k("fontStyle","normal"),k("paddingLeft","0"),k("borderLeft","none")):(k("fontStyle","italic"),k("paddingLeft","20px"),k("borderLeft","4px solid #ccc"))},icon:l.jsx(Ii,{className:"h-4 w-4"}),title:"Formato de cita"}),l.jsx(Z,{active:((Yr=e.style)==null?void 0:Yr.fontFamily)==="'Courier New', monospace"&&((Ar=e.style)==null?void 0:Ar.backgroundColor)==="#f5f5f5"&&((er=e.style)==null?void 0:er.padding)==="2px 4px",onClick:()=>{var A,ee;((A=e.style)==null?void 0:A.fontFamily)==="'Courier New', monospace"&&((ee=e.style)==null?void 0:ee.backgroundColor)==="#f5f5f5"?(k("fontFamily","Arial, sans-serif"),k("backgroundColor","transparent"),k("padding","0")):(k("fontFamily","'Courier New', monospace"),k("backgroundColor","#f5f5f5"),k("padding","2px 4px"))},icon:l.jsx(li,{className:"h-4 w-4"}),title:"Formato de cdigo"})]})]}),C&&D==="advanced"&&l.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-2",children:[l.jsxs("div",{className:"relative",ref:V,children:[l.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>c(!s),title:"Opciones de borde",children:[l.jsx(Ai,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Bordes"})]}),s&&l.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-xs font-medium block mb-1",children:"Estilo de borde"}),l.jsx("select",{className:"w-full p-1.5 border rounded-md text-sm",value:((Pr=e.style)==null?void 0:Pr.borderStyle)||"none",onChange:A=>k("borderStyle",A.target.value),children:Ku.map(A=>l.jsx("option",{value:A.value,children:A.label},A.value))})]}),((Xe=e.style)==null?void 0:Xe.borderStyle)&&((Dr=e.style)==null?void 0:Dr.borderStyle)!=="none"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-xs font-medium block mb-1",children:"Ancho de borde"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:Number.parseInt(((Xr=e.style)==null?void 0:Xr.borderWidth)||"1"),onChange:A=>k("borderWidth",`${A.target.value}px`),className:"flex-1"}),l.jsx("span",{className:"text-xs",children:((Jr=e.style)==null?void 0:Jr.borderWidth)||"1px"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-xs font-medium block mb-1",children:"Color de borde"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"color",value:((kr=e.style)==null?void 0:kr.borderColor)||"#000000",onChange:A=>k("borderColor",A.target.value),className:"w-8 h-8"}),l.jsx("div",{className:"grid grid-cols-5 gap-1 flex-1",children:["#000000","#cccccc","#ff0000","#0000ff","#00ff00"].map(A=>l.jsx("button",{type:"button",className:"w-6 h-6 rounded-sm border",style:{backgroundColor:A},onClick:()=>k("borderColor",A)},A))})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-xs font-medium block mb-1",children:"Radio de borde"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:Number.parseInt(((_r=e.style)==null?void 0:_r.borderRadius)||"0"),onChange:A=>k("borderRadius",`${A.target.value}px`),className:"flex-1"}),l.jsx("span",{className:"text-xs",children:((Qr=e.style)==null?void 0:Qr.borderRadius)||"0px"})]})]})]})]})})]}),l.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[l.jsx("span",{className:"text-xs font-medium",children:"Sombra:"}),l.jsx("button",{className:`px-2 py-1 text-xs rounded ${(hr=e.style)!=null&&hr.textShadow?"bg-blue-100 text-blue-700":"bg-gray-100"}`,onClick:()=>{var A;(A=e.style)!=null&&A.textShadow?k("textShadow",""):k("textShadow","1px 1px 2px rgba(0,0,0,0.3)")},children:(br=e.style)!=null&&br.textShadow?"Quitar":"Aadir"}),((xr=e.style)==null?void 0:xr.textShadow)&&l.jsxs("select",{className:"text-xs p-1 border rounded",value:(Le=e.style)==null?void 0:Le.textShadow,onChange:A=>k("textShadow",A.target.value),children:[l.jsx("option",{value:"1px 1px 2px rgba(0,0,0,0.3)",children:"Suave"}),l.jsx("option",{value:"2px 2px 4px rgba(0,0,0,0.4)",children:"Medio"}),l.jsx("option",{value:"3px 3px 6px rgba(0,0,0,0.5)",children:"Fuerte"}),l.jsx("option",{value:"0 0 5px rgba(0,0,255,0.5)",children:"Resplandor azul"}),l.jsx("option",{value:"0 0 5px rgba(255,0,0,0.5)",children:"Resplandor rojo"})]})]}),l.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[l.jsx("span",{className:"text-xs font-medium",children:"Opacidad:"}),l.jsx("div",{className:"flex items-center gap-1",children:l.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:Number.parseFloat(((He=e.style)==null?void 0:He.opacity)||"1"),onChange:A=>ue("opacity",A.target.value),className:"w-24"})}),l.jsxs("span",{className:"text-xs",children:[Math.round(Number.parseFloat(((Zr=e.style)==null?void 0:Zr.opacity)||"1")*100),"%"]})]}),l.jsx("div",{className:"flex items-center gap-1",children:l.jsxs("button",{className:`flex items-center gap-1 px-2 py-1.5 rounded-md border ${((rr=e.style)==null?void 0:rr.backgroundColor)==="#ffff00"?"bg-yellow-100":"bg-white hover:bg-gray-50"}`,onClick:()=>{var A;((A=e.style)==null?void 0:A.backgroundColor)==="#ffff00"?k("backgroundColor","transparent"):k("backgroundColor","#ffff00")},title:"Resaltar texto",children:[l.jsx(fi,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Resaltar"})]})}),l.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md ml-auto",children:[l.jsx(Z,{onClick:()=>{alert("Funcin deshacer (implementar)")},icon:l.jsx(ha,{className:"h-4 w-4"}),title:"Deshacer"}),l.jsx(Z,{onClick:()=>{alert("Funcin rehacer (implementar)")},icon:l.jsx(Ni,{className:"h-4 w-4"}),title:"Rehacer"})]})]})]})})},Xu=({currentSize:e,onSizeChange:r,presetData:t,workspaceDimensions:n})=>((()=>{if(t!=null&&t.canvas_config){const o=typeof t.canvas_config=="string"?JSON.parse(t.canvas_config):t.canvas_config;let i=o.width,s=o.height;return{width:i,height:s,unit:"cm"}}return null})(),l.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 h-full items-center",children:n&&l.jsx("div",{className:"text-sm customtext-neutral-dark font-medium ml-2",children:n.originalWidth&&l.jsxs("div",{children:["Dimensiones: ",n.originalWidth," cm x",n.originalHeight," cm"]})})})),Ju=async(e,r,t)=>{var n;try{console.log(" [SAVE] Subiendo imagen al backend:",r);const[a,o]=e.split(","),i=((n=a.match(/data:image\/(\w+)/))==null?void 0:n[1])||"png",s=new FormData,c=atob(o),p=new Array(c.length);for(let g=0;g<c.length;g++)p[g]=c.charCodeAt(g);const f=new Uint8Array(p),d=new Blob([f],{type:`image/${i}`});s.append("image",d,`element_${r}.${i}`),s.append("project_id",t),s.append("element_id",r);const u=await fetch("/api/canvas/projects/upload-image",{method:"POST",headers:{Accept:"application/json"},credentials:"include",body:s});if(!u.ok)throw new Error("Error al subir imagen al servidor");const v=await u.json();return console.log(" [SAVE] Imagen subida exitosamente:",v.url),v.url}catch(a){throw console.error(" [SAVE] Error subiendo imagen:",a),a}},_u=async(e,r)=>{var o,i;console.log(" [SAVE] Procesando imgenes para guardado...");const t=[];let n=0,a=0;for(const s of e)for(const c of s.cells||[])for(const p of c.elements||[])p.type==="image"&&((o=p.content)!=null&&o.startsWith("data:image/"))&&n++;console.log(` [SAVE] Total de imgenes base64 a procesar: ${n}`);for(const s of e){const c={...s};c.cells=[];for(const p of s.cells||[]){const f={...p};f.elements=[];for(const d of p.elements||[]){const u={...d};if(d.type==="image"&&((i=d.content)!=null&&i.startsWith("data:image/")))try{const v=await Ju(d.content,d.id,r);u.content=v,u.isUploaded=!0,a++,console.log(` [SAVE] Imagen ${a}/${n} procesada`)}catch(v){console.error(" [SAVE] Error procesando imagen:",d.id,v),u.uploadError=v.message}f.elements.push(u)}c.cells.push(f)}t.push(c)}return console.log(` [SAVE] Procesamiento completado: ${a}/${n} imgenes subidas`),t},ma=async(e,r,t,n,a,o,i=!1)=>{try{if(!(r!=null&&r.id))throw new Error("No se encontr el ID del proyecto");console.log(` [SAVE] Iniciando ${i?"auto-guardado":"guardado manual"}...`);let s=e;i||(s=await _u(e,r.id));const c={pages:s,projectInfo:{id:r.id,item_id:t==null?void 0:t.id,title:t==null?void 0:t.title,preset_id:n==null?void 0:n.id},workspace:{width:a.width,height:a.height,scale:a.scale},meta:{savedAt:new Date().toISOString(),version:"2.0",isAutoSave:i,totalPages:e.length}},p=i?"save-progress":"save",f=await fetch(`/api/canvas/projects/${r.id}/${p}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({design_data:c,thumbnails:o})});if(!f.ok){const u=await f.json().catch(()=>({}));throw new Error(u.message||"Error al guardar el proyecto")}const d=await f.json();return console.log(` [SAVE] ${i?"Auto-guardado":"Guardado"} exitoso:`,d),{success:!0,data:d}}catch(s){return console.error(` [SAVE] Error en ${i?"auto-guardado":"guardado"}:`,s),{success:!1,error:s.message}}},Qu=(e,r,t,n,a,o)=>{const[i,s]=y.useState("saved"),[c,p]=y.useState(null),[f,d]=y.useState(null),[u,v]=y.useState(null),[g,S]=y.useState(!1),[h,C]=y.useState(navigator.onLine),I=y.useRef(null),D=y.useRef(null),N=y.useRef(null),F=y.useRef(!1),T=y.useRef(null),K=15e3,te=2e3,J=5e3,ne=y.useCallback((k,Q)=>{try{const ue={pages:k.map(Z=>{var oe;return{id:Z.id,layout:Z.layout,cells:((oe=Z.cells)==null?void 0:oe.map(me=>{var he;return{id:me.id,elements:((he=me.elements)==null?void 0:he.map(G=>{var Ae;return{id:G.id,type:G.type,content:G.type==="image"&&((Ae=G.content)!=null&&Ae.startsWith("data:image/"))?`[IMAGE_${G.content.length}]`:G.content,position:G.position,size:G.size,style:G.style,filters:G.filters,rotation:G.rotation}}))||[]}}))||[]}})||[],workspace:{width:Q==null?void 0:Q.width,height:Q==null?void 0:Q.height}};return btoa(JSON.stringify(ue)).substring(0,32)}catch(ue){return console.warn(" [AUTO-SAVE] Error generando hash:",ue),Date.now().toString()}},[]),_=y.useCallback(()=>`album_editor_autosave_${(r==null?void 0:r.id)||"draft"}`,[r==null?void 0:r.id]),le=y.useCallback(k=>{try{const Q=_(),ue={...k,savedAt:Date.now(),version:"2.1"};return localStorage.setItem(Q,JSON.stringify(ue)),console.log(" [AUTO-SAVE] Guardado en localStorage"),!0}catch(Q){return console.error(" [AUTO-SAVE] Error guardando en localStorage:",Q),!1}},[_]),O=y.useCallback(()=>{var k;try{const Q=_(),ue=localStorage.getItem(Q);if(ue){const Z=JSON.parse(ue);return console.log(" [AUTO-SAVE] Datos encontrados en localStorage:",{pages:(k=Z.pages)==null?void 0:k.length,savedAt:new Date(Z.savedAt).toLocaleString()}),Z}}catch(Q){console.error(" [AUTO-SAVE] Error cargando desde localStorage:",Q)}return null},[_]),V=y.useCallback(async(k=!1)=>{if(F.current&&!k){console.log(" [AUTO-SAVE] Guardado en progreso, saltando...");return}if(!(r!=null&&r.id)||!e||e.length===0){console.log(" [AUTO-SAVE] Datos insuficientes para guardar");return}const Q=ne(e,a);if(!k&&Q===N.current){console.log(" [AUTO-SAVE] Sin cambios detectados, saltando guardado");return}try{F.current=!0,s("saving"),v(null);const ue={pages:e,projectInfo:{id:r.id,item_id:t==null?void 0:t.id,title:t==null?void 0:t.title,preset_id:n==null?void 0:n.id},workspace:a,meta:{savedAt:new Date().toISOString(),version:"2.1",contentHash:Q}};if(le(ue),h){const Z=await ma(e,r,t,n,a,o,!0);if(Z.success)N.current=Q,d(new Date),s("saved"),S(!1),console.log(" [AUTO-SAVE] Guardado exitoso en base de datos");else throw new Error(Z.error)}else console.log(" [AUTO-SAVE] Sin conexin, solo guardado en localStorage"),s("pending"),S(!0)}catch(ue){console.error(" [AUTO-SAVE] Error:",ue),v(ue.message),s("error"),h&&(T.current=setTimeout(()=>{console.log(" [AUTO-SAVE] Reintentando guardado..."),V(!0)},J))}finally{F.current=!1}},[e,r,t,n,a,o,ne,le,h]),pe=y.useCallback(async()=>{try{s("saving");const k=await ma(e,r,t,n,a,o,!1);if(k.success){const Q=ne(e,a);N.current=Q,p(new Date),s("saved"),S(!1),Pe.success(" Proyecto guardado exitosamente"),console.log(" [MANUAL-SAVE] Guardado manual exitoso")}else v(k.error),s("error"),Pe.error(` Error al guardar: ${k.error}`);return k.success}catch(k){return console.error(" [MANUAL-SAVE] Error:",k),v(k.message),s("error"),Pe.error(` Error inesperado: ${k.message}`),!1}},[e,r,t,n,a,o,ne]);return y.useEffect(()=>{if(!(r!=null&&r.id)||!e||e.length===0)return;const k=ne(e,a);return N.current&&k!==N.current?(console.log(" [AUTO-SAVE] Cambios detectados, programando guardado..."),S(!0),s("pending"),D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{V()},te)):N.current||(N.current=k),()=>{D.current&&clearTimeout(D.current)}},[e,a,r==null?void 0:r.id,ne,V]),y.useEffect(()=>{if(r!=null&&r.id)return I.current&&clearInterval(I.current),I.current=setInterval(()=>{g&&(console.log(" [AUTO-SAVE] Auto-save peridico activado"),V())},K),()=>{I.current&&clearInterval(I.current)}},[r==null?void 0:r.id,g,V]),y.useEffect(()=>{const k=()=>{console.log(" [AUTO-SAVE] Conexin restaurada"),C(!0),g&&setTimeout(()=>V(!0),1e3)},Q=()=>{console.log(" [AUTO-SAVE] Conexin perdida"),C(!1)};return window.addEventListener("online",k),window.addEventListener("offline",Q),()=>{window.removeEventListener("online",k),window.removeEventListener("offline",Q)}},[g,V]),y.useEffect(()=>{const k=Q=>{if(g){const ue={pages:e,projectInfo:{id:r.id},workspace:a,meta:{savedAt:new Date().toISOString()}};return le(ue),Q.preventDefault(),Q.returnValue="Ests seguro de salir? Hay cambios sin guardar.","Ests seguro de salir? Hay cambios sin guardar."}};return window.addEventListener("beforeunload",k),()=>window.removeEventListener("beforeunload",k)},[g,e,r==null?void 0:r.id,a,le]),y.useEffect(()=>()=>{D.current&&clearTimeout(D.current),I.current&&clearInterval(I.current),T.current&&clearTimeout(T.current)},[]),{saveStatus:i,lastSaved:c,lastAutoSaved:f,saveError:u,hasUnsavedChanges:g,isOnline:h,saveManually:pe,performAutoSave:()=>V(!0),loadFromLocalStorage:O,getStorageKey:_,autoSaveInterval:K,debounceDelay:te}},Zu=({saveStatus:e,lastSaved:r,lastAutoSaved:t,hasUnsavedChanges:n,isOnline:a,saveError:o,onManualSave:i,className:s=""})=>{const c=d=>{if(!d)return null;const v=new Date-d,g=Math.floor(v/(1e3*60)),S=Math.floor(v/1e3);if(S<30)return"hace unos segundos";if(g<1)return`hace ${S}s`;if(g<60)return`hace ${g}m`;const h=Math.floor(g/60);return h<24?`hace ${h}h`:d.toLocaleDateString()},f=(()=>{if(!a)return{icon:l.jsx(On,{className:"w-4 h-4"}),color:"text-orange-500",bg:"bg-orange-50 border-orange-200",text:"Sin conexin",detail:"Guardado local activo"};switch(e){case"saving":return{icon:l.jsx(Qo,{className:"w-4 h-4 animate-spin"}),color:"text-blue-500",bg:"bg-blue-50 border-blue-200",text:"Guardando...",detail:"Sincronizando cambios"};case"saved":return{icon:l.jsx(ba,{className:"w-4 h-4"}),color:"text-green-500",bg:"bg-green-50 border-green-200",text:"Guardado",detail:t?`Auto-guardado ${c(t)}`:"Todo sincronizado"};case"error":return{icon:l.jsx(ya,{className:"w-4 h-4"}),color:"text-red-500",bg:"bg-red-50 border-red-200",text:"Error al guardar",detail:o||"Error desconocido"};case"pending":return{icon:l.jsx(_o,{className:"w-4 h-4"}),color:"text-yellow-600",bg:"bg-yellow-50 border-yellow-200",text:n?"Cambios pendientes":"Pendiente",detail:"Esperando a guardar..."};default:return{icon:l.jsx(Xo,{className:"w-4 h-4"}),color:"text-gray-500",bg:"bg-gray-50 border-gray-200",text:"Listo",detail:"Sistema de guardado activo"}}})();return l.jsxs("div",{className:`relative group ${s}`,children:[l.jsxs("div",{className:`
                    inline-flex items-center gap-2 px-3 py-2 rounded-lg border-2 
                    transition-all duration-200 cursor-pointer
                    ${f.bg} ${f.color}
                    hover:shadow-md
                `,onClick:()=>e!=="saving"&&(i==null?void 0:i()),children:[f.icon,l.jsx("span",{className:"text-sm font-medium",children:f.text}),n&&e!=="saving"&&l.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),l.jsx("div",{className:"flex items-center",children:a?l.jsx(Ri,{className:"w-3 h-3 text-green-500"}):l.jsx(On,{className:"w-3 h-3 text-orange-500"})})]}),l.jsxs("div",{className:`
                absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2
                bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg
                opacity-0 group-hover:opacity-100 pointer-events-none
                transition-opacity duration-200 z-50 whitespace-nowrap
            `,children:[l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"font-medium",children:f.text}),l.jsx("div",{className:"text-gray-300",children:f.detail}),r&&l.jsxs("div",{className:"text-gray-400 text-xs",children:["ltimo guardado manual: ",c(r)]}),l.jsxs("div",{className:"text-gray-400 text-xs",children:[a?" En lnea":" Sin conexin",e!=="saving"&&"  Click para guardar"]})]}),l.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]}),e==="saving"&&l.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-blue-200 rounded-b-lg overflow-hidden",children:l.jsx("div",{className:"h-full bg-blue-500 animate-pulse"})})]})},eg=({isOpen:e,onClose:r,savedProgress:t,onLoadProgress:n,onDiscardProgress:a})=>{var f;const[o,i]=y.useState(!1);if(!e||!t)return null;const s=async()=>{i(!0);try{await n(t),r()}catch(d){console.error("Error cargando progreso:",d)}finally{i(!1)}},c=async()=>{i(!0);try{await a(),r()}catch(d){console.error("Error descartando progreso:",d)}finally{i(!1)}},p=d=>{const u=new Date(d),g=new Date-u,S=Math.floor(g/(1e3*60)),h=Math.floor(S/60),C=Math.floor(h/24);return S<1?"hace unos segundos":S<60?`hace ${S} minutos`:h<24?`hace ${h} horas`:C===1?"ayer":C<7?`hace ${C} das`:u.toLocaleDateString()};return l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-auto",children:[l.jsxs("div",{className:"flex items-center gap-3 p-6 border-b border-gray-200",children:[l.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:l.jsx(ha,{className:"w-5 h-5 text-blue-600"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progreso Guardado Encontrado"}),l.jsx("p",{className:"text-sm text-gray-500",children:"Se encontr un trabajo sin finalizar"})]})]}),l.jsxs("div",{className:"p-6 space-y-4",children:[l.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(ii,{className:"w-4 h-4 text-gray-400 mt-0.5"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Guardado automticamente"}),l.jsx("div",{className:"text-xs text-gray-500",children:p(t.savedAt)})]})]}),t.pages&&l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(Jo,{className:"w-4 h-4 text-gray-400 mt-0.5"}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"text-sm text-gray-700",children:[t.pages.length," pginas en progreso"]}),l.jsx("div",{className:"text-xs text-gray-500",children:((f=t.meta)==null?void 0:f.version)||"Versin no especificada"})]})]})]}),l.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(ya,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),l.jsxs("div",{className:"text-sm text-amber-800",children:[l.jsx("div",{className:"font-medium mb-1",children:"Qu te gustara hacer?"}),l.jsx("div",{className:"text-amber-700",children:"Puedes continuar desde donde lo dejaste o comenzar un nuevo diseo."})]})]})})]}),l.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[l.jsxs("button",{onClick:s,disabled:o,className:`flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium \r
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[o?l.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsx(ba,{className:"w-4 h-4"}),"Continuar Editando"]}),l.jsxs("button",{onClick:c,disabled:o,className:`flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2.5 rounded-lg font-medium \r
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[l.jsx(xa,{className:"w-4 h-4"}),"Comenzar de Nuevo"]})]}),l.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",disabled:o,children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})};function rg(e,r){let t;return function(...a){const o=()=>{clearTimeout(t),e(...a)};clearTimeout(t),t=setTimeout(o,r)}}const Ut=fe.memo(({pageId:e,thumbnail:r,altText:t,type:n})=>{if(r)return l.jsx("img",{src:r,alt:t,className:"w-full h-full object-contain",loading:"lazy",style:{transition:"opacity 0.2s ease-in-out",imageRendering:"optimizeQuality"}});const a=n==="cover"||n==="final"?$t:()=>l.jsx("div",{className:"grid grid-cols-2 gap-0.5 w-8 h-8",children:Array.from({length:4}).map((o,i)=>l.jsx("div",{className:"bg-gray-300 rounded-sm"},i))});return l.jsx("div",{className:"w-full h-full flex items-center justify-center",children:l.jsx("div",{className:`${n==="cover"?"text-purple-300":n==="final"?"text-green-300":"text-gray-300"}`,children:l.jsx(a,{})})})});function Yg(){var xn,yn,wn,Cn,Sn,En;const[e,r]=y.useState(null),[t,n]=y.useState(null),[a,o]=y.useState(null),[i,s]=y.useState(null),[c,p]=y.useState(!0),[f,d]=y.useState(null);y.useEffect(()=>{(async()=>{var b;try{const w=new URLSearchParams(window.location.search).get("project");if(!w){d("No se encontr el ID del proyecto en la URL"),p(!1);return}console.log(" Cargando proyecto con ID:",w);const E=await fetch(`/api/canvas/projects/${w}`,{headers:{"X-CSRF-TOKEN":((b=document.querySelector('meta[name="csrf-token"]'))==null?void 0:b.content)||""}});if(!E.ok)throw new Error("Error al cargar el proyecto");const B=await E.json();console.log(" Datos del proyecto cargados:",B),r(B.project),n(B.item),o(B.canvasPreset),s(B.initialProject),p(!1)}catch(x){console.error(" Error cargando proyecto:",x),d(x.message),p(!1)}})()},[]),y.useEffect(()=>{e&&t&&a&&(console.log(" Editor datos cargados exitosamente:"),console.log(" project:",e),console.log(" item:",t),console.log(" canvasPreset:",a),console.log(" initialProject:",i))},[e,t,a,i]),y.useEffect(()=>{if(i&&t&&a){if(console.log(" Actualizando estados del editor con datos del proyecto"),i.pages&&Array.isArray(i.pages)){console.log(" Recreando pginas con backgrounds actualizados...");const m=i.pages.map(b=>{let x=null,w=a.background_color||"#ffffff";return b.type==="cover"?t.cover_image?(x=`/storage/images/item/${t.cover_image}`,console.log(" [UPDATE] Cover page - usando cover_image:",x)):console.log(" [UPDATE] Cover page - usando background_color:",w):b.type==="content"?t.content_image?(x=`/storage/images/item/${t.content_image}`,console.log(" [UPDATE] Content page - usando content_image:",x)):console.log(" [UPDATE] Content page - usando background_color:",w):(b.type==="final"||b.type==="contraportada")&&(t.back_cover_image?(x=`/storage/images/item/${t.back_cover_image}`,console.log(" [UPDATE] Final page - usando back_cover_image:",x)):console.log(" [UPDATE] Final page - usando background_color:",w)),{...b,backgroundImage:x,backgroundColor:w}});console.log(" Pginas actualizadas con backgrounds:",m),S(m),O([JSON.stringify(m)]),pe(0)}else{console.log(" No hay pginas existentes, creando nuevas...");const m=kr(a,t);S(m),O([JSON.stringify(m)]),pe(0)}typeof i.currentPage=="number"&&C(i.currentPage),i.workspaceSize&&D(i.workspaceSize)}},[i,t,a]);const[u,v]=y.useState(jn.Local.get(`${Pt.APP_CORRELATIVE}_cart`)??[]);y.useEffect(()=>{jn.Local.set(`${Pt.APP_CORRELATIVE}_cart`,u)},[u]);const[g,S]=y.useState([]),[h,C]=y.useState(0),[I,D]=y.useState("preset"),[N,F]=y.useState(null),[T,K]=y.useState(null),[te,J]=y.useState("elements"),[ne,_]=y.useState("basic"),[le,O]=y.useState([JSON.stringify(g)]),[V,pe]=y.useState(0),[k,Q]=y.useState(!1),[ue,Z]=y.useState(null),[oe,me]=y.useState({}),he=y.useRef(),[G,Ae]=y.useState({width:800,height:600}),ve=Qu(g,e,t,a,G,oe),Ue=()=>{if(a!=null&&a.width&&(a!=null&&a.height)){let j=a.width,L=a.height,H=j*37.8,z=L*37.8;if(H&&z){const q=window.innerWidth*.6,re=window.innerHeight*.7,P=q/H,$=re/z,X=Math.min(P,$,1);return{width:Math.round(H*X),height:Math.round(z*X),originalWidth:j,originalHeight:L,scale:X,unit:"cm",originalWidthPx:Math.round(H),originalHeightPx:Math.round(z)}}}if(a!=null&&a.extra_settings)try{const j=typeof a.extra_settings=="string"?JSON.parse(a.extra_settings):a.extra_settings;if(j!=null&&j.canvas_config){const L=j.canvas_config;let H=L.width,z=L.height,q=H*37.8,re=z*37.8;if(q&&re){const P=window.innerWidth*.6,$=window.innerHeight*.7,X=P/q,W=$/re,de=Math.min(X,W,1);return{width:Math.round(q*de),height:Math.round(re*de),originalWidth:H,originalHeight:z,scale:de,unit:"cm",originalWidthPx:Math.round(q),originalHeightPx:Math.round(re)}}}}catch(j){console.warn("Error parsing extra_settings:",j)}const m={square:{width:600,height:600},landscape:{width:1280,height:720},portrait:{width:600,height:800},wide:{width:1200,height:600},tall:{width:540,height:960},preset:{width:800,height:600}},b=m[I]||m.preset,x=window.innerWidth*.6,w=window.innerHeight*.7,E=x/b.width,B=w/b.height,M=Math.min(E,B,1);return{width:Math.round(b.width*M),height:Math.round(b.height*M),originalWidth:b.width,originalHeight:b.height,scale:M,unit:"px"}},ye=y.useCallback(async(m={type:"thumbnail"})=>{if(!g[h])return null;try{let b=document.querySelector(`#page-${g[h].id}`);if(!b)return console.warn(" THUMBNAIL: No se encontr el elemento de pgina especfico"),null;console.log(" [THUMBNAIL-FIX] Elemento workspace encontrado:",b),console.log(" [THUMBNAIL-FIX] Dimensiones del elemento:",{offsetWidth:b.offsetWidth,offsetHeight:b.offsetHeight,style_width:b.style.width,style_height:b.style.height,background:getComputedStyle(b).backgroundColor,backgroundImage:getComputedStyle(b).backgroundImage}),console.log(" [THUMBNAIL-FIX] Dimensiones del workspace desde BD:",G);const x=g[h];console.log(" [THUMBNAIL-FIX] Datos de la pgina actual:",{id:x==null?void 0:x.id,type:x==null?void 0:x.type,backgroundImage:x==null?void 0:x.backgroundImage,backgroundColor:x==null?void 0:x.backgroundColor});const w=m.type==="pdf",E=w?11.81:3,B=1,M=getComputedStyle(b);let j=(x==null?void 0:x.backgroundColor)||"#ffffff";M.backgroundColor&&M.backgroundColor!=="rgba(0, 0, 0, 0)"&&(j=M.backgroundColor),console.log(" [THUMBNAIL-FIX] Background detectado:",j);const L={scale:E,useCORS:!0,allowTaint:!1,backgroundColor:j,width:G.width,height:G.height,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!!w,removeContainer:!1,logging:!1,imageTimeout:w?6e4:15e3,pixelRatio:w?3:window.devicePixelRatio||1,canvas:w?document.createElement("canvas"):null,windowWidth:w?G.width*E:null,windowHeight:w?G.height*E:null,onclone:async q=>{console.log(" [THUMBNAIL-FIX] Iniciando proceso de clonado para elemento de pgina especfico..."),[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(P=>{try{q.querySelectorAll(P).forEach(X=>X.remove())}catch($){console.warn("Error removing selector:",P,$)}});try{const P=q.querySelector(`#page-${g[h].id}`);console.log(" [THUMBNAIL-FIX] Elemento de pgina clonado encontrado:",P),P&&(P.style.width=G.width+"px",P.style.height=G.height+"px",P.style.position="relative",P.style.overflow="hidden",x!=null&&x.backgroundImage&&(console.log(" [THUMBNAIL-FIX] Aplicando backgroundImage de pgina:",x.backgroundImage),P.style.backgroundImage=`url(${x.backgroundImage})`,P.style.backgroundSize="cover",P.style.backgroundPosition="center",P.style.backgroundRepeat="no-repeat"),x!=null&&x.backgroundColor&&(console.log(" [THUMBNAIL-FIX] Aplicando backgroundColor de pgina:",x.backgroundColor),P.style.backgroundColor=x.backgroundColor),console.log(" [THUMBNAIL-FIX] Dimensiones del elemento de pgina aplicadas:",{width:P.style.width,height:P.style.height,backgroundColor:P.style.backgroundColor,backgroundImage:P.style.backgroundImage}))}catch(P){console.error(" [THUMBNAIL-FIX] Error configurando elemento de pgina:",P)}try{console.log(" [ADVANCED-THUMBNAIL] Iniciando pre-procesamiento avanzado de imgenes...");const P=new Map;b.querySelectorAll('[data-element-type="image"] img, .workspace-image, img').forEach((ae,ze)=>{if(ae.complete&&ae.naturalWidth>0){const Ee=(ae.closest('[data-element-type="image"]')||ae.parentElement).getBoundingClientRect(),We=ae.getBoundingClientRect();P.set(ae.src,{src:ae.src,naturalWidth:ae.naturalWidth,naturalHeight:ae.naturalHeight,containerWidth:Ee.width,containerHeight:Ee.height,objectFit:getComputedStyle(ae).objectFit||"cover",objectPosition:getComputedStyle(ae).objectPosition||"center",crossOrigin:ae.crossOrigin}),console.log(` [ADVANCED-THUMBNAIL] Imagen ${ze} datos capturados:`,P.get(ae.src))}});const X=async(ae,ze,we,Ee,We)=>new Promise(ur=>{try{const gr=ze/we,Et=Ee/We;let et,rt,It,Nt,In,Nn;Et>gr?(Nn=we,In=we*Et,rt=We,et=We*gr,It=(Ee-et)/2,Nt=0):(In=ze,Nn=ze/Et,et=Ee,rt=Ee/gr,It=0,Nt=(We-rt)/2);const tt=q.createElement("canvas");tt.width=ze,tt.height=we;const ko=tt.getContext("2d"),jr=new Image;jr.crossOrigin="anonymous",jr.onload=()=>{try{ko.drawImage(jr,It,Nt,et,rt,0,0,ze,we);const At=tt.toDataURL("image/png",1);ae.src=At,ae.style.objectFit="fill",ae.style.objectPosition="center",ae.style.width="100%",ae.style.height="100%",console.log(" [ADVANCED-THUMBNAIL] Imagen pre-procesada con object-fit cover simulado"),ur()}catch(At){console.warn(" [ADVANCED-THUMBNAIL] Error en canvas processing:",At),ur()}},jr.onerror=()=>{console.warn(" [ADVANCED-THUMBNAIL] Error cargando imagen temporal"),ur()},jr.src=ae.src}catch(gr){console.warn(" [ADVANCED-THUMBNAIL] Error en simulateObjectFitCover:",gr),ur()}}),W=q.querySelectorAll('[data-element-type="image"] img, .workspace-image, img'),de=[];W.forEach((ae,ze)=>{if(ae.src&&P.has(ae.src)){const we=P.get(ae.src),Ee=ae.closest('[data-element-type="image"]')||ae.parentElement;if(Ee&&(Ee.style.overflow="hidden",Ee.style.position="relative"),we.objectFit==="cover"||ae.classList.contains("object-cover")||ae.classList.contains("workspace-image")){console.log(` [ADVANCED-THUMBNAIL] Procesando imagen ${ze} con pre-procesamiento...`);const We=X(ae,we.containerWidth,we.containerHeight,we.naturalWidth,we.naturalHeight);de.push(We)}else ae.style.width="100%",ae.style.height="100%",ae.style.objectFit="fill"}}),de.length>0&&(console.log(` [ADVANCED-THUMBNAIL] Esperando procesamiento de ${de.length} imgenes...`),await Promise.all(de),console.log(" [ADVANCED-THUMBNAIL] Todas las imgenes pre-procesadas exitosamente"));const ce=q.createElement("style");ce.textContent=`
                            /* CORRECCIN THUMBNAIL: Estructura del elemento de pgina */
                            #page-${g[h].id} {
                                width: ${G.width}px !important;
                                height: ${G.height}px !important;
                                position: relative !important;
                                overflow: hidden !important;
                                box-sizing: border-box !important;
                            }
                            
                            /*  IMGENES PROFESIONALES: Optimizada para PDF vs Thumbnails */
                            img {
                                width: 100% !important;
                                height: 100% !important;
                                object-fit: fill !important; /* fill porque ya estn recortadas */
                                object-position: center !important;
                                display: block !important;
                                ${w?`
                                /*  IMPRESIN PROFESIONAL 300 DPI */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: -webkit-crisp-edges !important;
                                image-rendering: -moz-crisp-edges !important;
                                image-rendering: pixelated !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: optimizeQuality !important;
                                backface-visibility: hidden !important;
                                transform: translateZ(0) scale(1) !important;
                                will-change: transform !important;
                                filter: contrast(1.02) saturate(1.05) !important;
                                `:`
                                /* Thumbnails optimizados */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: high-quality !important;
                                `}
                            }
                            
                            /* Contenedores de imagen */
                            [data-element-type="image"] {
                                overflow: hidden !important;
                                position: relative !important;
                            }
                            
                            [data-element-type="image"] > div {
                                width: 100% !important;
                                height: 100% !important;
                                overflow: hidden !important;
                            }
                            
                            /* Backgrounds de pgina */
                            #page-${g[h].id} {
                                background-size: cover !important;
                                background-position: center !important;
                                background-repeat: no-repeat !important;
                            }
                            
                            /*  OPTIMIZACIONES GENERALES PARA PDF DE IMPRESIN */
                            ${w?`
                            * {
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                text-rendering: optimizeLegibility !important;
                                -webkit-backface-visibility: hidden !important;
                                backface-visibility: hidden !important;
                                -webkit-transform: translateZ(0) !important;
                                transform: translateZ(0) !important;
                            }
                            
                            /* Elementos de texto de alta calidad */
                            p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable] {
                                text-rendering: optimizeLegibility !important;
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                font-smooth: always !important;
                            }
                            
                            /* Elementos vectoriales de alta calidad */
                            svg, path, circle, rect, line {
                                shape-rendering: geometricPrecision !important;
                                vector-effect: non-scaling-stroke !important;
                            }
                            `:""}
                            
                            /* Resetear estilos que puedan interferir */
                            img {
                                max-width: none !important;
                                max-height: none !important;
                                border: none !important;
                                outline: none !important;
                            }
                        `,q.head.appendChild(ce),console.log(" [ADVANCED-THUMBNAIL] CSS para imgenes pre-procesadas aplicado"),console.log(" [ADVANCED-THUMBNAIL] Pre-procesamiento avanzado completado - listo para html2canvas")}catch(P){console.error(" [ADVANCED-THUMBNAIL] Error en pre-procesamiento avanzado:",P);const $=q.createElement("style");$.textContent=`
                            img { object-fit: cover !important; object-position: center !important; }
                            [data-element-type="image"] { overflow: hidden !important; }
                        `,q.head.appendChild($)}console.log(" [THUMBNAIL-FIX] Proceso de clonado completado - elemento de pgina con dimensiones exactas")}};console.log(" [THUMBNAIL-FIX] Iniciando captura de elemento de pgina con dimensiones exactas de BD:",L);const H=await Dn(b,L);if(w&&H){const q=H.getContext("2d");if(q){q.imageSmoothingEnabled=!1,q.imageSmoothingQuality="high";const re=q.getImageData(0,0,H.width,H.height),P=re.data;for(let $=0;$<P.length;$+=4)P[$]=Math.min(255,P[$]*1.05),P[$+1]=Math.min(255,P[$+1]*1.05),P[$+2]=Math.min(255,P[$+2]*1.05);q.putImageData(re,0,0),console.log(" [PDF-PROFESSIONAL] Post-procesamiento de calidad aplicado")}}if(!H)throw new Error("html2canvas no devolvi un canvas vlido para el elemento de pgina");if(H.width===0||H.height===0)throw new Error("Canvas del elemento de pgina tiene dimensiones invlidas");const z=H.toDataURL("image/png",B);if(!z||z==="data:,")throw new Error("No se pudo generar dataURL del elemento de pgina");return console.log(" [THUMBNAIL-FIX] Captura de elemento de pgina exitosa para pgina:",g[h].id,"Tipo:",m.type),console.log(" [THUMBNAIL-FIX] Canvas del elemento de pgina generado:",{width:H.width,height:H.height,expectedWidth:G.width*E,expectedHeight:G.height*E,dataUrlLength:z.length,workspaceBackground:j}),w?H:z}catch(b){console.error(" [THUMBNAIL-FIX] Error capturando elemento de pgina:",b);try{console.log(" [THUMBNAIL-FIX] Intentando fallback con canvas de elemento de pgina...");const x=document.createElement("canvas"),w=m.type==="pdf"?11.81:1;x.width=G.width*w,x.height=G.height*w;const E=x.getContext("2d"),B=workspaceBackground||(currentPageData==null?void 0:currentPageData.backgroundColor)||"#ffffff";if(E.fillStyle=B,E.fillRect(0,0,x.width,x.height),E.fillStyle=B==="#ffffff"||B.includes("white")?"#374151":"#666666",E.font=`${14*w}px Arial`,E.textAlign="center",E.fillText("Pgina "+(h+1),x.width/2,x.height/2),console.log(" [THUMBNAIL-FIX] Fallback creado con dimensiones exactas:",{width:x.width,height:x.height,expectedDimensions:G,background:B}),m.type==="pdf")return x;{const M=x.toDataURL("image/png",1);return console.log(" [DEBUG] Fallback thumbnail creado"),M}}catch(x){return console.error(" [DEBUG] Error en fallback:",x),null}}},[h,g]),Ne=y.useCallback(async()=>{if(!g[h])return;const m=await ye({type:"thumbnail"});m&&(me(b=>({...b,[g[h].id]:m})),console.log(" Thumbnail generated for page:",g[h].id))},[ye,h,g]);y.useCallback(()=>{clearTimeout(he.current),he.current=setTimeout(()=>{g[h]&&!oe[g[h].id]&&Ne()},1200)},[Ne,g,h,oe]);const Ve=y.useCallback(()=>{g[h]&&!oe[g[h].id]&&setTimeout(()=>{Ne()},300)},[Ne,g,h,oe]),Be=y.useCallback(async(m=h,b={width:800,height:600})=>{var x,w;if(!g[m])return null;try{console.log(` Generando thumbnail de alta calidad para pgina ${m+1}`);const E=h;m!==h&&(C(m),await new Promise(L=>setTimeout(L,100)));const B=document.querySelector(`#page-${g[m].id}`);if(!B)return console.warn("Workspace element not found for page:",g[m].id),null;const M={scale:4,useCORS:!0,allowTaint:!1,backgroundColor:((x=g[m])==null?void 0:x.backgroundColor)||"#ffffff",width:B.offsetWidth,height:B.offsetHeight,removeContainer:!0,logging:!1,onclone:L=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(P=>{L.querySelectorAll(P).forEach(X=>X.remove())});const z=L.querySelector(`#page-${g[m].id}`);if(z){const P=g[m];P!=null&&P.backgroundImage&&(console.log(" [HIGH-QUALITY] Aplicando backgroundImage al clon:",P.backgroundImage),z.style.backgroundImage=`url(${P.backgroundImage})`,z.style.backgroundSize="cover",z.style.backgroundPosition="center",z.style.backgroundRepeat="no-repeat"),P!=null&&P.backgroundColor&&(console.log(" [HIGH-QUALITY] Aplicando backgroundColor al clon:",P.backgroundColor),z.style.backgroundColor=P.backgroundColor)}try{const P=B.querySelectorAll("img"),$=new Map;P.forEach((W,de)=>{const ce=getComputedStyle(W);$.set(de,{objectFit:ce.objectFit,objectPosition:ce.objectPosition,width:ce.width,height:ce.height,borderRadius:ce.borderRadius,transform:ce.transform})}),L.querySelectorAll("img").forEach((W,de)=>{const ce=$.get(de);ce&&(W.style.objectFit=ce.objectFit||"cover",W.style.objectPosition=ce.objectPosition||"center",W.style.width=ce.width,W.style.height=ce.height,W.style.borderRadius=ce.borderRadius,W.style.transform=ce.transform,console.log(` [HIGH-QUALITY] Imagen ${de} - Estilos aplicados:`,{objectFit:W.style.objectFit,objectPosition:W.style.objectPosition,width:W.style.width,height:W.style.height}))})}catch(P){console.warn("Error preservando estilos de imgenes:",P),L.querySelectorAll("img").forEach(X=>{X.style.objectFit="cover",X.style.objectPosition="center",X.style.width||(X.style.width="100%"),X.style.height||(X.style.height="100%")})}L.querySelectorAll('[class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable]').forEach(P=>{const $=P.className;$&&(P.className=$);const X=getComputedStyle?getComputedStyle(P):null;X&&(X.fontFamily&&X.fontFamily!=="Arial"&&(P.style.fontFamily=X.fontFamily),X.fontSize&&(P.style.fontSize=X.fontSize),X.fontWeight&&(P.style.fontWeight=X.fontWeight),X.fontStyle&&(P.style.fontStyle=X.fontStyle))});const re=L.createElement("style");re.textContent=`
                        /* Preservar fuentes originales y NO forzar Arial */
                        * { 
                            -webkit-font-smoothing: antialiased !important;
                            -moz-osx-font-smoothing: grayscale !important;
                        }
                        
                        /* CRTICO: Asegurar que las imgenes mantengan cover + CALIDAD HD */
                        img {
                            object-fit: cover !important;
                            object-position: center !important;
                            image-rendering: -webkit-optimize-contrast !important;
                            image-rendering: crisp-edges !important;
                            image-rendering: high-quality !important;
                        }
                        
                        /* CRTICO: Asegurar que los backgrounds de pgina se mantengan en cover */
                        [id^="page-"] {
                            background-size: cover !important;
                            background-position: center !important;
                            background-repeat: no-repeat !important;
                        }
                        
                        /* Asegurar que los elementos de texto mantengan sus fuentes */
                        [class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6 {
                            font-family: inherit !important;
                        }
                    `,L.head.appendChild(re)}},j=await Dn(B,M);if(b.width!==j.width||b.height!==j.height){const L=document.createElement("canvas");L.width=b.width,L.height=b.height;const H=L.getContext("2d"),z=j.width/j.height,q=b.width/b.height;let re,P,$=0,X=0;z>q?(re=b.width,P=b.width/z,X=(b.height-P)/2):(P=b.height,re=b.height*z,$=(b.width-re)/2),H.fillStyle=((w=g[m])==null?void 0:w.backgroundColor)||"#ffffff",H.fillRect(0,0,b.width,b.height),H.drawImage(j,$,X,re,P);const W=L.toDataURL("image/png",1);return m!==E&&C(E),W}return m!==E&&C(E),j.toDataURL("image/png",1)}catch(E){return console.error(" Error generando thumbnail de alta calidad:",E),null}},[g,h,C]);y.useEffect(()=>{const m=Ue();Ae(m)},[a,I]),y.useEffect(()=>{const m=()=>{const b=Ue();Ae(b)};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[a,I]),y.useEffect(()=>{if(g[h]&&!oe[g[h].id]){const m=setTimeout(()=>{Ve()},400);return()=>clearTimeout(m)}},[h]),y.useEffect(()=>{const m=`${G.width}x${G.height}`,b=sessionStorage.getItem("lastWorkspaceDimensions");b&&b!==m&&g.length>0&&(console.log(" Dimensiones del workspace cambiaron, limpiando miniaturas"),me({}),setTimeout(()=>{g[h]&&Ve()},800)),sessionStorage.setItem("lastWorkspaceDimensions",m)},[G.width,G.height]);const[_e,Me]=y.useState(!1),[qe,Ke]=y.useState({elementId:null,cellId:null}),[cr,Ye]=y.useState(!1),[Qe,dr]=y.useState(!1),[$e,Ze]=y.useState(null),vr=y.useRef(null),qr=async m=>{const b=m.target.files[0];if(!b||!(e!=null&&e.id))return;const x=new FormData;x.append("image",b),x.append("projectId",e.id);try{const E=await(await fetch("/api/canvas/editor/upload-image",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:x})).json();E.success?(Kr(E.url),Pe.success("Imagen subida correctamente")):Pe.error(E.message||"Error al subir la imagen")}catch(w){console.error("Error subiendo la imagen:",w),Pe.error("Error de red al subir la imagen")}},Kr=m=>{const b={id:`image-${Date.now()}`,type:"image",content:m,position:{x:10,y:10},size:{width:50,height:50},filters:{},mask:"none",zIndex:g[h].cells[0].elements.length+1},x=[...g];(x[h].cells.find(E=>E.id===T)||x[h].cells[0]).elements.push(b),He(x)},Yr=()=>{const m={id:`text-${Date.now()}`,type:"text",content:"Doble clic para editar",position:{x:10,y:10},size:{width:50,height:10},style:{fontSize:"16px",fontFamily:"Arial",color:"#000000",textAlign:"left"},zIndex:g[h].cells[0].elements.length+1},b=[...g];(b[h].cells.find(w=>w.id===T)||b[h].cells[0]).elements.push(m),He(b),Pe.success("Texto aadido")},Ar=y.useCallback(async(m,b)=>{var E,B;const x=[],w=[];for(const M of m){const j={...M};if(M.cells){j.cells=[];for(const L of M.cells){const H={...L};if(L.elements){H.elements=[];for(const z of L.elements)if(z.type==="image"&&((E=z.content)!=null&&E.startsWith("data:image/"))){const q=`${z.id}_${Date.now()}`,re=z.content.match(/^data:image\/([^;]+);base64,(.+)$/);if(re){const P=re[1],$=re[2],W=`${q}.${P==="jpeg"?"jpg":P}`;w.push({filename:W,data:$,type:P,elementId:z.id}),H.elements.push({...z,content:`/api/canvas/image/${btoa(`images/projects/${b}/${W}`)}`,_wasBase64:!0,_originalSize:z.content.length}),console.log(` [IMAGE-PROCESS] Imagen base64 procesada: ${z.id} -> ${W}`)}else H.elements.push(z)}else H.elements.push(z)}j.cells.push(H)}}x.push(j)}if(w.length>0){console.log(` [IMAGE-UPLOAD] Subiendo ${w.length} imgenes al servidor...`);try{const M=await fetch(`/api/canvas/projects/${b}/upload-images`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((B=document.querySelector('meta[name="csrf-token"]'))==null?void 0:B.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({images:w})});if(M.ok){const j=await M.json();console.log(` [IMAGE-UPLOAD] ${w.length} imgenes subidas exitosamente:`,j)}else{const j=await M.json().catch(()=>({message:"Error desconocido en upload"}));return console.error(" [IMAGE-UPLOAD] Error subiendo imgenes:",j),console.log(" [IMAGE-UPLOAD] Fallback: conservando imgenes base64 originales"),m}}catch(M){return console.error(" [IMAGE-UPLOAD] Error de red subiendo imgenes:",M),m}}return x},[]),er=y.useCallback(async(m=g,b=!1)=>{var x;if(!(!(e!=null&&e.id)||!b&&m.length===0))try{console.log(" [AUTO-SAVE] Guardando progreso con procesamiento de imgenes...");const w=await Ar(m,e.id),E={pages:w,currentPage:h,workspaceDimensions:G,workspaceSize:I,selectedElement:N,selectedCell:T,history:le.slice(-5),historyIndex:Math.min(V,4),timestamp:new Date().toISOString(),version:"2.0",project:{id:e.id,name:(t==null?void 0:t.name)||"lbum Personalizado",item_id:t==null?void 0:t.id,preset_id:a==null?void 0:a.id}},B=Object.entries(oe).map(([z,q])=>({page_id:z,thumbnail:q})),M={design_data:E,thumbnails:B},j=JSON.stringify(M).length,L=j/(1024*1024);console.log(" [AUTO-SAVE] Datos optimizados con imgenes en servidor:",{projectId:e.id,pagesCount:w.length,thumbnailsCount:B.length,dataSize:j,dataSizeMB:L.toFixed(2)+" MB",optimized:" Imgenes en servidor"});const H=await fetch(`/api/canvas/projects/${e.id}/save-progress`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((x=document.querySelector('meta[name="csrf-token"]'))==null?void 0:x.getAttribute("content"))||""},credentials:"include",body:JSON.stringify(M)});if(H.ok){const z=await H.json();console.log(" [AUTO-SAVE] Progreso con imgenes optimizadas guardado exitosamente:",z);const q=`editor_progress_project_${e.id}`;return localStorage.removeItem(q),!0}else{const z=await H.json().catch(()=>({message:"Error desconocido"}));return console.error(" [AUTO-SAVE] Error guardando en BD:",z),!1}}catch(w){return console.error(" [AUTO-SAVE] Error en auto-save con procesamiento de imgenes:",w),!1}},[g,h,G,I,N,T,le,V,e==null?void 0:e.id,t==null?void 0:t.name,t==null?void 0:t.id,a==null?void 0:a.id,oe,Ar]);y.useEffect(()=>{if(!(e!=null&&e.id))return;const m=setInterval(()=>{g.length>0&&(console.log(" [AUTO-SAVE] Ejecutando auto-save automtico..."),er(g,!1))},3e4);return()=>clearInterval(m)},[er,g,e==null?void 0:e.id]);const Pr=y.useCallback(rg(()=>{g.length>0&&(e!=null&&e.id)&&(console.log(" [AUTO-SAVE] Cambios detectados, guardando..."),er(g,!1))},3e3),[er,g,e==null?void 0:e.id]);y.useEffect(()=>{Pr()},[g,Pr]);const Xe=()=>`editor_progress_project_${e==null?void 0:e.id}`,Dr=y.useCallback(async()=>{var m,b,x,w;if(e!=null&&e.id)try{const E=ve.loadFromLocalStorage(),B=await fetch(`/api/canvas/projects/${e.id}/load-progress`,{headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});let M=null;if(B.ok){const L=await B.json();L.success&&((m=L.data)!=null&&m.design_data)&&(M=L.data)}let j=null;if(E&&M){const L=new Date(E.savedAt).getTime(),H=new Date(M.saved_at).getTime();j=L>H?E:M}else E?j=E:M&&(j=M);j&&(((b=j.pages)==null?void 0:b.length)>0||((w=(x=j.design_data)==null?void 0:x.pages)==null?void 0:w.length)>0)&&(console.log(" [RECOVERY] Progreso encontrado, mostrando modal de recuperacin"),Ze(j),dr(!0))}catch(E){console.error(" [RECOVERY] Error verificando progreso guardado:",E)}},[e==null?void 0:e.id,ve]),Xr=y.useCallback(async m=>{var b;try{console.log(" [RECOVERY] Cargando progreso guardado...");let x=[];if(m.pages?x=m.pages:(b=m.design_data)!=null&&b.pages&&(x=m.design_data.pages),x.length>0){S(x);const w=[JSON.stringify(x)];O(w),pe(0),setTimeout(()=>{me({})},100),Pe.success(" Progreso cargado exitosamente"),console.log(" [RECOVERY] Progreso cargado:",x.length,"pginas")}}catch(x){console.error(" [RECOVERY] Error cargando progreso:",x),Pe.error("Error al cargar el progreso guardado")}},[S,O,pe,me]),Jr=y.useCallback(async()=>{try{console.log(" [RECOVERY] Descartando progreso guardado...");const m=ve.getStorageKey();localStorage.removeItem(m),Pe.success("Progreso anterior eliminado"),console.log(" [RECOVERY] Progreso descartado exitosamente")}catch(m){console.error(" [RECOVERY] Error descartando progreso:",m)}},[ve]);y.useEffect(()=>{e&&t&&a&&(console.log(" Todos los datos estn disponibles, inicializando editor..."),console.log(" projectData:",a,e,t),(!(i!=null&&i.pages)||i.pages.length===0)&&(console.log(" No hay pginas iniciales, creando desde preset..."),kr(a,t)))},[e,t,a,i]),y.useEffect(()=>{e!=null&&e.id&&!c&&g.length===0&&setTimeout(()=>{Dr()},500)},[e==null?void 0:e.id,c,g.length,Dr]);const kr=(m,b)=>{try{console.log("Creating pages from preset:",m),console.log("Item data:",b),console.log(" Imgenes disponibles:"),console.log("   - Portada (cover_image):",b.cover_image),console.log("   - Contenido (content_image):",b.content_image),console.log("   - Contraportada (back_cover_image):",b.back_cover_image),console.log("   - Color de fondo del preset:",m.background_color);const x=[],w=b.pages||m.pages||20;console.log(" Total pages to create:",w);const E=b.cover_image?`/storage/images/item/${b.cover_image}`:null,B=b.cover_image?null:m.background_color||"#ffffff";console.log(" [COVER] cover_image:",b.cover_image),console.log(" [COVER] backgroundImage construida:",E),console.log(" [COVER] backgroundColor:",B);const M={id:"page-cover",type:"cover",layout:"layout-1",backgroundImage:E,backgroundColor:B,cells:[{id:"cell-cover-1",elements:[{id:"cover-title",type:"text",content:b.name||"Mi lbum Personalizado",position:{x:10,y:20},size:{width:80,height:15},style:{fontSize:"28px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",textAlign:"center",backgroundColor:"transparent",padding:"8px"},zIndex:2},...b.image?[{id:"cover-image",type:"image",content:`/storage/images/item/${b.image}`,position:{x:25,y:40},size:{width:50,height:40},filters:{},mask:"none",zIndex:1}]:[]]}]};x.push(M);const j=b.content_image?`/storage/images/item/${b.content_image}`:null,L=b.content_image?null:m.background_color||"#ffffff";console.log(" [CONTENT] content_image:",b.content_image),console.log(" [CONTENT] backgroundImage construida:",j),console.log(" [CONTENT] backgroundColor:",L);for(let re=1;re<=w;re++){const P={id:`page-content-${re}`,type:"content",pageNumber:re,layout:"layout-1",backgroundImage:j,backgroundColor:L,cells:[{id:`cell-content-${re}-1`,elements:[{id:`page-number-${re}`,type:"text",content:`Pgina ${re}`,position:{x:5,y:5},size:{width:20,height:8},style:{fontSize:"14px",fontFamily:"Arial",color:"#666666",textAlign:"left"},zIndex:1},{id:`content-area-${re}`,type:"text",content:"Haz clic para agregar contenido...",position:{x:10,y:20},size:{width:80,height:60},style:{fontSize:"16px",fontFamily:"Arial",color:"#999999",textAlign:"center"},zIndex:1}]}]};x.push(P)}const H=b.back_cover_image?`/storage/images/item/${b.back_cover_image}`:null,z=b.back_cover_image?null:m.background_color||"#ffffff";console.log(" [FINAL] back_cover_image:",b.back_cover_image),console.log(" [FINAL] backgroundImage construida:",H),console.log(" [FINAL] backgroundColor:",z);const q={id:"page-final",type:"final",layout:"layout-1",backgroundImage:H,backgroundColor:z,cells:[{id:"cell-final-1",elements:[]}]};x.push(q),console.log(" Created pages:",x),S(x),C(0),m.width&&m.height&&(console.log(" Canvas dimensions found, setting workspace to preset dimensions"),D("preset"))}catch(x){console.error(" Error creating pages:",x),d(x.message)}},_r=()=>{if(g.length===0)return"Cargando...";const m=g[h];if(!m)return"Pgina";switch(m.type){case"cover":return"Portada";case"content":return`Pgina ${m.pageNumber}`;case"final":return"Contraportada";default:return`Pgina ${h+1}`}},Qr=()=>{if(g.length===0)return!1;const m=g[h];return(m==null?void 0:m.type)==="content"},hr=y.useMemo(()=>({cover:g.filter(m=>m.type==="cover"),content:g.filter(m=>m.type==="content"),final:g.filter(m=>m.type==="final")}),[g]),br=y.useCallback(()=>{if(!N||!T||g.length===0)return null;const m=g[h];if(!m)return null;const b=m.cells.find(x=>x.id===T);return b?b.elements.find(x=>x.id===N):null},[N,T,g,h]),xr=(m,b)=>{if(b){const x=g[h].cells.find(E=>E.id===b),w=x==null?void 0:x.elements.find(E=>E.id===m);if(w!=null&&w.locked){console.log("Elemento bloqueado, no se puede seleccionar");const E=document.createElement("div");E.className="fixed top-4 right-4 bg-amber-100 border border-amber-400 text-amber-700 px-4 py-2 rounded-lg z-50",E.textContent="Este elemento es parte del diseo base y no se puede editar",document.body.appendChild(E),setTimeout(()=>{document.body.contains(E)&&document.body.removeChild(E)},3e3);return}}if(b&&K(b),F(m),m){const x=g[h].cells.find(E=>E.id===(b||T)),w=x==null?void 0:x.elements.find(E=>E.id===m);(w==null?void 0:w.type)==="image"?(Z(w),console.log(ue)):(w==null?void 0:w.type)==="text"?(Me(!0),Ke({elementId:m,cellId:b||T})):Me(!1)}else Me(!1),Z(null)},Le=()=>{if(g.length===0)return Ce[0];const m=g[h];return m?Ce.find(b=>b.id===m.layout)||Ce[0]:Ce[0]},He=y.useCallback(m=>{console.log(" [DEBUG] updatePages llamado para pgina:",h),S(m);const b=[...le.slice(0,V+1),JSON.stringify(m)];O(b),pe(b.length-1);try{const x=Xe(),w={pages:m,currentPage:h,savedAt:Date.now()},E=JSON.stringify(w),B=Math.round(E.length/1024);if(B<2048)localStorage.setItem(x,E),console.log(` Progreso guardado en localStorage (${B} KB)`);else{console.warn(` Datos demasiado grandes para localStorage (${B} KB), saltando guardado local`);try{localStorage.removeItem(x)}catch(M){console.error("Error limpiando localStorage:",M)}}}catch(x){if(console.error(" Error guardando en localStorage:",x),x.name==="QuotaExceededError")try{const w=Xe();localStorage.removeItem(w),console.log(" localStorage limpiado debido a QuotaExceededError")}catch(w){console.error("Error limpiando localStorage:",w)}}if(m[h]){const x=m[h].id;console.log(" [DEBUG] Invalidando miniatura por cambios en pgina:",x),me(w=>{const E={...w};return delete E[x],console.log(" [DEBUG] Thumbnail eliminado, forzando regeneracin"),E})}},[le,V,Xe,h]);y.useEffect(()=>{try{const m=Xe(),b={pages:g,currentPage:h,savedAt:Date.now()},x=JSON.stringify(b),w=Math.round(x.length/1024);w<2048?localStorage.setItem(m,x):console.warn(` Datos demasiado grandes para localStorage (${w} KB), saltando guardado`)}catch(m){if(console.error(" Error guardando currentPage en localStorage:",m),m.name==="QuotaExceededError")try{const b=Xe();localStorage.removeItem(b),console.log(" localStorage limpiado debido a QuotaExceededError")}catch(b){console.error("Error limpiando localStorage:",b)}}},[h,g,Xe]),y.useCallback(()=>{me({}),console.log(" Thumbnails limpiados para liberar memoria"),setTimeout(()=>{g[h]&&(console.log(" Forzando regeneracin de thumbnail para pgina actual..."),Ne())},500)},[Ne,g,h]),y.useCallback(async()=>{console.log(" [DEBUG] Generando thumbnail manualmente..."),console.log(" [DEBUG] Pgina actual:",h),console.log(" [DEBUG] Datos de la pgina:",g[h]);try{const m=await ye({type:"thumbnail"});console.log(" [DEBUG] Resultado de captura:",m?"SUCCESS":"FAILED"),m&&(me(b=>({...b,[g[h].id]:m})),console.log(" [DEBUG] Thumbnail guardado exitosamente"))}catch(m){console.error(" [DEBUG] Error en debug thumbnail:",m)}},[ye,h,g]);const Zr=m=>{const b=Ce.find(B=>B.id===m);if(!b)return;const x=[...g],w=x[h],E=Array.from({length:b.cells}).map((B,M)=>w.cells[M]||{id:`cell-${w.id}-${M+1}`,elements:[]});x[h]={...w,layout:m,cells:E},He(x),F(null),K(null)},rr=(m,b)=>{console.log(" [DEBUG] addElementToCell llamado:",{cellId:m,elementId:b.id,type:b.type});const x=[...g];for(let w=0;w<x[h].cells.length;w++)x[h].cells[w].id===m&&(x[h].cells[w].elements.push(b),console.log(" [DEBUG] Elemento aadido a celda. Total elementos en celda:",x[h].cells[w].elements.length));He(x),F(b.id),K(m),console.log(" [DEBUG] Elemento aadido, thumbnail debera regenerarse")},A=(m,b,x,w=!1)=>{const E=[...g],B=E[h].cells.findIndex(M=>M.id===m);if(B!==-1){if(w)E[h].cells[B].elements.push({...E[h].cells[B].elements.find(M=>M.id===b),...x}),console.log(" [DEBUG] Elemento duplicado, thumbnail debera regenerarse");else{const M=E[h].cells[B].elements.findIndex(j=>j.id===b);M!==-1&&(E[h].cells[B].elements[M]={...E[h].cells[B].elements[M],...x},console.log(" [DEBUG] Elemento actualizado, thumbnail debera regenerarse"))}He(E)}},ee=(m,b)=>{console.log(" [DEBUG] Eliminando elemento, thumbnail debera regenerarse");const x=[...g],w=x[h].cells.findIndex(E=>E.id===m);w!==-1&&(x[h].cells[w].elements=x[h].cells[w].elements.filter(E=>E.id!==b),He(x),N===b&&F(null))},Fe=()=>{V>0&&(pe(V-1),S(JSON.parse(le[V-1])),F(null),K(null))},tr=()=>{V<le.length-1&&(pe(V+1),S(JSON.parse(le[V+1])),F(null),K(null))},nr=y.useMemo(()=>{var E;const m=g[h];if(!m)return null;const b=((E=m.cells)==null?void 0:E.flatMap(B=>B.elements||[]))||[],x=b.map(B=>({id:B.id,type:B.type,position:B.position,size:B.size}));return{pageId:m.id,elementsCount:b.length,contentHash:JSON.stringify(x).substring(0,100),backgroundImage:m.backgroundImage,backgroundColor:m.backgroundColor,layout:m.layout}},[g,h]);y.useEffect(()=>{if(g.length===0||c||!nr){console.log(" [DEBUG] Saltando generacin de thumbnail:",{pagesLength:g.length,isLoading:c,hasKey:!!nr});return}let m=!1;const b=async()=>{try{const w=g[h];if(!w||!w.id){console.log(" [DEBUG] No hay pgina actual vlida");return}const E=w.id;if(console.log(" [DEBUG] Forzando regeneracin de miniatura para pgina:",E),console.log(" [DEBUG] Clave de generacin completa:",nr),me(M=>{const j={...M};return delete j[E],j}),await new Promise(M=>setTimeout(M,100)),m){console.log(" [DEBUG] Generacin cancelada");return}console.log(" [DEBUG] Capturando workspace...");const B=await ye();B&&!m?(console.log(" [DEBUG] Miniatura capturada, aplicando..."),me(M=>({...M,[E]:B})),console.log(" [DEBUG] Miniatura regenerada exitosamente para:",E)):console.warn(" [DEBUG] No se pudo generar miniatura para:",E)}catch(w){m||console.error(" [DEBUG] Error regenerando miniatura:",w)}},x=setTimeout(()=>{console.log(" [DEBUG] Ejecutando generacin de thumbnail despus del debounce"),b()},500);return()=>{m=!0,clearTimeout(x)}},[h,nr,c,ye]),y.useEffect(()=>{if(g.length===0||c)return;const m=async()=>{const x=g.filter(w=>!oe[w.id]);if(x.length!==0){console.log(" Generando miniaturas en segundo plano para",x.length,"pginas");for(const w of x)try{const E=document.createElement("canvas");E.width=200,E.height=150;const B=E.getContext("2d");if(B.fillStyle=w.backgroundColor||"#ffffff",B.fillRect(0,0,200,150),w.backgroundImage)try{const j=new Image;j.crossOrigin="anonymous",await new Promise((L,H)=>{j.onload=L,j.onerror=H,j.src=w.backgroundImage}),B.drawImage(j,0,0,200,150)}catch(j){console.warn("No se pudo cargar imagen de fondo para miniatura:",j)}w.cells&&w.cells.forEach(j=>{j.elements&&j.elements.forEach(L=>{var H;L.type==="text"&&L.content&&(B.fillStyle=((H=L.style)==null?void 0:H.color)||"#000000",B.font="12px Arial",B.fillText(L.content.substring(0,20)+(L.content.length>20?"...":""),10,30))})});const M=E.toDataURL("image/jpeg",.7);me(j=>({...j,[w.id]:M})),console.log(" Miniatura de fondo generada para:",w.id),await new Promise(j=>setTimeout(j,300))}catch(E){console.error(" Error generando miniatura de fondo para:",w.id,E)}}},b=setTimeout(()=>{m()},2e3);return()=>clearTimeout(b)},[g,oe,c]);const Po=async()=>{var m;console.log(" === INICIO addAlbumToCart CON BACKEND PDF ===");try{if(console.log(" Estado actual:",{itemData:t,presetData:a,cartLength:u==null?void 0:u.length,pagesLength:g==null?void 0:g.length,projectId:e==null?void 0:e.id}),!t||!a||!(e!=null&&e.id))return console.error(" Faltan datos necesarios para crear el lbum"),console.log("itemData:",t),console.log("presetData:",a),console.log("projectData:",e),Pe.error("Error: Datos del lbum incompletos"),!1;console.log(" Guardando progreso final en base de datos..."),await er(g,!0)||console.warn(" No se pudo guardar el progreso, pero continuando..."),console.log(" Preparando datos para PDF backend...");const x={project_data:{id:e.id,title:(t==null?void 0:t.name)||"lbum Personalizado",pages:g,workspace_dimensions:G,created_at:new Date().toISOString()},item_data:{id:t==null?void 0:t.id,name:(t==null?void 0:t.name)||(t==null?void 0:t.title),price:t==null?void 0:t.price,user_id:t==null?void 0:t.user_id,width:t==null?void 0:t.width,height:t==null?void 0:t.height},preset_data:{id:a==null?void 0:a.id,width:a==null?void 0:a.width,height:a==null?void 0:a.height,cover_image:a==null?void 0:a.cover_image,content_layer_image:a==null?void 0:a.content_layer_image,final_layer_image:a==null?void 0:a.final_layer_image},dimensions:{width_mm:(a==null?void 0:a.width)||(t==null?void 0:t.width)||210,height_mm:(a==null?void 0:a.height)||(t==null?void 0:t.height)||297,workspace_width:(G==null?void 0:G.width)||800,workspace_height:(G==null?void 0:G.height)||600}};console.log(" Marcando proyecto listo para PDF backend...");try{const z=await fetch("/api/canvas-projects/save",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({id:e.id,status:"ready_for_pdf",pdf_data:x,completed_at:new Date().toISOString()})});if(z.ok){const q=await z.json();console.log(" Proyecto marcado como completado:",q)}else console.warn(" Error marcando proyecto como completado")}catch(z){console.warn(" Error en marcado de completado:",z)}console.log(" Generando project_id nico...");const w=Date.now(),E=e.id;console.log(" Project ID para carrito:",E),window.currentProjectId=E,window.albumProjectId=E,console.log(" Creando producto del lbum...");let B=a.cover_image;oe&&oe["page-cover"]&&(B=oe["page-cover"]);let M=B;B&&B.startsWith("data:image/")&&B.length>1e5&&(console.log(" Thumbnail muy grande, usando imagen del preset"),M=a.cover_image||"/assets/img/default-album.jpg");const j={...t,project_id:E,canvas_project_id:e.id,quantity:1,type:"custom_album",pdf_metadata:{width_mm:a.width,height_mm:a.height,pages_count:g.length,workspace_dimensions:G,requires_pdf_generation:!0}};console.log(" Producto del lbum creado:",j),console.log(" Agregando producto al carrito...");const L=structuredClone(u),H=L.findIndex(z=>z.id==j.id);return H==-1?(L.push({...j,quantity:1}),console.log(" Producto agregado como nuevo item")):(L[H].quantity++,console.log(" Cantidad incrementada para producto existente")),v(L),console.log(" Carrito actualizado:",L.length,"items"),Pe.success("lbum agregado al carrito",{description:`${j.name} se ha aadido al carrito. El PDF se generar en el backend.`,icon:l.jsx(ei,{className:"h-5 w-5 text-green-500"}),duration:4e3,position:"bottom-center"}),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{cart:L,action:"add",product:j}})),console.log(" === FIN addAlbumToCart EXITOSO ==="),!0}catch(b){return console.error(" === ERROR EN addAlbumToCart ==="),console.error("Error completo:",b),console.error("Stack trace:",b.stack),console.error("Mensaje del error:",b.message),Pe.error("Error al agregar al carrito",{description:`Error especfico: ${b.message}`,duration:5e3,position:"bottom-center"}),!1}};window.finalizeAlbumDesign=async()=>{console.log(" Iniciando finalizacin del diseo del lbum...");try{if(!g||g.length===0)throw new Error("No hay pginas para finalizar");const b={pages:(z=>z.map(q=>({id:q.id,type:q.type,pageNumber:q.pageNumber,layout:q.layout,cells:q.cells.map(re=>({id:re.id,elements:re.elements.map(P=>{const $={id:P.id,type:P.type,position:P.position,zIndex:P.zIndex||1};if(P.type==="image"){if(P.content.startsWith("data:image/")){const X=btoa(P.content.substring(0,100)).substring(0,20);$.content=`[BASE64_IMAGE_${X}]`,$.contentType=P.content.split(";")[0].split(":")[1],$.originalSize=P.content.length}else $.content=P.content;if(P.filters){const X=Object.entries(P.filters).filter(([W,de])=>de!==0&&de!==!1&&de!==null).reduce((W,[de,ce])=>(W[de]=ce,W),{});Object.keys(X).length>0&&($.filters=X)}P.mask&&P.mask!=="none"&&($.mask=P.mask),P.size&&($.size=P.size),P.locked&&($.locked=P.locked)}else if(P.type==="text"&&($.content=P.content,P.style)){const X=Object.entries(P.style).filter(([W,de])=>!(W==="fontSize"&&de==="16px"||W==="color"&&de==="#000000"||W==="fontFamily"&&de==="Arial")).reduce((W,[de,ce])=>(W[de]=ce,W),{});Object.keys(X).length>0&&($.style=X)}return $})}))})))(g),projectInfo:{id:e==null?void 0:e.id,item_id:t==null?void 0:t.id,title:t==null?void 0:t.title,preset_id:a==null?void 0:a.id},presetInfo:{id:a==null?void 0:a.id,name:a==null?void 0:a.name,cover_image:a==null?void 0:a.cover_image,content_image:a==null?void 0:a.content_image,back_cover_image:a==null?void 0:a.back_cover_image},workspace:{width:G.width,height:G.height,scale:G.scale},meta:{finalizedAt:new Date().toISOString(),version:"1.3"}},x=JSON.stringify({design_data:b}),w=Math.round(x.length/1024),E=Math.round(w/1024*100)/100;console.log(`Tamao del payload: ${w} KB (${E} MB)`);let B=0,M=0;g.forEach(z=>{var q;(q=z.cells)==null||q.forEach(re=>{var P;(P=re.elements)==null||P.forEach($=>{$.type==="image"&&$.content&&$.content.startsWith("data:image/")&&(B++,M+=$.content.length)})})});const j=Math.round(M/(1024*1024)*100)/100;if(console.log(`Imgenes base64 encontradas: ${B}, Tamao total: ${j} MB`),w>1024&&!confirm(`El diseo contiene ${B} imgenes (${j} MB en imgenes). Payload completo: ${E} MB. Esto podra causar problemas al guardarlo. Desea continuar de todos modos?`))return!1;const L=await fetch(`/api/canvas/projects/${e.id}/save`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:x});if(!L.ok){let z="Error al finalizar el diseo";try{z=(await L.json()).message||z}catch{L.status===413?z="El diseo es demasiado grande para ser guardado. Intente simplificar las imgenes.":L.status>=500&&(z="Error del servidor. Intente nuevamente ms tarde.")}throw new Error(z)}const H=await L.json();return console.log(" Diseo finalizado exitosamente en el servidor"),console.log(" Respuesta del servidor:",H),!0}catch(m){console.error("Error al finalizar diseo:",m);let b=m.message;return m.message.includes("Failed to fetch")?b="Error de conexin. Verifique su conexin a internet e intente nuevamente.":(m.message.includes("NetworkError")||m.message.includes("net::"))&&(b="Error de red. Intente nuevamente ms tarde."),alert("Error al finalizar el diseo: "+b),!1}};const Do=y.useCallback(async()=>{console.log(" === INICIO generateAlbumPDF ===");try{const{jsPDF:m}=await jo(async()=>{const{jsPDF:W}=await import("./jspdf.es.min-CHaihsQY.js").then(de=>de.j);return{jsPDF:W}},__vite__mapDeps([0,1,2,3,4]));let b=(a==null?void 0:a.width)||21,x=(a==null?void 0:a.height)||29.7;const w=.3,E=b+w*2,B=x+w*2,M=E*28.35,j=B*28.35;console.log(" Dimensiones PDF con sangrado profesional:",{originalWidthCm:b,originalHeightCm:x,printWidthCm:E,printHeightCm:B,widthPt:M,heightPt:j,bleedCm:w});const L=new m({orientation:M>j?"landscape":"portrait",unit:"pt",format:[M,j],compress:!1}),H=g.length;let z=0;const q=document.createElement("div");q.id="pdf-progress",q.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",q.innerHTML=`
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Generando PDF de alta calidad...</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="pdf-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                        <span id="current-page">0</span> de ${H} pginas procesadas
                    </p>
                </div>
            `,document.body.appendChild(q);const re=W=>{const de=W/H*100;document.getElementById("pdf-progress-bar").style.width=`${de}%`,document.getElementById("current-page").textContent=W},P=h;for(let W=0;W<g.length;W++){const de=g[W];console.log(` Procesando pgina ${W+1}/${H}: ${de.id}`),C(W),await new Promise(ce=>setTimeout(ce,500));try{const ce=await ye({type:"pdf"});if(ce){const ae=ce.width/ce.height,ze=M/j;let we,Ee,We=0,ur=0;ae>ze?(we=M,Ee=M/ae,ur=(j-Ee)/2):(Ee=j,we=j*ae,We=(M-we)/2);const gr=ce.toDataURL("image/png",1);W>0&&L.addPage([M,j]),L.addImage(gr,"PNG",We,ur,we,Ee),console.log(` Pgina ${W+1} agregada al PDF`)}else console.warn(` No se pudo capturar la pgina ${W+1}`),W>0&&L.addPage([M,j]),L.setFontSize(12),L.text(`Error al renderizar pgina ${W+1}`,M/2,j/2,{align:"center"})}catch(ce){console.error(` Error procesando pgina ${W+1}:`,ce),W>0&&L.addPage([M,j]),L.setFontSize(12),L.text(`Error al procesar pgina ${W+1}`,M/2,j/2,{align:"center"})}z++,re(z),await new Promise(ce=>setTimeout(ce,200))}C(P);const $=`${(t==null?void 0:t.name)||"album"}_${new Date().toISOString().split("T")[0]}.pdf`;L.save($),document.body.removeChild(q),console.log(" PDF generado exitosamente:",$);const X=document.createElement("div");return X.className="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",X.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>PDF de alta calidad generado: ${$}</span>
                </div>
            `,document.body.appendChild(X),setTimeout(()=>{document.body.contains(X)&&document.body.removeChild(X)},5e3),$}catch(m){console.error(" Error generando PDF:",m);const b=document.getElementById("pdf-progress");b&&document.body.removeChild(b);const x=document.createElement("div");throw x.className="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",x.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Error al generar PDF: ${m.message}</span>
                </div>
            `,document.body.appendChild(x),setTimeout(()=>{document.body.contains(x)&&document.body.removeChild(x)},7e3),m}},[g,h,C,ye,a,t]);return window.generateAlbumPDF=Do,window.generateHighQualityThumbnail=Be,window.captureCurrentWorkspace=ye,l.jsxs(Bo,{backend:Mo,className:"!h-screen !w-screen overflow-hidden",children:[c?l.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:l.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),l.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Cargando Editor"}),l.jsx("p",{className:"customtext-neutral-dark",children:"Preparando tu lbum personalizado..."})]})}):f?l.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:l.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[l.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Error"}),l.jsx("p",{className:"customtext-neutral-dark mb-4",children:f}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Reintentar"}),l.jsx("button",{onClick:()=>window.history.back(),className:"w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Volver"})]})]})}):g.length===0?l.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:l.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[l.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Inicializando Editor"}),l.jsx("p",{className:"customtext-neutral-dark mb-4",children:"Generando pginas del lbum..."}),l.jsx("div",{className:"animate-pulse flex space-x-4",children:l.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[l.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"h-4 bg-gray-300 rounded"}),l.jsx("div",{className:"h-4 bg-gray-300 rounded w-5/6"})]})]})})]})}):l.jsxs("div",{className:"h-screen w-screen overflow-hidden bg-gray-50 font-paragraph",children:[l.jsx(Yo,{isOpen:cr,onRequestClose:()=>Ye(!1),pages:g.map(m=>({...m,layout:Ce.find(b=>b.id===m.layout)||Ce[0]})),workspaceDimensions:G,getCurrentLayout:m=>m?Ce.find(b=>b.id===m.layout)||Ce[0]:Ce[0],presetData:a,pageThumbnails:oe,addAlbumToCart:Po,projectData:e,itemData:t}),l.jsx("header",{className:"fixed top-0 left-0 right-0 h-16 border-b bg-primary shadow-sm flex items-center px-4 z-10",children:l.jsxs("div",{className:"container mx-auto flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("img",{src:`/assets/resources/logo.png?v=${crypto.randomUUID()}`,alt:Pt.APP_NAME,className:"h-7 object-contain object-center invert brightness-0"}),l.jsx("div",{className:"h-6 w-px bg-white/20"}),l.jsx("h1",{className:"text-lg font-bold text-white truncate hidden sm:block",children:(e==null?void 0:e.name)||"lbum Sin Ttulo"})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:"bg-white/10 rounded-full px-4 py-1.5 flex items-center gap-2",children:[l.jsx("span",{className:"h-2 w-2 rounded-full bg-secondary animate-pulse"}),l.jsx("p",{className:"text-sm text-white font-medium",children:_r()})]}),l.jsx("div",{className:"text-xs text-white/70 hidden sm:block",children:g.length>0&&`${g.length} pginas total`}),Qr()?l.jsx("span",{className:"bg-white/10 text-white/80 px-2 py-2 rounded-md text-xs font-medium flex items-center gap-1",children:l.jsx(Ei,{className:"h-3 w-3"})}):l.jsx("span",{className:"bg-white/10 text-white/80 px-2 py-2 rounded-md text-xs font-medium flex items-center gap-1",children:l.jsx(yi,{className:"h-3 w-3"})})]}),l.jsxs("div",{className:"flex gap-3 items-center",children:[l.jsx(Zu,{saveStatus:ve.saveStatus,lastSaved:ve.lastSaved,lastAutoSaved:ve.lastAutoSaved,hasUnsavedChanges:ve.hasUnsavedChanges,isOnline:ve.isOnline,saveError:ve.saveError,onManualSave:ve.saveManually}),l.jsx(Je,{variant:"secondary",size:"sm",onClick:()=>Ye(!0),icon:l.jsx($t,{className:"h-4 w-4"}),children:"Vista de lbum"}),!1]})]})}),l.jsxs("div",{className:"flex w-full h-full pt-16",children:[l.jsxs("aside",{className:"w-64 bg-white border-r flex flex-col",children:[l.jsx("div",{className:"p-3 border-b",children:l.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-md",children:[l.jsx("button",{className:`flex-1 py-1.5 text-xs font-medium rounded-md transition ${te==="elements"?"bg-white shadow-sm text-purple-700":"customtext-neutral-dark hover:bg-white/50"}`,onClick:()=>J("elements"),children:"Elementos"}),l.jsx("button",{className:`flex-1 py-1.5 text-xs font-medium rounded-md transition ${te==="filters"?"bg-white shadow-sm text-purple-700":"customtext-neutral-dark hover:bg-white/50"}`,onClick:()=>J("filters"),children:"Filtros"})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-3 custom-scroll",children:[te==="elements"&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"font-medium text-xs uppercase customtext-neutral-dark mb-2",children:"Layouts"}),l.jsx(Gu,{currentLayoutId:(xn=g[h])==null?void 0:xn.layout,onLayoutChange:Zr})]}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-medium text-xs uppercase customtext-neutral-dark mb-2",children:"Capas"}),l.jsx(zu,{elements:((yn=g[h].cells.find(m=>m.id===T))==null?void 0:yn.elements)||[],onReorder:m=>{const b=[...g],x=b[h].cells.findIndex(w=>w.id===T);x!==-1&&(b[h].cells[x].elements=m,He(b))},onSelect:xr,selectedElement:N})]})]}),te==="filters"&&l.jsx("div",{className:"space-y-3 max-h-full",children:(()=>{const m=br();return m?l.jsxs(l.Fragment,{children:[m.type==="image"&&l.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx(Br,{className:"h-4 w-4 text-purple-600"}),l.jsx("span",{className:"text-sm font-medium",children:"Imagen seleccionada"})]}),l.jsx("div",{className:"w-full h-16 rounded-md overflow-hidden bg-gray-200",children:l.jsx("img",{src:m.content,alt:"",className:"w-full h-full object-cover"})})]}),m.type==="image"&&l.jsxs("div",{className:"border-t pt-3",children:[l.jsx("h3",{className:"font-medium text-xs uppercase customtext-neutral-dark mb-2",children:"Mscaras"}),l.jsx(Uu,{selectedMask:m.mask||"none",onSelect:b=>{A(T,N,{mask:b})},availableMasks:va.map(b=>b.id),selectedImage:m})]}),l.jsxs("div",{className:"border-t pt-3",children:[l.jsx("h3",{className:"font-medium text-xs uppercase customtext-neutral-dark mb-2",children:"Filtros y efectos"}),l.jsx("div",{className:"",children:l.jsx(Lo,{filters:m.filters||{},onFilterChange:b=>{A(T,N,{filters:b})},selectedElement:m})})]})]}):l.jsxs("div",{className:"text-center py-8 px-2",children:[l.jsx("div",{className:"bg-gray-100 p-4 rounded-lg mb-3",children:l.jsx(Br,{className:"h-6 w-6 text-gray-400 mx-auto"})}),l.jsx("h3",{className:"text-sm font-medium customtext-neutral-dark",children:"Selecciona un elemento"}),l.jsx("p",{className:"text-xs customtext-neutral-dark mt-1",children:"Para aplicar filtros y efectos, primero selecciona una imagen o texto en el lienzo"})]})})()})]})]}),l.jsxs("main",{className:"flex-1 flex flex-col h-full",children:[l.jsx("div",{className:"bg-white border-b px-4 py-2 flex items-center justify-between",children:_e?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(Je,{variant:"ghost",size:"sm",onClick:()=>Me(!1),className:"h-8 px-2",icon:l.jsx(Zo,{className:"h-4 w-4"}),children:"Volver"}),l.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"})]}),l.jsx("div",{className:"flex-1 flex justify-start",children:l.jsx(Yu,{element:br(),onUpdate:m=>{A(qe.cellId,qe.elementId,m)},onClose:()=>Me(!1)})})]}):l.jsx(l.Fragment,{children:l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsxs("div",{className:"flex space-x-1",children:[l.jsx(Je,{variant:"ghost",size:"sm",onClick:Fe,disabled:V<=0,className:"h-8 px-2",icon:l.jsx(Fo,{className:"h-4 w-4"}),children:"Deshacer"}),l.jsx(Je,{variant:"ghost",size:"sm",onClick:tr,disabled:V>=le.length-1,className:"h-8 px-2",icon:l.jsx(zo,{className:"h-4 w-4"}),children:"Rehacer"})]}),l.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),l.jsxs("div",{className:"flex space-x-1",children:[l.jsx(Je,{variant:"ghost",size:"sm",onClick:()=>{const m=document.createElement("input");m.type="file",m.accept="image/*",m.onchange=b=>{if(b.target.files&&b.target.files[0]){const w={id:`img-${Date.now()}`,type:"image",content:"",position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"},E=new FileReader;E.onload=B=>{var M,j;(M=B.target)!=null&&M.result&&(w.content=B.target.result,T?rr(T,w):(j=g[h])!=null&&j.cells[0]&&rr(g[h].cells[0].id,w))},E.readAsDataURL(b.target.files[0])}},m.click()},className:"h-8 px-2",icon:l.jsx(Br,{className:"h-4 w-4"}),children:"Imagen"}),l.jsx(Je,{variant:"ghost",tooltip:"Aadir Imagen",onClick:()=>vr.current&&vr.current.click(),children:l.jsx(Br,{className:"w-5 h-5"})}),l.jsx("input",{type:"file",ref:vr,onChange:qr,className:"hidden",accept:"image/*"}),l.jsx(Je,{variant:"ghost",tooltip:"Aadir Texto",onClick:Yr,children:l.jsx(Mr,{className:"w-5 h-5"})})]}),l.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),N&&l.jsxs("div",{className:"flex space-x-1",children:[l.jsx(Je,{variant:"ghost",size:"sm",onClick:()=>{if(N&&T){const m=br();if(m){const b={...m,id:`${m.type}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,position:{x:m.position.x+.05,y:m.position.y+.05}};rr(T,b)}}},className:"h-8 px-2",icon:l.jsx(Ho,{className:"h-4 w-4"}),children:"Duplicar"}),l.jsx(Je,{variant:"ghost",size:"sm",onClick:()=>{N&&T&&ee(T,N)},className:"h-8 px-2 text-red-600 hover:text-white",icon:l.jsx(xa,{className:"h-4 w-4"}),children:"Eliminar"})]}),l.jsx("div",{className:"flex items-center space-x-2",children:l.jsx(Xu,{currentSize:I,onSizeChange:D,presetData:a,workspaceDimensions:G})})]})})}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-6 overflow-hidden bg-gray-100",children:k?l.jsx("div",{className:"bg-white rounded-lg shadow-lg",children:l.jsx("div",{className:"overflow-hidden",style:{width:G.width,height:G.height},children:l.jsx("div",{id:`page-${g[h].id}`,className:`grid ${Le().template} gap-6`,style:{width:"100%",height:"100%"},children:g[h].cells.map((m,b)=>{var x;return l.jsx(Pn,{id:m.id,elements:m.elements.filter(w=>!w.locked),workspaceSize:G,cellStyle:(x=Le().cellStyles)==null?void 0:x[g[h].cells.indexOf(m)],selectedElement:T===m.id?N:null,onSelectElement:xr,onAddElement:(w,E)=>rr(E,w),onUpdateElement:(w,E,B)=>A(m.id,w,E,B),onDeleteElement:w=>ee(m.id,w),availableMasks:Le().maskCategories.flatMap(w=>w.masks)},m.id)})})})}):l.jsxs("div",{id:`page-${g[h].id}`,className:" shadow-xl overflow-hidden",style:{width:G.width,height:G.height,position:"relative",backgroundColor:((wn=g[h])==null?void 0:wn.backgroundColor)||"#ffffff",backgroundImage:(Cn=g[h])!=null&&Cn.backgroundImage?`url(${g[h].backgroundImage})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:["                                        ",(()=>{const m=g[h];if(console.log(" [WORKSPACE] Renderizando background para pgina:",m==null?void 0:m.type),console.log(" [WORKSPACE] backgroundImage:",m==null?void 0:m.backgroundImage),console.log(" [WORKSPACE] backgroundColor:",m==null?void 0:m.backgroundColor),m!=null&&m.backgroundImage){const b=window.location.origin+m.backgroundImage;console.log(" [WORKSPACE] URL completa de la imagen:",b),console.log(" [WORKSPACE] URL relativa:",m.backgroundImage),fetch(m.backgroundImage,{method:"HEAD"}).then(x=>{x.ok?console.log(" [WORKSPACE] Imagen existe en el servidor"):console.error(" [WORKSPACE] Imagen NO existe en el servidor. Status:",x.status)}).catch(x=>{console.error(" [WORKSPACE] Error verificando imagen:",x)})}return m!=null&&m.backgroundImage?(console.log(" [WORKSPACE] Aplicando imagen de fondo:",m.backgroundImage),l.jsx("img",{src:m.backgroundImage,alt:"background",className:"absolute inset-0 w-full h-full object-cover pointer-events-none",style:{zIndex:1},onLoad:()=>{var b,x,w,E;console.log(" [WORKSPACE] Imagen de fondo cargada exitosamente"),console.log(" [WORKSPACE] Dimensiones de la imagen cargada:",(x=(b=arguments[0])==null?void 0:b.target)==null?void 0:x.naturalWidth,"x",(E=(w=arguments[0])==null?void 0:w.target)==null?void 0:E.naturalHeight)},onError:b=>{console.error(" [WORKSPACE] Error cargando imagen de fondo:",b),console.error(" [WORKSPACE] URL que fall:",b.target.src),console.error(" [WORKSPACE] Error details:",b.target.error)}})):m!=null&&m.backgroundColor?(console.log(" [WORKSPACE] Aplicando color de fondo:",m.backgroundColor),l.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{backgroundColor:m.backgroundColor,zIndex:1}})):(console.log(" [WORKSPACE] Sin fondo personalizado, usando fondo por defecto"),null)})(),l.jsx("div",{className:`grid ${Le().template}`,style:{position:"relative",zIndex:10,width:"100%",height:"100%",boxSizing:"border-box",gap:((Sn=Le().style)==null?void 0:Sn.gap)||"16px",padding:((En=Le().style)==null?void 0:En.padding)||"16px"},children:g[h].cells.map(m=>{var b;return l.jsx(Pn,{id:m.id,elements:m.elements.filter(x=>!x.locked),workspaceSize:G,cellStyle:(b=Le().cellStyles)==null?void 0:b[g[h].cells.indexOf(m)],selectedElement:T===m.id?N:null,onSelectElement:xr,onAddElement:(x,w)=>rr(w,x),onUpdateElement:(x,w,E)=>A(m.id,x,w,E),onDeleteElement:x=>ee(m.id,x),availableMasks:Le().maskCategories.flatMap(x=>x.masks)},m.id)})})]})})]}),l.jsxs("aside",{className:"w-52 bg-white border-l flex flex-col h-full",children:[l.jsx("div",{className:"p-4 border-b bg-gray-50",children:l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs("h3",{className:"font-medium text-sm text-gray-700 flex items-center gap-1.5",children:[l.jsx($t,{className:"h-4 w-4 text-purple-600"}),"Pginas"]}),l.jsxs("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded-full border",children:[g.length," total"]})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scroll",children:l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mr-1.5"}),"Portada"]}),hr.cover.map((m,b)=>l.jsx("div",{className:`relative group flex flex-col cursor-pointer  transition-all duration-200 transform 
                            ${h===g.indexOf(m)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                            mb-2`,onClick:()=>C(g.indexOf(m)),children:l.jsxs("div",{className:"relative bg-purple-50  overflow-hidden border aspect-[4/3] ",children:[l.jsx(Ut,{pageId:m.id,thumbnail:oe[m.id],altText:"Portada",type:"cover"}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:l.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Portada"})})]})},m.id))]}),l.jsxs("div",{children:[l.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mr-1.5"}),"Pginas de contenido"]}),l.jsx("div",{className:"space-y-2",children:hr.content.map((m,b)=>l.jsx("div",{className:`relative group flex flex-col cursor-pointer  transition-all duration-200 transform 
                                ${h===g.indexOf(m)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                mb-1`,onClick:()=>C(g.indexOf(m)),children:l.jsxs("div",{className:"relative  overflow-hidden border aspect-[4/3]",children:[l.jsx(Ut,{pageId:m.id,thumbnail:oe[m.id],altText:`Pgina ${m.pageNumber}`,type:"content"}),l.jsx("div",{className:"absolute top-1 left-1 bg-white/90 rounded-full h-5 w-5 flex items-center justify-center text-[10px] font-bold shadow-sm",children:m.pageNumber}),l.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-[9px] px-1.5 py-0.5 rounded-full opacity-80 group-hover:opacity-100",children:"Editable"})]})},m.id))})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mr-1.5"}),"Contraportada"]}),hr.final.map((m,b)=>l.jsx("div",{className:`relative group flex flex-col cursor-pointer  transition-all duration-200 transform 
                            ${h===g.indexOf(m)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                            mb-2`,onClick:()=>C(g.indexOf(m)),children:l.jsxs("div",{className:"relative  overflow-hidden border mb-1 aspect-[4/3]",children:[l.jsx(Ut,{pageId:m.id,thumbnail:oe[m.id],altText:"Contraportada",type:"final"}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:l.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Contraportada"})})]})},m.id))]})]})})]})]})]}),l.jsx(Wo,{}),l.jsx(eg,{isOpen:Qe,onClose:()=>dr(!1),savedProgress:$e,onLoadProgress:Xr,onDiscardProgress:Jr})]})}export{Yg as default};
