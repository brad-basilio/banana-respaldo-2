const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-D3plwuQr.js","assets/index-BH53Isel.js","assets/index-yBjzXJbu.js","assets/preload-helper-BfFHrpNk.js","assets/typeof-QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{_ as ko}from"./preload-helper-BfFHrpNk.js";import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as p,R as Jt}from"./index-BH53Isel.js";import{T as Yt,l as te,i as Qt,a as Co,D as So,H as Ao,U as Po,R as Io,F as To,E as Gt}from"./EditableCell-Cu-5czkC.js";import{h as Vt}from"./thumbnailGenerator-B4goYG9Y.js";import{L as We}from"./layers-6oegOx-p.js";import{C as Oo}from"./chevron-down-DS-mdh9v.js";import{C as Mo}from"./chevron-right-Ckt5D2ka.js";import{E as _o}from"./eye-CKCH9ORv.js";import{c as se}from"./createLucideIcon-Cy5Ya80P.js";import{T as Zt}from"./trash-2-DK1wnsDn.js";import{S as $o}from"./star-wPQTHY_n.js";import{I as Ce}from"./image-BEA0kkBS.js";import{F as Ro}from"./EditorLayout-CkCvwqGw.js";import"./jspdf.es.min-D3plwuQr.js";import{t as S,T as Lo}from"./index-BZYhE2TF.js";import{m as Wt}from"./main-6DCdASTx.js";import{B as Fo}from"./V1Edit-CNtDxOEt.js";import{G as qt}from"./Global-ErywZRdd.js";import{S as eo,F as Uo}from"./save-BfW-kI1U.js";import{C as zo}from"./clock-BTrEpQej.js";import{C as to}from"./check-DQ7QoS0v.js";import{L as Bo}from"./loader-circle-CrvBvIt1.js";import{B as qe}from"./dom-to-image-more.min-Cey65QPP.js";import{C as Ho}from"./chevron-left-B2s3ZsB7.js";import{U as Go}from"./user-BvYmyGTY.js";import{P as $e}from"./plus-Bot15Khs.js";import{F as Vo}from"./filter-Ci9tsc_e.js";import{C as Wo}from"./circle-check-big-D6DM3vPb.js";import{u as qo}from"./useDrag-BaORhKlM.js";import"./index-yBjzXJbu.js";import"./sparkles-DeLUn6av.js";import"./sliders-vertical-C5ts4taK.js";import"./palette-DV_Vpyg9.js";import"./settings-BSPs3Zt8.js";import"./chevron-up-D78jyEhP.js";import"./copy-6OEekgvq.js";import"./TextElement-_pvTHO57.js";import"./upload-qgEr5bIl.js";import"./typeof-QjJsDpFa.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./PaymentModal-Bxx5p2o_.js";import"./index-Chjiymov.js";import"./x-DBMwyD6F.js";import"./download-Dh5rRDOT.js";import"./index-BSWw-p5k.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=se("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=se("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=se("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=se("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=se("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=se("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=se("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zo=se("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=se("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=se("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=se("Sticker",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M14 3v4a2 2 0 0 0 2 2h4",key:"36rjfy"}],["path",{d:"M8 13h.01",key:"1sbv64"}],["path",{d:"M16 13h.01",key:"wip0gl"}],["path",{d:"M10 16s.8 1 2 1c1.3 0 2-1 2-1",key:"1vvgv3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oo=se("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=se("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=se("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),ar=({pages:n,currentPage:v,selectedCell:c,selectedElement:P,onSelectCell:s,onSelectElement:k,onUpdateElement:E,onDeleteElement:$,onMoveElement:L})=>{var oe;if(!n||!n[v])return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(We,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No page data available"})]});const I=n[v],V=((oe=I==null?void 0:I.cells)==null?void 0:oe.filter(C=>C.elements&&C.elements.length>0))||[],[z,H]=p.useState(()=>{const C={};return V.forEach(j=>{C[j.id]=!0}),C}),J=C=>{H(j=>({...j,[C]:!j[C]}))},i=C=>{switch(C){case"image":return e.jsx(Ce,{className:"h-4 w-4"});case"text":return e.jsx(Yt,{className:"h-4 w-4"});case"shape":return e.jsx(tr,{className:"h-4 w-4"});case"sticker":return e.jsx($o,{className:"h-4 w-4"});default:return e.jsx(Jo,{className:"h-4 w-4"})}},X=(C,j)=>{switch(C.type){case"text":return C.content?C.content.substring(0,20)+"...":"Text Layer";case"image":return`Image ${j+1}`;case"shape":return C.shape||"Shape";case"sticker":return`Sticker ${j+1}`;default:return`Element ${j+1}`}},m=(C,j,Q)=>{E(C,j,{visible:Q})},K=(C,j)=>{s(C),k(j)};return e.jsx("div",{className:"space-y-2",children:V.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(We,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No elements yet"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Add elements to see them here"})]}):V.map(C=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center p-3 cursor-pointer transition-colors ${c===C.id?"bg-purple-50 border-purple-200":"hover:bg-gray-50"}`,onClick:()=>{J(C.id),s(C.id)},children:[e.jsx("button",{className:"mr-2 text-gray-500 hover:text-gray-700",children:z[C.id]?e.jsx(Oo,{className:"h-4 w-4"}):e.jsx(Mo,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm text-gray-800",children:["Cell ",C.id]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[C.elements.length," element",C.elements.length!==1?"s":""]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[C.x,", ",C.y]})]}),z[C.id]&&e.jsx("div",{className:"border-t border-gray-100",children:C.elements.map((j,Q)=>e.jsxs("div",{className:`flex items-center p-2 mx-2 mb-2 rounded cursor-pointer transition-colors ${P===j.id?"bg-purple-100 border border-purple-200":"hover:bg-gray-50"}`,onClick:()=>K(C.id,j.id),children:[e.jsx("div",{className:"mr-2 text-gray-500",children:i(j.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm truncate",children:X(j,Q)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[j.type," • Layer ",Q+1]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:O=>{O.stopPropagation(),m(C.id,j.id,!j.visible)},className:"p-1 hover:bg-gray-200 rounded",title:j.visible?"Hide element":"Show element",children:j.visible!==!1?e.jsx(_o,{className:"h-3 w-3 text-gray-500"}):e.jsx(Qo,{className:"h-3 w-3 text-gray-400"})}),e.jsx("button",{onClick:O=>{O.stopPropagation(),L(C.id,j.id,"up")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer up",disabled:Q===C.elements.length-1,children:e.jsx(Ko,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:O=>{O.stopPropagation(),L(C.id,j.id,"down")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer down",disabled:Q===0,children:e.jsx(Xo,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:O=>{O.stopPropagation(),$(C.id,j.id)},className:"p-1 hover:bg-red-100 rounded text-red-500",title:"Delete element",children:e.jsx(Zt,{className:"h-3 w-3"})})]})]},j.id))})]},C.id))})};function sr({currentLayoutId:n,onLayoutChange:v}){const[c,P]=p.useState("all"),s={all:{name:"Todos",layouts:te},hero:{name:"Hero",layouts:te.filter(k=>k.category==="hero")},editorial:{name:"Editorial",layouts:te.filter(k=>k.category==="editorial")},storytelling:{name:"Historia",layouts:te.filter(k=>k.category==="storytelling")},minimal:{name:"Minimal",layouts:te.filter(k=>k.category==="minimal")},creative:{name:"Creativo",layouts:te.filter(k=>k.category==="creative")},classic:{name:"Clásico",layouts:te.filter(k=>k.category==="classic")}};return Object.keys(s).filter(k=>k==="all"||s[k].layouts.length>0),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"grid grid-cols-2  gap-3 overflow-x-hidden custom-scroll",children:s[c].layouts.map(k=>e.jsxs("div",{className:`relative group cursor-pointer transition-all duration-200 
                                 hover:shadow-md hover:scale-102
                        `,onClick:()=>v(k.id),children:[e.jsxs("div",{className:"aspect-square relative bg-white rounded-lg p-2 border border-gray-200",children:[e.jsx("div",{className:`w-full h-full grid ${k.template}`,style:{gap:"2px",padding:"4px"},children:Array.from({length:k.cells}).map((E,$)=>{var L,I;return e.jsx("div",{className:`bg-gradient-to-br from-purple-100 to-purple-200 ${(I=(L=k.cellStyles)==null?void 0:L[$])!=null&&I.includes("rounded")?"rounded":"rounded-sm"}`,style:{minHeight:"8px"}},$)})}),n===k.id&&e.jsx("div",{className:"absolute top-1/2 right-1/2 translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-900 truncate",children:k.name}),k.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:k.description}),e.jsx("div",{className:"flex items-center justify-center mt-1 space-x-2",children:e.jsxs("span",{className:"text-xs text-gray-400",children:[k.cells," ",k.cells===1?"celda":"celdas"]})})]})]},k.id))}),s[c].layouts.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"No hay layouts disponibles en esta categoría."})})]})}const nr=({selectedMask:n,onSelect:v,availableMasks:c=[],selectedImage:P})=>{var $,L;const[s,k]=p.useState("Básicas"),E={};return Qt.forEach(I=>{E[I.category]||(E[I.category]=[]),(c.includes(I.id)||I.id==="none")&&E[I.category].push(I)}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-1 bg-gray-100 p-1 rounded-lg",children:Object.keys(E).slice(0,2).map(I=>E[I].length>0&&e.jsx("button",{onClick:()=>k(I),className:`py-1.5 px-2 text-xs rounded-md transition font-medium ${s===I?"bg-white text-purple-700 shadow-sm":"text-gray-600 hover:text-purple-600"}`,children:I},I))}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:($=E[s])==null?void 0:$.slice(0,6).map(I=>e.jsxs("div",{onClick:()=>v(I.id),className:`cursor-pointer border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all ${n===I.id?"ring-2 ring-purple-500 border-purple-300":"border-gray-200"}`,children:[e.jsx("div",{className:"aspect-square bg-white flex items-center justify-center p-1",children:P!=null&&P.content?e.jsx("img",{src:P.content,alt:I.name,className:`w-full h-full object-cover ${I.class}`}):e.jsx("div",{className:`w-full h-full bg-gray-200 ${I.class}`})}),e.jsx("p",{className:"text-center text-[10px] text-gray-700 p-1 truncate",children:I.name})]},I.id))}),((L=E[s])==null?void 0:L.length)>6&&e.jsxs("button",{className:"w-full py-2 text-xs text-purple-600 hover:text-purple-700 border border-purple-200 rounded-lg hover:bg-purple-50 transition",children:["Ver más máscaras (",E[s].length-6," más)"]})]})},ir=async(n,v,c)=>{var P;try{console.log("📤 [SAVE] Subiendo imagen al backend:",v);const[s,k]=n.split(","),E=((P=s.match(/data:image\/(\w+)/))==null?void 0:P[1])||"png",$=new FormData,L=atob(k),I=new Array(L.length);for(let i=0;i<L.length;i++)I[i]=L.charCodeAt(i);const V=new Uint8Array(I),z=new Blob([V],{type:`image/${E}`});$.append("image",z,`element_${v}.${E}`),$.append("project_id",c),$.append("element_id",v);const H=await fetch("/api/canvas/projects/upload-image",{method:"POST",headers:{Accept:"application/json"},credentials:"include",body:$});if(!H.ok)throw new Error("Error al subir imagen al servidor");const J=await H.json();return console.log("✅ [SAVE] Imagen subida exitosamente:",J.url),J.url}catch(s){throw console.error("❌ [SAVE] Error subiendo imagen:",s),s}},lr=async(n,v)=>{var k,E;console.log("🔄 [SAVE] Procesando imágenes para guardado...");const c=[];let P=0,s=0;for(const $ of n)for(const L of $.cells||[])for(const I of L.elements||[])I.type==="image"&&((k=I.content)!=null&&k.startsWith("data:image/"))&&P++;console.log(`📊 [SAVE] Total de imágenes base64 a procesar: ${P}`);for(const $ of n){const L={...$};L.cells=[];for(const I of $.cells||[]){const V={...I};V.elements=[];for(const z of I.elements||[]){const H={...z};if(z.type==="image"&&((E=z.content)!=null&&E.startsWith("data:image/")))try{const J=await ir(z.content,z.id,v);H.content=J,H.isUploaded=!0,s++,console.log(`✅ [SAVE] Imagen ${s}/${P} procesada`)}catch(J){console.error("❌ [SAVE] Error procesando imagen:",z.id,J),H.uploadError=J.message}V.elements.push(H)}L.cells.push(V)}c.push(L)}return console.log(`✅ [SAVE] Procesamiento completado: ${s}/${P} imágenes subidas`),c},Dt=async(n,v,c,P,s,k,E=!1)=>{try{if(!(v!=null&&v.id))throw new Error("No se encontró el ID del proyecto");console.log(`💾 [SAVE] Iniciando ${E?"auto-guardado":"guardado manual"}...`);let $=n;E||($=await lr(n,v.id));const L={pages:$,projectInfo:{id:v.id,item_id:c==null?void 0:c.id,title:c==null?void 0:c.title,preset_id:P==null?void 0:P.id},workspace:{width:s.width,height:s.height,scale:s.scale},meta:{savedAt:new Date().toISOString(),version:"2.0",isAutoSave:E,totalPages:n.length}},I=E?"save-progress":"save",V=await fetch(`/api/canvas/projects/${v.id}/${I}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({design_data:L,thumbnails:k})});if(!V.ok){const H=await V.json().catch(()=>({}));throw new Error(H.message||"Error al guardar el proyecto")}const z=await V.json();return console.log(`✅ [SAVE] ${E?"Auto-guardado":"Guardado"} exitoso:`,z),{success:!0,data:z}}catch($){return console.error(`❌ [SAVE] Error en ${E?"auto-guardado":"guardado"}:`,$),{success:!1,error:$.message}}},cr=(n,v,c,P,s,k)=>{const[E,$]=p.useState("saved"),[L,I]=p.useState(null),[V,z]=p.useState(null),[H,J]=p.useState(null),[i,X]=p.useState(!1),[m,K]=p.useState(navigator.onLine),oe=p.useRef(null),C=p.useRef(null),j=p.useRef(null),Q=p.useRef(!1),O=p.useRef(null),me=15e3,F=2e3,ue=5e3,be=p.useCallback((G,W)=>{try{const Z={pages:G.map(ie=>{var q;return{id:ie.id,layout:ie.layout,cells:((q=ie.cells)==null?void 0:q.map(le=>{var fe;return{id:le.id,elements:((fe=le.elements)==null?void 0:fe.map(ae=>{var Ne;return{id:ae.id,type:ae.type,content:ae.type==="image"&&((Ne=ae.content)!=null&&Ne.startsWith("data:image/"))?`[IMAGE_${ae.content.length}]`:ae.content,position:ae.position,size:ae.size,style:ae.style,filters:ae.filters,rotation:ae.rotation}}))||[]}}))||[]}})||[],workspace:{width:W==null?void 0:W.width,height:W==null?void 0:W.height}};return btoa(JSON.stringify(Z)).substring(0,32)}catch(Z){return console.warn("⚠️ [AUTO-SAVE] Error generando hash:",Z),Date.now().toString()}},[]),je=p.useCallback(()=>`album_editor_autosave_${(v==null?void 0:v.id)||"draft"}`,[v==null?void 0:v.id]),ne=p.useCallback(G=>{try{const W=je(),Z={...G,savedAt:Date.now(),version:"2.1"};return localStorage.setItem(W,JSON.stringify(Z)),console.log("💾 [AUTO-SAVE] Guardado en localStorage"),!0}catch(W){return console.error("❌ [AUTO-SAVE] Error guardando en localStorage:",W),!1}},[je]),ye=p.useCallback(()=>{var G;try{const W=je(),Z=localStorage.getItem(W);if(Z){const ie=JSON.parse(Z);return console.log("📂 [AUTO-SAVE] Datos encontrados en localStorage:",{pages:(G=ie.pages)==null?void 0:G.length,savedAt:new Date(ie.savedAt).toLocaleString()}),ie}}catch(W){console.error("❌ [AUTO-SAVE] Error cargando desde localStorage:",W)}return null},[je]),D=p.useCallback(async(G=!1)=>{if(Q.current&&!G){console.log("⏳ [AUTO-SAVE] Guardado en progreso, saltando...");return}if(!(v!=null&&v.id)||!n||n.length===0){console.log("⚠️ [AUTO-SAVE] Datos insuficientes para guardar");return}const W=be(n,s);if(!G&&W===j.current){console.log("📊 [AUTO-SAVE] Sin cambios detectados, saltando guardado");return}try{Q.current=!0,$("saving"),J(null);const Z={pages:n,projectInfo:{id:v.id,item_id:c==null?void 0:c.id,title:c==null?void 0:c.title,preset_id:P==null?void 0:P.id},workspace:s,meta:{savedAt:new Date().toISOString(),version:"2.1",contentHash:W}};if(ne(Z),m){const ie=await Dt(n,v,c,P,s,k,!0);if(ie.success)j.current=W,z(new Date),$("saved"),X(!1),console.log("✅ [AUTO-SAVE] Guardado exitoso en base de datos");else throw new Error(ie.error)}else console.log("� [AUTO-SAVE] Sin conexión, solo guardado en localStorage"),$("pending"),X(!0)}catch(Z){console.error("❌ [AUTO-SAVE] Error:",Z),J(Z.message),$("error"),m&&(O.current=setTimeout(()=>{console.log("🔄 [AUTO-SAVE] Reintentando guardado..."),D(!0)},ue))}finally{Q.current=!1}},[n,v,c,P,s,k,be,ne,m]),he=p.useCallback(async()=>{try{$("saving");const G=await Dt(n,v,c,P,s,k,!1);if(G.success){const W=be(n,s);j.current=W,I(new Date),$("saved"),X(!1),S.success("💾 Proyecto guardado exitosamente"),console.log("✅ [MANUAL-SAVE] Guardado manual exitoso")}else J(G.error),$("error"),S.error(`❌ Error al guardar: ${G.error}`);return G.success}catch(G){return console.error("❌ [MANUAL-SAVE] Error:",G),J(G.message),$("error"),S.error(`❌ Error inesperado: ${G.message}`),!1}},[n,v,c,P,s,k,be]);return p.useEffect(()=>{if(!(v!=null&&v.id)||!n||n.length===0)return;const G=be(n,s);return j.current&&G!==j.current?(console.log("🔄 [AUTO-SAVE] Cambios detectados, programando guardado..."),X(!0),$("pending"),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{D()},F)):j.current||(j.current=G),()=>{C.current&&clearTimeout(C.current)}},[n,s,v==null?void 0:v.id,be,D]),p.useEffect(()=>{if(v!=null&&v.id)return oe.current&&clearInterval(oe.current),oe.current=setInterval(()=>{i&&(console.log("⏰ [AUTO-SAVE] Auto-save periódico activado"),D())},me),()=>{oe.current&&clearInterval(oe.current)}},[v==null?void 0:v.id,i,D]),p.useEffect(()=>{const G=()=>{console.log("🌐 [AUTO-SAVE] Conexión restaurada"),K(!0),i&&setTimeout(()=>D(!0),1e3)},W=()=>{console.log("📴 [AUTO-SAVE] Conexión perdida"),K(!1)};return window.addEventListener("online",G),window.addEventListener("offline",W),()=>{window.removeEventListener("online",G),window.removeEventListener("offline",W)}},[i,D]),p.useEffect(()=>{const G=W=>{if(i){const Z={pages:n,projectInfo:{id:v.id},workspace:s,meta:{savedAt:new Date().toISOString()}};return ne(Z),W.preventDefault(),W.returnValue="¿Estás seguro de salir? Hay cambios sin guardar.","¿Estás seguro de salir? Hay cambios sin guardar."}};return window.addEventListener("beforeunload",G),()=>window.removeEventListener("beforeunload",G)},[i,n,v==null?void 0:v.id,s,ne]),p.useEffect(()=>()=>{C.current&&clearTimeout(C.current),oe.current&&clearInterval(oe.current),O.current&&clearTimeout(O.current)},[]),p.useEffect(()=>{H&&(H.includes("max_allowed_packet")||H.includes("data_too_large")?S.error("❌ El proyecto es demasiado grande para guardar automáticamente. Reduce el número o tamaño de imágenes."):S.error(`❌ Error de auto-guardado: ${H}`))},[H]),{saveStatus:E,lastSaved:L,lastAutoSaved:V,saveError:H,hasUnsavedChanges:i,isOnline:m,saveManually:he,performAutoSave:()=>D(!0),loadFromLocalStorage:ye,getStorageKey:je,autoSaveInterval:me,debounceDelay:F}},dr=({saveStatus:n,lastSaved:v,lastAutoSaved:c,hasUnsavedChanges:P,isOnline:s,saveError:k,onManualSave:E,className:$=""})=>{const L=z=>{if(!z)return null;const J=new Date-z,i=Math.floor(J/(1e3*60)),X=Math.floor(J/1e3);if(X<30)return"hace unos segundos";if(i<1)return`hace ${X}s`;if(i<60)return`hace ${i}m`;const m=Math.floor(i/60);return m<24?`hace ${m}h`:z.toLocaleDateString()},V=(()=>{if(!s)return{icon:e.jsx(Kt,{className:"w-4 h-4"}),color:"text-orange-500",bg:"bg-orange-50 border-orange-200",text:"Sin conexión",detail:"Guardado local activo"};switch(n){case"saving":return{icon:e.jsx(Bo,{className:"w-4 h-4 animate-spin"}),color:"text-blue-500",bg:"bg-blue-50 border-blue-200",text:"Guardando...",detail:"Sincronizando cambios"};case"saved":return{icon:e.jsx(to,{className:"w-4 h-4"}),color:"text-green-500",bg:"bg-green-50 border-green-200",text:"Guardado",detail:c?`Auto-guardado ${L(c)}`:"Todo sincronizado"};case"error":return{icon:e.jsx(oo,{className:"w-4 h-4"}),color:"text-red-500",bg:"bg-red-50 border-red-200",text:"Error al guardar",detail:k||"Error desconocido"};case"pending":return{icon:e.jsx(zo,{className:"w-4 h-4"}),color:"text-yellow-600",bg:"bg-yellow-50 border-yellow-200",text:P?"Cambios pendientes":"Pendiente",detail:"Esperando a guardar..."};default:return{icon:e.jsx(eo,{className:"w-4 h-4"}),color:"text-gray-500",bg:"bg-gray-50 border-gray-200",text:"Listo",detail:"Sistema de guardado activo"}}})();return e.jsxs("div",{className:`relative group ${$}`,children:[e.jsxs("div",{className:`
                    inline-flex items-center gap-2 px-3 py-2 rounded-lg border-2 
                    transition-all duration-200 cursor-pointer
                    ${V.bg} ${V.color}
                    hover:shadow-md
                `,onClick:()=>n!=="saving"&&(E==null?void 0:E()),children:[V.icon,e.jsx("span",{className:"text-sm font-medium",children:V.text}),P&&n!=="saving"&&e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),e.jsx("div",{className:"flex items-center",children:s?e.jsx(rr,{className:"w-3 h-3 text-green-500"}):e.jsx(Kt,{className:"w-3 h-3 text-orange-500"})})]}),e.jsxs("div",{className:`
                absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2
                bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg
                opacity-0 group-hover:opacity-100 pointer-events-none
                transition-opacity duration-200 z-50 whitespace-nowrap
            `,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:V.text}),e.jsx("div",{className:"text-gray-300",children:V.detail}),v&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Último guardado manual: ",L(v)]}),e.jsxs("div",{className:"text-gray-400 text-xs",children:[s?"🌐 En línea":"📴 Sin conexión",n!=="saving"&&" • Click para guardar"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]}),n==="saving"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-blue-200 rounded-b-lg overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 animate-pulse"})})]})},gr=({isOpen:n,onClose:v,savedProgress:c,onLoadProgress:P,onDiscardProgress:s})=>{var V;const[k,E]=p.useState(!1);if(!n||!c)return null;const $=async()=>{E(!0);try{await P(c),v()}catch(z){console.error("Error cargando progreso:",z)}finally{E(!1)}},L=async()=>{E(!0);try{await s(),v()}catch(z){console.error("Error descartando progreso:",z)}finally{E(!1)}},I=z=>{const H=new Date(z),i=new Date-H,X=Math.floor(i/(1e3*60)),m=Math.floor(X/60),K=Math.floor(m/24);return X<1?"hace unos segundos":X<60?`hace ${X} minutos`:m<24?`hace ${m} horas`:K===1?"ayer":K<7?`hace ${K} días`:H.toLocaleDateString()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 p-6 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Co,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progreso Guardado Encontrado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Se encontró un trabajo sin finalizar"})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Do,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Guardado automáticamente"}),e.jsx("div",{className:"text-xs text-gray-500",children:I(c.savedAt)})]})]}),c.pages&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Uo,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[c.pages.length," páginas en progreso"]}),e.jsx("div",{className:"text-xs text-gray-500",children:((V=c.meta)==null?void 0:V.version)||"Versión no especificada"})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oo,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"¿Qué te gustaría hacer?"}),e.jsx("div",{className:"text-amber-700",children:"Puedes continuar desde donde lo dejaste o comenzar un nuevo diseño."})]})]})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[e.jsxs("button",{onClick:$,disabled:k,className:`flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[k?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(to,{className:"w-4 h-4"}),"Continuar Editando"]}),e.jsxs("button",{onClick:L,disabled:k,className:`flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[e.jsx(Zt,{className:"w-4 h-4"}),"Comenzar de Nuevo"]})]}),e.jsx("button",{onClick:v,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",disabled:k,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},Ve=Jt.memo(({pageId:n,thumbnail:v,altText:c,type:P})=>{if(v)return e.jsx("img",{src:v,alt:c,className:"w-full h-full object-contain",loading:"lazy",style:{transition:"opacity 0.2s ease-in-out",imageRendering:"optimizeQuality"}});const s=P==="cover"||P==="final"?qe:()=>e.jsx("div",{className:"grid grid-cols-2 gap-0.5 w-8 h-8",children:Array.from({length:4}).map((k,E)=>e.jsx("div",{className:"bg-gray-300 rounded-sm"},E))});return e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:`${P==="cover"?"text-purple-300":P==="final"?"text-green-300":"text-gray-300"}`,children:e.jsx(s,{})})})}),mr=Jt.memo(({images:n,onImageSelect:v})=>{const c=({image:P})=>{const[{isDragging:s},k]=qo(()=>({type:"PROJECT_IMAGE",item:{type:"PROJECT_IMAGE",imageUrl:P.url},collect:E=>({isDragging:!!E.isDragging()})}));return e.jsxs("div",{ref:k,className:`relative group cursor-pointer bg-gray-50 rounded-lg overflow-hidden border-2 border-transparent hover:border-[#af5cb8] transition-all duration-200 ${s?"opacity-50 scale-95":""}`,onClick:()=>v(P.url),children:[e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:P.url,alt:P.filename||"Project image",className:"w-full h-full object-cover",loading:"lazy"})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("div",{className:"bg-white rounded-full p-2 shadow-md",children:e.jsx($e,{className:"h-4 w-4 text-[#af5cb8]"})})})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"Arrastra o haz clic"})]})};return n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"No hay imágenes en este proyecto"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sube una imagen para empezar"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.map((P,s)=>e.jsx(c,{image:P},`${P.id}-${s}`))})});function ca(){var rt,at,st,nt,it,lt,ct,dt,gt,mt,ut,ht,pt,ft,xt,bt,yt,vt,wt,jt,Nt,Et,kt,Ct,St,At,Pt,It,Tt,Ot,Mt,_t,$t,Rt,Lt,Ft,Ut,zt;const[n,v]=p.useState(null),[c,P]=p.useState(null),[s,k]=p.useState(null),[E,$]=p.useState(null),[L,I]=p.useState(!0),[V,z]=p.useState(null);p.useEffect(()=>{(async()=>{var o;try{const a=new URLSearchParams(window.location.search).get("project");if(!a){z("No se encontró el ID del proyecto en la URL"),I(!1);return}console.log("� Cargando proyecto con ID:",a);const l=await fetch(`/api/canvas/projects/${a}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)||"","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Error al cargar el proyecto");const u=await l.json();console.log("✅ Datos del proyecto cargados:",u),v(u.project),P(u.item),k(u.canvasPreset),$(u.initialProject),I(!1)}catch(r){console.error("❌ Error cargando proyecto:",r),z(r.message),I(!1)}})()},[]),p.useEffect(()=>{n&&c&&s&&(console.log("🔍 Editor datos cargados exitosamente:"),console.log("📦 project:",n),console.log("🎯 item:",c),console.log("🎨 canvasPreset:",s),console.log("📄 initialProject:",E))},[n,c,s,E]),p.useEffect(()=>{if(E&&c&&s){if(console.log("🔄 Actualizando estados del editor con datos del proyecto"),E.pages&&Array.isArray(E.pages)){console.log("🔧 Recreando páginas con backgrounds actualizados...");const t=E.pages.map(o=>{let r=null,a=s.background_color||"#ffffff";return o.type==="cover"?c.cover_image?(r=`/storage/images/item/${c.cover_image}`,console.log("🖼️ [UPDATE] Cover page - usando cover_image:",r)):console.log("🎨 [UPDATE] Cover page - usando background_color:",a):o.type==="content"?c.content_image?(r=`/storage/images/item/${c.content_image}`,console.log("🖼️ [UPDATE] Content page - usando content_image:",r)):console.log("🎨 [UPDATE] Content page - usando background_color:",a):(o.type==="final"||o.type==="contraportada")&&(c.back_cover_image?(r=`/storage/images/item/${c.back_cover_image}`,console.log("🖼️ [UPDATE] Final page - usando back_cover_image:",r)):console.log("🎨 [UPDATE] Final page - usando background_color:",a)),{...o,backgroundImage:r,backgroundColor:a}});console.log("✅ Páginas actualizadas con backgrounds:",t),X(t),ye([JSON.stringify(t)]),he(0)}else{console.log("🆕 No hay páginas existentes, creando nuevas...");const t=tt(s,c);X(t),ye([JSON.stringify(t)]),he(0)}typeof E.currentPage=="number"&&K(E.currentPage),E.workspaceSize&&C(E.workspaceSize)}},[E,c,s]);const[H,J]=p.useState(Wt.Local.get(`${qt.APP_CORRELATIVE}_cart`)??[]);p.useEffect(()=>{Wt.Local.set(`${qt.APP_CORRELATIVE}_cart`,H)},[H]);const[i,X]=p.useState([]),[m,K]=p.useState(0),[oe,C]=p.useState("preset"),[j,Q]=p.useState(null),[O,me]=p.useState(null),[F,ue]=p.useState("elements"),[be,je]=p.useState("basic"),[ne,ye]=p.useState([JSON.stringify(i)]),[D,he]=p.useState(0),[G,W]=p.useState(!1),[Z,ie]=p.useState(null),[q,le]=p.useState({}),[fe,ae]=p.useState(!1),[Ne,ro]=p.useState([]),Xe=p.useRef(),[R,Ke]=p.useState({width:800,height:600}),de=cr(i,n,c,s,R,q),De=()=>{if(s!=null&&s.width&&(s!=null&&s.height)){let g=s.width,h=s.height,f=g*37.8,b=h*37.8;if(f&&b){const y=window.innerWidth*.6,T=window.innerHeight*.7,x=y/f,w=T/b,N=Math.min(x,w,1);return{width:Math.round(f*N),height:Math.round(b*N),originalWidth:g,originalHeight:h,scale:N,unit:"cm",originalWidthPx:Math.round(f),originalHeightPx:Math.round(b)}}}if(s!=null&&s.extra_settings)try{const g=typeof s.extra_settings=="string"?JSON.parse(s.extra_settings):s.extra_settings;if(g!=null&&g.canvas_config){const h=g.canvas_config;let f=h.width,b=h.height,y=f*37.8,T=b*37.8;if(y&&T){const x=window.innerWidth*.6,w=window.innerHeight*.7,N=x/y,A=w/T,B=Math.min(N,A,1);return{width:Math.round(y*B),height:Math.round(T*B),originalWidth:f,originalHeight:b,scale:B,unit:"cm",originalWidthPx:Math.round(y),originalHeightPx:Math.round(T)}}}}catch(g){console.warn("Error parsing extra_settings:",g)}const t={square:{width:600,height:600},landscape:{width:1280,height:720},portrait:{width:600,height:800},wide:{width:1200,height:600},tall:{width:540,height:960},preset:{width:800,height:600}},o=t[oe]||t.preset,r=window.innerWidth*.6,a=window.innerHeight*.7,l=r/o.width,u=a/o.height,d=Math.min(l,u,1);return{width:Math.round(o.width*d),height:Math.round(o.height*d),originalWidth:o.width,originalHeight:o.height,scale:d,unit:"px"}},pe=p.useCallback(async(t={type:"thumbnail"})=>{if(!i[m])return null;try{let o=document.querySelector(`#page-${i[m].id}`);if(!o)return console.warn("❌ THUMBNAIL: No se encontró el elemento de página específico"),null;console.log("📸 [THUMBNAIL-FIX] Elemento workspace encontrado:",o),console.log("📸 [THUMBNAIL-FIX] Dimensiones del elemento:",{offsetWidth:o.offsetWidth,offsetHeight:o.offsetHeight,style_width:o.style.width,style_height:o.style.height,background:getComputedStyle(o).backgroundColor,backgroundImage:getComputedStyle(o).backgroundImage}),console.log("📐 [THUMBNAIL-FIX] Dimensiones del workspace desde BD:",R);const r=i[m];console.log("📸 [THUMBNAIL-FIX] Datos de la página actual:",{id:r==null?void 0:r.id,type:r==null?void 0:r.type,backgroundImage:r==null?void 0:r.backgroundImage,backgroundColor:r==null?void 0:r.backgroundColor});const a=t.type==="pdf",l=a?11.81:3,u=1,d=getComputedStyle(o);let g=(r==null?void 0:r.backgroundColor)||"#ffffff";d.backgroundColor&&d.backgroundColor!=="rgba(0, 0, 0, 0)"&&(g=d.backgroundColor),console.log("🎨 [THUMBNAIL-FIX] Background detectado:",g);const h={scale:l,useCORS:!0,allowTaint:!1,backgroundColor:g,width:R.width,height:R.height,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!!a,removeContainer:!1,logging:!1,imageTimeout:a?6e4:15e3,pixelRatio:a?3:window.devicePixelRatio||1,canvas:a?document.createElement("canvas"):null,windowWidth:a?R.width*l:null,windowHeight:a?R.height*l:null,onclone:async y=>{console.log("🔍 [THUMBNAIL-FIX] Iniciando proceso de clonado para elemento de página específico..."),[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(x=>{try{y.querySelectorAll(x).forEach(N=>N.remove())}catch(w){console.warn("Error removing selector:",x,w)}});try{const x=y.querySelector(`#page-${i[m].id}`);console.log("🖼️ [THUMBNAIL-FIX] Elemento de página clonado encontrado:",x),x&&(x.style.width=R.width+"px",x.style.height=R.height+"px",x.style.position="relative",x.style.overflow="hidden",r!=null&&r.backgroundImage&&(console.log("🖼️ [THUMBNAIL-FIX] Aplicando backgroundImage de página:",r.backgroundImage),x.style.backgroundImage=`url(${r.backgroundImage})`,x.style.backgroundSize="cover",x.style.backgroundPosition="center",x.style.backgroundRepeat="no-repeat"),r!=null&&r.backgroundColor&&(console.log("🎨 [THUMBNAIL-FIX] Aplicando backgroundColor de página:",r.backgroundColor),x.style.backgroundColor=r.backgroundColor),console.log("🎨 [THUMBNAIL-FIX] Dimensiones del elemento de página aplicadas:",{width:x.style.width,height:x.style.height,backgroundColor:x.style.backgroundColor,backgroundImage:x.style.backgroundImage}))}catch(x){console.error("❌ [THUMBNAIL-FIX] Error configurando elemento de página:",x)}try{console.log("🔧 [ADVANCED-THUMBNAIL] Iniciando pre-procesamiento avanzado de imágenes...");const x=new Map;o.querySelectorAll('[data-element-type="image"] img, .workspace-image, img').forEach((_,ce)=>{if(_.complete&&_.naturalWidth>0){const re=(_.closest('[data-element-type="image"]')||_.parentElement).getBoundingClientRect(),ge=_.getBoundingClientRect();x.set(_.src,{src:_.src,naturalWidth:_.naturalWidth,naturalHeight:_.naturalHeight,containerWidth:re.width,containerHeight:re.height,objectFit:getComputedStyle(_).objectFit||"cover",objectPosition:getComputedStyle(_).objectPosition||"center",crossOrigin:_.crossOrigin}),console.log(`📊 [ADVANCED-THUMBNAIL] Imagen ${ce} datos capturados:`,x.get(_.src))}});const N=async(_,ce,ee,re,ge)=>new Promise(ve=>{try{const we=ce/ee,ze=re/ge;let Oe,Me,Be,He,Bt,Ht;ze>we?(Ht=ee,Bt=ee*ze,Me=ge,Oe=ge*we,Be=(re-Oe)/2,He=0):(Bt=ce,Ht=ce/ze,Oe=re,Me=re/we,Be=0,He=(ge-Me)/2);const _e=y.createElement("canvas");_e.width=ce,_e.height=ee;const Eo=_e.getContext("2d"),Pe=new Image;Pe.crossOrigin="anonymous",Pe.onload=()=>{try{Eo.drawImage(Pe,Be,He,Oe,Me,0,0,ce,ee);const Ge=_e.toDataURL("image/png",1);_.src=Ge,_.style.objectFit="fill",_.style.objectPosition="center",_.style.width="100%",_.style.height="100%",console.log("✅ [ADVANCED-THUMBNAIL] Imagen pre-procesada con object-fit cover simulado"),ve()}catch(Ge){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en canvas processing:",Ge),ve()}},Pe.onerror=()=>{console.warn("⚠️ [ADVANCED-THUMBNAIL] Error cargando imagen temporal"),ve()},Pe.src=_.src}catch(we){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en simulateObjectFitCover:",we),ve()}}),A=y.querySelectorAll('[data-element-type="image"] img, .workspace-image, img'),B=[];A.forEach((_,ce)=>{if(_.src&&x.has(_.src)){const ee=x.get(_.src),re=_.closest('[data-element-type="image"]')||_.parentElement;if(re&&(re.style.overflow="hidden",re.style.position="relative"),ee.objectFit==="cover"||_.classList.contains("object-cover")||_.classList.contains("workspace-image")){console.log(`🔄 [ADVANCED-THUMBNAIL] Procesando imagen ${ce} con pre-procesamiento...`);const ge=N(_,ee.containerWidth,ee.containerHeight,ee.naturalWidth,ee.naturalHeight);B.push(ge)}else _.style.width="100%",_.style.height="100%",_.style.objectFit="fill"}}),B.length>0&&(console.log(`⏳ [ADVANCED-THUMBNAIL] Esperando procesamiento de ${B.length} imágenes...`),await Promise.all(B),console.log("✅ [ADVANCED-THUMBNAIL] Todas las imágenes pre-procesadas exitosamente"));const M=y.createElement("style");M.textContent=`
                            /* CORRECCIÓN THUMBNAIL: Estructura del elemento de página */
                            #page-${i[m].id} {
                                width: ${R.width}px !important;
                                height: ${R.height}px !important;
                                position: relative !important;
                                overflow: hidden !important;
                                box-sizing: border-box !important;
                            }
                            
                            /* 🖨️ IMÁGENES PROFESIONALES: Optimizada para PDF vs Thumbnails */
                            img {
                                width: 100% !important;
                                height: 100% !important;
                                object-fit: fill !important; /* fill porque ya están recortadas */
                                object-position: center !important;
                                display: block !important;
                                ${a?`
                                /* 🖨️ IMPRESIÓN PROFESIONAL 300 DPI */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: -webkit-crisp-edges !important;
                                image-rendering: -moz-crisp-edges !important;
                                image-rendering: pixelated !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: optimizeQuality !important;
                                backface-visibility: hidden !important;
                                transform: translateZ(0) scale(1) !important;
                                will-change: transform !important;
                                filter: contrast(1.02) saturate(1.05) !important;
                                `:`
                                /* Thumbnails optimizados */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: high-quality !important;
                                `}
                            }
                            
                            /* Contenedores de imagen */
                            [data-element-type="image"] {
                                overflow: hidden !important;
                                position: relative !important;
                            }
                            
                            [data-element-type="image"] > div {
                                width: 100% !important;
                                height: 100% !important;
                                overflow: hidden !important;
                            }
                            
                            /* Backgrounds de página */
                            #page-${i[m].id} {
                                background-size: cover !important;
                                background-position: center !important;
                                background-repeat: no-repeat !important;
                            }
                            
                            /* 🖨️ OPTIMIZACIONES GENERALES PARA PDF DE IMPRESIÓN */
                            ${a?`
                            * {
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                text-rendering: optimizeLegibility !important;
                                -webkit-backface-visibility: hidden !important;
                                backface-visibility: hidden !important;
                                -webkit-transform: translateZ(0) !important;
                                transform: translateZ(0) !important;
                            }
                            
                            /* Elementos de texto de alta calidad */
                            p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable] {
                                text-rendering: optimizeLegibility !important;
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                font-smooth: always !important;
                            }
                            
                            /* Elementos vectoriales de alta calidad */
                            svg, path, circle, rect, line {
                                shape-rendering: geometricPrecision !important;
                                vector-effect: non-scaling-stroke !important;
                            }
                            `:""}
                            
                            /* Resetear estilos que puedan interferir */
                            img {
                                max-width: none !important;
                                max-height: none !important;
                                border: none !important;
                                outline: none !important;
                            }
                        `,y.head.appendChild(M),console.log("✅ [ADVANCED-THUMBNAIL] CSS para imágenes pre-procesadas aplicado"),console.log("🎯 [ADVANCED-THUMBNAIL] Pre-procesamiento avanzado completado - listo para html2canvas")}catch(x){console.error("❌ [ADVANCED-THUMBNAIL] Error en pre-procesamiento avanzado:",x);const w=y.createElement("style");w.textContent=`
                            img { object-fit: cover !important; object-position: center !important; }
                            [data-element-type="image"] { overflow: hidden !important; }
                        `,y.head.appendChild(w)}console.log("✅ [THUMBNAIL-FIX] Proceso de clonado completado - elemento de página con dimensiones exactas")}};console.log("📸 [THUMBNAIL-FIX] Iniciando captura de elemento de página con dimensiones exactas de BD:",h);const f=await Vt(o,h);if(a&&f){const y=f.getContext("2d");if(y){y.imageSmoothingEnabled=!1,y.imageSmoothingQuality="high";const T=y.getImageData(0,0,f.width,f.height),x=T.data;for(let w=0;w<x.length;w+=4)x[w]=Math.min(255,x[w]*1.05),x[w+1]=Math.min(255,x[w+1]*1.05),x[w+2]=Math.min(255,x[w+2]*1.05);y.putImageData(T,0,0),console.log("✅ [PDF-PROFESSIONAL] Post-procesamiento de calidad aplicado")}}if(!f)throw new Error("html2canvas no devolvió un canvas válido para el elemento de página");if(f.width===0||f.height===0)throw new Error("Canvas del elemento de página tiene dimensiones inválidas");const b=f.toDataURL("image/png",u);if(!b||b==="data:,")throw new Error("No se pudo generar dataURL del elemento de página");return console.log("✅ [THUMBNAIL-FIX] Captura de elemento de página exitosa para página:",i[m].id,"Tipo:",t.type),console.log("📊 [THUMBNAIL-FIX] Canvas del elemento de página generado:",{width:f.width,height:f.height,expectedWidth:R.width*l,expectedHeight:R.height*l,dataUrlLength:b.length,workspaceBackground:g}),a?f:b}catch(o){console.error("❌ [THUMBNAIL-FIX] Error capturando elemento de página:",o);try{console.log("🔄 [THUMBNAIL-FIX] Intentando fallback con canvas de elemento de página...");const r=document.createElement("canvas"),a=t.type==="pdf"?11.81:1;r.width=R.width*a,r.height=R.height*a;const l=r.getContext("2d"),u=workspaceBackground||(currentPageData==null?void 0:currentPageData.backgroundColor)||"#ffffff";if(l.fillStyle=u,l.fillRect(0,0,r.width,r.height),l.fillStyle=u==="#ffffff"||u.includes("white")?"#374151":"#666666",l.font=`${14*a}px Arial`,l.textAlign="center",l.fillText("Página "+(m+1),r.width/2,r.height/2),console.log("🔄 [THUMBNAIL-FIX] Fallback creado con dimensiones exactas:",{width:r.width,height:r.height,expectedDimensions:R,background:u}),t.type==="pdf")return r;{const d=r.toDataURL("image/png",1);return console.log("✅ [DEBUG] Fallback thumbnail creado"),d}}catch(r){return console.error("❌ [DEBUG] Error en fallback:",r),null}}},[m,i]),Ee=p.useCallback(async()=>{if(!i[m])return;const t=await pe({type:"thumbnail"});t&&(le(o=>({...o,[i[m].id]:t})),console.log("🖼️ Thumbnail generated for page:",i[m].id))},[pe,m,i]);p.useCallback(()=>{clearTimeout(Xe.current),Xe.current=setTimeout(()=>{i[m]&&!q[i[m].id]&&Ee()},1200)},[Ee,i,m,q]);const Je=p.useCallback(()=>{i[m]&&!q[i[m].id]&&setTimeout(()=>{Ee()},300)},[Ee,i,m,q]),ao=p.useCallback(async(t=m,o={width:800,height:600})=>{var r,a;if(!i[t])return null;try{console.log(`🔍 Generando thumbnail de alta calidad para página ${t+1}`);const l=m;t!==m&&(K(t),await new Promise(h=>setTimeout(h,100)));const u=document.querySelector(`#page-${i[t].id}`);if(!u)return console.warn("Workspace element not found for page:",i[t].id),null;const d={scale:4,useCORS:!0,allowTaint:!1,backgroundColor:((r=i[t])==null?void 0:r.backgroundColor)||"#ffffff",width:u.offsetWidth,height:u.offsetHeight,removeContainer:!0,logging:!1,onclone:h=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(x=>{h.querySelectorAll(x).forEach(N=>N.remove())});const b=h.querySelector(`#page-${i[t].id}`);if(b){const x=i[t];x!=null&&x.backgroundImage&&(console.log("🖼️ [HIGH-QUALITY] Aplicando backgroundImage al clon:",x.backgroundImage),b.style.backgroundImage=`url(${x.backgroundImage})`,b.style.backgroundSize="cover",b.style.backgroundPosition="center",b.style.backgroundRepeat="no-repeat"),x!=null&&x.backgroundColor&&(console.log("🎨 [HIGH-QUALITY] Aplicando backgroundColor al clon:",x.backgroundColor),b.style.backgroundColor=x.backgroundColor)}try{const x=u.querySelectorAll("img"),w=new Map;x.forEach((A,B)=>{const M=getComputedStyle(A);w.set(B,{objectFit:M.objectFit,objectPosition:M.objectPosition,width:M.width,height:M.height,borderRadius:M.borderRadius,transform:M.transform})}),h.querySelectorAll("img").forEach((A,B)=>{const M=w.get(B);M&&(A.style.objectFit=M.objectFit||"cover",A.style.objectPosition=M.objectPosition||"center",A.style.width=M.width,A.style.height=M.height,A.style.borderRadius=M.borderRadius,A.style.transform=M.transform,console.log(`🖼️ [HIGH-QUALITY] Imagen ${B} - Estilos aplicados:`,{objectFit:A.style.objectFit,objectPosition:A.style.objectPosition,width:A.style.width,height:A.style.height}))})}catch(x){console.warn("Error preservando estilos de imágenes:",x),h.querySelectorAll("img").forEach(N=>{N.style.objectFit="cover",N.style.objectPosition="center",N.style.width||(N.style.width="100%"),N.style.height||(N.style.height="100%")})}h.querySelectorAll('[class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable]').forEach(x=>{const w=x.className;w&&(x.className=w);const N=getComputedStyle?getComputedStyle(x):null;N&&(N.fontFamily&&N.fontFamily!=="Arial"&&(x.style.fontFamily=N.fontFamily),N.fontSize&&(x.style.fontSize=N.fontSize),N.fontWeight&&(x.style.fontWeight=N.fontWeight),N.fontStyle&&(x.style.fontStyle=N.fontStyle))});const T=h.createElement("style");T.textContent=`
                        /* Preservar fuentes originales y NO forzar Arial */
                        * { 
                            -webkit-font-smoothing: antialiased !important;
                            -moz-osx-font-smoothing: grayscale !important;
                        }
                        
                        /* CRÍTICO: Asegurar que las imágenes mantengan cover + CALIDAD HD */
                        img {
                            object-fit: cover !important;
                            object-position: center !important;
                            image-rendering: -webkit-optimize-contrast !important;
                            image-rendering: crisp-edges !important;
                            image-rendering: high-quality !important;
                        }
                        
                        /* CRÍTICO: Asegurar que los backgrounds de página se mantengan en cover */
                        [id^="page-"] {
                            background-size: cover !important;
                            background-position: center !important;
                            background-repeat: no-repeat !important;
                        }
                        
                        /* Asegurar que los elementos de texto mantengan sus fuentes */
                        [class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6 {
                            font-family: inherit !important;
                        }
                    `,h.head.appendChild(T)}},g=await Vt(u,d);if(o.width!==g.width||o.height!==g.height){const h=document.createElement("canvas");h.width=o.width,h.height=o.height;const f=h.getContext("2d"),b=g.width/g.height,y=o.width/o.height;let T,x,w=0,N=0;b>y?(T=o.width,x=o.width/b,N=(o.height-x)/2):(x=o.height,T=o.height*b,w=(o.width-T)/2),f.fillStyle=((a=i[t])==null?void 0:a.backgroundColor)||"#ffffff",f.fillRect(0,0,o.width,o.height),f.drawImage(g,w,N,T,x);const A=h.toDataURL("image/png",1);return t!==l&&K(l),A}return t!==l&&K(l),g.toDataURL("image/png",1)}catch(l){return console.error("❌ Error generando thumbnail de alta calidad:",l),null}},[i,m,K]);p.useEffect(()=>{const t=De();Ke(t)},[s,oe]),p.useEffect(()=>{const t=()=>{const o=De();Ke(o)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[s,oe]),p.useEffect(()=>{if(i[m]&&!q[i[m].id]){const t=setTimeout(()=>{Je()},400);return()=>clearTimeout(t)}},[m]),p.useEffect(()=>{const t=`${R.width}x${R.height}`,o=sessionStorage.getItem("lastWorkspaceDimensions");o&&o!==t&&i.length>0&&(console.log("🔄 Dimensiones del workspace cambiaron, limpiando miniaturas"),le({}),setTimeout(()=>{i[m]&&Je()},800)),sessionStorage.setItem("lastWorkspaceDimensions",t)},[R.width,R.height]);const[ur,Re]=p.useState(!1),[hr,so]=p.useState({elementId:null,cellId:null}),[no,io]=p.useState(!1),[lo,Ye]=p.useState(!1),[co,go]=p.useState(null);p.useRef(null);const Qe=p.useCallback(async()=>{if(n!=null&&n.id)try{const o=await(await fetch(`/api/canvas/projects/${n.id}/images`,{method:"GET",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json"}})).json();o.success?ro(o.images||[]):console.error("Error cargando imágenes:",o.message)}catch(t){console.error("Error cargando imágenes del proyecto:",t)}},[n==null?void 0:n.id]);p.useEffect(()=>{n!=null&&n.id&&Qe()},[n==null?void 0:n.id,Qe]);const mo=t=>{var a,l,u,d;const o=O||((l=(a=i[m])==null?void 0:a.cells[0])==null?void 0:l.id);if(!o)return;const r={id:`image-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:t,position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:(((d=(u=i[m].cells.find(g=>g.id===o))==null?void 0:u.elements)==null?void 0:d.length)||0)+1};Ie(o,r),S.success("Imagen añadida desde la galería")},Ze=p.useCallback(async(t,o)=>{var l,u;const r=[],a=[];for(const d of t){const g={...d};if(d.cells){g.cells=[];for(const h of d.cells){const f={...h};if(h.elements){f.elements=[];for(const b of h.elements)if(b.type==="image"&&((l=b.content)!=null&&l.startsWith("data:image/"))){const y=`${b.id}_${Date.now()}`,T=b.content.match(/^data:image\/([^;]+);base64,(.+)$/);if(T){const x=T[1],w=T[2],A=`${y}.${x==="jpeg"?"jpg":x}`;a.push({filename:A,data:w,type:x,elementId:b.id}),f.elements.push({...b,content:b.content,_wasBase64:!0,_originalSize:b.content.length,_elementId:b.id}),console.log(`📸 [IMAGE-PROCESS] Imagen base64 procesada: ${b.id} -> ${A}`)}else f.elements.push(b)}else f.elements.push(b)}g.cells.push(f)}}r.push(g)}if(a.length>0){console.log(`📤 [IMAGE-UPLOAD] Subiendo ${a.length} imágenes al servidor...`);try{const d=await fetch(`/api/canvas/projects/${o}/upload-images`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((u=document.querySelector('meta[name="csrf-token"]'))==null?void 0:u.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({images:a})});if(d.ok){const g=await d.json();if(console.log(`✅ [IMAGE-UPLOAD] ${a.length} imágenes subidas exitosamente:`,g),g.uploadedImages){const h=new Map;g.uploadedImages.forEach(f=>{h.set(f.elementId,f.url),console.log(`🔄 [IMAGE-MAP] ${f.elementId} -> ${f.url}`)});for(const f of r)if(f.cells){for(const b of f.cells)if(b.elements)for(const y of b.elements)y._wasBase64&&y._elementId&&h.has(y._elementId)&&(y.content=h.get(y._elementId),console.log(`✅ [IMAGE-UPDATE] Elemento ${y._elementId} actualizado con URL del servidor`),delete y._elementId)}}}else{const g=await d.json().catch(()=>({message:"Error desconocido en upload"}));return console.error("❌ [IMAGE-UPLOAD] Error subiendo imágenes:",g),console.log("🔄 [IMAGE-UPLOAD] Fallback: conservando imágenes base64 originales"),t}}catch(d){return console.error("❌ [IMAGE-UPLOAD] Error de red subiendo imágenes:",d),t}}return r},[]),Se=p.useCallback(async(t=i,o=!1)=>{var r;if(!(!(n!=null&&n.id)||!o&&t.length===0))try{console.log("💾 [AUTO-SAVE] Guardando progreso con procesamiento de imágenes...");const a=await Ze(t,n.id),l={pages:a,currentPage:m,workspaceDimensions:R,workspaceSize:oe,selectedElement:j,selectedCell:O,history:ne.slice(-5),historyIndex:Math.min(D,4),timestamp:new Date().toISOString(),version:"2.0",project:{id:n.id,name:(c==null?void 0:c.name)||"Álbum Personalizado",item_id:c==null?void 0:c.id,preset_id:s==null?void 0:s.id}},u=Object.entries(q).map(([b,y])=>({page_id:b,thumbnail:y})),d={design_data:l,thumbnails:Object.fromEntries(Object.entries(q).map(([b,y])=>[b,y]))},g=JSON.stringify(d).length,h=g/(1024*1024);console.log("💾 [AUTO-SAVE] Datos optimizados con imágenes en servidor:",{projectId:n.id,pagesCount:a.length,thumbnailsCount:u.length,dataSize:g,dataSizeMB:h.toFixed(2)+" MB",optimized:"✅ Imágenes en servidor"});const f=await fetch(`/api/canvas/projects/${n.id}/save-progress`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},credentials:"include",body:JSON.stringify(d)});if(f.ok){const b=await f.json();console.log("✅ [AUTO-SAVE] Progreso con imágenes optimizadas guardado exitosamente:",b);const y=`editor_progress_project_${n.id}`;return localStorage.removeItem(y),!0}else{const b=await f.json().catch(()=>({message:"Error desconocido"}));return console.error("❌ [AUTO-SAVE] Error guardando en BD:",b),!1}}catch(a){return console.error("❌ [AUTO-SAVE] Error en auto-save con procesamiento de imágenes:",a),!1}},[i,m,R,oe,j,O,ne,D,n==null?void 0:n.id,c==null?void 0:c.name,c==null?void 0:c.id,s==null?void 0:s.id,q,Ze]);p.useEffect(()=>{if(!(n!=null&&n.id))return;const t=setInterval(()=>{i.length>0&&(console.log("⏰ [BACKUP-AUTO-SAVE] Ejecutando auto-save de respaldo (5min)..."),Se(i,!1))},5*60*1e3);return()=>clearInterval(t)},[Se,i,n==null?void 0:n.id]);const uo=p.useCallback(async()=>{if(!(n!=null&&n.id)||i.length===0)return S.error("No hay datos para guardar"),!1;try{return console.log("💾 [MANUAL-SAVE] Iniciando guardado manual..."),await Se(i,!0)?(S.success("Progreso guardado exitosamente"),console.log("✅ [MANUAL-SAVE] Guardado manual completado"),!0):(S.error("Error al guardar el progreso"),console.error("❌ [MANUAL-SAVE] Error en guardado manual"),!1)}catch(t){return console.error("❌ [MANUAL-SAVE] Error en guardado manual:",t),S.error("Error al guardar el progreso"),!1}},[Se,i,n==null?void 0:n.id]),ke=()=>`editor_progress_project_${n==null?void 0:n.id}`,et=p.useCallback(async()=>{var t,o,r,a;if(n!=null&&n.id)try{const l=de.loadFromLocalStorage(),u=await fetch(`/api/canvas/projects/${n.id}/load-progress`,{headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});let d=null;if(u.ok){const h=await u.json();h.success&&((t=h.data)!=null&&t.design_data)&&(d=h.data)}let g=null;if(l&&d){const h=new Date(l.savedAt).getTime(),f=new Date(d.saved_at).getTime();g=h>f?l:d}else l?g=l:d&&(g=d);g&&(((o=g.pages)==null?void 0:o.length)>0||((a=(r=g.design_data)==null?void 0:r.pages)==null?void 0:a.length)>0)&&(console.log("💾 [RECOVERY] Progreso encontrado, mostrando modal de recuperación"),go(g),Ye(!0))}catch(l){console.error("❌ [RECOVERY] Error verificando progreso guardado:",l)}},[n==null?void 0:n.id,de]),ho=p.useCallback(async t=>{var o;try{console.log("📂 [RECOVERY] Cargando progreso guardado...");let r=[];if(t.pages?r=t.pages:(o=t.design_data)!=null&&o.pages&&(r=t.design_data.pages),r.length>0){X(r);const a=[JSON.stringify(r)];ye(a),he(0),setTimeout(()=>{le({})},100),S.success("✅ Progreso cargado exitosamente"),console.log("✅ [RECOVERY] Progreso cargado:",r.length,"páginas")}}catch(r){console.error("❌ [RECOVERY] Error cargando progreso:",r),S.error("Error al cargar el progreso guardado")}},[X,ye,he,le]),po=p.useCallback(async()=>{try{console.log("🗑️ [RECOVERY] Descartando progreso guardado...");const t=de.getStorageKey();localStorage.removeItem(t),S.success("Progreso anterior eliminado"),console.log("✅ [RECOVERY] Progreso descartado exitosamente")}catch(t){console.error("❌ [RECOVERY] Error descartando progreso:",t)}},[de]);p.useEffect(()=>{n&&c&&s&&(console.log("✅ Todos los datos están disponibles, inicializando editor..."),console.log("📦 projectData:",s,n,c),(!(E!=null&&E.pages)||E.pages.length===0)&&(console.log("📝 No hay páginas iniciales, creando desde preset..."),tt(s,c)))},[n,c,s,E]),p.useEffect(()=>{n!=null&&n.id&&!L&&i.length===0&&setTimeout(()=>{et()},500)},[n==null?void 0:n.id,L,i.length,et]);const tt=(t,o)=>{try{console.log("Creating pages from preset:",t),console.log("Item data:",o),console.log("🖼️ Imágenes disponibles:"),console.log("   - Portada (cover_image):",o.cover_image),console.log("   - Contenido (content_image):",o.content_image),console.log("   - Contraportada (back_cover_image):",o.back_cover_image),console.log("   - Color de fondo del preset:",t.background_color);const r=[],a=o.pages||t.pages||20;console.log("📄 Total pages to create:",a);const l=o.cover_image?`/storage/images/item/${o.cover_image}`:null,u=o.cover_image?null:t.background_color||"#ffffff";console.log("🖼️ [COVER] cover_image:",o.cover_image),console.log("🖼️ [COVER] backgroundImage construida:",l),console.log("🎨 [COVER] backgroundColor:",u);const d={id:"page-cover",type:"cover",layout:"layout-1",backgroundImage:l,backgroundColor:u,cells:[{id:"cell-cover-1",elements:[{id:"cover-title",type:"text",content:o.name||"Mi Álbum Personalizado",position:{x:10,y:20},size:{width:80,height:15},style:{fontSize:"28px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",textAlign:"center",backgroundColor:"transparent",padding:"8px"},zIndex:2},...o.image?[{id:"cover-image",type:"image",content:`/storage/images/item/${o.image}`,position:{x:25,y:40},size:{width:50,height:40},filters:{},mask:"none",zIndex:1}]:[]]}]};r.push(d);const g=o.content_image?`/storage/images/item/${o.content_image}`:null,h=o.content_image?null:t.background_color||"#ffffff";console.log("🖼️ [CONTENT] content_image:",o.content_image),console.log("🖼️ [CONTENT] backgroundImage construida:",g),console.log("🎨 [CONTENT] backgroundColor:",h);for(let T=1;T<=a;T++){const x={id:`page-content-${T}`,type:"content",pageNumber:T,layout:"layout-1",backgroundImage:g,backgroundColor:h,cells:[{id:`cell-content-${T}-1`,elements:[{id:`page-number-${T}`,type:"text",content:`Página ${T}`,position:{x:5,y:5},size:{width:20,height:8},style:{fontSize:"14px",fontFamily:"Arial",color:"#666666",textAlign:"left"},zIndex:1},{id:`content-area-${T}`,type:"text",content:"Haz clic para agregar contenido...",position:{x:10,y:20},size:{width:80,height:60},style:{fontSize:"16px",fontFamily:"Arial",color:"#999999",textAlign:"center"},zIndex:1}]}]};r.push(x)}const f=o.back_cover_image?`/storage/images/item/${o.back_cover_image}`:null,b=o.back_cover_image?null:t.background_color||"#ffffff";console.log("🖼️ [FINAL] back_cover_image:",o.back_cover_image),console.log("🖼️ [FINAL] backgroundImage construida:",f),console.log("🎨 [FINAL] backgroundColor:",b);const y={id:"page-final",type:"final",layout:"layout-1",backgroundImage:f,backgroundColor:b,cells:[{id:"cell-final-1",elements:[]}]};r.push(y),console.log("✅ Created pages:",r),X(r),K(0),t.width&&t.height&&(console.log("📐 Canvas dimensions found, setting workspace to preset dimensions"),C("preset"))}catch(r){console.error("❌ Error creating pages:",r),z(r.message)}},Le=p.useMemo(()=>({cover:i.filter(t=>t.type==="cover"),content:i.filter(t=>t.type==="content"),final:i.filter(t=>t.type==="final")}),[i]),U=p.useCallback(()=>{if(!j||!O||i.length===0)return null;const t=i[m];if(!t)return null;const o=t.cells.find(r=>r.id===O);return o?o.elements.find(r=>r.id===j):null},[j,O,i,m]),ot=(t,o)=>{if(o){const r=i[m].cells.find(l=>l.id===o),a=r==null?void 0:r.elements.find(l=>l.id===t);if(a!=null&&a.locked){console.log("Elemento bloqueado, no se puede seleccionar");const l=document.createElement("div");l.className="fixed top-4 right-4 bg-amber-100 border border-amber-400 text-amber-700 px-4 py-2 rounded-lg z-50",l.textContent="Este elemento es parte del diseño base y no se puede editar",document.body.appendChild(l),setTimeout(()=>{document.body.contains(l)&&document.body.removeChild(l)},3e3);return}}if(o&&me(o),Q(t),t){const r=i[m].cells.find(l=>l.id===(o||O)),a=r==null?void 0:r.elements.find(l=>l.id===t);(a==null?void 0:a.type)==="image"?(ie(a),console.log(Z)):(a==null?void 0:a.type)==="text"?(Re(!0),so({elementId:t,cellId:o||O})):Re(!1)}else Re(!1),ie(null)},xe=()=>{if(i.length===0)return te[0];const t=i[m];return t?te.find(o=>o.id===t.layout)||te[0]:te[0]},Ae=p.useCallback(t=>{console.log("📝 [DEBUG] updatePages llamado para página:",m),X(t);const o=[...ne.slice(0,D+1),JSON.stringify(t)];ye(o),he(o.length-1);try{const r=ke(),a={pages:t,currentPage:m,savedAt:Date.now()},l=JSON.stringify(a),u=Math.round(l.length/1024);if(u<2048)localStorage.setItem(r,l),console.log(`💾 Progreso guardado en localStorage (${u} KB)`);else{console.warn(`⚠️ Datos demasiado grandes para localStorage (${u} KB), saltando guardado local`);try{localStorage.removeItem(r)}catch(d){console.error("Error limpiando localStorage:",d)}}}catch(r){if(console.error("❌ Error guardando en localStorage:",r),r.name==="QuotaExceededError")try{const a=ke();localStorage.removeItem(a),console.log("🧹 localStorage limpiado debido a QuotaExceededError")}catch(a){console.error("Error limpiando localStorage:",a)}}if(t[m]){const r=t[m].id;console.log("�️ [DEBUG] Invalidando miniatura por cambios en página:",r),le(a=>{const l={...a};return delete l[r],console.log("🗑️ [DEBUG] Thumbnail eliminado, forzando regeneración"),l})}},[ne,D,ke,m]);p.useEffect(()=>{try{const t=ke(),o={pages:i,currentPage:m,savedAt:Date.now()},r=JSON.stringify(o),a=Math.round(r.length/1024);a<2048?localStorage.setItem(t,r):console.warn(`⚠️ Datos demasiado grandes para localStorage (${a} KB), saltando guardado`)}catch(t){if(console.error("❌ Error guardando currentPage en localStorage:",t),t.name==="QuotaExceededError")try{const o=ke();localStorage.removeItem(o),console.log("🧹 localStorage limpiado debido a QuotaExceededError")}catch(o){console.error("Error limpiando localStorage:",o)}}},[m,i,ke]);const fo=async()=>{var o;if(!(n!=null&&n.id)){S.error("No se ha cargado ningún proyecto.");return}if(fe){S.warning("⏳ Ya se está generando un PDF. Por favor espera...");return}ae(!0);const t=S.loading(`🖨️ Generando PDF de alta calidad (300 DPI)...
⏱️ Este proceso puede tomar varios minutos
📁 El archivo se descargará automáticamente`,{duration:0});try{if(!i||i.length===0){S.dismiss(t),S.error("El proyecto no tiene páginas para exportar.");return}const r=i.filter(h=>h.cells&&h.cells.length>0&&h.cells.some(f=>f.elements&&f.elements.length>0));if(r.length===0){S.dismiss(t),S.error("Las páginas del proyecto están vacías. Agrega contenido antes de generar el PDF.");return}console.log("🖨️ [PDF-EXPORT] Iniciando exportación del proyecto:",{projectId:n.id,totalPages:i.length,pagesWithContent:r.length});const a=new AbortController,l=setTimeout(()=>{a.abort()},3e5),u={method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)||"",Accept:"application/pdf","X-Requested-With":"XMLHttpRequest","Cache-Control":"no-cache"},credentials:"same-origin",signal:a.signal,body:JSON.stringify({quality:"high",dpi:300,includeBackgrounds:!0,optimize:!0,pages:r,projectData:{id:n.id,name:n.name,design_data:{pages:r}}})};S.loading("📊 Procesando "+r.length+` páginas...
⏱️ Por favor mantén esta pestaña abierta`,{id:t});let d;const g=window.location.hostname==="localhost"&&window.location.port==="5174"?"http://127.0.0.1:8000":"";console.log("🌐 [PDF-EXPORT] Configuración de URL:",{currentLocation:window.location.href,hostname:window.location.hostname,port:window.location.port,baseUrl:g||"relative",finalUrl:`${g}/api/test/projects/${n.id}/export/pdf`});try{d=await fetch(`${g}/api/test/projects/${n.id}/export/pdf`,u),console.log("📡 [PDF-EXPORT] Respuesta recibida:",{status:d.status,statusText:d.statusText,ok:d.ok,headers:Object.fromEntries(d.headers.entries())})}catch(h){if(console.error("🚨 [PDF-EXPORT] Error de red:",{error:h,message:h.message,name:h.name}),h.name==="AbortError")throw new Error("Timeout: El PDF está tardando demasiado en generarse. Intenta con menos páginas.");console.warn("⚠️ [PDF-EXPORT] Error en ruta de test, intentando ruta autenticada...");try{d=await fetch(`${g}/api/customer/projects/${n.id}/export/pdf`,u)}catch(f){throw f.name==="AbortError"?new Error("Timeout: El PDF está tardando demasiado en generarse. Intenta con menos páginas."):(console.error("❌ [PDF-EXPORT] Todas las rutas fallaron:",f),new Error(`Error de conexión al generar el PDF: ${f.message}`))}}if(clearTimeout(l),!d.ok&&(d.status===401||d.status===404)){console.warn("⚠️ [PDF-EXPORT] Ruta de test falló, intentando ruta autenticada...");try{const h={...u};delete h.signal,d=await fetch(`${g}/api/customer/projects/${n.id}/export/pdf`,h)}catch(h){throw console.error("❌ [PDF-EXPORT] Ruta autenticada también falló:",h),new Error("Error de conexión al generar el PDF. Verifica tu conexión a internet.")}}if(d.ok){const h=d.headers.get("content-type");if(h&&h.includes("application/pdf")){S.loading(`📦 Descargando PDF...
⏬ Preparando archivo`,{id:t});try{const f=await d.blob();if(f.size>0){const b=`${n.name||"proyecto"}_${new Date().toISOString().split("T")[0]}.pdf`,y=(f.size/(1024*1024)).toFixed(2);Ro.saveAs(f,b),S.dismiss(t),S.success(`✅ PDF descargado exitosamente!
📄 Archivo: ${b}
📦 Tamaño: ${y} MB
📁 Ubicación: Carpeta de Descargas`,{duration:8e3}),console.log("✅ [PDF-EXPORT] PDF descargado exitosamente:",{fileName:b,size:y+" MB",pages:r.length})}else console.error("❌ [PDF-EXPORT] PDF blob está vacío"),S.dismiss(t),S.error("El PDF generado está vacío. Verifica que el proyecto tenga contenido.")}catch(f){console.error("❌ [PDF-EXPORT] Error al procesar blob:",f),S.dismiss(t),S.error(`Error al procesar el PDF: ${f.message}`)}}else{const f=await d.json(),b=f.message||"Error desconocido al generar el PDF.";S.dismiss(t),S.error(`❌ ${b}`),console.error("❌ [PDF-EXPORT] Error del servidor:",f)}}else try{const h=await d.json(),f=h.message||`Error HTTP ${d.status}`;S.dismiss(t),d.status===401?S.error("❌ Sesión expirada. Por favor, inicia sesión nuevamente."):d.status===403?S.error("❌ No tienes permisos para exportar este proyecto."):d.status===404?S.error("❌ Proyecto no encontrado. Verifica que el proyecto exista."):d.status===413?S.error("❌ El proyecto es demasiado grande para generar PDF. Intenta reducir el número de páginas o imágenes."):d.status===500?S.error("❌ Error del servidor. El proyecto puede ser demasiado complejo o grande."):S.error(`❌ ${f}`),console.error("❌ [PDF-EXPORT] Error HTTP:",{status:d.status,error:h})}catch(h){S.dismiss(t),d.status===404?S.error("❌ Endpoint de PDF no encontrado. Verifica la configuración del servidor."):d.status===401?S.error("❌ Sesión expirada. Por favor, inicia sesión nuevamente."):d.status===413?S.error("❌ El proyecto es demasiado grande. Intenta reducir el contenido."):S.error(`❌ Error del servidor (${d.status}). El proyecto puede ser demasiado grande o complejo.`),console.error("❌ [PDF-EXPORT] Error parseando respuesta de error:",h)}}catch(r){S.dismiss(t),console.error("❌ [PDF-EXPORT] Error de red:",r),r.message.includes("Timeout")?S.error("⏱️ "+r.message):r.name==="AbortError"?S.error("❌ Operación cancelada. El PDF tardó demasiado en generarse."):S.error("❌ Error de conexión al generar el PDF. Verifica tu conexión a internet.")}finally{ae(!1)}},xo=()=>{console.log("🔍 [DEBUG] Estado actual de thumbnails:",{pageThumbnails:q,totalThumbnails:Object.keys(q).length,pages:i.map(t=>({id:t.id,type:t.type,hasThumbnail:!!q[t.id]}))})};window.debugThumbnails=xo,p.useCallback(()=>{le({}),console.log("🧹 Thumbnails limpiados para liberar memoria"),setTimeout(()=>{i[m]&&(console.log("🔄 Forzando regeneración de thumbnail para página actual..."),Ee())},500)},[Ee,i,m]),p.useCallback(async()=>{console.log("🐛 [DEBUG] Generando thumbnail manualmente..."),console.log("🐛 [DEBUG] Página actual:",m),console.log("🐛 [DEBUG] Datos de la página:",i[m]);try{const t=await pe({type:"thumbnail"});console.log("🐛 [DEBUG] Resultado de captura:",t?"SUCCESS":"FAILED"),t&&(le(o=>({...o,[i[m].id]:t})),console.log("🐛 [DEBUG] Thumbnail guardado exitosamente"))}catch(t){console.error("🐛 [DEBUG] Error en debug thumbnail:",t)}},[pe,m,i]);const bo=t=>{const o=te.find(u=>u.id===t);if(!o)return;const r=[...i],a=r[m],l=Array.from({length:o.cells}).map((u,d)=>a.cells[d]||{id:`cell-${a.id}-${d+1}`,elements:[]});r[m]={...a,layout:t,cells:l},Ae(r),Q(null),me(null)},Ie=(t,o)=>{console.log("➕ [DEBUG] addElementToCell llamado:",{cellId:t,elementId:o.id,type:o.type});const r=[...i];for(let a=0;a<r[m].cells.length;a++)r[m].cells[a].id===t&&(r[m].cells[a].elements.push(o),console.log("✅ [DEBUG] Elemento añadido a celda. Total elementos en celda:",r[m].cells[a].elements.length));Ae(r),Q(o.id),me(t),console.log("🎯 [DEBUG] Elemento añadido, thumbnail debería regenerarse")},Y=(t,o,r,a=!1)=>{const l=[...i],u=l[m].cells.findIndex(d=>d.id===t);if(u!==-1){if(a)l[m].cells[u].elements.push({...l[m].cells[u].elements.find(d=>d.id===o),...r}),console.log("🎯 [DEBUG] Elemento duplicado, thumbnail debería regenerarse");else{const d=l[m].cells[u].elements.findIndex(g=>g.id===o);d!==-1&&(l[m].cells[u].elements[d]={...l[m].cells[u].elements[d],...r},console.log("🎯 [DEBUG] Elemento actualizado, thumbnail debería regenerarse"))}Ae(l)}},Fe=(t,o)=>{console.log("🎯 [DEBUG] Eliminando elemento, thumbnail debería regenerarse");const r=[...i],a=r[m].cells.findIndex(l=>l.id===t);a!==-1&&(r[m].cells[a].elements=r[m].cells[a].elements.filter(l=>l.id!==o),Ae(r),j===o&&Q(null))},yo=(t,o,r)=>{console.log("🎯 [DEBUG] Moviendo elemento, thumbnail debería regenerarse");const a=[...i],l=a[m].cells.findIndex(u=>u.id===t);if(l!==-1){const u=a[m].cells[l].elements,d=u.findIndex(g=>g.id===o);if(d!==-1){const g=r==="up"?d+1:d-1;if(g>=0&&g<u.length){const h=u[d];u[d]=u[g],u[g]=h,Ae(a)}}}},vo=()=>{D>0&&(he(D-1),X(JSON.parse(ne[D-1])),Q(null),me(null))},wo=()=>{D<ne.length-1&&(he(D+1),X(JSON.parse(ne[D+1])),Q(null),me(null))},Ue=(t="body")=>{const o=`text-${Date.now()}`,r={heading:{fontSize:"32px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"12px",borderRadius:"0px",border:"none",opacity:1},subheading:{fontSize:"24px",fontFamily:"Arial",color:"#333333",fontWeight:"600",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"10px",borderRadius:"0px",border:"none",opacity:1},body:{fontSize:"16px",fontFamily:"Arial",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1}},a={heading:"Título Principal",subheading:"Subtítulo",body:"Haz clic para editar"},l={heading:{width:.8,height:.2},subheading:{width:.6,height:.15},body:{width:.4,height:.15}},u={id:o,type:"text",content:a[t],position:{x:.05,y:.05},size:l[t],style:r[t]};O?Ie(O,u):console.log("Selecciona una celda primero")},Te=p.useMemo(()=>{var l;const t=i[m];if(!t)return null;const o=((l=t.cells)==null?void 0:l.flatMap(u=>u.elements||[]))||[],r=o.map(u=>({id:u.id,type:u.type,position:u.position,size:u.size}));return{pageId:t.id,elementsCount:o.length,contentHash:JSON.stringify(r).substring(0,100),backgroundImage:t.backgroundImage,backgroundColor:t.backgroundColor,layout:t.layout}},[i,m]);p.useEffect(()=>{if(i.length===0||L||!Te){console.log("🔍 [DEBUG] Saltando generación de thumbnail:",{pagesLength:i.length,isLoading:L,hasKey:!!Te});return}let t=!1;const o=async()=>{try{const a=i[m];if(!a||!a.id){console.log("🔍 [DEBUG] No hay página actual válida");return}const l=a.id;if(console.log("🔄 [DEBUG] Forzando regeneración de miniatura para página:",l),console.log("🔍 [DEBUG] Clave de generación completa:",Te),le(d=>{const g={...d};return delete g[l],g}),await new Promise(d=>setTimeout(d,100)),t){console.log("🚫 [DEBUG] Generación cancelada");return}console.log("📸 [DEBUG] Capturando workspace...");const u=await pe();u&&!t?(console.log("✅ [DEBUG] Miniatura capturada, aplicando..."),le(d=>({...d,[l]:u})),console.log("✅ [DEBUG] Miniatura regenerada exitosamente para:",l)):console.warn("⚠️ [DEBUG] No se pudo generar miniatura para:",l)}catch(a){t||console.error("❌ [DEBUG] Error regenerando miniatura:",a)}},r=setTimeout(()=>{console.log("⏰ [DEBUG] Ejecutando generación de thumbnail después del debounce"),o()},500);return()=>{t=!0,clearTimeout(r)}},[m,Te,L,pe]),p.useEffect(()=>{if(i.length===0||L)return;const t=async()=>{const r=i.filter(a=>!q[a.id]);if(r.length!==0){console.log("🔄 Generando miniaturas en segundo plano para",r.length,"páginas");for(const a of r)try{const l=document.createElement("canvas");l.width=200,l.height=150;const u=l.getContext("2d");if(u.fillStyle=a.backgroundColor||"#ffffff",u.fillRect(0,0,200,150),a.backgroundImage)try{const g=new Image;g.crossOrigin="anonymous",await new Promise((h,f)=>{g.onload=h,g.onerror=f,g.src=a.backgroundImage}),u.drawImage(g,0,0,200,150)}catch(g){console.warn("No se pudo cargar imagen de fondo para miniatura:",g)}a.cells&&a.cells.forEach(g=>{g.elements&&g.elements.forEach(h=>{var f;h.type==="text"&&h.content&&(u.fillStyle=((f=h.style)==null?void 0:f.color)||"#000000",u.font="12px Arial",u.fillText(h.content.substring(0,20)+(h.content.length>20?"...":""),10,30))})});const d=l.toDataURL("image/jpeg",.7);le(g=>({...g,[a.id]:d})),console.log("✅ Miniatura de fondo generada para:",a.id),await new Promise(g=>setTimeout(g,300))}catch(l){console.error("❌ Error generando miniatura de fondo para:",a.id,l)}}},o=setTimeout(()=>{t()},2e3);return()=>clearTimeout(o)},[i,q,L]);const jo=async()=>{var t;console.log("🛒 === INICIO addAlbumToCart CON BACKEND PDF ===");try{if(console.log("📊 Estado actual:",{itemData:c,presetData:s,cartLength:H==null?void 0:H.length,pagesLength:i==null?void 0:i.length,projectId:n==null?void 0:n.id}),!c||!s||!(n!=null&&n.id))return console.error("❌ Faltan datos necesarios para crear el álbum"),console.log("itemData:",c),console.log("presetData:",s),console.log("projectData:",n),S.error("Error: Datos del álbum incompletos"),!1;console.log("💾 Guardando progreso final en base de datos..."),await Se(i,!0)||console.warn("⚠️ No se pudo guardar el progreso, pero continuando..."),console.log("📄 Preparando datos para PDF backend...");const r={design_data:{id:n.id,title:(c==null?void 0:c.name)||"Álbum Personalizado",pages:i,workspace_dimensions:R,created_at:new Date().toISOString()},item_data:{id:c==null?void 0:c.id,name:(c==null?void 0:c.name)||(c==null?void 0:c.title),price:c==null?void 0:c.price,user_id:c==null?void 0:c.user_id,width:c==null?void 0:c.width,height:c==null?void 0:c.height},preset_data:{id:s==null?void 0:s.id,width:s==null?void 0:s.width,height:s==null?void 0:s.height,cover_image:s==null?void 0:s.cover_image,content_layer_image:s==null?void 0:s.content_layer_image,final_layer_image:s==null?void 0:s.final_layer_image},dimensions:{width_mm:(s==null?void 0:s.width)||(c==null?void 0:c.width)||210,height_mm:(s==null?void 0:s.height)||(c==null?void 0:c.height)||297,workspace_width:(R==null?void 0:R.width)||800,workspace_height:(R==null?void 0:R.height)||600}};console.log("📄 Marcando proyecto listo para PDF backend...");try{const b=await fetch("/api/canvas-projects/save",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({id:n.id,status:"ready_for_pdf",pdf_data:r,completed_at:new Date().toISOString()})});if(b.ok){const y=await b.json();console.log("✅ Proyecto marcado como completado:",y)}else console.warn("⚠️ Error marcando proyecto como completado")}catch(b){console.warn("⚠️ Error en marcado de completado:",b)}console.log("🆔 Generando project_id único...");const a=Date.now(),l=n.id;console.log("🆔 Project ID para carrito:",l),window.currentProjectId=l,window.albumProjectId=l,console.log("📦 Creando producto del álbum...");let u=s.cover_image;q&&q["page-cover"]&&(u=q["page-cover"]);let d=u;u&&u.startsWith("data:image/")&&u.length>1e5&&(console.log("🖼️ Thumbnail muy grande, usando imagen del preset"),d=s.cover_image||"/assets/img/default-album.jpg");const g={...c,project_id:l,canvas_project_id:n.id,quantity:1,type:"custom_album",pdf_metadata:{width_mm:s.width,height_mm:s.height,pages_count:i.length,workspace_dimensions:R,requires_pdf_generation:!0}};console.log("📦 Producto del álbum creado:",g),console.log("🛒 Agregando producto al carrito...");const h=structuredClone(H),f=h.findIndex(b=>b.id==g.id);return f==-1?(h.push({...g,quantity:1}),console.log("➕ Producto agregado como nuevo item")):(h[f].quantity++,console.log("📈 Cantidad incrementada para producto existente")),J(h),console.log("✅ Carrito actualizado:",h.length,"items"),S.success("Álbum agregado al carrito",{description:`${g.name} se ha añadido al carrito. El PDF se generará en el backend.`,icon:e.jsx(Wo,{className:"h-5 w-5 text-green-500"}),duration:4e3,position:"bottom-center"}),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{cart:h,action:"add",product:g}})),console.log("🛒 === FIN addAlbumToCart EXITOSO ==="),!0}catch(o){return console.error("❌ === ERROR EN addAlbumToCart ==="),console.error("Error completo:",o),console.error("Stack trace:",o.stack),console.error("Mensaje del error:",o.message),S.error("Error al agregar al carrito",{description:`Error específico: ${o.message}`,duration:5e3,position:"bottom-center"}),!1}};window.finalizeAlbumDesign=async()=>{console.log("🚀 Iniciando finalización del diseño del álbum...");try{if(!i||i.length===0)throw new Error("No hay páginas para finalizar");const r={design_data:{pages:(y=>y.map(T=>({id:T.id,type:T.type,pageNumber:T.pageNumber,layout:T.layout,cells:T.cells.map(x=>({id:x.id,elements:x.elements.map(w=>{const N={id:w.id,type:w.type,position:w.position,zIndex:w.zIndex||1};if(w.type==="image"){if(w.content.startsWith("data:image/")){const A=btoa(w.content.substring(0,100)).substring(0,20);N.content=`[BASE64_IMAGE_${A}]`,N.contentType=w.content.split(";")[0].split(":")[1],N.originalSize=w.content.length}else N.content=w.content;if(w.filters){const A=Object.entries(w.filters).filter(([B,M])=>M!==0&&M!==!1&&M!==null).reduce((B,[M,_])=>(B[M]=_,B),{});Object.keys(A).length>0&&(N.filters=A)}w.mask&&w.mask!=="none"&&(N.mask=w.mask),w.size&&(N.size=w.size),w.locked&&(N.locked=w.locked)}else if(w.type==="text"&&(N.content=w.content,w.style)){const A=Object.entries(w.style).filter(([B,M])=>!(B==="fontSize"&&M==="16px"||B==="color"&&M==="#000000"||B==="fontFamily"&&M==="Arial")).reduce((B,[M,_])=>(B[M]=_,B),{});Object.keys(A).length>0&&(N.style=A)}return N})}))})))(i),projectInfo:{id:n==null?void 0:n.id,item_id:c==null?void 0:c.id,title:c==null?void 0:c.title,preset_id:s==null?void 0:s.id},presetInfo:{id:s==null?void 0:s.id,name:s==null?void 0:s.name,cover_image:s==null?void 0:s.cover_image,content_image:s==null?void 0:s.content_image,back_cover_image:s==null?void 0:s.back_cover_image},workspace:{width:R.width,height:R.height,scale:R.scale},meta:{finalizedAt:new Date().toISOString(),version:"1.3"}},thumbnails:Object.fromEntries(Object.entries(q).map(([y,T])=>[y,T]))},a=JSON.stringify(r),l=Math.round(a.length/1024),u=Math.round(l/1024*100)/100;console.log(`Tamaño del payload: ${l} KB (${u} MB)`);let d=0,g=0;i.forEach(y=>{var T;(T=y.cells)==null||T.forEach(x=>{var w;(w=x.elements)==null||w.forEach(N=>{N.type==="image"&&N.content&&N.content.startsWith("data:image/")&&(d++,g+=N.content.length)})})});const h=Math.round(g/(1024*1024)*100)/100;if(console.log(`Imágenes base64 encontradas: ${d}, Tamaño total: ${h} MB`),l>1024&&!confirm(`El diseño contiene ${d} imágenes (${h} MB en imágenes). Payload completo: ${u} MB. Esto podría causar problemas al guardarlo. ¿Desea continuar de todos modos?`))return!1;const f=await fetch(`/api/canvas/projects/${n.id}/save`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:a});if(!f.ok){let y="Error al finalizar el diseño";try{y=(await f.json()).message||y}catch{f.status===413?y="El diseño es demasiado grande para ser guardado. Intente simplificar las imágenes.":f.status>=500&&(y="Error del servidor. Intente nuevamente más tarde.")}throw new Error(y)}const b=await f.json();return console.log("✅ Diseño finalizado exitosamente en el servidor"),console.log("📄 Respuesta del servidor:",b),!0}catch(t){console.error("Error al finalizar diseño:",t);let o=t.message;return t.message.includes("Failed to fetch")?o="Error de conexión. Verifique su conexión a internet e intente nuevamente.":(t.message.includes("NetworkError")||t.message.includes("net::"))&&(o="Error de red. Intente nuevamente más tarde."),alert("Error al finalizar el diseño: "+o),!1}};const No=p.useCallback(async()=>{console.log("🖨️ === INICIO generateAlbumPDF ===");try{const{jsPDF:t}=await ko(async()=>{const{jsPDF:A}=await import("./jspdf.es.min-D3plwuQr.js").then(B=>B.j);return{jsPDF:A}},__vite__mapDeps([0,1,2,3,4]));let o=(s==null?void 0:s.width)||21,r=(s==null?void 0:s.height)||29.7;const a=.3,l=o+a*2,u=r+a*2,d=l*28.35,g=u*28.35;console.log("📏 Dimensiones PDF con sangrado profesional:",{originalWidthCm:o,originalHeightCm:r,printWidthCm:l,printHeightCm:u,widthPt:d,heightPt:g,bleedCm:a});const h=new t({orientation:d>g?"landscape":"portrait",unit:"pt",format:[d,g],compress:!1}),f=i.length;let b=0;const y=document.createElement("div");y.id="pdf-progress",y.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",y.innerHTML=`
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Generando PDF de alta calidad...</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="pdf-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                        <span id="current-page">0</span> de ${f} páginas procesadas
                    </p>
                </div>
            `,document.body.appendChild(y);const T=A=>{const B=A/f*100;document.getElementById("pdf-progress-bar").style.width=`${B}%`,document.getElementById("current-page").textContent=A},x=m;for(let A=0;A<i.length;A++){const B=i[A];console.log(`🔄 Procesando página ${A+1}/${f}: ${B.id}`),K(A),await new Promise(M=>setTimeout(M,500));try{const M=await pe({type:"pdf"});if(M){const _=M.width/M.height,ce=d/g;let ee,re,ge=0,ve=0;_>ce?(ee=d,re=d/_,ve=(g-re)/2):(re=g,ee=g*_,ge=(d-ee)/2);const we=M.toDataURL("image/png",1);A>0&&h.addPage([d,g]),h.addImage(we,"PNG",ge,ve,ee,re),console.log(`✅ Página ${A+1} agregada al PDF`)}else console.warn(`⚠️ No se pudo capturar la página ${A+1}`),A>0&&h.addPage([d,g]),h.setFontSize(12),h.text(`Error al renderizar página ${A+1}`,d/2,g/2,{align:"center"})}catch(M){console.error(`❌ Error procesando página ${A+1}:`,M),A>0&&h.addPage([d,g]),h.setFontSize(12),h.text(`Error al procesar página ${A+1}`,d/2,g/2,{align:"center"})}b++,T(b),await new Promise(M=>setTimeout(M,200))}K(x);const w=`${(c==null?void 0:c.name)||"album"}_${new Date().toISOString().split("T")[0]}.pdf`;h.save(w),document.body.removeChild(y),console.log("✅ PDF generado exitosamente:",w);const N=document.createElement("div");return N.className="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",N.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>PDF de alta calidad generado: ${w}</span>
                </div>
            `,document.body.appendChild(N),setTimeout(()=>{document.body.contains(N)&&document.body.removeChild(N)},5e3),w}catch(t){console.error("❌ Error generando PDF:",t);const o=document.getElementById("pdf-progress");o&&document.body.removeChild(o);const r=document.createElement("div");throw r.className="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",r.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Error al generar PDF: ${t.message}</span>
                </div>
            `,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},7e3),t}},[i,m,K,pe,s,c]);return window.generateAlbumPDF=No,window.generateHighQualityThumbnail=ao,window.captureCurrentWorkspace=pe,e.jsxs(So,{backend:Ao,className:"!h-screen !w-screen overflow-hidden",children:[L?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Cargando Editor"}),e.jsx("p",{className:"customtext-neutral-dark",children:"Preparando tu álbum personalizado..."})]})}):V?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:V}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Reintentar"}),e.jsx("button",{onClick:()=>window.history.back(),className:"w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Volver"})]})]})}):i.length===0?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Inicializando Editor"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:"Generando páginas del álbum..."}),e.jsx("div",{className:"animate-pulse flex space-x-4",children:e.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-5/6"})]})]})})]})}):e.jsxs("div",{className:"h-screen w-screen overflow-hidden bg-[#141b34] font-sans",children:[e.jsx(Fo,{isOpen:no,onRequestClose:()=>io(!1),pages:i.map(t=>({...t,layout:te.find(o=>o.id===t.layout)||te[0]})),workspaceDimensions:R,getCurrentLayout:t=>t?te.find(o=>o.id===t.layout)||te[0]:te[0],presetData:s,pageThumbnails:q,addAlbumToCart:jo,projectData:n,itemData:c}),e.jsx("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white shadow-lg flex items-center px-6 z-20 border-b border-gray-200",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors text-[#040404]",children:[e.jsx(Ho,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Volver"})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:vo,disabled:D<=0,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Po,{className:"h-4 w-4 text-[#040404]"})}),e.jsx("button",{onClick:wo,disabled:D>=ne.length-1,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Io,{className:"h-4 w-4 text-[#040404]"})})]})]}),e.jsx("div",{className:"flex-1 max-w-md mx-8",children:e.jsx("input",{type:"text",value:(n==null?void 0:n.name)||"Álbum Sin Título",onChange:t=>v({...n,name:t.target.value}),className:"w-full text-center text-lg font-bold text-[#040404] bg-transparent border-0 focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:bg-white rounded-lg px-4 py-2 transition-all",placeholder:"Nombre del diseño"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(dr,{saveStatus:de.saveStatus,lastSaved:de.lastSaved,lastAutoSaved:de.lastAutoSaved,hasUnsavedChanges:de.hasUnsavedChanges,isOnline:de.isOnline,saveError:de.saveError,onManualSave:uo}),e.jsxs("button",{onClick:fo,disabled:fe,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${fe?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#af5cb8] text-white hover:bg-[#5f2e61] shadow-md hover:shadow-lg"}`,children:[fe?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-gray-500 border-t-transparent"}):e.jsx(eo,{className:"h-4 w-4"}),fe?"Guardando...":"Guardar"]}),e.jsx("div",{className:"relative",children:e.jsx("button",{className:"h-8 w-8 rounded-full bg-[#af5cb8] flex items-center justify-center text-white font-medium",children:e.jsx(Go,{className:"h-4 w-4"})})})]})]})}),e.jsxs("div",{className:`flex h-full ${j?"pt-[60px]":"pt-16"}`,children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-20 bg-[#f7edfa] border-r border-gray-200 flex flex-col items-center py-6 space-y-2",children:[e.jsxs("button",{onClick:()=>ue("templates"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="templates"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Xt,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Templates"})]}),e.jsxs("button",{onClick:()=>ue("images"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="images"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ce,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Images"})]}),e.jsxs("button",{onClick:()=>ue("text"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="text"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Yt,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Text"})]}),e.jsxs("button",{onClick:()=>ue("shapes"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="shapes"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(er,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Shapes"})]}),e.jsxs("button",{onClick:()=>ue("stickers"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="stickers"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(or,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Stickers"})]}),e.jsxs("button",{onClick:()=>ue("pages"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="pages"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(qe,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Pages"})]}),e.jsxs("button",{onClick:()=>ue("panel"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="panel"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(We,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Panel"})]})]}),e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-[#040404] capitalize",children:[F==="templates"&&"Templates",F==="images"&&"Images",F==="text"&&"Text",F==="shapes"&&"Shapes",F==="stickers"&&"Stickers",F==="pages"&&"Pages",F==="panel"&&"Layers Panel"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[F==="templates"&&"Choose a template to get started",F==="images"&&"Search for images",F==="text"&&"Add and edit text",F==="shapes"&&"Add shapes and graphics",F==="stickers"&&"Add fun stickers",F==="pages"&&"Manage your pages",F==="panel"&&"Organize layers and z-index"]})]}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Yo,{className:"h-4 w-4 text-gray-500"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[F==="templates"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Xt,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Page Layouts"})]}),e.jsx(sr,{currentLayoutId:(rt=i[m])==null?void 0:rt.layout,onLayoutChange:bo})]}),F==="images"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ce,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Imágenes del Proyecto"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[Ne.length," imagen",Ne.length!==1?"s":""]})]}),e.jsx(mr,{images:Ne,onImageSelect:mo})]}),F==="text"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>Ue("heading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-2xl leading-tight",children:"Título Principal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"32px, Bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx($e,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>Ue("subheading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-lg leading-tight",children:"Subtítulo"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"24px, Semi-bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx($e,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>Ue("body"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-normal text-gray-900 text-base leading-tight",children:"Texto Normal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"16px, Normal"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx($e,{className:"h-4 w-4"})})]})})]}),F==="text"&&j&&((at=U())==null?void 0:at.type)==="text"&&e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"h-10 w-10 bg-[#af5cb8] rounded-xl flex items-center justify-center",children:e.jsx(Zo,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-[#040404] text-lg",children:"Editar Texto"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Personaliza el formato y estilo"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Formato:"}),e.jsx("button",{onClick:()=>{const t=U();Y(O,j,{style:{...t.style,fontWeight:t.style.fontWeight==="bold"?"normal":"bold"}})},className:`px-3 py-1.5 rounded-md text-sm font-bold transition-colors ${((nt=(st=U())==null?void 0:st.style)==null?void 0:nt.fontWeight)==="bold"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"B"}),e.jsx("button",{onClick:()=>{const t=U();Y(O,j,{style:{...t.style,fontStyle:t.style.fontStyle==="italic"?"normal":"italic"}})},className:`px-3 py-1.5 rounded-md text-sm italic transition-colors ${((lt=(it=U())==null?void 0:it.style)==null?void 0:lt.fontStyle)==="italic"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"I"}),e.jsx("button",{onClick:()=>{const t=U();Y(O,j,{style:{...t.style,textDecoration:t.style.textDecoration==="underline"?"none":"underline"}})},className:`px-3 py-1.5 rounded-md text-sm underline transition-colors ${((dt=(ct=U())==null?void 0:ct.style)==null?void 0:dt.textDecoration)==="underline"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"U"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tipografía:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((mt=(gt=U())==null?void 0:gt.style)==null?void 0:mt.fontFamily)||"Arial",onChange:t=>{const o=U();Y(O,j,{style:{...o.style,fontFamily:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Impact",children:"Impact"}),e.jsx("option",{value:"Comic Sans MS",children:"Comic Sans MS"}),e.jsx("option",{value:"Trebuchet MS",children:"Trebuchet MS"}),e.jsx("option",{value:"Tahoma",children:"Tahoma"}),e.jsx("option",{value:"Palatino",children:"Palatino"}),e.jsx("option",{value:"Garamond",children:"Garamond"}),e.jsx("option",{value:"Bookman",children:"Bookman"}),e.jsx("option",{value:"Avant Garde",children:"Avant Garde"}),e.jsx("option",{value:"Calibri",children:"Calibri"}),e.jsx("option",{value:"Cambria",children:"Cambria"}),e.jsx("option",{value:"Candara",children:"Candara"}),e.jsx("option",{value:"Century Gothic",children:"Century Gothic"}),e.jsx("option",{value:"Franklin Gothic",children:"Franklin Gothic"}),e.jsx("option",{value:"Futura",children:"Futura"}),e.jsx("option",{value:"Gill Sans",children:"Gill Sans"}),e.jsx("option",{value:"Lucida Grande",children:"Lucida Grande"}),e.jsx("option",{value:"Optima",children:"Optima"}),e.jsx("option",{value:"Segoe UI",children:"Segoe UI"}),e.jsx("option",{value:"Roboto",children:"Roboto"}),e.jsx("option",{value:"Open Sans",children:"Open Sans"}),e.jsx("option",{value:"Lato",children:"Lato"}),e.jsx("option",{value:"Montserrat",children:"Montserrat"}),e.jsx("option",{value:"Poppins",children:"Poppins"}),e.jsx("option",{value:"Nunito",children:"Nunito"}),e.jsx("option",{value:"Inter",children:"Inter"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tamaño:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((ht=(ut=U())==null?void 0:ut.style)==null?void 0:ht.fontSize)||"16px",onChange:t=>{const o=U();Y(O,j,{style:{...o.style,fontSize:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"8px",children:"8px"}),e.jsx("option",{value:"10px",children:"10px"}),e.jsx("option",{value:"12px",children:"12px"}),e.jsx("option",{value:"14px",children:"14px"}),e.jsx("option",{value:"16px",children:"16px"}),e.jsx("option",{value:"18px",children:"18px"}),e.jsx("option",{value:"20px",children:"20px"}),e.jsx("option",{value:"22px",children:"22px"}),e.jsx("option",{value:"24px",children:"24px"}),e.jsx("option",{value:"28px",children:"28px"}),e.jsx("option",{value:"32px",children:"32px"}),e.jsx("option",{value:"36px",children:"36px"}),e.jsx("option",{value:"40px",children:"40px"}),e.jsx("option",{value:"44px",children:"44px"}),e.jsx("option",{value:"48px",children:"48px"}),e.jsx("option",{value:"56px",children:"56px"}),e.jsx("option",{value:"64px",children:"64px"}),e.jsx("option",{value:"72px",children:"72px"}),e.jsx("option",{value:"80px",children:"80px"}),e.jsx("option",{value:"96px",children:"96px"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Color:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((ft=(pt=U())==null?void 0:pt.style)==null?void 0:ft.color)||"#000000",onChange:t=>{const o=U();Y(O,j,{style:{...o.style,color:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("span",{className:"text-xs text-gray-600 font-mono",children:((bt=(xt=U())==null?void 0:xt.style)==null?void 0:bt.color)||"#000000"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Fondo:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((vt=(yt=U())==null?void 0:yt.style)==null?void 0:vt.backgroundColor)||"#ffffff",onChange:t=>{const o=U();Y(O,j,{style:{...o.style,backgroundColor:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("button",{onClick:()=>{const t=U();Y(O,j,{style:{...t.style,backgroundColor:"transparent"}})},className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"🚫"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 w-20",children:"Alinear:"}),e.jsx("div",{className:"flex gap-1",children:["left","center","right","justify"].map(t=>{var o,r;return e.jsxs("button",{onClick:()=>{const a=U();Y(O,j,{style:{...a.style,textAlign:t}})},className:`px-3 py-1.5 rounded-md text-sm transition-colors ${((r=(o=U())==null?void 0:o.style)==null?void 0:r.textAlign)===t?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:[t==="left"&&"⬅",t==="center"&&"⬌",t==="right"&&"➡",t==="justify"&&"⬍"]},t)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Espaciado:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((jt=(wt=U())==null?void 0:wt.style)==null?void 0:jt.lineHeight)||"1.5",onChange:t=>{const o=U();Y(O,j,{style:{...o.style,lineHeight:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"1",children:"1.0"}),e.jsx("option",{value:"1.1",children:"1.1"}),e.jsx("option",{value:"1.2",children:"1.2"}),e.jsx("option",{value:"1.3",children:"1.3"}),e.jsx("option",{value:"1.4",children:"1.4"}),e.jsx("option",{value:"1.5",children:"1.5"}),e.jsx("option",{value:"1.6",children:"1.6"}),e.jsx("option",{value:"1.8",children:"1.8"}),e.jsx("option",{value:"2",children:"2.0"}),e.jsx("option",{value:"2.2",children:"2.2"}),e.jsx("option",{value:"2.5",children:"2.5"}),e.jsx("option",{value:"3",children:"3.0"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Letras:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((Et=(Nt=U())==null?void 0:Nt.style)==null?void 0:Et.letterSpacing)||"normal",onChange:t=>{const o=U();Y(O,j,{style:{...o.style,letterSpacing:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"-3px",children:"-3px"}),e.jsx("option",{value:"-2px",children:"-2px"}),e.jsx("option",{value:"-1px",children:"-1px"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"0.5px",children:"0.5px"}),e.jsx("option",{value:"1px",children:"1px"}),e.jsx("option",{value:"1.5px",children:"1.5px"}),e.jsx("option",{value:"2px",children:"2px"}),e.jsx("option",{value:"3px",children:"3px"}),e.jsx("option",{value:"4px",children:"4px"}),e.jsx("option",{value:"5px",children:"5px"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Efectos:"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>{const t=U();Y(O,j,{style:{...t.style,textTransform:t.style.textTransform==="uppercase"?"none":"uppercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((Ct=(kt=U())==null?void 0:kt.style)==null?void 0:Ct.textTransform)==="uppercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-black",children:"AA"}),"MAYÚS"]}),e.jsxs("button",{onClick:()=>{const t=U();Y(O,j,{style:{...t.style,textTransform:t.style.textTransform==="lowercase"?"none":"lowercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((At=(St=U())==null?void 0:St.style)==null?void 0:At.textTransform)==="lowercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-normal",children:"aa"}),"minús"]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Opacidad:"}),e.jsxs("span",{className:"text-sm font-bold text-[#af5cb8]",children:[Math.round((((It=(Pt=U())==null?void 0:Pt.style)==null?void 0:It.opacity)||1)*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:((Ot=(Tt=U())==null?void 0:Tt.style)==null?void 0:Ot.opacity)||"1",onChange:t=>{const o=U();Y(O,j,{style:{...o.style,opacity:t.target.value}})},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#af5cb8] slider",style:{background:`linear-gradient(to right, #af5cb8 0%, #af5cb8 ${(((_t=(Mt=U())==null?void 0:Mt.style)==null?void 0:_t.opacity)||1)*100}%, #e5e7eb ${(((Rt=($t=U())==null?void 0:$t.style)==null?void 0:Rt.opacity)||1)*100}%, #e5e7eb 100%)`}})]})]})]})]}),F==="shapes"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Array.from({length:9}).map((t,o)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#af5cb8] rounded-lg"})},o))})}),F==="stickers"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:6}).map((t,o)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#f6a4b2] rounded-full"})},o))})}),F==="pages"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(qe,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Pages"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[i.length," total"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mr-1.5"}),"Cover"]}),Le.cover.map((t,o)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${m===i.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>K(i.indexOf(t)),children:e.jsxs("div",{className:"relative bg-purple-50 overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(Ve,{pageId:t.id,thumbnail:q[t.id],altText:"Cover",type:"cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Cover"})})]})},t.id))]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mr-1.5"}),"Content Pages"]}),e.jsx("div",{className:"space-y-2",children:Le.content.map((t,o)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                    ${m===i.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                    mb-1`,onClick:()=>K(i.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(Ve,{pageId:t.id,thumbnail:q[t.id],altText:`Page ${t.pageNumber}`,type:"content"}),e.jsx("div",{className:"absolute top-1 left-1 bg-white/90 rounded-full h-5 w-5 flex items-center justify-center text-[10px] font-bold shadow-sm",children:t.pageNumber}),e.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-[9px] px-1.5 py-0.5 rounded-full opacity-80 group-hover:opacity-100",children:"Editable"})]})},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mr-1.5"}),"Back Cover"]}),Le.final.map((t,o)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${m===i.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>K(i.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border mb-1 aspect-[4/3] rounded-lg",children:[e.jsx(Ve,{pageId:t.id,thumbnail:q[t.id],altText:"Back Cover",type:"final"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Back Cover"})})]})},t.id))]})]})]}),F==="panel"&&e.jsx("div",{className:"space-y-4",children:e.jsx(ar,{pages:i,currentPage:m,selectedCell:O,selectedElement:j,onSelectCell:me,onSelectElement:Q,onUpdateElement:(t,o,r)=>{Y(t,o,r)},onDeleteElement:(t,o)=>{Fe(t,o)},onMoveElement:(t,o,r)=>{yo(t,o,r)}})}),F==="filters"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Vo,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Filters"})]}),(()=>{const t=U();return t?e.jsxs(e.Fragment,{children:[t.type==="image"&&e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-[#af5cb8]"}),e.jsx("span",{className:"text-sm font-medium",children:"Selected Image"})]}),e.jsx("div",{className:"w-full h-16 rounded-md overflow-hidden bg-gray-200",children:e.jsx("img",{src:t.content,alt:"",className:"w-full h-full object-cover"})})]}),t.type==="image"&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Masks"}),e.jsx(nr,{selectedMask:t.mask||"none",onSelect:o=>{Y(O,j,{mask:o})},availableMasks:Qt.map(o=>o.id),selectedImage:t})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Filters & Effects"}),e.jsx(To,{filters:t.filters||{},onFilterChange:o=>{Y(O,j,{filters:o})},selectedElement:t})]})]}):e.jsxs("div",{className:"text-center py-8 px-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg mb-3 inline-block",children:e.jsx(Ce,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h4",{className:"text-sm font-medium text-[#040404] mb-2",children:"Select an element"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Choose an image or text element to apply filters and effects"})]})})()]})]})]})]}),e.jsx("main",{className:"flex-1 flex flex-col h-full",children:e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 overflow-hidden bg-gray-100",children:G?e.jsx("div",{className:"bg-white rounded-lg shadow-lg",children:e.jsx("div",{className:"overflow-hidden",style:{width:R.width,height:R.height},children:e.jsx("div",{id:`page-${i[m].id}`,className:`grid ${xe().template} gap-6`,style:{width:"100%",height:"100%"},children:i[m].cells.map((t,o)=>{var r;return e.jsx(Gt,{id:t.id,elements:t.elements.filter(a=>!a.locked),workspaceSize:R,cellStyle:(r=xe().cellStyles)==null?void 0:r[i[m].cells.indexOf(t)],selectedElement:O===t.id?j:null,onSelectElement:ot,onAddElement:(a,l)=>Ie(l,a),onUpdateElement:(a,l,u)=>Y(t.id,a,l,u),onDeleteElement:a=>Fe(t.id,a),availableMasks:xe().maskCategories.flatMap(a=>a.masks),projectData:n},t.id)})})})}):e.jsxs("div",{id:`page-${i[m].id}`,className:" shadow-xl overflow-hidden",style:{width:R.width,height:R.height,position:"relative",backgroundColor:((Lt=i[m])==null?void 0:Lt.backgroundColor)||"#ffffff",backgroundImage:(Ft=i[m])!=null&&Ft.backgroundImage?`url(${i[m].backgroundImage})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:["                                        ",(()=>{const t=i[m];if(console.log("🖼️ [WORKSPACE] Renderizando background para página:",t==null?void 0:t.type),console.log("🖼️ [WORKSPACE] backgroundImage:",t==null?void 0:t.backgroundImage),console.log("🖼️ [WORKSPACE] backgroundColor:",t==null?void 0:t.backgroundColor),t!=null&&t.backgroundImage){const o=window.location.origin+t.backgroundImage;console.log("🔗 [WORKSPACE] URL completa de la imagen:",o),console.log("🔗 [WORKSPACE] URL relativa:",t.backgroundImage),fetch(t.backgroundImage,{method:"HEAD"}).then(r=>{r.ok?console.log("✅ [WORKSPACE] Imagen existe en el servidor"):console.error("❌ [WORKSPACE] Imagen NO existe en el servidor. Status:",r.status)}).catch(r=>{console.error("❌ [WORKSPACE] Error verificando imagen:",r)})}return t!=null&&t.backgroundImage?(console.log("🎨 [WORKSPACE] Aplicando imagen de fondo:",t.backgroundImage),e.jsx("img",{src:t.backgroundImage,alt:"background",className:"absolute inset-0 w-full h-full object-cover pointer-events-none",style:{zIndex:1},onLoad:()=>{var o,r,a,l;console.log("✅ [WORKSPACE] Imagen de fondo cargada exitosamente"),console.log("📐 [WORKSPACE] Dimensiones de la imagen cargada:",(r=(o=arguments[0])==null?void 0:o.target)==null?void 0:r.naturalWidth,"x",(l=(a=arguments[0])==null?void 0:a.target)==null?void 0:l.naturalHeight)},onError:o=>{console.error("❌ [WORKSPACE] Error cargando imagen de fondo:",o),console.error("❌ [WORKSPACE] URL que falló:",o.target.src),console.error("❌ [WORKSPACE] Error details:",o.target.error)}})):t!=null&&t.backgroundColor?(console.log("🎨 [WORKSPACE] Aplicando color de fondo:",t.backgroundColor),e.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{backgroundColor:t.backgroundColor,zIndex:1}})):(console.log("⚪ [WORKSPACE] Sin fondo personalizado, usando fondo por defecto"),null)})(),e.jsx("div",{className:`grid ${xe().template}`,style:{position:"relative",zIndex:10,width:"100%",height:"100%",boxSizing:"border-box",gap:((Ut=xe().style)==null?void 0:Ut.gap)||"16px",padding:((zt=xe().style)==null?void 0:zt.padding)||"16px"},children:i[m].cells.map(t=>{var o;return e.jsx(Gt,{id:t.id,elements:t.elements.filter(r=>!r.locked),workspaceSize:R,cellStyle:(o=xe().cellStyles)==null?void 0:o[i[m].cells.indexOf(t)],selectedElement:O===t.id?j:null,onSelectElement:ot,onAddElement:(r,a)=>Ie(a,r),onUpdateElement:(r,a,l)=>Y(t.id,r,a,l),onDeleteElement:r=>Fe(t.id,r),availableMasks:xe().maskCategories.flatMap(r=>r.masks),projectData:n},t.id)})})]})})})]})]}),e.jsx(Lo,{}),e.jsx(gr,{isOpen:lo,onClose:()=>Ye(!1),savedProgress:co,onLoadProgress:ho,onDiscardProgress:po})]})}export{ca as default};
