const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-D3plwuQr.js","assets/index-BH53Isel.js","assets/index-yBjzXJbu.js","assets/preload-helper-BfFHrpNk.js","assets/typeof-QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{_ as zs}from"./preload-helper-BfFHrpNk.js";import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as h,R as rt}from"./index-BH53Isel.js";import{T as hs,l as re,i as ms,a as Us,D as Fs,H as Ws,U as Bs,R as Hs,B as os,F as Vs,E as ns}from"./EditableCell-Cu-5czkC.js";import{h as is}from"./thumbnailGenerator-B4goYG9Y.js";import{L as Le}from"./layers-6oegOx-p.js";import{C as Gs}from"./chevron-down-DS-mdh9v.js";import{C as Ks}from"./chevron-right-Ckt5D2ka.js";import{E as qs}from"./eye-CKCH9ORv.js";import{c as le}from"./createLucideIcon-Cy5Ya80P.js";import{T as us}from"./trash-2-DK1wnsDn.js";import{S as Xs}from"./star-wPQTHY_n.js";import{I as be}from"./image-BEA0kkBS.js";import"./EditorLayout-CkCvwqGw.js";import"./jspdf.es.min-D3plwuQr.js";import{t as ee,T as Js}from"./index-BZYhE2TF.js";import{m as ls}from"./main-6DCdASTx.js";import{B as Ys}from"./V1Edit-CNtDxOEt.js";import{G as cs}from"./Global-ErywZRdd.js";import{S as Qs,F as Zs}from"./save-BfW-kI1U.js";import{C as Ds}from"./clock-BTrEpQej.js";import{C as ps}from"./check-DQ7QoS0v.js";import{L as er}from"./loader-circle-CrvBvIt1.js";import"./dom-to-image-more.min-BAoslaO8.js";import{C as tr}from"./chevron-left-B2s3ZsB7.js";import{U as sr}from"./user-BvYmyGTY.js";import{P as Me}from"./plus-Bot15Khs.js";import{F as rr}from"./filter-Ci9tsc_e.js";import{C as ar}from"./circle-check-big-D6DM3vPb.js";import{u as or}from"./useDrag-BaORhKlM.js";import"./index-yBjzXJbu.js";import"./sparkles-DeLUn6av.js";import"./sliders-vertical-C5ts4taK.js";import"./palette-DV_Vpyg9.js";import"./settings-BSPs3Zt8.js";import"./chevron-up-D78jyEhP.js";import"./copy-6OEekgvq.js";import"./TextElement-_pvTHO57.js";import"./upload-qgEr5bIl.js";import"./typeof-QjJsDpFa.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./PaymentModal-Bxx5p2o_.js";import"./index-Chjiymov.js";import"./x-DBMwyD6F.js";import"./download-Dh5rRDOT.js";import"./index-BSWw-p5k.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=le("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=le("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=le("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=le("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=le("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=le("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=le("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=le("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=le("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=le("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=le("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=le("Sticker",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M14 3v4a2 2 0 0 0 2 2h4",key:"36rjfy"}],["path",{d:"M8 13h.01",key:"1sbv64"}],["path",{d:"M16 13h.01",key:"wip0gl"}],["path",{d:"M10 16s.8 1 2 1c1.3 0 2-1 2-1",key:"1vvgv3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=le("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=le("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=le("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),xr=({pages:r,currentPage:g,selectedCell:c,selectedElement:N,onSelectCell:n,onSelectElement:m,onUpdateElement:x,onDeleteElement:b,onMoveElement:P})=>{var d;if(!r||!r[g])return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Le,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No page data available"})]});const j=r[g],E=((d=j==null?void 0:j.cells)==null?void 0:d.filter(y=>y.elements&&y.elements.length>0))||[],[C,L]=h.useState(()=>{const y={};return E.forEach(O=>{y[O.id]=!0}),y}),K=y=>{L(O=>({...O,[y]:!O[y]}))},F=y=>{switch(y){case"image":return e.jsx(be,{className:"h-4 w-4"});case"text":return e.jsx(hs,{className:"h-4 w-4"});case"shape":return e.jsx(ur,{className:"h-4 w-4"});case"sticker":return e.jsx(Xs,{className:"h-4 w-4"});default:return e.jsx(cr,{className:"h-4 w-4"})}},B=(y,O)=>{switch(y.type){case"text":return y.content?y.content.substring(0,20)+"...":"Text Layer";case"image":return`Image ${O+1}`;case"shape":return y.shape||"Shape";case"sticker":return`Sticker ${O+1}`;default:return`Element ${O+1}`}},o=(y,O,D)=>{x(y,O,{visible:D})},G=(y,O)=>{n(y),m(O)};return e.jsx("div",{className:"space-y-2",children:E.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Le,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No elements yet"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Add elements to see them here"})]}):E.map(y=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center p-3 cursor-pointer transition-colors ${c===y.id?"bg-purple-50 border-purple-200":"hover:bg-gray-50"}`,onClick:()=>{K(y.id),n(y.id)},children:[e.jsx("button",{className:"mr-2 text-gray-500 hover:text-gray-700",children:C[y.id]?e.jsx(Gs,{className:"h-4 w-4"}):e.jsx(Ks,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm text-gray-800",children:["Cell ",y.id]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[y.elements.length," element",y.elements.length!==1?"s":""]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[y.x,", ",y.y]})]}),C[y.id]&&e.jsx("div",{className:"border-t border-gray-100",children:y.elements.map((O,D)=>e.jsxs("div",{className:`flex items-center p-2 mx-2 mb-2 rounded cursor-pointer transition-colors ${N===O.id?"bg-purple-100 border border-purple-200":"hover:bg-gray-50"}`,onClick:()=>G(y.id,O.id),children:[e.jsx("div",{className:"mr-2 text-gray-500",children:F(O.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm truncate",children:B(O,D)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[O.type," • Layer ",D+1]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:$=>{$.stopPropagation(),o(y.id,O.id,!O.visible)},className:"p-1 hover:bg-gray-200 rounded",title:O.visible?"Hide element":"Show element",children:O.visible!==!1?e.jsx(qs,{className:"h-3 w-3 text-gray-500"}):e.jsx(gr,{className:"h-3 w-3 text-gray-400"})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),P(y.id,O.id,"up")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer up",disabled:D===y.elements.length-1,children:e.jsx(ir,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),P(y.id,O.id,"down")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer down",disabled:D===0,children:e.jsx(nr,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),b(y.id,O.id)},className:"p-1 hover:bg-red-100 rounded text-red-500",title:"Delete element",children:e.jsx(us,{className:"h-3 w-3"})})]})]},O.id))})]},y.id))})};function br({currentLayoutId:r,onLayoutChange:g}){const[c,N]=h.useState("all"),n={all:{name:"Todos",layouts:re},hero:{name:"Hero",layouts:re.filter(m=>m.category==="hero")},editorial:{name:"Editorial",layouts:re.filter(m=>m.category==="editorial")},storytelling:{name:"Historia",layouts:re.filter(m=>m.category==="storytelling")},minimal:{name:"Minimal",layouts:re.filter(m=>m.category==="minimal")},creative:{name:"Creativo",layouts:re.filter(m=>m.category==="creative")},classic:{name:"Clásico",layouts:re.filter(m=>m.category==="classic")}};return Object.keys(n).filter(m=>m==="all"||n[m].layouts.length>0),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"grid grid-cols-2  gap-3 overflow-x-hidden custom-scroll",children:n[c].layouts.map(m=>e.jsxs("div",{className:`relative group cursor-pointer transition-all duration-200 
                                 hover:shadow-md hover:scale-102
                        `,onClick:()=>g(m.id),children:[e.jsxs("div",{className:"aspect-square relative bg-white rounded-lg p-2 border border-gray-200",children:[e.jsx("div",{className:`w-full h-full grid ${m.template}`,style:{gap:"2px",padding:"4px"},children:Array.from({length:m.cells}).map((x,b)=>{var P,j;return e.jsx("div",{className:`bg-gradient-to-br from-purple-100 to-purple-200 ${(j=(P=m.cellStyles)==null?void 0:P[b])!=null&&j.includes("rounded")?"rounded":"rounded-sm"}`,style:{minHeight:"8px"}},b)})}),r===m.id&&e.jsx("div",{className:"absolute top-1/2 right-1/2 translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-900 truncate",children:m.name}),m.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:m.description}),e.jsx("div",{className:"flex items-center justify-center mt-1 space-x-2",children:e.jsxs("span",{className:"text-xs text-gray-400",children:[m.cells," ",m.cells===1?"celda":"celdas"]})})]})]},m.id))}),n[c].layouts.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"No hay layouts disponibles en esta categoría."})})]})}const yr=({selectedMask:r,onSelect:g,availableMasks:c=[],selectedImage:N})=>{var b,P;const[n,m]=h.useState("Básicas"),x={};return ms.forEach(j=>{x[j.category]||(x[j.category]=[]),(c.includes(j.id)||j.id==="none")&&x[j.category].push(j)}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-1 bg-gray-100 p-1 rounded-lg",children:Object.keys(x).slice(0,2).map(j=>x[j].length>0&&e.jsx("button",{onClick:()=>m(j),className:`py-1.5 px-2 text-xs rounded-md transition font-medium ${n===j?"bg-white text-purple-700 shadow-sm":"text-gray-600 hover:text-purple-600"}`,children:j},j))}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(b=x[n])==null?void 0:b.slice(0,6).map(j=>e.jsxs("div",{onClick:()=>g(j.id),className:`cursor-pointer border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all ${r===j.id?"ring-2 ring-purple-500 border-purple-300":"border-gray-200"}`,children:[e.jsx("div",{className:"aspect-square bg-white flex items-center justify-center p-1",children:N!=null&&N.content?e.jsx("img",{src:N.content,alt:j.name,className:`w-full h-full object-cover ${j.class}`}):e.jsx("div",{className:`w-full h-full bg-gray-200 ${j.class}`})}),e.jsx("p",{className:"text-center text-[10px] text-gray-700 p-1 truncate",children:j.name})]},j.id))}),((P=x[n])==null?void 0:P.length)>6&&e.jsxs("button",{className:"w-full py-2 text-xs text-purple-600 hover:text-purple-700 border border-purple-200 rounded-lg hover:bg-purple-50 transition",children:["Ver más máscaras (",x[n].length-6," más)"]})]})};function vr(r,g){var C,L,K,F;const c=parseInt((L=(C=r.style)==null?void 0:C.gap)==null?void 0:L.replace("px",""))||16,N=parseInt((F=(K=r.style)==null?void 0:K.padding)==null?void 0:F.replace("px",""))||16,n=B=>{const o=B.match(/grid-cols-(\d+)/),G=B.match(/grid-rows-(\d+)/),d=o?parseInt(o[1]):1,y=G?parseInt(G[1]):1;return{cols:d,rows:y}},{cols:m,rows:x}=n(r.template),b=g.width-2*N,P=g.height-2*N,j=(b-c*(m-1))/m,E=(P-c*(x-1))/x;return console.log("🎯 [WORKSPACE REPLICA] Grid simulation:",{template:r.template,cols:m,rows:x,gap:c,padding:N,workspace:g,cellSize:{width:j,height:E}}),{cols:m,rows:x,gap:c,padding:N,cellWidth:j,cellHeight:E,contentX:N,contentY:N}}function xs(r,g,c,N,n,m){if(!g||!r||n<=0||m<=0)return;const x=g.width/g.height,b=n/m;let P,j,E,C;x>b?(C=g.height,E=C*b,P=(g.width-E)/2,j=0):(E=g.width,C=E/b,P=0,j=(g.height-C)/2),r.save(),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high";try{r.drawImage(g,Math.max(0,P),Math.max(0,j),Math.min(E,g.width-Math.max(0,P)),Math.min(C,g.height-Math.max(0,j)),c,N,n,m)}catch(L){console.error("Error dibujando imagen:",L)}r.restore()}function wr(r,g,c,N,n,m){return new Promise(async x=>{try{const b=new Image;b.crossOrigin="anonymous",b.onload=()=>{var o,G,d,y;const P=((o=g.position)==null?void 0:o.x)||0,j=((G=g.position)==null?void 0:G.y)||0,E=P>=0&&P<=1,C=j>=0&&j<=1,L=c+(E?P*n:P),K=N+(C?j*m:j),F=(d=g.size)!=null&&d.width?g.size.width<=1?g.size.width*n:g.size.width:n,B=(y=g.size)!=null&&y.height?g.size.height<=1?g.size.height*m:g.size.height:m;console.log("🖼️ [WORKSPACE REPLICA] Imagen:",{id:g.id,cellPos:{x:c,y:N,width:n,height:m},elementPos:{x:L,y:K,width:F,height:B},originalPos:{x:P,y:j},isRelative:{x:E,y:C}}),g.filters&&(r.filter=`
                        brightness(${(g.filters.brightness||100)/100})
                        contrast(${(g.filters.contrast||100)/100})
                        saturate(${(g.filters.saturation||100)/100})
                        blur(${g.filters.blur||0}px)
                        opacity(${(g.filters.opacity||100)/100})
                    `),xs(r,b,L,K,F,B),r.filter="none",x()},b.onerror=()=>{console.error("Error cargando imagen:",g.content),x()},b.src=g.content}catch(b){console.error("Error en renderImageElement:",b),x()}})}function jr(r,g,c,N,n,m){var x,b,P,j;try{const E=((x=g.position)==null?void 0:x.x)||0,C=((b=g.position)==null?void 0:b.y)||0,L=E>=0&&E<=1,K=C>=0&&C<=1,F=c+(L?E*n:E),B=N+(K?C*m:C),o=(P=g.size)!=null&&P.width?g.size.width<=1?g.size.width*n:g.size.width:n*.8,G=(j=g.size)!=null&&j.height?g.size.height<=1?g.size.height*m:g.size.height:m*.2;console.log("📝 [WORKSPACE REPLICA] Texto:",{id:g.id,content:g.content,cellPos:{x:c,y:N,width:n,height:m},elementPos:{x:F,y:B,width:o,height:G}});const d=g.style||{},y=parseInt(d.fontSize)||16,O=d.fontFamily||"Arial, sans-serif",D=d.fontWeight||"normal",$=d.fontStyle||"normal",J=d.color||"#000000",V=d.textAlign||"left",de=d.backgroundColor,z=parseInt(d.padding)||8;r.save(),r.font=`${D} ${$} ${y}px ${O}`,r.fillStyle=J,r.textBaseline="top",de&&de!=="transparent"&&(r.fillStyle=de,r.fillRect(F,B,o,G),r.fillStyle=J);const ae=g.content.split(`
`),ye=y*1.2;ae.forEach((Ee,te)=>{if(Ee.trim()){let ce=F+z;const _=B+z+te*ye;V==="center"?(ce=F+o/2,r.textAlign="center"):V==="right"?(ce=F+o-z,r.textAlign="right"):r.textAlign="left",ce>=0&&_>=0&&ce<r.canvas.width&&_<r.canvas.height&&r.fillText(Ee,ce,_)}}),r.restore()}catch(E){console.error("Error en renderTextElement:",E)}}async function Nr({pages:r,workspaceDimensions:g,presetData:c}){var n;const N={};console.log("🎯 [WORKSPACE REPLICA] Iniciando generación IDÉNTICA al workspace..."),console.log("📐 [WORKSPACE REPLICA] Dimensiones:",g);for(const m of r)try{console.log(`🔄 [WORKSPACE REPLICA] Procesando página: ${m.id} (${m.type})`);const x=document.createElement("canvas"),b=x.getContext("2d",{willReadFrequently:!0});x.width=g.width,x.height=g.height,b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.textRendering="geometricPrecision",console.log("🎨 [WORKSPACE REPLICA] Renderizando background...");const P=m.backgroundColor||"#ffffff";if(b.fillStyle=P,b.fillRect(0,0,x.width,x.height),console.log("🎨 [WORKSPACE REPLICA] Background color aplicado:",P),m.backgroundImage)try{console.log("🖼️ [WORKSPACE REPLICA] Cargando background image:",m.backgroundImage);const B=new Image;B.crossOrigin="anonymous",await new Promise((o,G)=>{B.onload=o,B.onerror=G,B.src=m.backgroundImage}),xs(b,B,0,0,x.width,x.height),console.log("✅ [WORKSPACE REPLICA] Background image aplicada")}catch(B){console.error("❌ [WORKSPACE REPLICA] Error con background image:",B)}console.log("🗂️ [WORKSPACE REPLICA] Renderizando grid layout...");const j=re.find(B=>B.id===m.layout)||re[0];console.log("📋 [WORKSPACE REPLICA] Layout actual:",j.name,j.template);const E=vr(j,g);if(m.cells&&Array.isArray(m.cells)){console.log(`📦 [WORKSPACE REPLICA] Renderizando ${m.cells.length} celdas...`);const B=[...m.cells].sort((o,G)=>{const d=m.cells.indexOf(o),y=m.cells.indexOf(G);return d-y});for(let o=0;o<B.length;o++){const G=B[o],d=Math.floor(o/E.cols),y=o%E.cols,O=E.contentX+y*(E.cellWidth+E.gap),D=E.contentY+d*(E.cellHeight+E.gap);if(console.log(`📦 [WORKSPACE REPLICA] Celda ${o} (${G.id}):`,{gridPos:{row:d,col:y},realPos:{x:O,y:D,width:E.cellWidth,height:E.cellHeight}}),b.save(),b.fillStyle="transparent",b.fillRect(O,D,E.cellWidth,E.cellHeight),b.restore(),G.elements&&Array.isArray(G.elements)){const $=[...G.elements].sort((J,V)=>(J.zIndex||0)-(V.zIndex||0));console.log(`🔹 [WORKSPACE REPLICA] Renderizando ${$.length} elementos en celda ${G.id}`);for(const J of $){if(J.id==="cover-base"||J.id==="final-base"||(n=J.id)!=null&&n.startsWith("content-base-")){console.log("⏭️ [WORKSPACE REPLICA] Saltando elemento base:",J.id);continue}console.log(`🔸 [WORKSPACE REPLICA] Renderizando elemento: ${J.id} (${J.type})`),J.type==="image"&&J.content?await wr(b,J,O,D,E.cellWidth,E.cellHeight):J.type==="text"&&J.content&&jr(b,J,O,D,E.cellWidth,E.cellHeight)}}}}console.log("🖼️ [WORKSPACE REPLICA] Generando thumbnail final...");const C=document.createElement("canvas"),L=C.getContext("2d"),K=1200,F=Math.min(K/x.width,K/x.height);C.width=Math.round(x.width*F),C.height=Math.round(x.height*F),L.imageSmoothingEnabled=!0,L.imageSmoothingQuality="high",L.drawImage(x,0,0,x.width,x.height,0,0,C.width,C.height),N[m.id]=C.toDataURL("image/png",.9),console.log(`✅ [WORKSPACE REPLICA] Thumbnail generado para ${m.id} (${m.type}): ${C.width}x${C.height}`),console.log(`📋 [WORKSPACE REPLICA] ID de la página: ${m.id}, Tipo: ${m.type}`)}catch(x){console.error(`❌ [WORKSPACE REPLICA] Error generando thumbnail para página ${m.id}:`,x),N[m.id]=null}return console.log("🎯 [WORKSPACE REPLICA] ¡Generación COMPLETADA! Thumbnails idénticos al workspace."),console.log("📋 [WORKSPACE REPLICA] Thumbnails generados:",Object.keys(N)),console.log("📊 [WORKSPACE REPLICA] Total de thumbnails:",Object.keys(N).length),N}const Er=async(r,g,c)=>{var N;try{console.log("📤 [SAVE] Subiendo imagen al backend:",g);const[n,m]=r.split(","),x=((N=n.match(/data:image\/(\w+)/))==null?void 0:N[1])||"png",b=new FormData,P=atob(m),j=new Array(P.length);for(let F=0;F<P.length;F++)j[F]=P.charCodeAt(F);const E=new Uint8Array(j),C=new Blob([E],{type:`image/${x}`});b.append("image",C,`element_${g}.${x}`),b.append("project_id",c),b.append("element_id",g);const L=await fetch("/api/canvas/projects/upload-image",{method:"POST",headers:{Accept:"application/json"},credentials:"include",body:b});if(!L.ok)throw new Error("Error al subir imagen al servidor");const K=await L.json();return console.log("✅ [SAVE] Imagen subida exitosamente:",K.url),K.url}catch(n){throw console.error("❌ [SAVE] Error subiendo imagen:",n),n}},Sr=async(r,g)=>{var m,x;console.log("🔄 [SAVE] Procesando imágenes para guardado...");const c=[];let N=0,n=0;for(const b of r)for(const P of b.cells||[])for(const j of P.elements||[])j.type==="image"&&((m=j.content)!=null&&m.startsWith("data:image/"))&&N++;console.log(`📊 [SAVE] Total de imágenes base64 a procesar: ${N}`);for(const b of r){const P={...b};P.cells=[];for(const j of b.cells||[]){const E={...j};E.elements=[];for(const C of j.elements||[]){const L={...C};if(C.type==="image"&&((x=C.content)!=null&&x.startsWith("data:image/")))try{const K=await Er(C.content,C.id,g);L.content=K,L.isUploaded=!0,n++,console.log(`✅ [SAVE] Imagen ${n}/${N} procesada`)}catch(K){console.error("❌ [SAVE] Error procesando imagen:",C.id,K),L.uploadError=K.message}E.elements.push(L)}P.cells.push(E)}c.push(P)}return console.log(`✅ [SAVE] Procesamiento completado: ${n}/${N} imágenes subidas`),c},Cr=async(r,g)=>{var c;try{console.log("🔍 [DEBUG] saveThumbnailsAsFiles llamada con:",{projectId:r,thumbnailsCount:Object.keys(g).length});const N=[];for(const[x,b]of Object.entries(g))console.log(`🔍 [DEBUG] Procesando thumbnail para página ${x}:`,{hasData:!!b,isBase64:b&&b.startsWith("data:image/"),dataLength:b?b.length:0}),b&&b.startsWith("data:image/")&&N.push({page_id:x,thumbnail_data:b});if(N.length===0){console.log("ℹ️ [THUMBNAILS] No hay thumbnails base64 para guardar");return}console.log(`🖼️ [THUMBNAILS] Guardando ${N.length} thumbnails como archivos...`),console.log(`🔍 [DEBUG] URL del endpoint: /api/thumbnails/${r}/save-as-files`);const n=await fetch(`/api/thumbnails/${r}/save-as-files`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.content)||""},credentials:"include",body:JSON.stringify({thumbnails:N})});if(console.log("🔍 [DEBUG] Respuesta del servidor:",{status:n.status,statusText:n.statusText,ok:n.ok}),!n.ok){const x=await n.text();throw console.error("❌ [THUMBNAILS] Error respuesta del servidor:",x),new Error(`Error al guardar thumbnails: ${n.status} ${n.statusText}`)}const m=await n.json();return console.log("✅ [THUMBNAILS] Thumbnails guardados como archivos:",m),m}catch(N){throw console.error("❌ [THUMBNAILS] Error guardando thumbnails:",N),N}},gs=async(r,g,c,N,n,m,x=!1)=>{try{if(!(g!=null&&g.id))throw new Error("No se encontró el ID del proyecto");console.log(`💾 [SAVE] Iniciando ${x?"auto-guardado":"guardado manual"}...`);let b=r;x||(b=await Sr(r,g.id));const P={pages:b,projectInfo:{id:g.id,item_id:c==null?void 0:c.id,title:c==null?void 0:c.title,preset_id:N==null?void 0:N.id},workspace:{width:n.width,height:n.height,scale:n.scale},meta:{savedAt:new Date().toISOString(),version:"2.0",isAutoSave:x,totalPages:r.length}},j=x?"save-progress":"save",E=await fetch(`/api/canvas/projects/${g.id}/${j}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({design_data:P,thumbnails:m})});if(!E.ok){const L=await E.json().catch(()=>({}));throw new Error(L.message||"Error al guardar el proyecto")}const C=await E.json();if(console.log(`✅ [SAVE] ${x?"Auto-guardado":"Guardado"} exitoso:`,C),!x&&m&&Object.keys(m).length>0){console.log("🖼️ [SAVE] Guardando thumbnails como archivos...");try{await Cr(g.id,m),console.log("✅ [SAVE] Thumbnails guardados como archivos")}catch(L){console.warn("⚠️ [SAVE] Error guardando thumbnails como archivos:",L)}}return{success:!0,data:C}}catch(b){return console.error(`❌ [SAVE] Error en ${x?"auto-guardado":"guardado"}:`,b),{success:!1,error:b.message}}},kr=(r,g,c,N,n,m)=>{const[x,b]=h.useState("saved"),[P,j]=h.useState(null),[E,C]=h.useState(null),[L,K]=h.useState(null),[F,B]=h.useState(!1),[o,G]=h.useState(navigator.onLine),d=h.useRef(null),y=h.useRef(null),O=h.useRef(null),D=h.useRef(!1),$=h.useRef(null),J=15e3,V=2e3,de=5e3,z=h.useCallback((_,q)=>{try{const oe={pages:_.map(ge=>{var ze;return{id:ge.id,layout:ge.layout,cells:((ze=ge.cells)==null?void 0:ze.map(Se=>{var Q;return{id:Se.id,elements:((Q=Se.elements)==null?void 0:Q.map(Z=>{var Ue;return{id:Z.id,type:Z.type,content:Z.type==="image"&&((Ue=Z.content)!=null&&Ue.startsWith("data:image/"))?`[IMAGE_${Z.content.length}]`:Z.content,position:Z.position,size:Z.size,style:Z.style,filters:Z.filters,rotation:Z.rotation}}))||[]}}))||[]}})||[],workspace:{width:q==null?void 0:q.width,height:q==null?void 0:q.height}};return btoa(JSON.stringify(oe)).substring(0,32)}catch(oe){return console.warn("⚠️ [AUTO-SAVE] Error generando hash:",oe),Date.now().toString()}},[]),ae=h.useCallback(()=>`album_editor_autosave_${(g==null?void 0:g.id)||"draft"}`,[g==null?void 0:g.id]),ye=h.useCallback(_=>{try{const q=ae(),oe={..._,savedAt:Date.now(),version:"2.1"};return localStorage.setItem(q,JSON.stringify(oe)),console.log("💾 [AUTO-SAVE] Guardado en localStorage"),!0}catch(q){return console.error("❌ [AUTO-SAVE] Error guardando en localStorage:",q),!1}},[ae]),Ee=h.useCallback(()=>{var _;try{const q=ae(),oe=localStorage.getItem(q);if(oe){const ge=JSON.parse(oe);return console.log("📂 [AUTO-SAVE] Datos encontrados en localStorage:",{pages:(_=ge.pages)==null?void 0:_.length,savedAt:new Date(ge.savedAt).toLocaleString()}),ge}}catch(q){console.error("❌ [AUTO-SAVE] Error cargando desde localStorage:",q)}return null},[ae]),te=h.useCallback(async(_=!1)=>{if(D.current&&!_){console.log("⏳ [AUTO-SAVE] Guardado en progreso, saltando...");return}if(!(g!=null&&g.id)||!r||r.length===0){console.log("⚠️ [AUTO-SAVE] Datos insuficientes para guardar");return}const q=z(r,n);if(!_&&q===O.current){console.log("📊 [AUTO-SAVE] Sin cambios detectados, saltando guardado");return}try{D.current=!0,b("saving"),K(null);const oe={pages:r,projectInfo:{id:g.id,item_id:c==null?void 0:c.id,title:c==null?void 0:c.title,preset_id:N==null?void 0:N.id},workspace:n,meta:{savedAt:new Date().toISOString(),version:"2.1",contentHash:q}};if(ye(oe),o){const ge=await gs(r,g,c,N,n,m,!0);if(ge.success)O.current=q,C(new Date),b("saved"),B(!1),console.log("✅ [AUTO-SAVE] Guardado exitoso en base de datos");else throw new Error(ge.error)}else console.log("� [AUTO-SAVE] Sin conexión, solo guardado en localStorage"),b("pending"),B(!0)}catch(oe){console.error("❌ [AUTO-SAVE] Error:",oe),K(oe.message),b("error"),o&&($.current=setTimeout(()=>{console.log("🔄 [AUTO-SAVE] Reintentando guardado..."),te(!0)},de))}finally{D.current=!1}},[r,g,c,N,n,m,z,ye,o]),ce=h.useCallback(async()=>{try{b("saving");const _=await gs(r,g,c,N,n,m,!1);if(_.success){const q=z(r,n);O.current=q,j(new Date),b("saved"),B(!1),ee.success("💾 Proyecto guardado exitosamente"),console.log("✅ [MANUAL-SAVE] Guardado manual exitoso")}else K(_.error),b("error"),ee.error(`❌ Error al guardar: ${_.error}`);return _.success}catch(_){return console.error("❌ [MANUAL-SAVE] Error:",_),K(_.message),b("error"),ee.error(`❌ Error inesperado: ${_.message}`),!1}},[r,g,c,N,n,m,z]);return h.useEffect(()=>{if(!(g!=null&&g.id)||!r||r.length===0)return;const _=z(r,n);return O.current&&_!==O.current?(console.log("🔄 [AUTO-SAVE] Cambios detectados, programando guardado..."),B(!0),b("pending"),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{te()},V)):O.current||(O.current=_),()=>{y.current&&clearTimeout(y.current)}},[r,n,g==null?void 0:g.id,z,te]),h.useEffect(()=>{if(g!=null&&g.id)return d.current&&clearInterval(d.current),d.current=setInterval(()=>{F&&(console.log("⏰ [AUTO-SAVE] Auto-save periódico activado"),te())},J),()=>{d.current&&clearInterval(d.current)}},[g==null?void 0:g.id,F,te]),h.useEffect(()=>{const _=()=>{console.log("🌐 [AUTO-SAVE] Conexión restaurada"),G(!0),F&&setTimeout(()=>te(!0),1e3)},q=()=>{console.log("📴 [AUTO-SAVE] Conexión perdida"),G(!1)};return window.addEventListener("online",_),window.addEventListener("offline",q),()=>{window.removeEventListener("online",_),window.removeEventListener("offline",q)}},[F,te]),h.useEffect(()=>{const _=q=>{if(F){const oe={pages:r,projectInfo:{id:g.id},workspace:n,meta:{savedAt:new Date().toISOString()}};return ye(oe),q.preventDefault(),q.returnValue="¿Estás seguro de salir? Hay cambios sin guardar.","¿Estás seguro de salir? Hay cambios sin guardar."}};return window.addEventListener("beforeunload",_),()=>window.removeEventListener("beforeunload",_)},[F,r,g==null?void 0:g.id,n,ye]),h.useEffect(()=>()=>{y.current&&clearTimeout(y.current),d.current&&clearInterval(d.current),$.current&&clearTimeout($.current)},[]),h.useEffect(()=>{L&&(L.includes("max_allowed_packet")||L.includes("data_too_large")?ee.error("❌ El proyecto es demasiado grande para guardar automáticamente. Reduce el número o tamaño de imágenes."):ee.error(`❌ Error de auto-guardado: ${L}`))},[L]),{saveStatus:x,lastSaved:P,lastAutoSaved:E,saveError:L,hasUnsavedChanges:F,isOnline:o,saveManually:ce,performAutoSave:()=>te(!0),loadFromLocalStorage:Ee,getStorageKey:ae,autoSaveInterval:J,debounceDelay:V}},Ar=({saveStatus:r,lastSaved:g,lastAutoSaved:c,hasUnsavedChanges:N,isOnline:n,saveError:m,onManualSave:x,className:b=""})=>{const P=C=>{if(!C)return null;const K=new Date-C,F=Math.floor(K/(1e3*60)),B=Math.floor(K/1e3);if(B<30)return"hace unos segundos";if(F<1)return`hace ${B}s`;if(F<60)return`hace ${F}m`;const o=Math.floor(F/60);return o<24?`hace ${o}h`:C.toLocaleDateString()},E=(()=>{if(!n)return{icon:e.jsx(ds,{className:"w-4 h-4"}),color:"text-orange-500",bg:"bg-orange-50 border-orange-200",text:"Sin conexión",detail:"Guardado local activo"};switch(r){case"saving":return{icon:e.jsx(er,{className:"w-4 h-4 animate-spin"}),color:"text-blue-500",bg:"bg-blue-50 border-blue-200",text:"Guardando...",detail:"Sincronizando cambios"};case"saved":return{icon:e.jsx(ps,{className:"w-4 h-4"}),color:"text-green-500",bg:"bg-green-50 border-green-200",text:"Guardado",detail:c?`Auto-guardado ${P(c)}`:"Todo sincronizado"};case"error":return{icon:e.jsx(fs,{className:"w-4 h-4"}),color:"text-red-500",bg:"bg-red-50 border-red-200",text:"Error al guardar",detail:m||"Error desconocido"};case"pending":return{icon:e.jsx(Ds,{className:"w-4 h-4"}),color:"text-yellow-600",bg:"bg-yellow-50 border-yellow-200",text:N?"Cambios pendientes":"Pendiente",detail:"Esperando a guardar..."};default:return{icon:e.jsx(Qs,{className:"w-4 h-4"}),color:"text-gray-500",bg:"bg-gray-50 border-gray-200",text:"Listo",detail:"Sistema de guardado activo"}}})();return e.jsxs("div",{className:`relative group ${b}`,children:[e.jsxs("div",{className:`
                    inline-flex items-center gap-2 px-3 py-2 rounded-lg border-2 
                    transition-all duration-200 cursor-pointer
                    ${E.bg} ${E.color}
                    hover:shadow-md
                `,onClick:()=>r!=="saving"&&(x==null?void 0:x()),children:[E.icon,e.jsx("span",{className:"text-sm font-medium",children:E.text}),N&&r!=="saving"&&e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),e.jsx("div",{className:"flex items-center",children:n?e.jsx(fr,{className:"w-3 h-3 text-green-500"}):e.jsx(ds,{className:"w-3 h-3 text-orange-500"})})]}),e.jsxs("div",{className:`
                absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2
                bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg
                opacity-0 group-hover:opacity-100 pointer-events-none
                transition-opacity duration-200 z-50 whitespace-nowrap
            `,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:E.text}),e.jsx("div",{className:"text-gray-300",children:E.detail}),g&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Último guardado manual: ",P(g)]}),e.jsxs("div",{className:"text-gray-400 text-xs",children:[n?"🌐 En línea":"📴 Sin conexión",r!=="saving"&&" • Click para guardar"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]}),r==="saving"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-blue-200 rounded-b-lg overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 animate-pulse"})})]})},Ir=({isOpen:r,onClose:g,savedProgress:c,onLoadProgress:N,onDiscardProgress:n})=>{var E;const[m,x]=h.useState(!1);if(!r||!c)return null;const b=async()=>{x(!0);try{await N(c),g()}catch(C){console.error("Error cargando progreso:",C)}finally{x(!1)}},P=async()=>{x(!0);try{await n(),g()}catch(C){console.error("Error descartando progreso:",C)}finally{x(!1)}},j=C=>{const L=new Date(C),F=new Date-L,B=Math.floor(F/(1e3*60)),o=Math.floor(B/60),G=Math.floor(o/24);return B<1?"hace unos segundos":B<60?`hace ${B} minutos`:o<24?`hace ${o} horas`:G===1?"ayer":G<7?`hace ${G} días`:L.toLocaleDateString()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 p-6 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Us,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progreso Guardado Encontrado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Se encontró un trabajo sin finalizar"})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(lr,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Guardado automáticamente"}),e.jsx("div",{className:"text-xs text-gray-500",children:j(c.savedAt)})]})]}),c.pages&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Zs,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[c.pages.length," páginas en progreso"]}),e.jsx("div",{className:"text-xs text-gray-500",children:((E=c.meta)==null?void 0:E.version)||"Versión no especificada"})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fs,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"¿Qué te gustaría hacer?"}),e.jsx("div",{className:"text-amber-700",children:"Puedes continuar desde donde lo dejaste o comenzar un nuevo diseño."})]})]})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[e.jsxs("button",{onClick:b,disabled:m,className:`flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[m?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ps,{className:"w-4 h-4"}),"Continuar Editando"]}),e.jsxs("button",{onClick:P,disabled:m,className:`flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[e.jsx(us,{className:"w-4 h-4"}),"Comenzar de Nuevo"]})]}),e.jsx("button",{onClick:g,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",disabled:m,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},st=rt.memo(({pageId:r,thumbnail:g,altText:c,type:N})=>g?e.jsx("img",{src:g,alt:c,className:"w-full h-full object-contain",loading:"lazy",style:{transition:"opacity 0.2s ease-in-out",imageRendering:"optimizeQuality"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center"})),Pr=rt.memo(({images:r,onImageSelect:g,isLoading:c})=>{const N=rt.memo(({image:n})=>{const[m,x]=h.useState(!1),[b,P]=h.useState(!1),[{isDragging:j},E]=or(()=>({type:"PROJECT_IMAGE",item:{type:"PROJECT_IMAGE",imageUrl:n.url},collect:K=>({isDragging:!!K.isDragging()})})),C=n.thumbnail_url||n.url,L=n.url;return e.jsxs("div",{ref:E,className:`relative group cursor-pointer bg-gray-50 rounded-lg overflow-hidden border-2 border-transparent hover:border-[#af5cb8] transition-all duration-200 ${j?"opacity-50 scale-95":""}`,onClick:()=>g(L),children:[e.jsxs("div",{className:"aspect-square relative",children:[!m&&!b&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 animate-pulse flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[#af5cb8] border-t-transparent rounded-full animate-spin"})}),b?e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(be,{className:"h-6 w-6 mx-auto mb-1"}),e.jsx("p",{className:"text-xs",children:"Error al cargar"})]})}):e.jsx("img",{src:C,alt:n.filename||"Project image",className:`w-full h-full object-cover transition-opacity duration-300 ${m?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>x(!0),onError:()=>P(!0)})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("div",{className:"bg-white rounded-full p-2 shadow-md",children:e.jsx(Me,{className:"h-4 w-4 text-[#af5cb8]"})})})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:n.has_thumbnail?"Optimizada":"Arrastra o haz clic"}),n.has_thumbnail&&e.jsx("div",{className:"absolute top-2 left-2 bg-green-500 rounded-full w-2 h-2"})]})});return c?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:6}).map((n,m)=>e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg animate-pulse"},m))}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"No hay imágenes en este proyecto"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sube una imagen para empezar"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.map((n,m)=>e.jsx(N,{image:n},`${n.id||n.url}-${m}`))}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:[r.filter(n=>n.has_thumbnail).length," de ",r.length," imágenes optimizadas"]})})]})});function Aa(){var xt,bt,yt,vt,wt,jt,Nt,Et,St,Ct,kt,At,It,Pt,Tt,Ot,Rt,$t,_t,Mt,Lt,zt,Ut,Ft,Wt,Bt,Ht,Vt,Gt,Kt,qt,Xt,Jt,Yt,Qt,Zt,Dt,es,ts,ss;const[r,g]=h.useState(null),[c,N]=h.useState(null),[n,m]=h.useState(null),[x,b]=h.useState(null),[P,j]=h.useState(!0),[E,C]=h.useState(null),[L,K]=h.useState({hasUnsavedChanges:!1,lastEditTime:null,isSaving:!1});h.useEffect(()=>{(async()=>{var s;try{const i=new URLSearchParams(window.location.search).get("project");if(!i){C("No se encontró el ID del proyecto en la URL"),j(!1);return}const l=await fetch(`/api/canvas/projects/${i}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||"","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Error al cargar el proyecto");const u=await l.json();g(u.project),N(u.item),m(u.canvasPreset),b(u.initialProject),j(!1)}catch(a){console.error("❌ Error cargando proyecto:",a),C(a.message),j(!1)}})()},[]);const[F,B]=h.useState(ls.Local.get(`${cs.APP_CORRELATIVE}_cart`)??[]);h.useEffect(()=>{ls.Local.set(`${cs.APP_CORRELATIVE}_cart`,F)},[F]);const[o,G]=h.useState([]),[d,y]=h.useState(0),[O,D]=h.useState("preset"),[$,J]=h.useState(null),[V,de]=h.useState(null),[z,ae]=h.useState("pages"),[ye,Ee]=h.useState("basic"),[te,ce]=h.useState([JSON.stringify(o)]),[_,q]=h.useState(0),[oe,ge]=h.useState(!1),[ze,Se]=h.useState(null),[Q,Z]=h.useState({}),[Ue,Tr]=h.useState(!1),[Ce,Fe]=h.useState([]),[We,at]=h.useState(!1),[Te,bs]=h.useState(new Map),fe=h.useRef(null),ot=h.useRef(),[R,nt]=h.useState({width:800,height:600}),Be=h.useCallback(async()=>{if(r!=null&&r.id)try{const t=await fetch(`/api/thumbnails/${r.id}`);if(t.ok){const s=await t.json();if(s.success&&s.thumbnails&&s.thumbnails.length>0){const a={};s.thumbnails.forEach(i=>{i.page_id&&i.thumbnail_url&&(a[i.page_id]=i.thumbnail_url)}),Object.keys(a).length>0?(Z(i=>({...i,...a})),console.log("✅ Thumbnails cargados desde storage:",Object.keys(a).length)):console.log("ℹ️ No hay thumbnails guardados, usando generación local")}else console.log("ℹ️ No hay thumbnails guardados para este proyecto")}}catch(t){console.warn("⚠️ Error cargando thumbnails guardados (usando locales):",t)}},[r==null?void 0:r.id]),ve=h.useCallback(async()=>{if(!(!(o!=null&&o.length)||!R||!n))try{const t=await Nr({pages:o,workspaceDimensions:R,presetData:n});t&&Object.keys(t).length>0&&(Z(s=>({...s,...t})),console.log("✅ Thumbnails locales generados:",Object.keys(t).length))}catch(t){console.warn("⚠️ Error generando thumbnails locales:",t)}},[o,R,n]),He=h.useCallback(async()=>{var t;if(!(!(r!=null&&r.id)||!(o!=null&&o.length)))try{const s=await fetch(`/api/thumbnails/${r.id}/existing`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({pages:o})});if(s.ok){const a=await s.json();a&&Object.keys(a).length>0?(Z(i=>({...i,...a})),console.log("✅ Thumbnails existentes cargados:",Object.keys(a).length)):(console.log("📸 No hay thumbnails existentes, generando nuevos..."),await ve())}}catch(s){console.warn("⚠️ Error cargando thumbnails existentes:",s),await ve()}},[r==null?void 0:r.id,o,ve]);h.useCallback(async()=>{if(!(!(r!=null&&r.id)||!(o!=null&&o.length)))try{const t=o[d];if(!t)return;const s=await fetch(`/api/thumbnails/${r.id}/generate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({pages:[t],width:R.width,height:R.height,quality:95,scale:4,dpi:300})});if(s.ok){const a=await s.json();if(a.success&&a.thumbnails){const i={};a.thumbnails.forEach(l=>{l.page_id&&l.thumbnail_url&&(i[l.page_id]=l.thumbnail_url)}),Z(l=>({...l,...i})),console.log("✅ Thumbnail generado y guardado en storage para página actual:",a.thumbnails.length)}}}catch(t){console.warn("⚠️ Error generando thumbnail:",t)}},[r==null?void 0:r.id,o,d,R]),h.useCallback(async()=>{if(!(!(r!=null&&r.id)||!(o!=null&&o.length)))try{const t=await fetch(`/api/thumbnails/${r.id}/generate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({pages:o,width:R.width,height:R.height,quality:95,scale:4,dpi:300})});if(t.ok){const s=await t.json();if(s.success&&s.thumbnails){const a={};s.thumbnails.forEach(i=>{i.page_id&&i.thumbnail_url&&(a[i.page_id]=i.thumbnail_url)}),Z(i=>({...i,...a})),console.log("✅ Todos los thumbnails generados y guardados en storage:",s.thumbnails.length)}}}catch(t){console.warn("⚠️ Error generando todos los thumbnails:",t)}},[r==null?void 0:r.id,o,R]),h.useEffect(()=>{if(x&&c&&n){if(x.pages&&Array.isArray(x.pages)){const t=x.pages.map(s=>{let a=null,i=n.background_color||"#ffffff";return s.type==="cover"?c.cover_image&&(a=`/storage/images/item/${c.cover_image}`):s.type==="content"?c.content_image&&(a=`/storage/images/item/${c.content_image}`):(s.type==="final"||s.type==="contraportada")&&c.back_cover_image&&(a=`/storage/images/item/${c.back_cover_image}`),{...s,backgroundImage:a,backgroundColor:i}});G(t),ce([JSON.stringify(t)]),q(0),setTimeout(()=>{Be()},100)}else{const t=ut(n,c);G(t),ce([JSON.stringify(t)]),q(0),setTimeout(()=>{Be()},100)}typeof x.currentPage=="number"&&y(x.currentPage),x.workspaceSize&&D(x.workspaceSize)}},[x,c,n,Be]);const me=kr(o,r,c,n,R,Q),it=()=>{if(n!=null&&n.width&&(n!=null&&n.height)){let p=n.width,v=n.height,k=p*37.8,T=v*37.8;if(k&&T){const A=window.innerWidth*.6,M=window.innerHeight*.7,w=A/k,S=M/T,I=Math.min(w,S,1);return{width:Math.round(k*I),height:Math.round(T*I),originalWidth:p,originalHeight:v,scale:I,unit:"cm",originalWidthPx:Math.round(k),originalHeightPx:Math.round(T)}}}if(n!=null&&n.extra_settings)try{const p=typeof n.extra_settings=="string"?JSON.parse(n.extra_settings):n.extra_settings;if(p!=null&&p.canvas_config){const v=p.canvas_config;let k=v.width,T=v.height,A=k*37.8,M=T*37.8;if(A&&M){const w=window.innerWidth*.6,S=window.innerHeight*.7,I=w/A,U=S/M,Y=Math.min(I,U,1);return{width:Math.round(A*Y),height:Math.round(M*Y),originalWidth:k,originalHeight:T,scale:Y,unit:"cm",originalWidthPx:Math.round(A),originalHeightPx:Math.round(M)}}}}catch(p){console.warn("Error parsing extra_settings:",p)}const t={square:{width:600,height:600},landscape:{width:1280,height:720},portrait:{width:600,height:800},wide:{width:1200,height:600},tall:{width:540,height:960},preset:{width:800,height:600}},s=t[O]||t.preset,a=window.innerWidth*.6,i=window.innerHeight*.7,l=a/s.width,u=i/s.height,f=Math.min(l,u,1);return{width:Math.round(s.width*f),height:Math.round(s.height*f),originalWidth:s.width,originalHeight:s.height,scale:f,unit:"px"}},ue=h.useCallback(async(t={type:"thumbnail"})=>{if(!o[d])return null;try{let s=document.querySelector(`#page-${o[d].id}`);if(!s)return console.warn("❌ THUMBNAIL: No se encontró el elemento de página específico"),null;const a=o[d],i=t.type==="pdf",l=i?11.81:3,u=1,f=getComputedStyle(s);let p=(a==null?void 0:a.backgroundColor)||"#ffffff";f.backgroundColor&&f.backgroundColor!=="rgba(0, 0, 0, 0)"&&(p=f.backgroundColor);const v={scale:l,useCORS:!0,allowTaint:!1,backgroundColor:p,width:R.width,height:R.height,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!!i,removeContainer:!1,logging:!1,imageTimeout:i?6e4:15e3,pixelRatio:i?3:window.devicePixelRatio||1,canvas:i?document.createElement("canvas"):null,windowWidth:i?R.width*l:null,windowHeight:i?R.height*l:null,onclone:async A=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(w=>{try{A.querySelectorAll(w).forEach(I=>I.remove())}catch(S){console.warn("Error removing selector:",w,S)}});try{const w=A.querySelector(`#page-${o[d].id}`);w&&(w.style.width=R.width+"px",w.style.height=R.height+"px",w.style.position="relative",w.style.overflow="hidden",a!=null&&a.backgroundImage&&(w.style.backgroundImage=`url(${a.backgroundImage})`,w.style.backgroundSize="cover",w.style.backgroundPosition="center",w.style.backgroundRepeat="no-repeat"),a!=null&&a.backgroundColor&&(w.style.backgroundColor=a.backgroundColor))}catch(w){console.error("❌ [THUMBNAIL-FIX] Error configurando elemento de página:",w)}try{const w=new Map;s.querySelectorAll('[data-element-type="image"] img, .workspace-image, img').forEach((H,pe)=>{if(H.complete&&H.naturalWidth>0){const ie=(H.closest('[data-element-type="image"]')||H.parentElement).getBoundingClientRect(),he=H.getBoundingClientRect();w.set(H.src,{src:H.src,naturalWidth:H.naturalWidth,naturalHeight:H.naturalHeight,containerWidth:ie.width,containerHeight:ie.height,objectFit:getComputedStyle(H).objectFit||"cover",objectPosition:getComputedStyle(H).objectPosition||"center",crossOrigin:H.crossOrigin})}});const I=async(H,pe,ne,ie,he)=>new Promise(we=>{try{const je=pe/ne,Ye=ie/he;let Re,$e,Qe,Ze,rs,as;Ye>je?(as=ne,rs=ne*Ye,$e=he,Re=he*je,Qe=(ie-Re)/2,Ze=0):(rs=pe,as=pe/Ye,Re=ie,$e=ie/je,Qe=0,Ze=(he-$e)/2);const _e=A.createElement("canvas");_e.width=pe,_e.height=ne;const Ls=_e.getContext("2d"),Pe=new Image;Pe.crossOrigin="anonymous",Pe.onload=()=>{try{Ls.drawImage(Pe,Qe,Ze,Re,$e,0,0,pe,ne);const De=_e.toDataURL("image/png",1);H.src=De,H.style.objectFit="fill",H.style.objectPosition="center",H.style.width="100%",H.style.height="100%",we()}catch(De){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en canvas processing:",De),we()}},Pe.onerror=()=>{console.warn("⚠️ [ADVANCED-THUMBNAIL] Error cargando imagen temporal"),we()},Pe.src=H.src}catch(je){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en simulateObjectFitCover:",je),we()}}),U=A.querySelectorAll('[data-element-type="image"] img, .workspace-image, img'),Y=[];U.forEach((H,pe)=>{if(H.src&&w.has(H.src)){const ne=w.get(H.src),ie=H.closest('[data-element-type="image"]')||H.parentElement;if(ie&&(ie.style.overflow="hidden",ie.style.position="relative"),ne.objectFit==="cover"||H.classList.contains("object-cover")||H.classList.contains("workspace-image")){const he=I(H,ne.containerWidth,ne.containerHeight,ne.naturalWidth,ne.naturalHeight);Y.push(he)}else H.style.width="100%",H.style.height="100%",H.style.objectFit="fill"}}),Y.length>0&&await Promise.all(Y);const W=A.createElement("style");W.textContent=`
                            /* CORRECCIÓN THUMBNAIL: Estructura del elemento de página */
                            #page-${o[d].id} {
                                width: ${R.width}px !important;
                                height: ${R.height}px !important;
                                position: relative !important;
                                overflow: hidden !important;
                                box-sizing: border-box !important;
                            }
                            
                            /* 🖨️ IMÁGENES PROFESIONALES: Optimizada para PDF vs Thumbnails */
                            img {
                                width: 100% !important;
                                height: 100% !important;
                                object-fit: fill !important; /* fill porque ya están recortadas */
                                object-position: center !important;
                                display: block !important;
                                ${i?`
                                /* 🖨️ IMPRESIÓN PROFESIONAL 300 DPI */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: -webkit-crisp-edges !important;
                                image-rendering: -moz-crisp-edges !important;
                                image-rendering: pixelated !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: optimizeQuality !important;
                                backface-visibility: hidden !important;
                                transform: translateZ(0) scale(1) !important;
                                will-change: transform !important;
                                filter: contrast(1.02) saturate(1.05) !important;
                                `:`
                                /* Thumbnails optimizados */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: high-quality !important;
                                `}
                            }
                            
                            /* Contenedores de imagen */
                            [data-element-type="image"] {
                                overflow: hidden !important;
                                position: relative !important;
                            }
                            
                            [data-element-type="image"] > div {
                                width: 100% !important;
                                height: 100% !important;
                                overflow: hidden !important;
                            }
                            
                            /* Backgrounds de página */
                            #page-${o[d].id} {
                                background-size: cover !important;
                                background-position: center !important;
                                background-repeat: no-repeat !important;
                            }
                            
                            /* 🖨️ OPTIMIZACIONES GENERALES PARA PDF DE IMPRESIÓN */
                            ${i?`
                            * {
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                text-rendering: optimizeLegibility !important;
                                -webkit-backface-visibility: hidden !important;
                                backface-visibility: hidden !important;
                                -webkit-transform: translateZ(0) !important;
                                transform: translateZ(0) !important;
                            }
                            
                            /* Elementos de texto de alta calidad */
                            p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable] {
                                text-rendering: optimizeLegibility !important;
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                font-smooth: always !important;
                            }
                            
                            /* Elementos vectoriales de alta calidad */
                            svg, path, circle, rect, line {
                                shape-rendering: geometricPrecision !important;
                                vector-effect: non-scaling-stroke !important;
                            }
                            `:""}
                            
                            /* Resetear estilos que puedan interferir */
                            img {
                                max-width: none !important;
                                max-height: none !important;
                                border: none !important;
                                outline: none !important;
                            }
                        `,A.head.appendChild(W)}catch(w){console.error("❌ [ADVANCED-THUMBNAIL] Error en pre-procesamiento avanzado:",w);const S=A.createElement("style");S.textContent=`
                            img { object-fit: cover !important; object-position: center !important; }
                            [data-element-type="image"] { overflow: hidden !important; }
                        `,A.head.appendChild(S)}}},k=await is(s,v);if(i&&k){const A=k.getContext("2d");if(A){A.imageSmoothingEnabled=!1,A.imageSmoothingQuality="high";const M=A.getImageData(0,0,k.width,k.height),w=M.data;for(let S=0;S<w.length;S+=4)w[S]=Math.min(255,w[S]*1.05),w[S+1]=Math.min(255,w[S+1]*1.05),w[S+2]=Math.min(255,w[S+2]*1.05);A.putImageData(M,0,0)}}if(!k)throw new Error("html2canvas no devolvió un canvas válido para el elemento de página");if(k.width===0||k.height===0)throw new Error("Canvas del elemento de página tiene dimensiones inválidas");const T=k.toDataURL("image/png",u);if(!T||T==="data:,")throw new Error("No se pudo generar dataURL del elemento de página");return i?k:T}catch(s){console.error("❌ [THUMBNAIL-FIX] Error capturando elemento de página:",s);try{const a=document.createElement("canvas"),i=t.type==="pdf"?11.81:1;a.width=R.width*i,a.height=R.height*i;const l=a.getContext("2d"),u=workspaceBackground||(currentPageData==null?void 0:currentPageData.backgroundColor)||"#ffffff";return l.fillStyle=u,l.fillRect(0,0,a.width,a.height),l.fillStyle=u==="#ffffff"||u.includes("white")?"#374151":"#666666",l.font=`${14*i}px Arial`,l.textAlign="center",l.fillText("Página "+(d+1),a.width/2,a.height/2),t.type==="pdf"?a:a.toDataURL("image/png",1)}catch{return null}}},[d,o]),Oe=h.useCallback(async()=>{if(!o[d])return;const t=await ue({type:"thumbnail"});t&&Z(s=>({...s,[o[d].id]:t}))},[ue,d,o]);h.useCallback(()=>{clearTimeout(ot.current),ot.current=setTimeout(()=>{o[d]&&!Q[o[d].id]&&Oe()},1200)},[Oe,o,d,Q]);const lt=h.useCallback(()=>{o[d]&&!Q[o[d].id]&&setTimeout(()=>{Oe()},300)},[Oe,o,d,Q]),ys=h.useCallback(async(t=d,s={width:800,height:600})=>{var a,i;if(!o[t])return null;try{const l=d;t!==d&&(y(t),await new Promise(v=>setTimeout(v,100)));const u=document.querySelector(`#page-${o[t].id}`);if(!u)return console.warn("Workspace element not found for page:",o[t].id),null;const f={scale:4,useCORS:!0,allowTaint:!1,backgroundColor:((a=o[t])==null?void 0:a.backgroundColor)||"#ffffff",width:u.offsetWidth,height:u.offsetHeight,removeContainer:!0,logging:!1,onclone:v=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(w=>{v.querySelectorAll(w).forEach(I=>I.remove())});const T=v.querySelector(`#page-${o[t].id}`);if(T){const w=o[t];w!=null&&w.backgroundImage&&(T.style.backgroundImage=`url(${w.backgroundImage})`,T.style.backgroundSize="cover",T.style.backgroundPosition="center",T.style.backgroundRepeat="no-repeat"),w!=null&&w.backgroundColor&&(T.style.backgroundColor=w.backgroundColor)}try{const w=u.querySelectorAll("img"),S=new Map;w.forEach((U,Y)=>{const W=getComputedStyle(U);S.set(Y,{objectFit:W.objectFit,objectPosition:W.objectPosition,width:W.width,height:W.height,borderRadius:W.borderRadius,transform:W.transform})}),v.querySelectorAll("img").forEach((U,Y)=>{const W=S.get(Y);W&&(U.style.objectFit=W.objectFit||"cover",U.style.objectPosition=W.objectPosition||"center",U.style.width=W.width,U.style.height=W.height,U.style.borderRadius=W.borderRadius,U.style.transform=W.transform)})}catch(w){console.warn("Error preservando estilos de imágenes:",w),v.querySelectorAll("img").forEach(I=>{I.style.objectFit="cover",I.style.objectPosition="center",I.style.width||(I.style.width="100%"),I.style.height||(I.style.height="100%")})}v.querySelectorAll('[class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable]').forEach(w=>{const S=w.className;S&&(w.className=S);const I=getComputedStyle?getComputedStyle(w):null;I&&(I.fontFamily&&I.fontFamily!=="Arial"&&(w.style.fontFamily=I.fontFamily),I.fontSize&&(w.style.fontSize=I.fontSize),I.fontWeight&&(w.style.fontWeight=I.fontWeight),I.fontStyle&&(w.style.fontStyle=I.fontStyle))});const M=v.createElement("style");M.textContent=`
                        /* Preservar fuentes originales y NO forzar Arial */
                        * { 
                            -webkit-font-smoothing: antialiased !important;
                            -moz-osx-font-smoothing: grayscale !important;
                        }
                        
                        /* CRÍTICO: Asegurar que las imágenes mantengan cover + CALIDAD HD */
                        img {
                            object-fit: cover !important;
                            object-position: center !important;
                            image-rendering: -webkit-optimize-contrast !important;
                            image-rendering: crisp-edges !important;
                            image-rendering: high-quality !important;
                        }
                        
                        /* CRÍTICO: Asegurar que los backgrounds de página se mantengan en cover */
                        [id^="page-"] {
                            background-size: cover !important;
                            background-position: center !important;
                            background-repeat: no-repeat !important;
                        }
                        
                        /* Asegurar que los elementos de texto mantengan sus fuentes */
                        [class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6 {
                            font-family: inherit !important;
                        }
                    `,v.head.appendChild(M)}},p=await is(u,f);if(s.width!==p.width||s.height!==p.height){const v=document.createElement("canvas");v.width=s.width,v.height=s.height;const k=v.getContext("2d"),T=p.width/p.height,A=s.width/s.height;let M,w,S=0,I=0;T>A?(M=s.width,w=s.width/T,I=(s.height-w)/2):(w=s.height,M=s.height*T,S=(s.width-M)/2),k.fillStyle=((i=o[t])==null?void 0:i.backgroundColor)||"#ffffff",k.fillRect(0,0,s.width,s.height),k.drawImage(p,S,I,M,w);const U=v.toDataURL("image/png",1);return t!==l&&y(l),U}return t!==l&&y(l),p.toDataURL("image/png",1)}catch(l){return console.error("❌ Error generando thumbnail de alta calidad:",l),null}},[o,d,y]);h.useEffect(()=>{const t=it();nt(t)},[n,O]),h.useEffect(()=>{const t=()=>{const s=it();nt(s)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[n,O]),h.useEffect(()=>{if(o[d]&&!Q[o[d].id]){const t=setTimeout(()=>{lt()},400);return()=>clearTimeout(t)}},[d]),h.useEffect(()=>{const t=o[d];t!=null&&t.backgroundImage&&fetch(t.backgroundImage,{method:"HEAD"}).then(s=>{s.ok?console.log("✅ [WORKSPACE] Imagen existe en el servidor"):console.error("❌ [WORKSPACE] Imagen NO existe en el servidor. Status:",s.status)}).catch(s=>{console.error("❌ [WORKSPACE] Error verificando imagen:",s)})},[d,(xt=o[d])==null?void 0:xt.backgroundImage]),h.useEffect(()=>{const t=`${R.width}x${R.height}`,s=sessionStorage.getItem("lastWorkspaceDimensions");s&&s!==t&&o.length>0&&(Z({}),setTimeout(()=>{o[d]&&lt()},800)),sessionStorage.setItem("lastWorkspaceDimensions",t)},[R.width,R.height]),h.useEffect(()=>{if(!(r!=null&&r.id)||o.length===0)return;let t,s=Date.now(),a=!1;const i=()=>{a=!0,s=Date.now()},l=async()=>{if(a)try{console.log("🔄 [AUTO-SAVE] Iniciando guardado silencioso en segundo plano..."),setAutoSave(v=>({...v,saveStatus:"saving"}));const f=await fetch(`/api/projects/${r.id}/save`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({pages:o,force:!1})}),p=await f.json();if(f.ok&&p.success)a=!1,K(v=>({...v,saveStatus:"saved",lastAutoSaved:new Date,hasUnsavedChanges:!1})),console.log("✅ [AUTO-SAVE] Guardado silencioso completado");else throw new Error("Guardado falló")}catch(f){console.error("❌ [AUTO-SAVE] Error en guardado silencioso:",f),K(p=>({...p,saveStatus:"error",saveError:f.message}))}},u=()=>{t=setInterval(()=>{const f=Date.now()-s;a&&f>6e4&&(console.log("⏰ [AUTO-SAVE] Condiciones cumplidas para guardado automático"),l())},3*60*1e3)};return JSON.stringify(o),o[d],i(),u(),()=>{t&&clearInterval(t)}},[o,d,r==null?void 0:r.id]),h.useEffect(()=>{var s;if(!o[d])return;const t=((s=o[d].cells)==null?void 0:s.flatMap(a=>a.elements))||[];JSON.stringify(t),K(a=>({...a,hasUnsavedChanges:!0}))},[(bt=o[d])==null?void 0:bt.cells,d]);const[Or,Ve]=h.useState(!1),[Rr,vs]=h.useState({elementId:null,cellId:null}),[ws,ct]=h.useState(!1),[js,dt]=h.useState(!1),[Ns,Es]=h.useState(null),Ge=h.useRef(null),Ss=async t=>{const s=t.target.files[0];if(!s||!(r!=null&&r.id))return;const a=new FormData;a.append("image",s),a.append("projectId",r.id);try{const l=await(await fetch("/api/canvas/editor/upload-image",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:a})).json();if(l.success){const u={id:Date.now(),filename:s.name,url:l.url,thumbnail_url:l.thumbnail_url,has_thumbnail:l.has_thumbnail,size:s.size,last_modified:Date.now()/1e3,created_at:new Date().toISOString()};Fe(f=>[u,...f]),Cs(l.url),l.has_thumbnail?ee.success("Imagen subida y optimizada correctamente"):ee.success("Imagen subida correctamente"),fe.current=setTimeout(()=>{gt(!0)},1e3)}else ee.error(l.message||"Error al subir la imagen")}catch(i){console.error("Error subiendo la imagen:",i),ee.error("Error de red al subir la imagen")}},Cs=t=>{var i,l,u,f;const s=V||((l=(i=o[d])==null?void 0:i.cells[0])==null?void 0:l.id);if(!s)return;const a={id:`image-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:t,position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:(((f=(u=o[d].cells.find(p=>p.id===s))==null?void 0:u.elements)==null?void 0:f.length)||0)+1};Ie(s,a),ee.success("Imagen añadida correctamente")},gt=h.useCallback(async(t=!1)=>{if(r!=null&&r.id&&(fe.current&&clearTimeout(fe.current),!(!t&&Te.has(r.id)&&Ce.length>0)&&!(We&&!t))){at(!0);try{const a=await(await fetch(`/api/canvas/projects/${r.id}/images`,{method:"GET",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json"}})).json();if(a.success){const i=a.images||[];Fe(i),bs(l=>{const u=new Map(l);return u.set(r.id,i),u})}else console.error("Error cargando imágenes:",a.message)}catch(s){console.error("Error cargando imágenes del proyecto:",s)}finally{at(!1)}}},[r==null?void 0:r.id,Te,Ce.length,We]);h.useEffect(()=>{if(r!=null&&r.id){const t=Te.get(r.id);if(t&&t.length>0){Fe(t);return}return fe.current=setTimeout(()=>{gt(!1)},150),()=>{fe.current&&clearTimeout(fe.current)}}},[r==null?void 0:r.id,Te]),h.useEffect(()=>()=>{fe.current&&clearTimeout(fe.current)},[]);const ks=t=>{var i,l,u,f;const s=V||((l=(i=o[d])==null?void 0:i.cells[0])==null?void 0:l.id);if(!s)return;const a={id:`image-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:t,position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:(((f=(u=o[d].cells.find(p=>p.id===s))==null?void 0:u.elements)==null?void 0:f.length)||0)+1};Ie(s,a),ee.success("Imagen añadida desde la galería")},ht=h.useCallback(async(t,s)=>{var l,u;const a=[],i=[];for(const f of t){const p={...f};if(f.cells){p.cells=[];for(const v of f.cells){const k={...v};if(v.elements){k.elements=[];for(const T of v.elements)if(T.type==="image"&&((l=T.content)!=null&&l.startsWith("data:image/"))){const A=`${T.id}_${Date.now()}`,M=T.content.match(/^data:image\/([^;]+);base64,(.+)$/);if(M){const w=M[1],S=M[2],U=`${A}.${w==="jpeg"?"jpg":w}`;i.push({filename:U,data:S,type:w,elementId:T.id}),k.elements.push({...T,content:T.content,_wasBase64:!0,_originalSize:T.content.length,_elementId:T.id})}else k.elements.push(T)}else k.elements.push(T)}p.cells.push(k)}}a.push(p)}if(i.length>0)try{const f=await fetch(`/api/canvas/projects/${s}/upload-images`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((u=document.querySelector('meta[name="csrf-token"]'))==null?void 0:u.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({images:i})});if(f.ok){const p=await f.json();if(p.uploadedImages){const v=new Map;p.uploadedImages.forEach(k=>{v.set(k.elementId,k.url)});for(const k of a)if(k.cells){for(const T of k.cells)if(T.elements)for(const A of T.elements)A._wasBase64&&A._elementId&&v.has(A._elementId)&&(A.content=v.get(A._elementId),delete A._elementId)}}}else{const p=await f.json().catch(()=>({message:"Error desconocido en upload"}));return console.error("❌ [IMAGE-UPLOAD] Error subiendo imágenes:",p),t}}catch(f){return console.error("❌ [IMAGE-UPLOAD] Error de red subiendo imágenes:",f),t}return a},[]),ke=h.useCallback(async(t=o,s=!1)=>{var a;if(!(!(r!=null&&r.id)||!s&&t.length===0))try{const u={design_data:{pages:await ht(t,r.id),currentPage:d,workspaceDimensions:R,workspaceSize:O,selectedElement:$,selectedCell:V,history:te.slice(-5),historyIndex:Math.min(_,4),timestamp:new Date().toISOString(),version:"2.0",project:{id:r.id,name:(c==null?void 0:c.name)||"Álbum Personalizado",item_id:c==null?void 0:c.id,preset_id:n==null?void 0:n.id}},thumbnails:Q},p=JSON.stringify(u).length/(1024*1024),v=await fetch(`/api/canvas/projects/${r.id}/save-progress`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""},credentials:"include",body:JSON.stringify(u)});if(v.ok){const k=await v.json(),T=`editor_progress_project_${r.id}`;return localStorage.removeItem(T),o&&o.length>0&&ve().catch(A=>{console.warn("⚠️ Error generando thumbnails locales:",A)}),!0}else{const k=await v.json().catch(()=>({message:"Error desconocido"}));return console.error("❌ [AUTO-SAVE] Error guardando en BD:",k),!1}}catch(i){return console.error("❌ [AUTO-SAVE] Error en auto-save con procesamiento de imágenes:",i),!1}},[o,d,R,O,$,V,te,_,r==null?void 0:r.id,c==null?void 0:c.name,c==null?void 0:c.id,n==null?void 0:n.id,Q,ht,ve]);h.useEffect(()=>{if(!(r!=null&&r.id))return;const t=setInterval(()=>{o.length>0&&ke(o,!1)},5*60*1e3);return()=>clearInterval(t)},[ke,o,r==null?void 0:r.id]),h.useCallback(async()=>{if(!o.length)return{};console.log("📸 [THUMBNAILS] Capturando thumbnails de todas las páginas...");const t={},s=d;try{for(let a=0;a<o.length;a++){const i=o[a];if(i!=null&&i.id)try{a!==d&&(y(a),await new Promise(u=>setTimeout(u,300)));const l=await ue({type:"thumbnail"});l&&(t[i.id]=l,console.log(`✅ [THUMBNAILS] Thumbnail capturado para página ${a+1}: ${i.id}`))}catch(l){console.warn(`⚠️ [THUMBNAILS] Error capturando thumbnail para página ${i.id}:`,l),Q[i.id]&&(t[i.id]=Q[i.id])}}return s!==d&&y(s),console.log(`✅ [THUMBNAILS] Capturados ${Object.keys(t).length} thumbnails de ${o.length} páginas`),t}catch(a){return console.error("❌ [THUMBNAILS] Error capturando thumbnails:",a),s!==d&&y(s),Q}},[o,d,y,ue,Q]);const As=h.useCallback(async()=>{if(!(r!=null&&r.id)||o.length===0)return ee.error("No hay datos para guardar"),!1;try{return console.log("📸 [SAVE] Generando thumbnails localmente..."),await ve(),await He(),await ke(o,!0)?(ee.success("Progreso guardado exitosamente"),!0):(ee.error("Error al guardar el progreso"),!1)}catch(t){return console.error("❌ [SAVE] Error al guardar el progreso:",t),ee.error("Error al guardar el progreso"),!1}},[ke,o,r==null?void 0:r.id,R,n,ve]),Ke=h.useCallback(t=>{t!==d&&(y(t),console.log("📄 [PAGE-CHANGE] Página cambiada a:",t))},[d]),Ne=()=>`editor_progress_project_${r==null?void 0:r.id}`,mt=h.useCallback(async()=>{var t,s,a,i;if(r!=null&&r.id)try{const l=me.loadFromLocalStorage(),u=await fetch(`/api/canvas/projects/${r.id}/load-progress`,{headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});let f=null;if(u.ok){const v=await u.json();v.success&&((t=v.data)!=null&&t.design_data)&&(f=v.data)}let p=null;if(l&&f){const v=new Date(l.savedAt).getTime(),k=new Date(f.saved_at).getTime();p=v>k?l:f}else l?p=l:f&&(p=f);p&&(((s=p.pages)==null?void 0:s.length)>0||((i=(a=p.design_data)==null?void 0:a.pages)==null?void 0:i.length)>0)&&(Es(p),dt(!0))}catch(l){console.error("❌ [RECOVERY] Error verificando progreso guardado:",l)}},[r==null?void 0:r.id,me]),Is=h.useCallback(async t=>{var s;try{let a=[];if(t.pages?a=t.pages:(s=t.design_data)!=null&&s.pages&&(a=t.design_data.pages),a.length>0){G(a);const i=[JSON.stringify(a)];ce(i),q(0),setTimeout(()=>{Z({})},100),ee.success("✅ Progreso cargado exitosamente")}}catch(a){console.error("❌ [RECOVERY] Error cargando progreso:",a),ee.error("Error al cargar el progreso guardado")}},[G,ce,q,Z]),Ps=h.useCallback(async()=>{try{const t=me.getStorageKey();localStorage.removeItem(t),ee.success("Progreso anterior eliminado")}catch(t){console.error("❌ [RECOVERY] Error descartando progreso:",t)}},[me]);h.useEffect(()=>{r&&c&&n&&(!(x!=null&&x.pages)||x.pages.length===0)&&ut(n,c)},[r,c,n,x]),h.useEffect(()=>{r!=null&&r.id&&!P&&o.length===0&&setTimeout(()=>{mt()},500)},[r==null?void 0:r.id,P,o.length,mt]),h.useEffect(()=>{r!=null&&r.id&&o.length>0&&setTimeout(()=>{He()},100)},[r==null?void 0:r.id,o.length,He]);const ut=(t,s)=>{try{const a=[],i=s.pages||t.pages||20,l=s.cover_image?`/storage/images/item/${s.cover_image}`:null,u=s.cover_image?null:t.background_color||"#ffffff",f={id:"page-cover",type:"cover",layout:"layout-1",backgroundImage:l,backgroundColor:u,cells:[{id:"cell-cover-1",elements:[{id:"cover-title",type:"text",content:s.name||"Mi Álbum Personalizado",position:{x:10,y:20},size:{width:80,height:15},style:{fontSize:"28px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",textAlign:"center",backgroundColor:"transparent",padding:"8px"},zIndex:2},...s.image?[{id:"cover-image",type:"image",content:`/storage/images/item/${s.image}`,position:{x:25,y:40},size:{width:50,height:40},filters:{},mask:"none",zIndex:1}]:[]]}]};a.push(f);const p=s.content_image?`/storage/images/item/${s.content_image}`:null,v=s.content_image?null:t.background_color||"#ffffff";for(let M=1;M<=i;M++){const w={id:`page-content-${M}`,type:"content",pageNumber:M,layout:"layout-1",backgroundImage:p,backgroundColor:v,cells:[{id:`cell-content-${M}-1`,elements:[]}]};a.push(w)}const k=s.back_cover_image?`/storage/images/item/${s.back_cover_image}`:null,T=s.back_cover_image?null:t.background_color||"#ffffff",A={id:"page-final",type:"final",layout:"layout-1",backgroundImage:k,backgroundColor:T,cells:[{id:"cell-final-1",elements:[]}]};a.push(A),G(a),y(0),t.width&&t.height&&D("preset")}catch(a){console.error("❌ Error creating pages:",a),C(a.message)}},qe=h.useMemo(()=>({cover:o.filter(t=>t.type==="cover"),content:o.filter(t=>t.type==="content"),final:o.filter(t=>t.type==="final")}),[o]),X=h.useCallback(()=>{if(!$||!V||o.length===0)return null;const t=o[d];if(!t)return null;const s=t.cells.find(a=>a.id===V);return s?s.elements.find(a=>a.id===$):null},[$,V,o,d]),pt=(t,s)=>{if(s){const a=o[d].cells.find(l=>l.id===s),i=a==null?void 0:a.elements.find(l=>l.id===t);if(i!=null&&i.locked){const l=document.createElement("div");l.className="fixed top-4 right-4 bg-amber-100 border border-amber-400 text-amber-700 px-4 py-2 rounded-lg z-50",l.textContent="Este elemento es parte del diseño base y no se puede editar",document.body.appendChild(l),setTimeout(()=>{document.body.contains(l)&&document.body.removeChild(l)},3e3);return}}if(s&&de(s),J(t),t){const a=o[d].cells.find(l=>l.id===(s||V)),i=a==null?void 0:a.elements.find(l=>l.id===t);(i==null?void 0:i.type)==="image"?Se(i):(i==null?void 0:i.type)==="text"?(Ve(!0),vs({elementId:t,cellId:s||V}),ae("text")):Ve(!1)}else Ve(!1),Se(null)},xe=()=>{if(o.length===0)return re[0];const t=o[d];return t?re.find(s=>s.id===t.layout)||re[0]:re[0]},Ae=h.useCallback(t=>{G(t);const s=[...te.slice(0,_+1),JSON.stringify(t)];ce(s),q(s.length-1);try{const a=Ne(),i={pages:t,currentPage:d,savedAt:Date.now()},l=JSON.stringify(i),u=Math.round(l.length/1024);if(u<2048)localStorage.setItem(a,l);else{console.warn(`⚠️ Datos demasiado grandes para localStorage (${u} KB), saltando guardado local`);try{localStorage.removeItem(a)}catch(f){console.error("Error limpiando localStorage:",f)}}}catch(a){if(console.error("❌ Error guardando en localStorage:",a),a.name==="QuotaExceededError")try{const i=Ne();localStorage.removeItem(i)}catch(i){console.error("Error limpiando localStorage:",i)}}if(t[d]){const a=t[d].id;Z(i=>{const l={...i};return delete l[a],l})}},[te,_,Ne,d]);h.useEffect(()=>{try{const t=Ne(),s={pages:o,currentPage:d,savedAt:Date.now()},a=JSON.stringify(s),i=Math.round(a.length/1024);i<2048?localStorage.setItem(t,a):console.warn(`⚠️ Datos demasiado grandes para localStorage (${i} KB), saltando guardado`)}catch(t){if(console.error("❌ Error guardando currentPage en localStorage:",t),t.name==="QuotaExceededError")try{const s=Ne();localStorage.removeItem(s)}catch(s){console.error("Error limpiando localStorage:",s)}}},[d,o,Ne]);const Ts=t=>{const s=re.find(u=>u.id===t);if(!s)return;const a=[...o],i=a[d],l=Array.from({length:s.cells}).map((u,f)=>i.cells[f]||{id:`cell-${i.id}-${f+1}`,elements:[]});a[d]={...i,layout:t,cells:l},Ae(a),J(null),de(null)},Ie=(t,s)=>{const a=[...o];for(let i=0;i<a[d].cells.length;i++)a[d].cells[i].id===t&&a[d].cells[i].elements.push(s);Ae(a),J(s.id),de(t)},se=(t,s,a,i=!1)=>{const l=[...o],u=l[d].cells.findIndex(f=>f.id===t);if(u!==-1){if(i)l[d].cells[u].elements.push({...l[d].cells[u].elements.find(f=>f.id===s),...a});else{const f=l[d].cells[u].elements.findIndex(p=>p.id===s);f!==-1&&(l[d].cells[u].elements[f]={...l[d].cells[u].elements[f],...a})}Ae(l)}},Xe=(t,s)=>{const a=[...o],i=a[d].cells.findIndex(l=>l.id===t);i!==-1&&(a[d].cells[i].elements=a[d].cells[i].elements.filter(l=>l.id!==s),Ae(a),$===s&&J(null))},Os=(t,s,a)=>{const i=[...o],l=i[d].cells.findIndex(u=>u.id===t);if(l!==-1){const u=i[d].cells[l].elements,f=u.findIndex(p=>p.id===s);if(f!==-1){const p=a==="up"?f+1:f-1;if(p>=0&&p<u.length){const v=u[f];u[f]=u[p],u[p]=v,Ae(i)}}}},Rs=()=>{_>0&&(q(_-1),G(JSON.parse(te[_-1])),J(null),de(null))},$s=()=>{_<te.length-1&&(q(_+1),G(JSON.parse(te[_+1])),J(null),de(null))},Je=(t="body")=>{const s=`text-${Date.now()}`,a={heading:{fontSize:"32px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"12px",borderRadius:"0px",border:"none",opacity:1},subheading:{fontSize:"24px",fontFamily:"Arial",color:"#333333",fontWeight:"600",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"10px",borderRadius:"0px",border:"none",opacity:1},body:{fontSize:"16px",fontFamily:"Arial",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1}},i={heading:"Título Principal",subheading:"Subtítulo",body:"Haz clic para editar"},l={heading:{width:.8,height:.2},subheading:{width:.6,height:.15},body:{width:.4,height:.15}},u={id:s,type:"text",content:i[t],position:{x:.05,y:.05},size:l[t],style:a[t]};V?Ie(V,u):console.log("Selecciona una celda primero")},ft=h.useMemo(()=>{var l;const t=o[d];if(!t)return null;const s=((l=t.cells)==null?void 0:l.flatMap(u=>u.elements||[]))||[],a=s.map(u=>({id:u.id,type:u.type,position:u.position,size:u.size}));return{pageId:t.id,elementsCount:s.length,contentHash:JSON.stringify(a).substring(0,100),backgroundImage:t.backgroundImage,backgroundColor:t.backgroundColor,layout:t.layout}},[o,d]);h.useEffect(()=>{if(o.length===0||P||!ft)return;let t=!1;const s=async()=>{try{const i=o[d];if(!i||!i.id)return;const l=i.id;if(Z(f=>{const p={...f};return delete p[l],p}),await new Promise(f=>setTimeout(f,100)),t)return;const u=await ue();u&&!t?Z(f=>({...f,[l]:u})):console.warn("⚠️ [DEBUG] No se pudo generar miniatura para:",l)}catch(i){t||console.error("❌ [DEBUG] Error regenerando miniatura:",i)}},a=setTimeout(()=>{s()},500);return()=>{t=!0,clearTimeout(a)}},[d,ft,P,ue]),h.useEffect(()=>{if(o.length===0||P)return;const t=async()=>{const a=o.filter(i=>!Q[i.id]);if(a.length!==0)for(const i of a)try{const l=document.createElement("canvas");l.width=200,l.height=150;const u=l.getContext("2d");if(u.fillStyle=i.backgroundColor||"#ffffff",u.fillRect(0,0,200,150),i.backgroundImage)try{const p=new Image;p.crossOrigin="anonymous",await new Promise((v,k)=>{p.onload=v,p.onerror=k,p.src=i.backgroundImage}),u.drawImage(p,0,0,200,150)}catch(p){console.warn("No se pudo cargar imagen de fondo para miniatura:",p)}i.cells&&i.cells.forEach(p=>{p.elements&&p.elements.forEach(v=>{var k;v.type==="text"&&v.content&&(u.fillStyle=((k=v.style)==null?void 0:k.color)||"#000000",u.font="12px Arial",u.fillText(v.content.substring(0,20)+(v.content.length>20?"...":""),10,30))})});const f=l.toDataURL("image/jpeg",.7);Z(p=>({...p,[i.id]:f})),await new Promise(p=>setTimeout(p,300))}catch(l){console.error("❌ Error generando miniatura de fondo para:",i.id,l)}},s=setTimeout(()=>{t()},2e3);return()=>clearTimeout(s)},[o,Q,P]);const _s=async()=>{var t;try{if(!c||!n||!(r!=null&&r.id))return!1;await ke(o,!0)||console.warn("⚠️ No se pudo guardar el progreso, pero continuando...");const a={design_data:{id:r.id,title:(c==null?void 0:c.name)||"Álbum Personalizado",pages:o,workspace_dimensions:R,created_at:new Date().toISOString()},item_data:{id:c==null?void 0:c.id,name:(c==null?void 0:c.name)||(c==null?void 0:c.title),price:c==null?void 0:c.price,user_id:c==null?void 0:c.user_id,width:c==null?void 0:c.width,height:c==null?void 0:c.height},preset_data:{id:n==null?void 0:n.id,width:n==null?void 0:n.width,height:n==null?void 0:n.height,cover_image:n==null?void 0:n.cover_image,content_layer_image:n==null?void 0:n.content_layer_image,final_layer_image:n==null?void 0:n.final_layer_image},dimensions:{width_mm:(n==null?void 0:n.width)||(c==null?void 0:c.width)||210,height_mm:(n==null?void 0:n.height)||(c==null?void 0:c.height)||297,workspace_width:(R==null?void 0:R.width)||800,workspace_height:(R==null?void 0:R.height)||600}};try{const T=await fetch("/api/canvas-projects/save",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({id:r.id,status:"ready_for_pdf",pdf_data:a,completed_at:new Date().toISOString()})});if(T.ok){const A=await T.json()}else console.warn("⚠️ Error marcando proyecto como completado")}catch(T){console.warn("⚠️ Error en marcado de completado:",T)}const i=Date.now(),l=r.id;window.currentProjectId=l,window.albumProjectId=l;let u=n.cover_image;Q&&Q["page-cover"]&&(u=Q["page-cover"]);let f=u;u&&u.startsWith("data:image/")&&u.length>1e5&&(f=n.cover_image||"/assets/img/default-album.jpg");const p={...c,project_id:l,canvas_project_id:r.id,quantity:1,type:"custom_album",pdf_metadata:{width_mm:n.width,height_mm:n.height,pages_count:o.length,workspace_dimensions:R,requires_pdf_generation:!0}},v=structuredClone(F),k=v.findIndex(T=>T.id==p.id);return k==-1?v.push({...p,quantity:1}):v[k].quantity++,B(v),ee.success("Álbum agregado al carrito",{description:`${p.name} se ha añadido al carrito. El PDF se generará en el backend.`,icon:e.jsx(ar,{className:"h-5 w-5 text-green-500"}),duration:4e3,position:"bottom-center"}),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{cart:v,action:"add",product:p}})),!0}catch(s){return console.error("❌ === ERROR EN addAlbumToCart ==="),console.error("Error completo:",s),console.error("Stack trace:",s.stack),console.error("Mensaje del error:",s.message),ee.error("Error al agregar al carrito",{description:`Error específico: ${s.message}`,duration:5e3,position:"bottom-center"}),!1}};window.finalizeAlbumDesign=async()=>{try{if(!o||o.length===0)throw new Error("No hay páginas para finalizar");const a={design_data:{pages:(A=>A.map(M=>({id:M.id,type:M.type,pageNumber:M.pageNumber,layout:M.layout,cells:M.cells.map(w=>({id:w.id,elements:w.elements.map(S=>{const I={id:S.id,type:S.type,position:S.position,zIndex:S.zIndex||1};if(S.type==="image"){if(S.content.startsWith("data:image/")){const U=btoa(S.content.substring(0,100)).substring(0,20);I.content=`[BASE64_IMAGE_${U}]`,I.contentType=S.content.split(";")[0].split(":")[1],I.originalSize=S.content.length}else I.content=S.content;if(S.filters){const U=Object.entries(S.filters).filter(([Y,W])=>W!==0&&W!==!1&&W!==null).reduce((Y,[W,H])=>(Y[W]=H,Y),{});Object.keys(U).length>0&&(I.filters=U)}S.mask&&S.mask!=="none"&&(I.mask=S.mask),S.size&&(I.size=S.size),S.locked&&(I.locked=S.locked)}else if(S.type==="text"&&(I.content=S.content,S.style)){const U=Object.entries(S.style).filter(([Y,W])=>!(Y==="fontSize"&&W==="16px"||Y==="color"&&W==="#000000"||Y==="fontFamily"&&W==="Arial")).reduce((Y,[W,H])=>(Y[W]=H,Y),{});Object.keys(U).length>0&&(I.style=U)}return I})}))})))(o),projectInfo:{id:r==null?void 0:r.id,item_id:c==null?void 0:c.id,title:c==null?void 0:c.title,preset_id:n==null?void 0:n.id},presetInfo:{id:n==null?void 0:n.id,name:n==null?void 0:n.name,cover_image:n==null?void 0:n.cover_image,content_image:n==null?void 0:n.content_image,back_cover_image:n==null?void 0:n.back_cover_image},workspace:{width:R.width,height:R.height,scale:R.scale},meta:{finalizedAt:new Date().toISOString(),version:"1.3"}},thumbnails:Object.fromEntries(Object.entries(Q).map(([A,M])=>[A,M]))},i=JSON.stringify(a),l=Math.round(i.length/1024),u=Math.round(l/1024*100)/100;let f=0,p=0;o.forEach(A=>{var M;(M=A.cells)==null||M.forEach(w=>{var S;(S=w.elements)==null||S.forEach(I=>{I.type==="image"&&I.content&&I.content.startsWith("data:image/")&&(f++,p+=I.content.length)})})});const v=Math.round(p/(1024*1024)*100)/100;if(l>1024&&!confirm(`El diseño contiene ${f} imágenes (${v} MB en imágenes). Payload completo: ${u} MB. Esto podría causar problemas al guardarlo. ¿Desea continuar de todos modos?`))return!1;const k=await fetch(`/api/canvas/projects/${r.id}/save`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:i});if(!k.ok){let A="Error al finalizar el diseño";try{A=(await k.json()).message||A}catch{k.status===413?A="El diseño es demasiado grande para ser guardado. Intente simplificar las imágenes.":k.status>=500&&(A="Error del servidor. Intente nuevamente más tarde.")}throw new Error(A)}const T=await k.json();return!0}catch(t){console.error("Error al finalizar diseño:",t);let s=t.message;return t.message.includes("Failed to fetch")?s="Error de conexión. Verifique su conexión a internet e intente nuevamente.":(t.message.includes("NetworkError")||t.message.includes("net::"))&&(s="Error de red. Intente nuevamente más tarde."),alert("Error al finalizar el diseño: "+s),!1}};const Ms=h.useCallback(async()=>{try{const{jsPDF:t}=await zs(async()=>{const{jsPDF:U}=await import("./jspdf.es.min-D3plwuQr.js").then(Y=>Y.j);return{jsPDF:U}},__vite__mapDeps([0,1,2,3,4]));let s=(n==null?void 0:n.width)||21,a=(n==null?void 0:n.height)||29.7;const i=.3,l=s+i*2,u=a+i*2,f=l*28.35,p=u*28.35,v=new t({orientation:f>p?"landscape":"portrait",unit:"pt",format:[f,p],compress:!1}),k=o.length;let T=0;const A=document.createElement("div");A.id="pdf-progress",A.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",A.innerHTML=`
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Generando PDF de alta calidad...</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="pdf-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                        <span id="current-page">0</span> de ${k} páginas procesadas
                    </p>
                </div>
            `,document.body.appendChild(A);const M=U=>{const Y=U/k*100;document.getElementById("pdf-progress-bar").style.width=`${Y}%`,document.getElementById("current-page").textContent=U},w=d;for(let U=0;U<o.length;U++){const Y=o[U];y(U),await new Promise(W=>setTimeout(W,500));try{const W=await ue({type:"pdf"});if(W){const H=W.width/W.height,pe=f/p;let ne,ie,he=0,we=0;H>pe?(ne=f,ie=f/H,we=(p-ie)/2):(ie=p,ne=p*H,he=(f-ne)/2);const je=W.toDataURL("image/png",1);U>0&&v.addPage([f,p]),v.addImage(je,"PNG",he,we,ne,ie)}else console.warn(`⚠️ No se pudo capturar la página ${U+1}`),U>0&&v.addPage([f,p]),v.setFontSize(12),v.text(`Error al renderizar página ${U+1}`,f/2,p/2,{align:"center"})}catch(W){console.error(`❌ Error procesando página ${U+1}:`,W),U>0&&v.addPage([f,p]),v.setFontSize(12),v.text(`Error al procesar página ${U+1}`,f/2,p/2,{align:"center"})}T++,M(T),await new Promise(W=>setTimeout(W,200))}y(w);const S=`${(c==null?void 0:c.name)||"album"}_${new Date().toISOString().split("T")[0]}.pdf`;v.save(S),document.body.removeChild(A);const I=document.createElement("div");return I.className="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",I.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>PDF de alta calidad generado: ${S}</span>
                </div>
            `,document.body.appendChild(I),setTimeout(()=>{document.body.contains(I)&&document.body.removeChild(I)},5e3),S}catch(t){console.error("❌ Error generando PDF:",t);const s=document.getElementById("pdf-progress");s&&document.body.removeChild(s);const a=document.createElement("div");throw a.className="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",a.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Error al generar PDF: ${t.message}</span>
                </div>
            `,document.body.appendChild(a),setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},7e3),t}},[o,d,y,ue,n,c]);return window.generateAlbumPDF=Ms,window.generateHighQualityThumbnail=ys,window.captureCurrentWorkspace=ue,e.jsxs(Fs,{backend:Ws,className:"!h-screen !w-screen overflow-hidden",children:[P?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Cargando Editor"}),e.jsx("p",{className:"customtext-neutral-dark",children:"Preparando tu álbum personalizado..."})]})}):E?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:E}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Reintentar"}),e.jsx("button",{onClick:()=>window.history.back(),className:"w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Volver"})]})]})}):o.length===0?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Inicializando Editor"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:"Generando páginas del álbum..."}),e.jsx("div",{className:"animate-pulse flex space-x-4",children:e.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-5/6"})]})]})})]})}):e.jsxs("div",{className:"h-screen w-screen overflow-hidden bg-[#141b34] font-sans",children:[e.jsx(Ys,{isOpen:ws,onRequestClose:()=>ct(!1),pages:o.map(t=>({...t,layout:re.find(s=>s.id===t.layout)||re[0]})),workspaceDimensions:R,getCurrentLayout:t=>t?re.find(s=>s.id===t.layout)||re[0]:re[0],presetData:n,pageThumbnails:Q,addAlbumToCart:_s,projectData:r,itemData:c}),e.jsx("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white shadow-lg flex items-center px-6 z-20 border-b border-gray-200",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors text-[#040404]",children:[e.jsx(tr,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Volver"})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:Rs,disabled:_<=0,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Bs,{className:"h-4 w-4 text-[#040404]"})}),e.jsx("button",{onClick:$s,disabled:_>=te.length-1,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Hs,{className:"h-4 w-4 text-[#040404]"})})]})]}),e.jsx("div",{className:"flex-1 max-w-md mx-8",children:e.jsx("input",{type:"text",value:(r==null?void 0:r.name)||"Álbum Sin Título",onChange:t=>g({...r,name:t.target.value}),className:"w-full text-center text-lg font-bold text-[#040404] bg-transparent border-0 focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:bg-white rounded-lg px-4 py-2 transition-all",placeholder:"Nombre del diseño"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ar,{saveStatus:me.saveStatus,lastSaved:me.lastSaved,lastAutoSaved:me.lastAutoSaved,hasUnsavedChanges:L.hasUnsavedChanges,isOnline:me.isOnline,saveError:me.saveError,onManualSave:As}),e.jsx(os,{variant:"secondary",size:"sm",onClick:()=>ct(!0),icon:e.jsx(et,{className:"h-4 w-4"}),children:"Vista de Álbum"}),e.jsx("div",{className:"relative",children:e.jsx("button",{className:"h-8 w-8 rounded-full bg-[#af5cb8] flex items-center justify-center text-white font-medium",children:e.jsx(sr,{className:"h-4 w-4"})})})]})]})}),e.jsxs("div",{className:`flex h-full ${$?"pt-[60px]":"pt-16"}`,children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-20 bg-[#f7edfa] border-r border-gray-200 flex flex-col items-center py-6 space-y-2",children:[e.jsxs("button",{onClick:()=>ae("pages"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${z==="pages"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(et,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Páginas"})]}),e.jsxs("button",{onClick:()=>ae("templates"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${z==="templates"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(tt,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Diseños"})]}),e.jsxs("button",{onClick:()=>ae("panel"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${z==="panel"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Le,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Capas"})]}),e.jsxs("button",{onClick:()=>ae("images"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${z==="images"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(be,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Imagenes"})]}),e.jsxs("button",{onClick:()=>ae("text"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${z==="text"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(hs,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Textos"})]}),e.jsxs("button",{onClick:()=>ae("shapes"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${z==="shapes"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(mr,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Formas"})]}),e.jsxs("button",{onClick:()=>ae("stickers"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${z==="stickers"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(pr,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Stickers"})]})]}),e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-[#040404] capitalize",children:[z==="templates"&&"Templates",z==="images"&&"Images",z==="text"&&"Text",z==="shapes"&&"Shapes",z==="stickers"&&"Stickers",z==="pages"&&"Pages",z==="panel"&&"Layers Panel"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[z==="templates"&&"Choose a template to get started",z==="images"&&"Search for images",z==="text"&&"Add and edit text",z==="shapes"&&"Add shapes and graphics",z==="stickers"&&"Add fun stickers",z==="pages"&&"Manage your pages",z==="panel"&&"Organize layers and z-index"]})]}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(dr,{className:"h-4 w-4 text-gray-500"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[z==="templates"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(tt,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Page Layouts"})]}),e.jsx(br,{currentLayoutId:(yt=o[d])==null?void 0:yt.layout,onLayoutChange:Ts})]}),z==="images"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Imágenes del Proyecto"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[Ce.length," imagen",Ce.length!==1?"s":""]})]}),e.jsx(Pr,{images:Ce,onImageSelect:ks,isLoading:We})]}),z==="text"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>Je("heading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-2xl leading-tight",children:"Título Principal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"32px, Bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(Me,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>Je("subheading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-lg leading-tight",children:"Subtítulo"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"24px, Semi-bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(Me,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>Je("body"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-normal text-gray-900 text-base leading-tight",children:"Texto Normal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"16px, Normal"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(Me,{className:"h-4 w-4"})})]})})]}),z==="text"&&$&&((vt=X())==null?void 0:vt.type)==="text"&&e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"h-10 w-10 bg-[#af5cb8] rounded-xl flex items-center justify-center",children:e.jsx(hr,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-[#040404] text-lg",children:"Editar Texto"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Personaliza el formato y estilo"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Formato:"}),e.jsx("button",{onClick:()=>{const t=X();se(V,$,{style:{...t.style,fontWeight:t.style.fontWeight==="bold"?"normal":"bold"}})},className:`px-3 py-1.5 rounded-md text-sm font-bold transition-colors ${((jt=(wt=X())==null?void 0:wt.style)==null?void 0:jt.fontWeight)==="bold"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"B"}),e.jsx("button",{onClick:()=>{const t=X();se(V,$,{style:{...t.style,fontStyle:t.style.fontStyle==="italic"?"normal":"italic"}})},className:`px-3 py-1.5 rounded-md text-sm italic transition-colors ${((Et=(Nt=X())==null?void 0:Nt.style)==null?void 0:Et.fontStyle)==="italic"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"I"}),e.jsx("button",{onClick:()=>{const t=X();se(V,$,{style:{...t.style,textDecoration:t.style.textDecoration==="underline"?"none":"underline"}})},className:`px-3 py-1.5 rounded-md text-sm underline transition-colors ${((Ct=(St=X())==null?void 0:St.style)==null?void 0:Ct.textDecoration)==="underline"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"U"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tipografía:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((At=(kt=X())==null?void 0:kt.style)==null?void 0:At.fontFamily)||"Arial",onChange:t=>{const s=X();se(V,$,{style:{...s.style,fontFamily:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Impact",children:"Impact"}),e.jsx("option",{value:"Comic Sans MS",children:"Comic Sans MS"}),e.jsx("option",{value:"Trebuchet MS",children:"Trebuchet MS"}),e.jsx("option",{value:"Tahoma",children:"Tahoma"}),e.jsx("option",{value:"Palatino",children:"Palatino"}),e.jsx("option",{value:"Garamond",children:"Garamond"}),e.jsx("option",{value:"Bookman",children:"Bookman"}),e.jsx("option",{value:"Avant Garde",children:"Avant Garde"}),e.jsx("option",{value:"Calibri",children:"Calibri"}),e.jsx("option",{value:"Cambria",children:"Cambria"}),e.jsx("option",{value:"Candara",children:"Candara"}),e.jsx("option",{value:"Century Gothic",children:"Century Gothic"}),e.jsx("option",{value:"Franklin Gothic",children:"Franklin Gothic"}),e.jsx("option",{value:"Futura",children:"Futura"}),e.jsx("option",{value:"Gill Sans",children:"Gill Sans"}),e.jsx("option",{value:"Lucida Grande",children:"Lucida Grande"}),e.jsx("option",{value:"Optima",children:"Optima"}),e.jsx("option",{value:"Segoe UI",children:"Segoe UI"}),e.jsx("option",{value:"Roboto",children:"Roboto"}),e.jsx("option",{value:"Open Sans",children:"Open Sans"}),e.jsx("option",{value:"Lato",children:"Lato"}),e.jsx("option",{value:"Montserrat",children:"Montserrat"}),e.jsx("option",{value:"Poppins",children:"Poppins"}),e.jsx("option",{value:"Nunito",children:"Nunito"}),e.jsx("option",{value:"Inter",children:"Inter"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tamaño:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((Pt=(It=X())==null?void 0:It.style)==null?void 0:Pt.fontSize)||"16px",onChange:t=>{const s=X();se(V,$,{style:{...s.style,fontSize:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"8px",children:"8px"}),e.jsx("option",{value:"10px",children:"10px"}),e.jsx("option",{value:"12px",children:"12px"}),e.jsx("option",{value:"14px",children:"14px"}),e.jsx("option",{value:"16px",children:"16px"}),e.jsx("option",{value:"18px",children:"18px"}),e.jsx("option",{value:"20px",children:"20px"}),e.jsx("option",{value:"22px",children:"22px"}),e.jsx("option",{value:"24px",children:"24px"}),e.jsx("option",{value:"28px",children:"28px"}),e.jsx("option",{value:"32px",children:"32px"}),e.jsx("option",{value:"36px",children:"36px"}),e.jsx("option",{value:"40px",children:"40px"}),e.jsx("option",{value:"44px",children:"44px"}),e.jsx("option",{value:"48px",children:"48px"}),e.jsx("option",{value:"56px",children:"56px"}),e.jsx("option",{value:"64px",children:"64px"}),e.jsx("option",{value:"72px",children:"72px"}),e.jsx("option",{value:"80px",children:"80px"}),e.jsx("option",{value:"96px",children:"96px"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Color:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((Ot=(Tt=X())==null?void 0:Tt.style)==null?void 0:Ot.color)||"#000000",onChange:t=>{const s=X();se(V,$,{style:{...s.style,color:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("span",{className:"text-xs text-gray-600 font-mono",children:(($t=(Rt=X())==null?void 0:Rt.style)==null?void 0:$t.color)||"#000000"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Fondo:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((Mt=(_t=X())==null?void 0:_t.style)==null?void 0:Mt.backgroundColor)||"#ffffff",onChange:t=>{const s=X();se(V,$,{style:{...s.style,backgroundColor:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("button",{onClick:()=>{const t=X();se(V,$,{style:{...t.style,backgroundColor:"transparent"}})},className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"🚫"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 w-20",children:"Alinear:"}),e.jsx("div",{className:"flex gap-1",children:["left","center","right","justify"].map(t=>{var s,a;return e.jsxs("button",{onClick:()=>{const i=X();se(V,$,{style:{...i.style,textAlign:t}})},className:`px-3 py-1.5 rounded-md text-sm transition-colors ${((a=(s=X())==null?void 0:s.style)==null?void 0:a.textAlign)===t?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:[t==="left"&&"⬅",t==="center"&&"⬌",t==="right"&&"➡",t==="justify"&&"⬍"]},t)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Espaciado:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((zt=(Lt=X())==null?void 0:Lt.style)==null?void 0:zt.lineHeight)||"1.5",onChange:t=>{const s=X();se(V,$,{style:{...s.style,lineHeight:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"1",children:"1.0"}),e.jsx("option",{value:"1.1",children:"1.1"}),e.jsx("option",{value:"1.2",children:"1.2"}),e.jsx("option",{value:"1.3",children:"1.3"}),e.jsx("option",{value:"1.4",children:"1.4"}),e.jsx("option",{value:"1.5",children:"1.5"}),e.jsx("option",{value:"1.6",children:"1.6"}),e.jsx("option",{value:"1.8",children:"1.8"}),e.jsx("option",{value:"2",children:"2.0"}),e.jsx("option",{value:"2.2",children:"2.2"}),e.jsx("option",{value:"2.5",children:"2.5"}),e.jsx("option",{value:"3",children:"3.0"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Letras:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((Ft=(Ut=X())==null?void 0:Ut.style)==null?void 0:Ft.letterSpacing)||"normal",onChange:t=>{const s=X();se(V,$,{style:{...s.style,letterSpacing:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"-3px",children:"-3px"}),e.jsx("option",{value:"-2px",children:"-2px"}),e.jsx("option",{value:"-1px",children:"-1px"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"0.5px",children:"0.5px"}),e.jsx("option",{value:"1px",children:"1px"}),e.jsx("option",{value:"1.5px",children:"1.5px"}),e.jsx("option",{value:"2px",children:"2px"}),e.jsx("option",{value:"3px",children:"3px"}),e.jsx("option",{value:"4px",children:"4px"}),e.jsx("option",{value:"5px",children:"5px"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Efectos:"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>{const t=X();se(V,$,{style:{...t.style,textTransform:t.style.textTransform==="uppercase"?"none":"uppercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((Bt=(Wt=X())==null?void 0:Wt.style)==null?void 0:Bt.textTransform)==="uppercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-black",children:"AA"}),"MAYÚS"]}),e.jsxs("button",{onClick:()=>{const t=X();se(V,$,{style:{...t.style,textTransform:t.style.textTransform==="lowercase"?"none":"lowercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((Vt=(Ht=X())==null?void 0:Ht.style)==null?void 0:Vt.textTransform)==="lowercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-normal",children:"aa"}),"minús"]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Opacidad:"}),e.jsxs("span",{className:"text-sm font-bold text-[#af5cb8]",children:[Math.round((((Kt=(Gt=X())==null?void 0:Gt.style)==null?void 0:Kt.opacity)||1)*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:((Xt=(qt=X())==null?void 0:qt.style)==null?void 0:Xt.opacity)||"1",onChange:t=>{const s=X();se(V,$,{style:{...s.style,opacity:t.target.value}})},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#af5cb8] slider",style:{background:`linear-gradient(to right, #af5cb8 0%, #af5cb8 ${(((Yt=(Jt=X())==null?void 0:Jt.style)==null?void 0:Yt.opacity)||1)*100}%, #e5e7eb ${(((Zt=(Qt=X())==null?void 0:Qt.style)==null?void 0:Zt.opacity)||1)*100}%, #e5e7eb 100%)`}})]})]})]})]}),z==="shapes"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Array.from({length:9}).map((t,s)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#af5cb8] rounded-lg"})},s))})}),z==="stickers"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:6}).map((t,s)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#f6a4b2] rounded-full"})},s))})}),z==="pages"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(et,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Pages"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[o.length," total"]})]}),o.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cargando páginas..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mr-1.5"}),"Cover"]}),qe.cover.map((t,s)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${d===o.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>Ke(o.indexOf(t)),children:e.jsxs("div",{className:"relative bg-purple-50 overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(st,{pageId:t.id,thumbnail:Q[t.id],altText:"Cover",type:"cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Cover"})})]})},t.id))]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mr-1.5"}),"Content Pages"]}),e.jsx("div",{className:"space-y-2",children:qe.content.map((t,s)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                    ${d===o.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                    mb-1`,onClick:()=>Ke(o.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(st,{pageId:t.id,thumbnail:Q[t.id],altText:`Page ${t.pageNumber}`,type:"content"}),e.jsx("div",{className:"absolute top-1 left-1 bg-white/90 rounded-full h-5 w-5 flex items-center justify-center text-[10px] font-bold shadow-sm",children:t.pageNumber}),e.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-[9px] px-1.5 py-0.5 rounded-full opacity-80 group-hover:opacity-100",children:"Editable"})]})},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mr-1.5"}),"Back Cover"]}),qe.final.map((t,s)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${d===o.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>Ke(o.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border mb-1 aspect-[4/3] rounded-lg",children:[e.jsx(st,{pageId:t.id,thumbnail:Q[t.id],altText:"Back Cover",type:"final"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Back Cover"})})]})},t.id))]})]})]}),z==="panel"&&e.jsx("div",{className:"space-y-4",children:e.jsx(xr,{pages:o,currentPage:d,selectedCell:V,selectedElement:$,onSelectCell:de,onSelectElement:J,onUpdateElement:(t,s,a)=>{se(t,s,a)},onDeleteElement:(t,s)=>{Xe(t,s)},onMoveElement:(t,s,a)=>{Os(t,s,a)}})}),z==="filters"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(rr,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Filters"})]}),(()=>{const t=X();return t?e.jsxs(e.Fragment,{children:[t.type==="image"&&e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(be,{className:"h-4 w-4 text-[#af5cb8]"}),e.jsx("span",{className:"text-sm font-medium",children:"Selected Image"})]}),e.jsx("div",{className:"w-full h-16 rounded-md overflow-hidden bg-gray-200",children:e.jsx("img",{src:t.content,alt:"",className:"w-full h-full object-cover"})})]}),t.type==="image"&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Masks"}),e.jsx(yr,{selectedMask:t.mask||"none",onSelect:s=>{se(V,$,{mask:s})},availableMasks:ms.map(s=>s.id),selectedImage:t})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Filters & Effects"}),e.jsx(Vs,{filters:t.filters||{},onFilterChange:s=>{se(V,$,{filters:s})},selectedElement:t})]})]}):e.jsxs("div",{className:"text-center py-8 px-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg mb-3 inline-block",children:e.jsx(be,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h4",{className:"text-sm font-medium text-[#040404] mb-2",children:"Select an element"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Choose an image or text element to apply filters and effects"})]})})()]})]})]})]}),e.jsxs("main",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"bg-white border-b px-4 py-2 flex items-center justify-between",children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>ae("templates"),className:"bg-white/90 hover:bg-white text-gray-700 px-3 py-1.5 rounded-lg shadow-md text-sm font-medium flex items-center gap-1.5 transition-all duration-200 hover:shadow-lg",children:[e.jsx(tt,{className:"h-4 w-4"}),"Diseño de página"]}),e.jsxs("button",{onClick:()=>ae("panel"),className:"bg-white/90 hover:bg-white text-gray-700 px-3 py-1.5 rounded-lg shadow-md text-sm font-medium flex items-center gap-1.5 transition-all duration-200 hover:shadow-lg",children:[e.jsx(Le,{className:"h-4 w-4"}),"Superponer objetos"]})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(os,{variant:"ghost",tooltip:"Añadir Imagen",onClick:()=>Ge.current&&Ge.current.click(),children:e.jsx(be,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",ref:Ge,onChange:Ss,className:"hidden",accept:"image/*"})]})]})})}),e.jsx("div",{className:"flex-1 relative flex items-center justify-center p-6 overflow-hidden bg-gray-100",children:oe?e.jsx("div",{className:"bg-white rounded-lg shadow-lg",children:e.jsx("div",{className:"overflow-hidden",style:{width:R.width,height:R.height},children:e.jsx("div",{id:`page-${o[d].id}`,className:`grid ${xe().template} gap-6`,style:{width:"100%",height:"100%"},children:o[d].cells.map((t,s)=>{var a;return e.jsx(ns,{id:t.id,elements:t.elements.filter(i=>!i.locked),workspaceSize:R,cellStyle:(a=xe().cellStyles)==null?void 0:a[o[d].cells.indexOf(t)],selectedElement:V===t.id?$:null,onSelectElement:pt,onAddElement:(i,l)=>Ie(l,i),onUpdateElement:(i,l,u)=>se(t.id,i,l,u),onDeleteElement:i=>Xe(t.id,i),availableMasks:xe().maskCategories.flatMap(i=>i.masks),projectData:r},t.id)})})})}):e.jsxs("div",{id:`page-${o[d].id}`,className:" shadow-xl overflow-hidden",style:{width:R.width,height:R.height,position:"relative",backgroundColor:((Dt=o[d])==null?void 0:Dt.backgroundColor)||"#ffffff",backgroundImage:(es=o[d])!=null&&es.backgroundImage?`url(${o[d].backgroundImage})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[(()=>{const t=o[d];return t!=null&&t.backgroundImage?e.jsx("img",{src:t.backgroundImage,alt:"background",className:"absolute inset-0 w-full h-full object-cover pointer-events-none",style:{zIndex:1}}):t!=null&&t.backgroundColor?e.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{backgroundColor:t.backgroundColor,zIndex:1}}):null})(),e.jsx("div",{className:`grid ${xe().template}`,style:{position:"relative",zIndex:10,width:"100%",height:"100%",boxSizing:"border-box",gap:((ts=xe().style)==null?void 0:ts.gap)||"16px",padding:((ss=xe().style)==null?void 0:ss.padding)||"16px"},children:o[d].cells.map(t=>{var s;return e.jsx(ns,{id:t.id,elements:t.elements.filter(a=>!a.locked),workspaceSize:R,cellStyle:(s=xe().cellStyles)==null?void 0:s[o[d].cells.indexOf(t)],selectedElement:V===t.id?$:null,onSelectElement:pt,onAddElement:(a,i)=>Ie(i,a),onUpdateElement:(a,i,l)=>se(t.id,a,i,l),onDeleteElement:a=>Xe(t.id,a),availableMasks:xe().maskCategories.flatMap(a=>a.masks),projectData:r},t.id)})})]})})]})]})]}),e.jsx(Js,{}),e.jsx(Ir,{isOpen:js,onClose:()=>dt(!1),savedProgress:Ns,onLoadProgress:Is,onDiscardProgress:Ps})]})}export{Aa as default};
