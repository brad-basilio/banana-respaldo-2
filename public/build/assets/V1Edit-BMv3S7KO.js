import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as b}from"./index-BH53Isel.js";import"./EditorLayout-B9zigUT-.js";import"./thumbnailGenerator-GSue5zvm.js";import"./EditorMain-CmA53jPW.js";import{R as V}from"./PaymentModal-lELjrGc2.js";import{H as ve,E as ce}from"./jspdf.es.min-BpOt4WUZ.js";import{X as oe}from"./x-DBMwyD6F.js";import{C as Fe}from"./chevron-left-B2s3ZsB7.js";import{C as Oe}from"./chevron-right-Ckt5D2ka.js";import"./index-yBjzXJbu.js";import"./index-BJa4kPFi.js";import"./index-fRpqIG3j.js";import"./index-B6ujFmsw.js";import"./index-BSWw-p5k.js";import"./createLucideIcon-Cy5Ya80P.js";import"./copy-6OEekgvq.js";import"./trash-2-DK1wnsDn.js";import"./TextElement-CTWCUpKD.js";import"./upload-qgEr5bIl.js";import"./index-Chjiymov.js";import"./preload-helper-BfFHrpNk.js";import"./typeof-QjJsDpFa.js";const se={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"0",border:"none",background:"none",overflow:"visible"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:1e3}},Ee=`
    .stf__wrapper {
        margin: 0 !important;
        padding: 0 !important;
    }
    .stf__block {
        margin: 0 !important;
        padding: 0 !important;
    }
    .stf__page {
        margin: 0 !important;
        padding: 0 !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
    }
    .page-container img {
        display: block;
        margin: 0;
        padding: 0;
        border: none;
        outline: none;
        image-rendering: -webkit-optimize-contrast !important;
        image-rendering: high-quality !important;
        -webkit-backface-visibility: hidden !important;
        backface-visibility: hidden !important;
        -webkit-transform: translateZ(0) !important;
        transform: translateZ(0) !important;
        -ms-interpolation-mode: bicubic !important;
    }
    .page-container {
        -webkit-font-smoothing: subpixel-antialiased !important;
        -moz-osx-font-smoothing: auto !important;
    }
`;V.setAppElement("#app");const ro=({isOpen:n,onRequestClose:p,pages:x,pageThumbnails:v={},addAlbumToCart:F,workspaceDimensions:O={width:800,height:600},layouts:te=[],presetData:G=null,projectData:i=null,itemData:P=null,contentType:R={type:"album",name:"Álbum",description:"Vista de Álbum",icon:"📖"},categorizedPages:ke={cover:[],content:[],final:[]},albumLoadingState:E={isLoading:!1,loadedImages:0,totalImages:0,message:""}})=>{var le;const[K,de]=b.useState(0),[M,J]=b.useState(!1),[z,Te]=b.useState(!1),[B,A]=b.useState({}),[ge,re]=b.useState(!1),[me,ae]=b.useState(!1),[Ce,Se]=b.useState(!1),[Ie,De]=b.useState(0),[X,Z]=b.useState(!1),[D,m]=b.useState({isOpen:!1,message:"Iniciando proceso...",subMessage:"Estamos preparando tu álbum",progress:0}),_=b.useRef(),ue=async()=>{var o;if(!M){J(!0),m({isOpen:!0,message:"🎯 Procesando tu álbum...",subMessage:"Iniciando el proceso de compra",progress:5}),await new Promise(a=>setTimeout(a,300));try{if(m({isOpen:!0,message:"🔍 Verificando proyecto...",subMessage:"Validando información del álbum",progress:10}),await new Promise(r=>setTimeout(r,500)),!(i!=null&&i.id)){console.error("❌ No hay datos del proyecto"),m({isOpen:!1,message:"",subMessage:"",progress:0}),alert("Error: No se encontró información del proyecto.");return}if(typeof F!="function"){console.error("❌ addAlbumToCart no es una función"),m({isOpen:!1,message:"",subMessage:"",progress:0}),alert("Error: Función de carrito no disponible. Inténtelo nuevamente.");return}m({isOpen:!0,message:"✅ Proyecto verificado",subMessage:"Preparando tu álbum para la compra",progress:20}),await new Promise(r=>setTimeout(r,400));let a=!1;if(!me&&!X){if(console.log("📄 [PURCHASE] PASO 1: Generando PDF para compra..."),m({isOpen:!0,message:"📄 Generando PDF...",subMessage:"Creando el archivo de tu álbum",progress:30}),a=await be(),console.log("📄 [PURCHASE] Resultado de generatePDFSilently:",a),!a){console.error("❌ [PURCHASE] PDF no se pudo generar o subir correctamente"),m({isOpen:!0,message:"❌ Error en PDF",subMessage:"No pudimos generar el archivo",progress:30}),await new Promise(r=>setTimeout(r,2e3)),m({isOpen:!1,message:"",subMessage:"",progress:0}),alert("Error: No se pudo generar el PDF del álbum. Por favor, inténtelo nuevamente.");return}console.log("✅ [PURCHASE] PDF generado y subido exitosamente al servidor"),m({isOpen:!0,message:"🎉 PDF creado exitosamente",subMessage:"Archivo listo en el servidor",progress:65})}else console.log("📄 [PURCHASE] PDF ya disponible, procediendo..."),a=!0,m({isOpen:!0,message:"📄 PDF ya disponible",subMessage:"Archivo encontrado en el servidor",progress:65});await new Promise(r=>setTimeout(r,500)),m({isOpen:!0,message:"🛒 Agregando al carrito...",subMessage:"Configurando tu pedido",progress:75}),console.log("🛒 [CART] PASO 2: PDF confirmado en servidor, agregando al carrito...");const s=F();let t;if(s&&typeof s.then=="function"?(console.log("🛒 [CART] addAlbumToCart es async, esperando resultado..."),t=await s):(console.log("🛒 [CART] addAlbumToCart es sync, resultado inmediato:",s),t=s),!t)throw console.error("❌ No se pudo agregar al carrito"),m({isOpen:!0,message:"❌ Error en carrito",subMessage:"No pudimos agregar el álbum",progress:75}),await new Promise(r=>setTimeout(r,2e3)),m({isOpen:!1,message:"",subMessage:"",progress:0}),new Error("No se pudo agregar al carrito. El PDF se generó correctamente, pero hubo un problema con el carrito.");console.log("✅ [PURCHASE] Álbum agregado exitosamente al carrito"),m({isOpen:!0,message:"🎉 ¡Álbum agregado al carrito!",subMessage:"Preparando redirección...",progress:90}),await new Promise(r=>setTimeout(r,800)),m({isOpen:!0,message:"✨ ¡Proceso completado!",subMessage:"Redirigiendo al carrito de compras",progress:100}),console.log("✅ [REDIRECT] Todo completado exitosamente, redirigiendo..."),await new Promise(r=>setTimeout(r,1e3)),m({isOpen:!1,message:"",subMessage:"",progress:0}),p(),window.location.href="/cart"}catch(a){console.error("❌ Error en proceso de compra:",a),m({isOpen:!0,message:"❌ Error inesperado",subMessage:"Algo salió mal durante el proceso",progress:0}),await new Promise(t=>setTimeout(t,2e3)),m({isOpen:!1,message:"",subMessage:"",progress:0});try{const t=`${((o=window.Global)==null?void 0:o.APP_CORRELATIVE)||"bananalab"}_cart`;if(JSON.parse(localStorage.getItem(t)||"[]").length>0){console.log("✅ [RECOVERY] Producto encontrado en carrito, redirigiendo..."),p(),setTimeout(()=>{window.location.href="/cart"},500);return}}catch(t){console.error("❌ Error en recuperación:",t)}confirm(`Error: ${a.message}

¿Desea intentar ir al carrito manualmente?`)&&(window.location.href="/cart")}finally{J(!1)}}};function pe(o,a,s,t,r,g){const d=a.width,c=a.height,u=r/g,h=d/c;let f=0,w=0,y=d,l=c;u>h?(l=d/u,w=(c-l)/2):(y=c*u,f=(d-y)/2),o.drawImage(a,f,w,y,l,s,t,r,g)}function he(o){const a=o.match(/grid-cols-(\d+)/),s=o.match(/grid-rows-(\d+)/),t=o.match(/gap-(\d+)/);return{cols:a?parseInt(a[1],10):1,rows:s?parseInt(s[1],10):1,gap:t?parseInt(t[1],10)*4:0}}function ne(o,a,s=1){const t=o&&o.match(new RegExp(`${a}-span-(\\d+)`));return t?parseInt(t[1],10):s}function fe(o,a,s){const{cols:t,rows:r,gap:g}=he(o.template),d=o.style&&o.style.padding?parseInt(o.style.padding):0,c=a.width-2*d,u=a.height-2*d,h=(c-g*(t-1))/t,f=(u-g*(r-1))/r,w=Array.from({length:r},()=>Array(t).fill(!1)),y={};for(let l=0;l<o.cells;l++){const T=o.cellStyles&&o.cellStyles[l]?o.cellStyles[l]:"",C=ne(T,"col",1),$=ne(T,"row",1);let H=!1;for(let N=0;N<=r-$&&!H;N++)for(let S=0;S<=t-C&&!H;S++){let q=!0;for(let U=N;U<N+$;U++){for(let I=S;I<S+C;I++)if(w[U][I]){q=!1;break}if(!q)break}if(q){for(let I=N;I<N+$;I++)for(let ee=S;ee<S+C;ee++)w[I][ee]=!0;const U=s&&s[l]?s[l].id:l;y[U]={x:d+S*(h+g),y:d+N*(f+g),width:h*C+g*(C-1),height:f*$+g*($-1)},H=!0}}if(!H){const N=s&&s[l]?s[l].id:l;console.warn(`[GRID-PLACEMENT] No se pudo ubicar la celda ${N}`),y[N]={x:0,y:0,width:h,height:f}}}return y}b.useCallback(async()=>{if(!x||x.length===0||!n)return;re(!0),A({});const o={},a=4,s=(d,c,u,h)=>{if(!c||!c.image)return;const f=new Image;f.src=c.image,f.onload=()=>{const w=u.x+c.x*h,y=u.y+c.y*h,l=c.width*h,T=c.height*h;pe(d,f,w,y,l,T)}},t=async(d,c)=>{const u=document.createElement("canvas"),h=u.getContext("2d");if(u.width=O.width*a,u.height=O.height*a,G&&G.final_layer_image){const l=new Image;l.src=G.final_layer_image,l.onload=()=>{h.drawImage(l,0,0,u.width,u.height)}}const f=te.find(l=>l.id===d.layoutId);if(!f)return;const w=fe(f,O,d.cells);d.cells.forEach(l=>{const T=w[l.id];T&&l.elements.forEach(C=>{s(h,C,T,a)})});const y=u.toDataURL("image/jpeg",.9);return{[d.id]:y}},r=x.map((d,c)=>t(d));(await Promise.all(r)).forEach(d=>{Object.assign(o,d)}),A(o),re(!1)},[x,n,O,te,G]),b.useEffect(()=>{i!=null&&i.id&&(window.currentProjectId=i.id,console.log("🔍 [DEBUG] Proyecto cargado:",i.id))},[i==null?void 0:i.id]);const be=async()=>{if(console.log("🎯 [FRONTEND-PDF] ========== FUNCIÓN LLAMADA =========="),console.log("🎯 [FRONTEND-PDF] projectData:",i),console.log("🎯 [FRONTEND-PDF] pdfGenerationInProgress:",X),!(i!=null&&i.id))return console.warn("📄 [FRONTEND-PDF] No hay proyecto cargado."),!1;if(X)return console.warn("⚠️ [FRONTEND-PDF] Generación ya en progreso, omitiendo llamada duplicada"),!1;Z(!0),console.log("🚀 [FRONTEND-PDF] Iniciando generación de PDF en el frontend...");try{const o=Object.keys(k).length>0?k:B;if(console.log("🔍 [FRONTEND-PDF] activeThumbnails:",Object.keys(k).length,"elementos"),console.log("🔍 [FRONTEND-PDF] generatedThumbnails:",Object.keys(B).length,"elementos"),console.log("🔍 [FRONTEND-PDF] imagesToUse:",Object.keys(o).length,"elementos"),Object.keys(o).length===0)return console.warn("⚠️ [FRONTEND-PDF] No hay imágenes disponibles para el PDF"),console.log("⚠️ [FRONTEND-PDF] activeThumbnails:",k),console.log("⚠️ [FRONTEND-PDF] generatedThumbnails:",B),!1;console.log("🖼️ [FRONTEND-PDF] Usando",Object.keys(o).length,"imágenes del flipbook"),console.log("📦 [FRONTEND-PDF] Verificando jsPDF:",typeof ce);const a=O.originalWidth||210,s=O.originalHeight||297,t=a/6,r=s/6;console.log("📐 [FRONTEND-PDF] Dimensiones PDF:",t+"mm x "+r+"mm");const g=new ce({orientation:t>r?"landscape":"portrait",unit:"mm",format:[t,r]}),d=Y();let c=0;for(const f of d){const w=o[f.originalId||f.id];if(w)try{c>0&&g.addPage([t,r]),g.addImage(w,"JPEG",0,0,t,r),c++,console.log(`📄 [FRONTEND-PDF] Página ${c} agregada al PDF`)}catch(y){console.warn(`⚠️ [FRONTEND-PDF] Error agregando página ${c+1}:`,y)}}if(c===0)return console.error("❌ [FRONTEND-PDF] No se pudo agregar ninguna página al PDF"),!1;const u=g.output("blob");console.log("✅ [FRONTEND-PDF] PDF generado:",(u.size/1024/1024).toFixed(2)+" MB,",c,"páginas"),console.log("🚀 [FRONTEND-PDF] Iniciando subida al servidor...");const h=await xe(u);return console.log("🏁 [FRONTEND-PDF] Resultado de subida:",h),h}catch(o){return console.error("❌ [FRONTEND-PDF] Error generando PDF:",o),!1}finally{Z(!1),console.log("🏁 [FRONTEND-PDF] Proceso finalizado")}},xe=async o=>{var a;try{console.log("📤 [UPLOAD-PDF] Subiendo PDF al servidor..."),console.log("📤 [UPLOAD-PDF] Tamaño del blob:",(o.size/1024/1024).toFixed(2)+" MB"),console.log("📤 [UPLOAD-PDF] Proyecto ID:",i.id);const s=`pdf_upload_log_${i.id}`;localStorage.setItem(s,JSON.stringify({timestamp:new Date().toISOString(),step:"iniciando_subida",blobSize:o.size,projectId:i.id}));const t=new FormData;t.append("pdf",o,`${i.id}.pdf`),t.append("project_id",i.id),t.append("pages_count",Y().length),console.log("📤 [UPLOAD-PDF] FormData preparado, enviando a:",`/api/customer/projects/${i.id}/upload-pdf`);const r=await fetch(`/api/customer/projects/${i.id}/upload-pdf`,{method:"POST",headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)||""},body:t});if(console.log("📤 [UPLOAD-PDF] Respuesta del servidor:",r.status,r.statusText),localStorage.setItem(s,JSON.stringify({timestamp:new Date().toISOString(),step:"respuesta_recibida",status:r.status,statusText:r.statusText})),r.ok){const g=await r.json();return console.log("✅ [UPLOAD-PDF] PDF subido exitosamente:",g),localStorage.setItem(s,JSON.stringify({timestamp:new Date().toISOString(),step:"upload_exitoso",result:g})),ae(!0),!0}else{const g=await r.json().catch(()=>({message:"Error desconocido"}));return console.error("❌ [UPLOAD-PDF] Error subiendo PDF:",r.status,g.message),localStorage.setItem(s,JSON.stringify({timestamp:new Date().toISOString(),step:"error_upload",status:r.status,error:g.message})),!1}}catch(s){console.error("❌ [UPLOAD-PDF] Error en la subida:",s.message),console.error("❌ [UPLOAD-PDF] Stack trace:",s);const t=`pdf_upload_log_${i.id}`;return localStorage.setItem(t,JSON.stringify({timestamp:new Date().toISOString(),step:"excepcion",error:s.message,stack:s.stack})),!1}};b.useEffect(()=>{n&&(Object.keys(v).length>0?(A(v),console.log("🖼️ [BOOK-PREVIEW] Thumbnails cargados:",Object.keys(v).length)):(A({}),console.log("📄 [BOOK-PREVIEW] Sin thumbnails, usando placeholders")),console.log("📖 [BOOK-PREVIEW] Modal abierto, inicializando estado..."),console.log("📄 [BOOK-PREVIEW] ProjectData ID:",i==null?void 0:i.id))},[n,v]),b.useEffect(()=>{n||(A({}),ae(!1),Z(!1),J(!1),console.log("🔄 [BOOK-PREVIEW] Modal cerrado, estados reseteados"))},[n]);const k=Object.keys(v).length>0?v:B;if(!x||!Array.isArray(x)||x.length===0)return e.jsx(V,{isOpen:n,onRequestClose:p,style:se,contentLabel:"Vista previa del álbum",ariaHideApp:!0,shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-description",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-bold",children:"Vista previa del álbum"}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-700","aria-label":"Cerrar vista previa",children:e.jsx(oe,{size:24})})]}),e.jsx("p",{id:"modal-description",className:"text-gray-600",children:"No hay páginas disponibles para mostrar."})]})});const ye=()=>{_.current&&_.current.pageFlip().flipPrev()},Pe=()=>{_.current&&_.current.pageFlip().flipNext()},we=O.width/O.height,L=600,W=Math.round(L*we),Ne=()=>{const o=(P==null?void 0:P.has_cover_image)===!0||(P==null?void 0:P.has_cover_image)===1,a=(P==null?void 0:P.has_back_cover_image)===!0||(P==null?void 0:P.has_back_cover_image)===1;return x.filter(t=>!(t.type==="cover"&&!o||t.type==="final"&&!a))},Y=()=>{const o=Ne();return o.length===0?(console.warn("⚠️ [BOOK-PAGES] No hay páginas válidas para mostrar"),[]):o.map((s,t)=>{let r="";return s.type==="cover"?r="Portada":s.type==="final"?r="Contraportada":s.type==="content"?r=`Página ${s.pageNumber||t+1}`:r=`Página ${t+1}`,{...s,id:`${s.id}-display`,originalId:s.id,displayIndex:t,pageType:s.type,pageTitle:r,originalPageNumber:s.pageNumber}})},j=Y(),ie=j.length>0&&((le=j[0])==null?void 0:le.pageType)==="cover",Q=j.length>0&&!ie&&!j.some(o=>o.pageType==="final");return j.length===0?e.jsx(V,{isOpen:n,onRequestClose:p,style:se,contentLabel:"Vista previa del álbum",ariaHideApp:!0,shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-description",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{id:"modal-title",className:"text-xl font-bold",children:["Vista previa del ",R.name.toLowerCase()]}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-700","aria-label":"Cerrar vista previa",children:e.jsx(oe,{size:24})})]}),e.jsx("p",{id:"modal-description",className:"text-gray-600",children:"No hay páginas habilitadas para mostrar. Verifique la configuración de portada y contraportada."})]})}):e.jsxs(V,{isOpen:n,onRequestClose:p,style:se,contentLabel:`Vista previa del ${R.name.toLowerCase()}`,ariaHideApp:!0,shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-description",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:Ee}}),(ge||z||E.isLoading)&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl flex flex-col items-center max-w-md mx-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mb-4"}),E.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-700 text-center",children:E.message||"Cargando álbum..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-3",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${E.totalImages>0?E.loadedImages/E.totalImages*100:0}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[E.loadedImages," de ",E.totalImages," imágenes"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-700",children:z?"Preparando álbum...":"Cargando vistas previas..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Procesando contenido"})]})]})}),e.jsxs("div",{className:"relative flex flex-col items-center justify-center p-6 bg-white rounded-2xl shadow-2xl",children:[e.jsxs("h2",{id:"modal-title",className:"sr-only",children:["Vista previa del ",R.name.toLowerCase()]}),e.jsxs("p",{id:"modal-description",className:"sr-only",children:["Navegue por las páginas de su ",R.name.toLowerCase()," usando los controles de navegación o teclado. Puede cerrar esta ventana presionando Escape o el botón de cerrar."]}),e.jsx("button",{onClick:p,className:"absolute top-4 right-4 p-2 rounded-full bg-white/80 hover:bg-white text-gray-700 shadow z-10","aria-label":`Cerrar vista previa del ${R.name.toLowerCase()}`,children:e.jsx(oe,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex items-center justify-center gap-8 mb-6 mt-2",children:[e.jsx("button",{onClick:ye,className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 shadow transition-colors","aria-label":"Página anterior",children:e.jsx(Fe,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"flex items-center text-gray-700 text-base font-medium px-4 py-2 bg-gray-50 rounded-lg","aria-live":"polite",children:[(()=>{const o=j[K];return o?o.pageTitle||`Página ${K+1}`:"Cargando..."})(),e.jsx("span",{className:"mx-2 text-gray-400",children:"•"}),K+1," / ",j.length," páginas",Q&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"Solo contenido"})]})}),e.jsx("button",{onClick:Pe,className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 shadow transition-colors","aria-label":"Página siguiente",children:e.jsx(Oe,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(ve,{ref:_,width:W,height:L,size:"stretch",minWidth:W*.7,maxWidth:W*1.3,minHeight:L*.7,maxHeight:L*1.3,maxShadowOpacity:.3,showCover:ie,mobileScrollSupport:!0,onFlip:o=>de(o.data),className:"shadow-xl",usePortrait:!1,startPage:0,drawShadow:!0,flippingTime:600,useMouseEvents:!0,swipeDistance:50,showPageCorners:!Q,disableFlipByClick:!1,autoSize:Q,style:{margin:0,padding:0},children:j.map((o,a)=>{const s=o.originalId||o.id;return k[s],e.jsx("div",{id:`page-${o.originalId||o.id}`,className:"page-container",style:{width:W,height:L,margin:0,padding:0,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#ffffff"},children:e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:o.isBlankPage?e.jsx("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",display:"flex",alignItems:"center",justifyContent:"center",color:"#f3f4f6",fontSize:"14px",fontStyle:"italic"},children:o.hasLogo&&o.logoUrl?e.jsx("img",{src:o.logoUrl,alt:"Logo",style:{maxWidth:"120px",maxHeight:"120px",objectFit:"contain",opacity:.8,filter:"grayscale(20%)"},onError:t=>{console.warn("⚠️ [BOOK-PREVIEW] Error cargando logo:",o.logoUrl),t.target.style.display="none"}}):null}):k[o.originalId||o.id]?e.jsx("img",{src:k[o.originalId||o.id],alt:o.pageTitle||`Página ${a+1}`,style:{width:"100%",height:"100%",objectFit:"contain",margin:0,padding:0,border:"none",imageRendering:"auto",backgroundColor:"#ffffff",WebkitBackfaceVisibility:"hidden",backfaceVisibility:"hidden",WebkitTransform:"translateZ(0)",transform:"translateZ(0)"}}):e.jsx(je,{page:o,pageIdx:a})})},`page-${a}`)})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 w-full max-w-2xl mx-auto",children:[e.jsx("button",{className:`flex-1 py-3 px-4 rounded-lg font-semibold shadow transition flex items-center justify-center ${M?"bg-purple-400 text-white cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,onClick:ue,disabled:M||z,children:M?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Agregando al carrito..."]}):"Comprar ahora"}),e.jsx("button",{className:"flex-1 py-3 px-4 rounded-lg bg-gray-200 text-gray-700 font-semibold shadow hover:bg-gray-300 transition",onClick:p,disabled:M||z,children:"Continuar editando"})]}),D.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] animate-in fade-in duration-500",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 min-w-96 max-w-96 mx-4 text-center relative overflow-hidden animate-in zoom-in duration-500",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50 opacity-60"}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-4 left-4 w-2 h-2 bg-purple-300 rounded-full animate-bounce opacity-60",style:{animationDelay:"0s"}}),e.jsx("div",{className:"absolute top-8 right-6 w-1 h-1 bg-blue-300 rounded-full animate-bounce opacity-60",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute bottom-8 left-8 w-1.5 h-1.5 bg-pink-300 rounded-full animate-bounce opacity-60",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-4 right-4 w-1 h-1 bg-purple-400 rounded-full animate-bounce opacity-60",style:{animationDelay:"1.5s"}})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"mb-6 relative",children:[e.jsxs("div",{className:"w-24 h-24 mx-auto bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-2xl relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full animate-ping opacity-20"}),e.jsx("div",{className:"absolute inset-2 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full animate-pulse"}),e.jsx("svg",{className:"w-12 h-12 text-white relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})]}),e.jsx("div",{className:"absolute inset-0 w-24 h-24 mx-auto",children:e.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 96 96",children:[e.jsx("circle",{cx:"48",cy:"48",r:"44",stroke:"currentColor",strokeWidth:"4",fill:"none",className:"text-gray-200"}),e.jsx("circle",{cx:"48",cy:"48",r:"44",stroke:"url(#progressGradient)",strokeWidth:"4",fill:"none",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*44}`,strokeDashoffset:`${2*Math.PI*44*(1-D.progress/100)}`,style:{transition:"stroke-dashoffset 0.5s ease-in-out"}}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",style:{stopColor:"#8b5cf6",stopOpacity:1}}),e.jsx("stop",{offset:"100%",style:{stopColor:"#ec4899",stopOpacity:1}})]})})]})})]}),e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-3 animate-pulse",children:D.message}),e.jsx("p",{className:"text-gray-600 mb-6 text-base leading-relaxed",children:D.subMessage}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden shadow-inner",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 h-4 rounded-full transition-all duration-500 ease-out relative",style:{width:`${D.progress}%`},children:[e.jsx("div",{className:"absolute inset-0 bg-white/30 animate-pulse rounded-full"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-12 animate-shimmer"})]})}),e.jsxs("p",{className:"text-lg font-bold text-purple-600 mb-4",children:[D.progress,"%"]})]}),e.jsx("style",{jsx:!0,children:`
                            @keyframes shimmer {
                                0% { transform: translateX(-100%) skewX(-12deg); }
                                100% { transform: translateX(200%) skewX(-12deg); }
                            }
                            .animate-shimmer {
                                animation: shimmer 2s infinite;
                            }
                        `})]})})]})},je=({page:n,pageIdx:p})=>{const x=n.pageTitle||(n.type==="content"?`Página ${n.originalPageNumber||n.pageNumber||p+1}`:n.type==="cover"?"Portada":n.type==="final"?"Contraportada":`Página ${p+1}`),v=n.pageType||n.type||"content";let F="";switch(v){case"cover":F="📚";break;case"final":F="📖";break;case"content":F="📄";break;default:F="📄"}return e.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full bg-gray-50 border-2 border-gray-200 rounded-lg",style:{minHeight:"400px"},children:[e.jsx("div",{className:"text-6xl mb-4",children:F}),e.jsx("div",{className:"text-lg font-semibold text-gray-700 mb-2",children:x}),e.jsx("div",{className:"text-sm text-gray-500",children:"Vista previa"}),n.layout&&e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Layout: ",n.layout.name||"Personalizado"]}),!1]})};window.checkPDFUploadLogs=function(n){const p=`pdf_upload_log_${n}`,x=localStorage.getItem(p);return x?(console.log("📋 [PDF-LOGS] Logs encontrados para proyecto",n,":",JSON.parse(x)),JSON.parse(x)):(console.log("📋 [PDF-LOGS] No hay logs para proyecto",n),null)};window.clearPDFUploadLogs=function(n){const p=`pdf_upload_log_${n}`;localStorage.removeItem(p),console.log("🧹 [PDF-LOGS] Logs limpiados para proyecto",n)};window.testPDFGeneration=function(n=!1){if(console.log("🧪 [TEST-PDF] Iniciando test de generación de PDF..."),!document.querySelector('[data-component="book-preview"]')){console.error("❌ [TEST-PDF] No se encontró elemento BookPreview");return}console.log("🧪 [TEST-PDF] Para probar, agrega un proyecto al carrito o ejecuta desde dentro del componente"),console.log("🧪 [TEST-PDF] ID del proyecto actual:",window.currentProjectId||"No definido")};export{ro as B};
