import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as p}from"./index-BH53Isel.js";import{N as k}from"./Number2Currency-e57Tgsuk.js";import{B as he,a as _e,D as Re,A as $e,O as Oe,C as ze}from"./OptionCard-C_V13-dD.js";import{S as re}from"./sparkles-DeLUn6av.js";import{c as fe}from"./createLucideIcon-Cy5Ya80P.js";import{M as Le}from"./CartItemRow-4VUVjpPz.js";import{P as De}from"./plus-Bot15Khs.js";import{T as Ve}from"./trash-2-DK1wnsDn.js";import{a as Be}from"./index-xsH4HHeE.js";import{X as Pe}from"./x-DBMwyD6F.js";import{m as Ue}from"./main-BvVILmTO.js";import{G as ae}from"./Global-ErywZRdd.js";import{t as $}from"./index-CMHsc23u.js";import{I as Z}from"./InputForm-ZnsQvLid.js";import{l as Ge}from"./lodash-CblvOeJM.js";import{C as de}from"./circle-x-p-TkKhsF.js";import{m as ee}from"./proxy-BTYtmp9V.js";import"./ProductNavigation-BMRqC0Ff.js";import"./ProductCard-Ap6bpF1Q.js";/* empty css              */import"./BlogCarousel-CCgb3gK1.js";/* empty css               */import"./InfiniteCategory-BtlY-czj.js";import{M as He}from"./PaymentModal-Bxx5p2o_.js";import{H as Xe}from"./HtmlContent-FTivcJrM.js";import"./index-yBjzXJbu.js";import"./useStateManager-7e1e8489.esm-oj4m82YY.js";import"./hoist-non-react-statics.cjs-kbdZbs82.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./tippy-react.esm-BWiGTO87.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./ItemsRest-DGjwRLrz.js";import"./BasicRest-B3rfI5GY.js";import"./HeaderSearch-B_41BEro.js";import"./index-CFtDjG4d.js";import"./eye-CKCH9ORv.js";import"./index-Chjiymov.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=fe("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=fe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=fe("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=fe("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]]);function Je({onClick:r,className:u=""}){return e.jsxs("div",{className:`relative ${u}`,children:[e.jsx(re,{size:12,className:"absolute -top-1 -left-1 text-yellow-400 animate-ping",style:{animationDelay:"0s"}}),e.jsx(re,{size:10,className:"absolute -top-2 -right-1 text-pink-400 animate-ping",style:{animationDelay:"0.5s"}}),e.jsx(re,{size:8,className:"absolute -bottom-1 -left-2 text-blue-400 animate-ping",style:{animationDelay:"1s"}}),e.jsx(re,{size:14,className:"absolute -bottom-2 -right-2 text-purple-400 animate-ping",style:{animationDelay:"1.5s"}}),e.jsxs("button",{onClick:r,className:"relative group bg-primary p-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 animate-bounce cursor-pointer",style:{animationDuration:"2s",animationIterationCount:"infinite"},children:[e.jsx("div",{className:"absolute inset-0 bg-primary rounded-xl opacity-0 group-hover:opacity-50 transition-opacity duration-300 blur-lg"}),e.jsx(xe,{size:24,className:"text-white relative z-10 drop-shadow-sm"}),e.jsx("div",{className:"absolute inset-0 bg-primary rounded-xl animate-pulse opacity-30"})]}),e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20",children:"Â¡PromociÃ³n disponible!"})]})}const Qe=({setCart:r,hasPromotion:u,onPromotionClick:o,...m})=>{const w=()=>{r(y=>y.filter(c=>c.id!==m.id))},j=()=>{r(y=>y.map(c=>c.id===m.id?{...c,quantity:(c.quantity||1)+1}:c))},x=()=>{r(y=>y.map(c=>{if(c.id===m.id){const d=(c.quantity||1)-1;return d<=0?(w(m.id),null):{...c,quantity:d}}return c}).filter(Boolean))};return e.jsx("div",{className:"w-full bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center  justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-grow",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`/storage/images/item/${m.image}`,alt:m.name,className:"w-20 h-20 object-cover rounded flex-shrink-0",onError:y=>y.target.src="/api/cover/thumbnail/null"}),u&&e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(Je,{onClick:()=>o(m),className:"group"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-lg mb-2 line-clamp-2",children:m.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark",children:m.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Disponibilidad: ",e.jsxs("span",{className:"customtext-neutral-dark",children:[m.stock>=m.quantity?"En stock":"Agotado"," "]})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark",children:m.sku})]})]})]}),e.jsxs("div",{className:"flex flex-row justify-between md:flex-col items-end md:items-end gap-4 mt-4 md:mt-0 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number(m.price*m.quantity).toFixed(2)]}),e.jsxs("div",{className:"font-bold text-lg",children:["S/ ",Number(m.final_price*m.quantity).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsx("button",{type:"button",onClick:x,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Decrease quantity",children:e.jsx(Le,{size:16})}),e.jsx("div",{className:"w-12 h-8 flex justify-center items-center bg-white",children:e.jsx("span",{className:"font-semibold text-sm",children:m.quantity||1})}),e.jsx("button",{type:"button",onClick:j,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Increase quantity",children:e.jsx(De,{size:16})})]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-400 hover:text-red-500 transition-colors duration-200 rounded-full hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-200","aria-label":"Remove item",children:e.jsx(Ve,{size:18})})]})]})]})},m.id)},We="/api";class je{static async applyToCart(u,o,m=null){var w;try{if(console.log("ðŸ›’ Applying discount rules to cart:",{cartItems:u,totalAmount:o,customerEmail:m}),!Array.isArray(u)||u.length===0)return{success:!1,error:"Carrito vacÃ­o o invÃ¡lido",data:null};const j={cart_items:u.map(y=>{const c={item_id:String(y.item_id||y.id||""),quantity:parseInt(y.quantity)||1,price:parseFloat(y.price||y.final_price||0),name:String(y.name||y.description||"Producto sin nombre"),category_id:y.category_id?String(y.category_id):null};return console.log("ðŸ“¦ Processing cart item:",c),c}),total_amount:parseFloat(o)||0,customer_email:m||null};console.log("ðŸ“¤ Sending payload to API:",j);const x=await Be.post(`${We}/discount-rules/apply-to-cart`,j);return x.data.status===200?{success:!0,data:x.data.data,message:x.data.message}:{success:!1,error:x.data.message||"Error al aplicar descuentos",data:null}}catch(j){return console.error("Error applying discount rules:",j),(w=j.response)!=null&&w.data?{success:!1,error:j.response.data.message||"Error del servidor",data:j.response.data.data||null}:{success:!1,error:"Error de conexiÃ³n",data:null}}}static formatDiscounts(u){return!u||!Array.isArray(u)?[]:u.map(o=>({id:o.rule_id,name:o.rule_name||"Descuento automÃ¡tico",description:o.description||"",amount:parseFloat(o.discount_amount||0),type:o.discount_type||"fixed",promotion_type:o.promotion_type||null,free_items:o.free_items||[],formatted_amount:o.discount_type==="percentage"?`${o.discount_amount}%`:`S/ ${parseFloat(o.discount_amount||0).toFixed(2)}`}))}static getFreeItems(u){if(!u||!Array.isArray(u))return[];const o=[];return u.forEach(m=>{m.free_items&&Array.isArray(m.free_items)&&o.push(...m.free_items)}),o}static calculateTotalDiscount(u){return!u||!Array.isArray(u)?0:u.reduce((o,m)=>o+parseFloat(m.discount_amount||0),0)}}function Ze({isOpen:r,onClose:u,suggestion:o,onAddToCart:m,productName:w}){const[j,x]=p.useState(!1);if(!r||!o)return null;const y=async()=>{x(!0);try{console.log("Modal - suggestion data:",o),await m(o),u()}catch(c){console.error("Error adding promotional item:",c)}finally{x(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity duration-300",onClick:u}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-auto transform transition-all duration-300 scale-100",children:[e.jsx("button",{onClick:u,className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100",children:e.jsx(Pe,{size:20})}),e.jsxs("div",{className:"text-center pt-8 pb-6 px-6",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("div",{className:"animate-bounce",children:e.jsx(xe,{size:48,className:"customtext-primary mx-auto"})}),e.jsx(re,{size:20,className:"absolute -top-2 -right-2 text-yellow-400 animate-pulse"}),e.jsx(re,{size:16,className:"absolute -bottom-1 -left-2 text-yellow-400 animate-pulse delay-300"})]}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-2",children:"ðŸŽ‰ Â¡PromociÃ³n Especial!"}),e.jsx("p",{className:"text-gray-600",children:"Tienes un producto que califica para una promociÃ³n"})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Al tener  ",e.jsxs("span",{className:"font-semibold customtext-primary",children:[o.current_quantity," ",w]})," en tu carrito"]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("p",{className:"font-bold text-lg customtext-primary mb-1",children:o.rule_name}),e.jsx("p",{className:"text-sm customtext-neutral-light",children:o.description||"ObtÃ©n un producto gratis"})]})]})}),e.jsx("div",{className:"border-2 border-dashed rounded-xl p-4 mb-6 bg-green-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 w-9/12",children:[e.jsx("div",{className:"w-12 h-12  rounded-full flex items-center justify-center",children:e.jsx(xe,{className:"customtext-primary",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold customtext-neutral-dark",children:o.item_name}),e.jsxs("p",{className:"text-sm customtext-primary",children:["Cantidad: ",o.suggested_quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold customtext-primary",children:"Â¡GRATIS!"}),e.jsxs("p",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number(o.value||0).toFixed(2)]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:y,disabled:j,className:"w-full bg-primary text-white font-semibold py-3 px-6 rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:transform-none shadow-lg",children:j?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Agregando..."})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(xe,{size:20}),e.jsx("span",{children:"Â¡Agregar Regalo!"})]})}),e.jsx("button",{onClick:u,className:"w-full bg-gray-100 customtext-neutral-light font-medium py-3 px-6 rounded-xl hover:bg-gray-200 transition-colors duration-200",children:"Tal vez despuÃ©s"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"* PromociÃ³n vÃ¡lida mientras tengas los productos requeridos en tu carrito"})]})]})})]})}function et({cart:r,setCart:u,onContinue:o,subTotal:m,envio:w,igv:j,totalFinal:x,openModal:y,automaticDiscounts:c,setAutomaticDiscounts:d,automaticDiscountTotal:t,setAutomaticDiscountTotal:h,totalWithoutDiscounts:f}){const[l,C]=p.useState(c||[]),[P,z]=p.useState(t||0),[L,H]=p.useState(!1),[ge,J]=p.useState([]),[X,V]=p.useState([]),[B,U]=p.useState(!1),[Q,ne]=p.useState(null),[b,O]=p.useState(null),G=r.length===0;p.useEffect(()=>{if(r.length>0&&m>0)W();else{const n=[];C(n),z(0),J([]),V([]),d&&d(n),h&&h(0)}},[r,m]);const W=async()=>{H(!0);try{console.log("ðŸ›’ CartStep applying discounts:",{cart:r,subTotal:m,totalWithoutDiscounts:f});const n=await je.applyToCart(r,f);if(n.success&&n.data){const g=je.formatDiscounts(n.data.applied_discounts),E=n.data.total_discount||0,R=je.getFreeItems(n.data.applied_discounts),v=[];n.data.applied_discounts.forEach(T=>{T.suggested_items&&Array.isArray(T.suggested_items)&&v.push(...T.suggested_items)}),C(g),z(E),J(R),V(v),d&&d(g),h&&h(E)}else{console.error("âŒ Discount application failed:",n.error);const g=[],E=0;C(g),z(E),J([]),V([]),d&&d(g),h&&h(E)}}catch(n){console.error("Error applying discount rules:",n);const g=[],E=0;C(g),z(E),J([]),V([]),d&&d(g),h&&h(E)}finally{H(!1)}},K=n=>X.some(g=>g.item_id===n||g.triggering_item_id===n),te=n=>X.find(g=>g.item_id===n||g.triggering_item_id===n),Y=n=>{const g=te(n.id);g&&(ne(g),O(n),U(!0))},se=async n=>{try{console.log("CartStep - handleAddPromotionalItem received:",n),console.log("CartStep - current cart:",r),u(g=>{console.log("CartStep - old cart before update:",g);const E=g.findIndex(R=>(R.item_id||R.id)===n.item_id);if(console.log("CartStep - existingItemIndex:",E),E!==-1){const R=[...g],v=n.quantity||n.suggested_quantity||1;return console.log("CartStep - adding quantity:",v),R[E].quantity+=v,console.log("CartStep - updated cart:",R),R}else{console.log("CartStep - item not found, creating new product");const R={id:n.item_id,name:n.item_name,quantity:n.quantity||n.suggested_quantity||1,price:n.value||0,final_price:n.value||0,image:n.item_image||"default.jpg",brand:{name:n.item_brand||"N/A"},sku:n.item_sku||"PROMO",stock:999};return[...g,R]}}),setTimeout(()=>{W()},100)}catch(g){console.error("Error adding promotional item:",g)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:G?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito estÃ¡ vacÃ­o"}),e.jsx("p",{className:"text-gray-500",children:"Â¡Explora nuestros productos y encuentra algo especial!"})]}):r.map((n,g)=>e.jsx(Qe,{...n,setCart:u,hasPromotion:K(n.id),onPromotionClick:Y},g))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(m)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(j)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"EnvÃ­o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(w)]})]}),L&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!L&&l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6  customtext-neutral-dark mb-2",children:"ðŸŽ‰ Descuentos aplicados:"}),l.map((n,g)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[n.name,n.description&&e.jsx("span",{className:"text-xs font-semibold block",children:n.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",k(n.amount)]})]},g)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",k(P)]})]})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",k(x)]})]}),P>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:["S/ ",k(f||x+P)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras S/ ",k(P)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(he,{onClick:o,className:"w-full",disabled:G,children:G?"Carrito VacÃ­o":"Continuar Compra"}),e.jsx(_e,{href:"/",className:"w-full",children:G?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas losÂ ",e.jsx("a",{href:"#",onClick:()=>y(1),className:"customtext-primary font-bold",children:"TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestraÂ ",e.jsx("a",{href:"#",onClick:()=>y(0),className:"customtext-primary font-bold",children:"PolÃ­tica de Privacidad"}),"."]})})]})]}),e.jsx(Ze,{isOpen:B,onClose:()=>U(!1),suggestion:Q,onAddToCart:se,productName:(b==null?void 0:b.name)||""})]})}function tt(){let r="";for(let u=0;u<12;u++){const o=Math.floor(Math.random()*10);r+=o}return r}const st=r=>new Promise((u,o)=>{var m;try{console.log(r);const w=tt(r.email);console.log(w);let j=!1;window.Culqi.publicKey=ae.CULQI_PUBLIC_KEY;const x=parseFloat(r.amount.toFixed(2)),y=Math.round(x*100);console.log("ðŸ’° Configurando Culqi:"),console.log("   - Monto original:",r.amount),console.log("   - Monto redondeado (soles):",x),console.log("   - Monto en cÃ©ntimos:",y),console.log("   - Email:",r.email),window.Culqi.settings({title:ae.APP_NAME,email:r.email,currency:"PEN",amount:y,order:`${w}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:ae.APP_URL+"/assets/resources/logo.png",bannerColor:ae.APP_COLOR_PRIMARY,buttonBackground:ae.APP_COLOR_PRIMARY}});const c=(m=window.Culqi)==null?void 0:m.close;c&&(window.Culqi.close=function(){return!window.Culqi.token&&!j&&(console.log("ðŸš« Modal de Culqi cerrado sin completar el pago"),o("Pago cancelado por el usuario")),c.apply(this,arguments)}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){o("No se obtuvo un token de Culqi");return}j=!0;const t=window.Culqi.token.id;console.log("âœ… Token generado:",t),r={...r,token:t,orderNumber:w},console.log("_request actualizado",r);const{status:h,result:f}=await Ue.Fetch("./api/pago",{method:"POST",body:JSON.stringify(r)});h||console.log((f==null?void 0:f.message)||"Error en el pago"),window.Culqi.close(),$.success("Â¡Pago exitoso!",{description:"Tu pago se procesÃ³ correctamente. Pronto recibirÃ¡s la confirmaciÃ³n de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),u(f)}catch(t){$.error("Â¡Error en el Pago!",{description:t.message,duration:3e3,position:"top-right",richColors:!0}),o(t.message||"Error en el pago")}},window.addEventListener("message",function(t){t.data==="culqi_closed"&&o("Pago cancelado por el usuario")});const d=t=>{t.key==="Escape"&&!j&&(console.log("ðŸš« Modal de Culqi cerrado con Escape"),o("Pago cancelado por el usuario"))};document.addEventListener("keydown",d),setTimeout(()=>{document.removeEventListener("keydown",d)},3e5),document.addEventListener("culqi.error",function(t){var h,f;$.error("Â¡Error en Culqi!",{description:((h=t.detail)==null?void 0:h.message)||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),o(((f=t.detail)==null?void 0:f.message)||"Error desconocido")})}catch(w){$.error("Â¡Error en la integraciÃ³n con Culqi!",{description:w.message,duration:3e3,position:"top-right",richColors:!0}),o("Error en la integraciÃ³n con Culqi")}});function at({cart:r,setSale:u,setCode:o,setDelivery:m,setCart:w,onContinue:j,noContinue:x,subTotal:y,igv:c,totalFinal:d,user:t,setEnvio:h,envio:f,ubigeos:l=[],openModal:C,setCouponDiscount:P,setCouponCode:z,automaticDiscounts:L=[],automaticDiscountTotal:H=0,totalWithoutDiscounts:ge,conversionScripts:J,setConversionScripts:X,onPurchaseComplete:V}){var Ce,Se;const[B,U]=p.useState(null),[Q,ne]=p.useState(null);L.reduce((a,s)=>s.free_items&&Array.isArray(s.free_items)?[...a,...s.free_items]:a,[]);const[b,O]=p.useState({name:(t==null?void 0:t.name)||"",lastname:(t==null?void 0:t.lastname)||"",email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",department:(t==null?void 0:t.department)||"",province:(t==null?void 0:t.province)||"",district:(t==null?void 0:t.district)||"",address:(t==null?void 0:t.address)||"",number:(t==null?void 0:t.number)||"",comment:"",reference:(t==null?void 0:t.reference)||"",ubigeo:(t==null?void 0:t.ubigeo)||null});p.useEffect(()=>{if(t!=null&&t.ubigeo&&(t!=null&&t.district)&&(t!=null&&t.province)&&(t!=null&&t.department)){const a={value:t.ubigeo,label:`${t.district}, ${t.province}, ${t.department}`,data:{reniec:t.ubigeo,departamento:t.department,provincia:t.province,distrito:t.district}};ne(a),U(a),we(a)}},[t]);const[G,W]=p.useState(!1),[K,te]=p.useState(!1),[Y,se]=p.useState([]),[n,g]=p.useState(null),[E,R]=p.useState(null),[v,T]=p.useState({}),[me,_]=p.useState(""),[M,oe]=p.useState(""),[F,ie]=p.useState(null),[le,ve]=p.useState(0),[pe,Ne]=p.useState(!1),[ye,ce]=p.useState(""),qe=a=>{var i,S,N;const s=["name","lastname","email","phone","ubigeo","address","shipping"];for(const q of s)if(a[q]){let A=null,I=!1;if(q==="ubigeo"?A=((S=(i=document.querySelector('[name="ubigeo"]'))==null?void 0:i.parentElement)==null?void 0:S.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):q==="shipping"?A=((N=document.querySelector('input[name="shipping"]'))==null?void 0:N.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(A=document.querySelector(`[name="${q}"]`),I=!0),A){A.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),I&&setTimeout(()=>{try{A.focus(),A.tagName==="INPUT"&&A.type==="text"&&A.select()}catch(Me){console.warn("No se pudo enfocar el elemento:",Me)}},600),Ee(A);break}}},Ee=a=>{if(!a)return;const s=document.createElement("div");if(s.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const S=document.createElement("style");S.id="error-highlight-styles",S.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(S)}const i=a.style.position;(!i||i==="static")&&(a.style.position="relative"),a.appendChild(s),setTimeout(()=>{s.parentNode&&(s.parentNode.removeChild(s),(!i||i==="static")&&(a.style.position=i))},1200)},we=async a=>{if(!a)return;T(i=>({...i,ubigeo:""}));const{data:s}=a;O(i=>({...i,department:s.departamento,province:s.provincia,district:s.distrito,ubigeo:s.reniec})),W(!0);try{const i=await Re.getShippingCost({ubigeo:s.reniec}),S=[];i.data.is_free?(S.push({type:"free",price:0,description:i.data.standard.description,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics}),i.data.express.price>0&&S.push({type:"express",price:i.data.express.price,description:i.data.express.description,deliveryType:i.data.express.type,characteristics:i.data.express.characteristics})):i.data.is_agency?S.push({type:"agency",price:0,description:i.data.agency.description,deliveryType:i.data.agency.type,characteristics:i.data.agency.characteristics}):S.push({type:"standard",price:i.data.standard.price,description:i.data.standard.description,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics}),se(S),g(S[0].type),h(S[0].price)}catch{$.error("Sin cobertura",{description:"No realizamos envÃ­os a esta ubicaciÃ³n.",icon:e.jsx(be,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),se([]),g(null),h(0)}W(!1)},ke=async a=>{var N,q;if(a.preventDefault(),K)return;if(!t){$.error("Acceso requerido",{description:"Debe iniciar sesiÃ³n para continuar.",icon:e.jsx(Ye,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"});return}const s={},i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,S=/^[0-9]{9}$/;if(b.name.trim()||(s.name="Nombre es requerido"),b.lastname.trim()||(s.lastname="Apellido es requerido"),b.email.trim()?i.test(b.email)||(s.email="Email invÃ¡lido"):s.email="Email es requerido",b.phone.trim()?S.test(b.phone.trim())||(s.phone="TelÃ©fono debe tener exactamente 9 dÃ­gitos"):s.phone="TelÃ©fono es requerido",b.ubigeo||(s.ubigeo="UbicaciÃ³n es requerida"),b.address||(s.address="DirecciÃ³n es requerida"),n||(s.shipping="Seleccione un mÃ©todo de envÃ­o"),Object.keys(s).length>0){T(s);const A=Object.keys(s)[0],I={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",email:(N=s.email)!=null&&N.includes("invÃ¡lido")?"Por favor ingrese un correo electrÃ³nico vÃ¡lido":"Por favor ingrese su correo electrÃ³nico",phone:(q=s.phone)!=null&&q.includes("9 dÃ­gitos")?"El telÃ©fono debe tener exactamente 9 dÃ­gitos":"Por favor ingrese su nÃºmero de telÃ©fono",ubigeo:"Por favor seleccione su ubicaciÃ³n de entrega",address:"Por favor ingrese su direcciÃ³n de entrega",shipping:"Por favor seleccione un mÃ©todo de envÃ­o"};$.error("Complete el campo requerido",{description:I[A],icon:e.jsx(de,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),qe(s);return}te(!0);try{const A={user_id:t.id,...b,fullname:`${b.name} ${b.lastname}`,country:"PerÃº",amount:D(ue),delivery:D(f),cart:r,coupon_id:(F==null?void 0:F.id)||null,coupon_code:(F==null?void 0:F.code)||null,coupon_discount:D(le||0),applied_promotions:L||[],promotion_discount:D(H||0)};console.log("ðŸ“¦ Request completo a enviar:",A),console.log("ðŸ’° Monto final con cupÃ³n:",ue),console.log("ðŸŽŸï¸ Descuento del cupÃ³n:",le),console.log("ðŸšš Costo de envÃ­o:",f);const I=await st(A);I.status?(u(I.sale),m(I.delivery),o(I.code),I.conversion_scripts&&(console.log("Scripts de conversiÃ³n recibidos:",I.conversion_scripts),X(I.conversion_scripts),V&&V(I.sale_id,I.conversion_scripts)),w([]),j()):$.error("Error en el pago",{description:I.message||"Pago rechazado",icon:e.jsx(be,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch{$.error("Lo sentimos, no puede continuar con la compra",{description:"OcurriÃ³ un error al procesar el pedido.",icon:e.jsx(be,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{te(!1)}},Te=p.useCallback(Ge.debounce((a,s)=>{if(a.length<3){s([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(a)}`).then(i=>{if(!i.ok)throw new Error("Error en la respuesta");return i.json()}).then(i=>{const S=i.map(N=>({value:N.reniec,label:`${N.distrito}, ${N.provincia}, ${N.departamento}`,data:{inei:N.inei,reniec:N.reniec,departamento:N.departamento,provincia:N.provincia,distrito:N.distrito}}));s(S)}).catch(i=>{s([])})},300),[]);p.useEffect(()=>{T(a=>{const s={...a};return b.name.trim()&&delete s.name,b.lastname.trim()&&delete s.lastname,b.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b.email)&&delete s.email,b.phone.trim()&&/^[0-9]{9}$/.test(b.phone.trim())&&delete s.phone,b.address.trim()&&delete s.address,b.ubigeo&&delete s.ubigeo,n&&delete s.shipping,s})},[b,n]);const Fe=a=>({control:s=>({...s,border:`1px solid ${a?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:a?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:s=>({...s,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:s=>({...s,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),Ae=async()=>{var a;if(!M.trim()){ce("Ingrese un cÃ³digo de cupÃ³n");return}Ne(!0),ce("");try{const s=[...new Set(r.map(q=>q.category_id).filter(Boolean))],i=r.map(q=>q.id);console.log("Validando cupÃ³n:",{code:M.trim(),cart_total:y,category_ids:s,product_ids:i});const S=await ze.validateCoupon({code:M.trim(),cart_total:y,category_ids:s,product_ids:i});console.log("Respuesta del cupÃ³n:",S);const N=S.data||S;if(N&&N.valid){ie(N.coupon);const q=Math.round(N.discount*100)/100;ve(q),P&&P(q),z&&z(((a=N.coupon)==null?void 0:a.code)||M.trim()),$.success("CupÃ³n aplicado",{description:N.message||"CupÃ³n aplicado correctamente",duration:3e3,position:"top-center"})}else{const q=(N==null?void 0:N.message)||"CupÃ³n no vÃ¡lido";ce(q),$.error("CupÃ³n no vÃ¡lido",{description:q,icon:e.jsx(de,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(s){console.error("Error al validar cupÃ³n:",s),ce("Error al validar el cupÃ³n"),$.error("Error",{description:s.message||"No se pudo validar el cupÃ³n. Intente nuevamente.",icon:e.jsx(de,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{Ne(!1)}},Ie=()=>{ie(null),ve(0),oe(""),ce(""),P&&P(0),z&&z(""),$.success("CupÃ³n removido",{description:"El cupÃ³n ha sido removido de su pedido",duration:2e3,position:"top-center"})},D=a=>{const s=typeof a=="string"?parseFloat(a):a;return parseFloat(s.toFixed(2))},ue=D(d);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:ke,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Z,{name:"name",label:"Nombres",value:b.name,error:v.name,onChange:a=>{O(s=>({...s,name:a.target.value})),a.target.value.trim()&&v.name&&T(s=>({...s,name:""}))},required:!0,className:`border-gray-200 ${v.name?"border-red-500 bg-red-50":""}`}),e.jsx(Z,{name:"lastname",label:"Apellidos",value:b.lastname,error:v.lastname,onChange:a=>{O(s=>({...s,lastname:a.target.value})),a.target.value.trim()&&v.lastname&&T(s=>({...s,lastname:""}))},required:!0,className:`border-gray-200 ${v.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsx(Z,{name:"email",label:"Correo electrÃ³nico",type:"email",value:b.email,error:v.email,onChange:a=>{O(s=>({...s,email:a.target.value})),a.target.value.trim()&&v.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.target.value)&&T(i=>({...i,email:""}))},required:!0,className:`border-gray-200 ${v.email?"border-red-500 bg-red-50":""}`}),e.jsx(Z,{name:"phone",label:"TelÃ©fono",type:"tel",value:b.phone,error:v.phone,onChange:a=>{const s=a.target.value.replace(/\D/g,"");O(i=>({...i,phone:s})),s.length===9&&v.phone&&T(i=>({...i,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${v.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (UbicaciÃ³n de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx($e,{name:"ubigeo",cacheOptions:!0,value:B,loadOptions:Te,onChange:a=>{U(a),we(a),_("")},inputValue:me,onInputChange:(a,{action:s})=>{s==="input-change"&&_(a)},onFocus:()=>{U(null),_("")},onMenuOpen:()=>{B&&(U(null),_(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:a})=>a.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:G,styles:Fe(!!v.ubigeo),formatOptionLabel:({data:a})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:a.distrito}),e.jsxs("div",{className:"text-gray-500",children:[a.provincia,", ",a.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),v.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:v.ubigeo})]}),e.jsx(Z,{name:"address",label:"DirecciÃ³n ",value:b.address,error:v.address,onChange:a=>{O(s=>({...s,address:a.target.value})),a.target.value.trim()&&v.address&&T(s=>({...s,address:""}))},required:!0,className:`border-gray-200 ${v.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Z,{label:"NÃºmero",value:b.number,onChange:a=>O(s=>({...s,number:a.target.value})),className:"border-gray-200"}),e.jsx(Z,{label:"Referencia",value:b.reference,onChange:a=>O(s=>({...s,reference:a.target.value})),className:"border-gray-200"})]}),Y.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"MÃ©todo de envÃ­o"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Y.map(a=>e.jsx(Oe,{title:a.deliveryType,price:a.price,description:a.description,selected:n===a.type,onSelect:()=>{g(a.type),h(a.price),T(s=>({...s,shipping:""}))}},a.type))}),n&&Y.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(Se=(Ce=Y.find(a=>a.type===n))==null?void 0:Ce.characteristics)==null?void 0:Se.map((a,s)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(Ke,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:a})})]},`char-${s}`))})]}),!x&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(_e,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(he,{type:"submit",loading:G,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:r.map(a=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`/storage/images/item/${a.image}`,alt:a.name,className:"w-16 h-16 object-cover rounded-lg",onError:s=>s.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Cantidad: ",a.quantity]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["S/ ",k(a.final_price)]})]})]},a.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",k(D(y))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",k(D(c))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"EnvÃ­o:"}),e.jsxs("span",{children:["S/ ",k(D(f))]})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"Â¿Tienes un cupÃ³n de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu cÃ³digo de cupÃ³n",value:M,onChange:a=>oe(a.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${ye?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":F?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!F||pe}),pe&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),F?e.jsx("button",{type:"button",onClick:Ie,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cupÃ³n",children:e.jsx(de,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:Ae,disabled:pe||!M.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:pe?"Validando...":"Aplicar"})]}),ye&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(de,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:ye})]}),F&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",F.type==="percentage"?`${F.value}%`:`S/${k(F.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:F.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-S/ ",k(D(le))]})})]})})]})}),L&&L.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium customtext-neutral-dark mb-2",children:"ðŸŽ‰ Descuentos automÃ¡ticos aplicados:"}),L.map((a,s)=>e.jsx("div",{className:" border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"customtext-neutral-dark font-semibold text-sm",children:a.name}),a.description&&e.jsx("p",{className:"customtext-neutral-dark text-xs mt-1",children:a.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-neutral-dark font-bold text-base",children:["-S/ ",k(a.amount)]})})]})},s)),H>0&&e.jsx("div",{className:"l p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Total descuentos automÃ¡ticos:"}),e.jsxs("span",{className:"customtext-neutral-dark font-bold text-lg",children:["-S/ ",k(H)]})]})})]})}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",k(D(ue))]})]})}),e.jsx(he,{onClick:ke,className:"w-full mt-6",disabled:K,loading:K,children:K?"Procesando...":`Pagar S/ ${k(D(ue))}`}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas losÂ ",e.jsx("a",{href:"#",onClick:()=>C(1),className:"customtext-primary font-bold",children:"TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestraÂ ",e.jsx("a",{href:"#",onClick:()=>C(0),className:"customtext-primary font-bold",children:"PolÃ­tica de Privacidad"}),"."]})]})]})]})}function rt({cart:r,code:u,delivery:o,couponDiscount:m=0,couponCode:w=null,conversionScripts:j=null,automaticDiscounts:x=[],automaticDiscountTotal:y=0}){const c=r.reduce((l,C)=>{const P=C.final_price;return l+P*C.quantity},0),d=parseFloat((c/1.18).toFixed(2)),t=parseFloat((c-d).toFixed(2)),f=parseFloat(d)+parseFloat(t)+parseFloat(o)-m-y;return p.useEffect(()=>{if(j){console.log("Executing conversion scripts...");try{if(j.head){const l=document.createElement("script");l.innerHTML=j.head,document.head.appendChild(l)}if(j.body){const l=document.createElement("script");l.innerHTML=j.body,document.body.appendChild(l)}console.log("Conversion scripts executed successfully")}catch(l){console.error("Error executing conversion scripts:",l)}}},[j]),e.jsx(ee.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(ee.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(ee.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"âœ“"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"Â¡Gracias por tu compra! ðŸŽ‰"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(ee.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"CÃ³digo de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${u}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:r.map((l,C)=>e.jsx(ee.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:C*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:`/storage/images/item/${l.image}`,alt:l.name,className:"w-24 h-24 object-cover rounded-lg",onError:P=>P.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-xl lg:w-8/12 line-clamp-3",children:l.name}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:["S/ ",k(l.final_price*l.quantity)]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:l.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:l.quantity})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:l.sku})]})]})]})]})},C))}),e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[[{label:"Subtotal",value:d},{label:"IGV",value:t},{label:"EnvÃ­o",value:o}].map((l,C)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:l.label}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(l.value)]})]},C)),m>0&&w&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark text-start",children:["CupÃ³n: ",e.jsx("br",{className:"lg:hidden"}),e.jsxs("span",{className:"font-semibold text-xs lg:text-base",children:["(",w,")"]})]}),e.jsxs("span",{className:"font-semibold",children:["-S/ ",k(m)]})]}),y>0&&x.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6 customtext-neutral-dark mb-2",children:"ðŸŽ‰ Descuentos aplicados:"}),x.map((l,C)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[l.name,l.description&&e.jsx("span",{className:"text-xs font-semibold block",children:l.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",k(l.amount)]})]},C)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",k(y)]})]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",k(f)]})]})})]}),e.jsx(ee.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(he,{href:"/catalogo",className:"w-full mx-auto md:w-auto",children:"Seguir Comprando"})})]})]})})})}const nt=()=>{const r=p.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),u=(c,d={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[c],content_type:"product",content_name:d.name||"",value:d.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:d.price||0,items:[{item_id:c,item_name:d.name||"",category:d.category||"",price:d.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:c,content_type:"product",content_name:d.name||"",value:d.price||0,currency:"PEN"}),console.log("âœ… ProductView tracked for product:",c))},o=async(c,d=1,t={})=>{var h;if(!(typeof window>"u"))try{const l=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((h=document.querySelector('meta[name="csrf-token"]'))==null?void 0:h.content)||""},body:JSON.stringify({product_id:c,quantity:d,...t})})).json();l.success&&l.tracking_scripts&&(x(l.tracking_scripts),console.log("âœ… AddToCart tracked successfully"))}catch(f){console.error("âŒ Error tracking AddToCart:",f)}},m=async(c,d)=>{var t;if(!(typeof window>"u"||r.current.hasTrackedInitiateCheckout))try{r.current.hasTrackedInitiateCheckout=!0;const f=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""},body:JSON.stringify({cart_items:c.map(l=>({product_id:l.id,name:l.name,price:l.final_price||l.price,quantity:l.quantity,subtotal:(l.final_price||l.price)*l.quantity}))})})).json();f.success&&f.tracking_scripts&&(x(f.tracking_scripts),console.log("âœ… InitiateCheckout tracked successfully"))}catch(h){console.error("âŒ Error tracking InitiateCheckout:",h),r.current.hasTrackedInitiateCheckout=!1}},w=(c,d)=>{typeof window>"u"||(d?x(d):fetch(`/api/tracking/purchase/${c}`).then(t=>t.text()).then(t=>{t&&(x(t),console.log("âœ… Purchase tracked successfully"))}).catch(t=>{console.error("âŒ Error tracking Purchase:",t)}))},j=(c,d=[])=>{if(typeof window>"u"||r.current.hasTrackedPageView)return;r.current.hasTrackedPageView=!0;const t=d.reduce((h,f)=>h+(f.final_price||f.price)*f.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),c===1&&d.length>0&&window.fbq("track","AddToCart",{content_ids:d.map(h=>h.id),content_type:"product",value:t,currency:"PEN",num_items:d.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${c}`,page_location:window.location.href}),c===1&&d.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:t,items:d.map(h=>{var f;return{item_id:h.id,item_name:h.name,category:((f=h.category)==null?void 0:f.name)||"Sin categorÃ­a",quantity:h.quantity,price:h.final_price||h.price}})})),console.log(`âœ… Checkout PageView tracked - Step ${c}`)},x=c=>{if(typeof window>"u"||!c)return;const d=document.createElement("div");d.innerHTML=c,d.querySelectorAll("script").forEach(h=>{const f=document.createElement("script");f.textContent=h.textContent,document.head.appendChild(f),setTimeout(()=>{f.parentNode&&f.parentNode.removeChild(f)},100)})};return{trackProductView:u,trackAddToCart:o,trackInitiateCheckout:m,trackPurchase:w,trackCheckoutPageView:j,resetTracking:()=>{r.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};function Gt({cart:r,setCart:u,user:o,ubigeos:m=[],items:w,generals:j}){const[x,y]=p.useState(1),c=r.reduce((_,M)=>_+M.final_price*M.quantity,0),{trackCheckoutPageView:d,trackInitiateCheckout:t,trackPurchase:h,resetTracking:f}=nt(),l=parseFloat((c/1.18).toFixed(2)),C=parseFloat((c-l).toFixed(2)),[P,z]=p.useState(0),[L,H]=p.useState(0),[ge,J]=p.useState(null),[X,V]=p.useState([]),[B,U]=p.useState(0),Q=l+C+parseFloat(P),ne=L+B,b=Math.max(0,Q-ne),[O,G]=p.useState([]),[W,K]=p.useState([]),[te,Y]=p.useState([]),[se,n]=p.useState(null);p.useEffect(()=>(d(x,r),()=>f()),[]),p.useEffect(()=>{d(x,r),x===2&&t(r,b)},[x]),p.useEffect(()=>{const _=document.createElement("script");return _.src=ae.CULQI_API,_.async=!0,_.onload=()=>{window.culqi=function(){window.Culqi.token||window.Culqi.order}},document.body.appendChild(_),()=>document.body.removeChild(_)},[]);const g=_=>{y(_),window.scrollTo({top:0,behavior:"smooth"})},E={privacy_policy:"PolÃ­ticas de privacidad",terms_conditions:"TÃ©rminos y condiciones",saleback_policy:"PolÃ­ticas de devolucion y cambio"},[R,v]=p.useState(null),T=_=>v(_),me=()=>v(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${x===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:x>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${x>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${x>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"EnvÃ­o"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:x>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${x===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${x===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"ConfirmaciÃ³n"})]})]})}),x===1&&e.jsx(et,{cart:r,setCart:u,onContinue:()=>g(2),subTotal:l,envio:P,igv:C,totalFinal:b,openModal:T,automaticDiscounts:X,setAutomaticDiscounts:V,automaticDiscountTotal:B,setAutomaticDiscountTotal:U,totalWithoutDiscounts:Q}),x===2&&e.jsx(at,{items:w,setCode:K,setDelivery:Y,cart:r,setSale:G,setCart:u,onContinue:()=>g(3),noContinue:()=>g(1),subTotal:l,envio:P,setEnvio:z,igv:C,totalFinal:b,user:o,ubigeos:m,openModal:T,setCouponDiscount:H,setCouponCode:J,automaticDiscounts:X,automaticDiscountTotal:B,totalWithoutDiscounts:Q}),x===3&&e.jsx(rt,{code:W,delivery:te,cart:O,subTotal:l,envio:P,igv:C,totalFinal:b,couponDiscount:L,couponCode:ge,automaticDiscounts:X,automaticDiscountTotal:B,totalWithoutDiscounts:Q,conversionScripts:se,setConversionScripts:n,onPurchaseComplete:(_,M)=>{h(_,M)}})]}),Object.keys(E).map((_,M)=>{var ie;const oe=E[_],F=((ie=j.find(le=>le.correlative==_))==null?void 0:ie.description)??"";return e.jsxs(He,{isOpen:R===M,onRequestClose:me,contentLabel:oe,className:"absolute left-1/2 -translate-x-1/2 bg-white p-6 rounded-xl shadow-lg w-[95%] max-w-4xl my-8",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",children:[e.jsx("button",{onClick:me,className:"float-right text-red-500 hover:text-red-700 transition-all duration-300 ",children:e.jsx(Pe,{width:"2rem",strokeWidth:"4px"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:oe}),e.jsx(Xe,{className:"prose",html:F})]},M)})]})}export{Gt as default};
