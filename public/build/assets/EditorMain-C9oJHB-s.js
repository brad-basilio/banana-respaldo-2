import{j as o}from"./AboutSimple-Cf8x2fCZ.js";import{t as Y}from"./index-BJa4kPFi.js";import{r as s}from"./index-BH53Isel.js";import{e as Le}from"./index-BSWw-p5k.js";import{c as Me}from"./createLucideIcon-Cy5Ya80P.js";import{C as Ee}from"./copy-6OEekgvq.js";import{T as Pe}from"./trash-2-DK1wnsDn.js";import"./TextElement-CTWCUpKD.js";import{U as Fe}from"./upload-qgEr5bIl.js";import"./index-yBjzXJbu.js";import"./index-fRpqIG3j.js";import"./index-B6ujFmsw.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Me("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=Me("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=Me("Replace",[["path",{d:"M14 4a2 2 0 0 1 2-2",key:"1w2hp7"}],["path",{d:"M16 10a2 2 0 0 1-2-2",key:"shjach"}],["path",{d:"M20 2a2 2 0 0 1 2 2",key:"188mtx"}],["path",{d:"M22 8a2 2 0 0 1-2 2",key:"ddf4tu"}],["path",{d:"m3 7 3 3 3-3",key:"x25e72"}],["path",{d:"M6 10V5a3 3 0 0 1 3-3h1",key:"3y3t5z"}],["rect",{x:"2",y:"14",width:"8",height:"8",rx:"2",key:"4rksxw"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=Me("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),Ye=s.createContext({dragDropManager:void 0});function J(e,t,...r){if(We()&&t===void 0)throw new Error("invariant requires an error message argument");if(!e){let i;if(t===void 0)i=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let l=0;i=new Error(t.replace(/%s/g,function(){return r[l++]})),i.name="Invariant Violation"}throw i.framesToPop=1,i}}function We(){return typeof process<"u"&&!0}const re=typeof window<"u"?s.useLayoutEffect:s.useEffect;function Ve(e,t,r){const[i,l]=s.useState(()=>t(e)),f=s.useCallback(()=>{const d=t(e);Le(i,d)||(l(d),r&&r())},[i,e,r]);return re(f),[i,f]}function qe(e,t,r){const[i,l]=Ve(e,t,r);return re(function(){const d=e.getHandlerId();if(d!=null)return e.subscribeToStateChange(l,{handlerIds:[d]})},[e,l]),i}function Ne(e,t,r){return qe(t,e||(()=>({})),()=>r.reconnect())}function je(e,t){const r=[];return typeof e!="function"&&r.push(e),s.useMemo(()=>typeof e=="function"?e():e,r)}function Ue(e){return s.useMemo(()=>e.hooks.dragSource(),[e])}function Ge(e){return s.useMemo(()=>e.hooks.dragPreview(),[e])}let Ce=!1,Ie=!1;class Ke{receiveHandlerId(t){this.sourceId=t}getHandlerId(){return this.sourceId}canDrag(){J(!Ce,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Ce=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{Ce=!1}}isDragging(){if(!this.sourceId)return!1;J(!Ie,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Ie=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{Ie=!1}}subscribeToStateChange(t,r){return this.internalMonitor.subscribeToStateChange(t,r)}isDraggingSource(t){return this.internalMonitor.isDraggingSource(t)}isOverTarget(t,r){return this.internalMonitor.isOverTarget(t,r)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(t){return this.internalMonitor.subscribeToOffsetChange(t)}canDragSource(t){return this.internalMonitor.canDragSource(t)}canDropOnTarget(t){return this.internalMonitor.canDropOnTarget(t)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(t){this.sourceId=null,this.internalMonitor=t.getMonitor()}}let Se=!1;class _e{receiveHandlerId(t){this.targetId=t}getHandlerId(){return this.targetId}subscribeToStateChange(t,r){return this.internalMonitor.subscribeToStateChange(t,r)}canDrop(){if(!this.targetId)return!1;J(!Se,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return Se=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{Se=!1}}isOver(t){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,t):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(t){this.targetId=null,this.internalMonitor=t.getMonitor()}}function Je(e,t,r){const i=r.getRegistry(),l=i.addTarget(e,t);return[l,()=>i.removeTarget(l)]}function Ze(e,t,r){const i=r.getRegistry(),l=i.addSource(e,t);return[l,()=>i.removeSource(l)]}function Te(e,t,r,i){let l;if(l!==void 0)return!!l;if(e===t)return!0;if(typeof e!="object"||!e||typeof t!="object"||!t)return!1;const f=Object.keys(e),d=Object.keys(t);if(f.length!==d.length)return!1;const C=Object.prototype.hasOwnProperty.bind(t);for(let M=0;M<f.length;M++){const I=f[M];if(!C(I))return!1;const A=e[I],k=t[I];if(l=void 0,l===!1||l===void 0&&A!==k)return!1}return!0}function ke(e){return e!==null&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Qe(e){if(typeof e.type=="string")return;const t=e.type.displayName||e.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${t} into a <div>, or turn it into a drag source or a drop target itself.`)}function et(e){return(t=null,r=null)=>{if(!s.isValidElement(t)){const f=t;return e(f,r),f}const i=t;return Qe(i),tt(i,r?f=>e(f,r):e)}}function $e(e){const t={};return Object.keys(e).forEach(r=>{const i=e[r];if(r.endsWith("Ref"))t[r]=e[r];else{const l=et(i);t[r]=()=>l}}),t}function Oe(e,t){typeof e=="function"?e(t):e.current=t}function tt(e,t){const r=e.ref;return J(typeof r!="string","Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),r?s.cloneElement(e,{ref:i=>{Oe(r,i),Oe(t,i)}}):s.cloneElement(e,{ref:t})}class rt{receiveHandlerId(t){this.handlerId!==t&&(this.handlerId=t,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(t){this.dragSourceOptionsInternal=t}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(t){this.dragPreviewOptionsInternal=t}reconnect(){const t=this.reconnectDragSource();this.reconnectDragPreview(t)}reconnectDragSource(){const t=this.dragSource,r=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return r&&this.disconnectDragSource(),this.handlerId?t?(r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=t,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,t,this.dragSourceOptions)),r):(this.lastConnectedDragSource=t,r):r}reconnectDragPreview(t=!1){const r=this.dragPreview,i=t||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(i&&this.disconnectDragPreview(),!!this.handlerId){if(!r){this.lastConnectedDragPreview=r;return}i&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=r,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,r,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!Te(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!Te(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(t){this.hooks=$e({dragSource:(r,i)=>{this.clearDragSource(),this.dragSourceOptions=i||null,ke(r)?this.dragSourceRef=r:this.dragSourceNode=r,this.reconnectDragSource()},dragPreview:(r,i)=>{this.clearDragPreview(),this.dragPreviewOptions=i||null,ke(r)?this.dragPreviewRef=r:this.dragPreviewNode=r,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=t}}class nt{get connectTarget(){return this.dropTarget}reconnect(){const t=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();t&&this.disconnectDropTarget();const r=this.dropTarget;if(this.handlerId){if(!r){this.lastConnectedDropTarget=r;return}t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=r,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,r,this.dropTargetOptions))}}receiveHandlerId(t){t!==this.handlerId&&(this.handlerId=t,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(t){this.dropTargetOptionsInternal=t}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!Te(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(t){this.hooks=$e({dropTarget:(r,i)=>{this.clearDropTarget(),this.dropTargetOptions=i,ke(r)?this.dropTargetRef=r:this.dropTargetNode=r,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=t}}function ie(){const{dragDropManager:e}=s.useContext(Ye);return J(e!=null,"Expected drag drop context"),e}function it(e,t){const r=ie(),i=s.useMemo(()=>new rt(r.getBackend()),[r]);return re(()=>(i.dragSourceOptions=e||null,i.reconnect(),()=>i.disconnectDragSource()),[i,e]),re(()=>(i.dragPreviewOptions=t||null,i.reconnect(),()=>i.disconnectDragPreview()),[i,t]),i}function ot(){const e=ie();return s.useMemo(()=>new Ke(e),[e])}class st{beginDrag(){const t=this.spec,r=this.monitor;let i=null;return typeof t.item=="object"?i=t.item:typeof t.item=="function"?i=t.item(r):i={},i??null}canDrag(){const t=this.spec,r=this.monitor;return typeof t.canDrag=="boolean"?t.canDrag:typeof t.canDrag=="function"?t.canDrag(r):!0}isDragging(t,r){const i=this.spec,l=this.monitor,{isDragging:f}=i;return f?f(l):r===t.getSourceId()}endDrag(){const t=this.spec,r=this.monitor,i=this.connector,{end:l}=t;l&&l(r.getItem(),r),i.reconnect()}constructor(t,r,i){this.spec=t,this.monitor=r,this.connector=i}}function at(e,t,r){const i=s.useMemo(()=>new st(e,t,r),[t,r]);return s.useEffect(()=>{i.spec=e},[e]),i}function lt(e){return s.useMemo(()=>{const t=e.type;return J(t!=null,"spec.type must be defined"),t},[e])}function ct(e,t,r){const i=ie(),l=at(e,t,r),f=lt(e);re(function(){if(f!=null){const[C,M]=Ze(f,l,i);return t.receiveHandlerId(C),r.receiveHandlerId(C),M}},[i,t,r,l,f])}function He(e,t){const r=je(e);J(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const i=ot(),l=it(r.options,r.previewOptions);return ct(r,i,l),[Ne(r.collect,i,l),Ue(l),Ge(l)]}function dt(e){return s.useMemo(()=>e.hooks.dropTarget(),[e])}function ut(e){const t=ie(),r=s.useMemo(()=>new nt(t.getBackend()),[t]);return re(()=>(r.dropTargetOptions=e||null,r.reconnect(),()=>r.disconnectDropTarget()),[e]),r}function gt(){const e=ie();return s.useMemo(()=>new _e(e),[e])}function ht(e){const{accept:t}=e;return s.useMemo(()=>(J(e.accept!=null,"accept must be defined"),Array.isArray(t)?t:[t]),[t])}class pt{canDrop(){const t=this.spec,r=this.monitor;return t.canDrop?t.canDrop(r.getItem(),r):!0}hover(){const t=this.spec,r=this.monitor;t.hover&&t.hover(r.getItem(),r)}drop(){const t=this.spec,r=this.monitor;if(t.drop)return t.drop(r.getItem(),r)}constructor(t,r){this.spec=t,this.monitor=r}}function ft(e,t){const r=s.useMemo(()=>new pt(e,t),[t]);return s.useEffect(()=>{r.spec=e},[e]),r}function mt(e,t,r){const i=ie(),l=ft(e,t),f=ht(e);re(function(){const[C,M]=Je(f,l,i);return t.receiveHandlerId(C),r.receiveHandlerId(C),M},[i,t,l,r,f.map(d=>d.toString()).join("|")])}function yt(e,t){const r=je(e),i=gt(),l=ut(r.options);return mt(r,i,l),[Ne(r.collect,i,l),dt(l)]}const ze=[{id:"none",name:"Sin máscara",class:"",category:"Básicas"},{id:"circle",name:"Círculo",class:"mask-circle",category:"Básicas"},{id:"rounded",name:"Redondeado",class:"mask-rounded",category:"Básicas"},{id:"star",name:"Estrella",class:"mask-star-2",category:"Formas"},{id:"hexagon",name:"Hexágono",class:"mask-hexagon",category:"Formas"},{id:"triangle",name:"Triángulo",class:"mask-triangle",category:"Formas"},{id:"diamond",name:"Diamante",class:"mask-diamond",category:"Formas"},{id:"polaroid",name:"Polaroid",class:"mask-polaroid",category:"Fotográficos"},{id:"vintage",name:"Vintage",class:"mask-vintage",category:"Fotográficos"},{id:"diagonal",name:"Diagonal",class:"mask-diagonal",category:"Fotográficos"},{id:"frame",name:"Marco",class:"mask-frame",category:"Fotográficos"},{id:"blob1",name:"Mancha 1",class:"mask-blob1",category:"Creativas"},{id:"blob2",name:"Mancha 2",class:"mask-blob2",category:"Creativas"},{id:"blob3",name:"Mancha 3",class:"mask-blob3",category:"Creativas"},{id:"rounded-lg",name:"Redondeado grande",class:"mask-rounded-lg",category:"Básicas"},{id:"rounded-rect",name:"Rectángulo redondeado",class:"mask-rounded-rect",category:"Básicas"}];function xt({element:e,isSelected:t,onSelect:r,onUpdate:i,onDelete:l,availableMasks:f=[],workspaceSize:d={width:800,height:600}}){var De,ve,se,ae,le,ce,de,ue,ge,he,pe,fe,me,ye,xe,be,g,E;const[{isDragging:C},M]=He(()=>({type:"IMAGE_ELEMENT",item:{id:e.id},collect:n=>({isDragging:!!n.isDragging()})})),I=s.useRef(null),A=s.useRef(null),k=s.useCallback((n,c)=>typeof n=="number"?n<=1?n*c:n:0,[]),h=s.useCallback((n,c)=>typeof n=="number"&&c>0?n>1?Math.min(n/c,1):n:0,[]),w={x:Math.max(0,k(((De=e.position)==null?void 0:De.x)||0,d.width)),y:Math.max(0,k(((ve=e.position)==null?void 0:ve.y)||0,d.height))},D={width:Math.max(50,(se=e.size)!=null&&se.width?k(e.size.width,d.width):200),height:Math.max(50,(ae=e.size)!=null&&ae.height?k(e.size.height,d.height):200)},[B,Z]=s.useState(!1),[H,q]=s.useState(null),[u,m]=s.useState(null),[a,O]=s.useState({mouseX:0,mouseY:0,elementX:0,elementY:0,elementWidth:0,elementHeight:0}),[T,b]=s.useState(!1),[N,W]=s.useState({x:0,y:0});s.useEffect(()=>{var n,c,p,$,S,x,y,P,R,V,_,U;if(A.current&&e.filters){const X=A.current;X.style.filter=`
                brightness(${(((n=e.filters)==null?void 0:n.brightness)??100)/100})
                contrast(${(((c=e.filters)==null?void 0:c.contrast)??100)/100})
                saturate(${(((p=e.filters)==null?void 0:p.saturation)??100)/100})
                sepia(${((($=e.filters)==null?void 0:$.tint)??0)/100})
                hue-rotate(${((S=e.filters)==null?void 0:S.hue)??0}deg)
                blur(${((x=e.filters)==null?void 0:x.blur)??0}px)
            `.replace(/\s+/g," ").trim(),X.style.transform=`scale(${((y=e.filters)==null?void 0:y.scale)??1}) rotate(${((P=e.filters)==null?void 0:P.rotate)??0}deg) ${(R=e.filters)!=null&&R.flipHorizontal?"scaleX(-1)":""} ${(V=e.filters)!=null&&V.flipVertical?"scaleY(-1)":""}`.replace(/\s+/g," ").trim(),X.style.mixBlendMode=((_=e.filters)==null?void 0:_.blendMode)??"normal",X.style.opacity=(((U=e.filters)==null?void 0:U.opacity)??100)/100,X.style.willChange="filter, transform, opacity",setTimeout(()=>{X&&(X.style.willChange="auto")},100)}},[e.filters]),s.useEffect(()=>{const n=c=>{var p;t&&(I.current&&I.current.contains(c.target)||c.target.classList.contains("bg-blue-500")||(p=c.target.getAttribute("title"))!=null&&p.includes("Redimensionar")||r==null||r(null))};return t&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[t,r]);const v={filter:`
            brightness(${(((le=e.filters)==null?void 0:le.brightness)??100)/100})
            contrast(${(((ce=e.filters)==null?void 0:ce.contrast)??100)/100})
            saturate(${(((de=e.filters)==null?void 0:de.saturation)??100)/100})
            sepia(${(((ue=e.filters)==null?void 0:ue.tint)??0)/100})
            hue-rotate(${((ge=e.filters)==null?void 0:ge.hue)??0}deg)
            blur(${Math.max(((he=e.filters)==null?void 0:he.blur)??0,((pe=e.filters)==null?void 0:pe.gaussianBlur)??0)}px)
        `.replace(/\s+/g," ").trim(),transform:`scale(${((fe=e.filters)==null?void 0:fe.scale)??1}) rotate(${((me=e.filters)==null?void 0:me.rotate)??0}deg) ${(ye=e.filters)!=null&&ye.flipHorizontal?"scaleX(-1)":""} ${(xe=e.filters)!=null&&xe.flipVertical?"scaleY(-1)":""}`.replace(/\s+/g," ").trim(),mixBlendMode:((be=e.filters)==null?void 0:be.blendMode)??"normal",opacity:(((g=e.filters)==null?void 0:g.opacity)??100)/100,zIndex:((E=e.filters)==null?void 0:E.zIndex)??1,position:"relative",willChange:"filter, transform, opacity",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",objectFit:"cover",objectPosition:"center",width:"100%",height:"100%"};ze.find(n=>n.id===e.mask)||ze[0];const j=s.useCallback((n,c)=>{t&&(n.stopPropagation(),n.preventDefault(),Z(!0),q("resize"),m(c),O({mouseX:n.clientX,mouseY:n.clientY,elementX:w.x,elementY:w.y,elementWidth:D.width,elementHeight:D.height}))},[t,w,D]),Q=s.useCallback(n=>{!t||n.target.closest(".resize-handle")||(n.stopPropagation(),n.preventDefault(),Z(!0),q("move"),O({mouseX:n.clientX,mouseY:n.clientY,elementX:w.x,elementY:w.y,elementWidth:D.width,elementHeight:D.height}))},[t,w,D]),z=s.useCallback(n=>{if(!B||!a)return;const c=n.clientX-a.mouseX,p=n.clientY-a.mouseY;if(H==="move"){const $=Math.max(0,Math.min(d.width-D.width,a.elementX+c)),S=Math.max(0,Math.min(d.height-D.height,a.elementY+p)),x={position:{x:h($,d.width),y:h(S,d.height)}};i(x)}else if(H==="resize"){const S=a.elementWidth/a.elementHeight;let x=a.elementWidth,y=a.elementHeight,P=a.elementX,R=a.elementY;switch(u){case"nw":x=Math.max(20,a.elementWidth-c),y=Math.max(20,a.elementHeight-p),n.shiftKey&&(y=x/S),P=a.elementX+(a.elementWidth-x),R=a.elementY+(a.elementHeight-y);break;case"n":y=Math.max(20,a.elementHeight-p),R=a.elementY+(a.elementHeight-y);break;case"ne":x=Math.max(20,a.elementWidth+c),y=Math.max(20,a.elementHeight-p),n.shiftKey&&(y=x/S),R=a.elementY+(a.elementHeight-y);break;case"e":x=Math.max(20,a.elementWidth+c);break;case"se":x=Math.max(20,a.elementWidth+c),y=Math.max(20,a.elementHeight+p),n.shiftKey&&(y=x/S);break;case"s":y=Math.max(20,a.elementHeight+p);break;case"sw":x=Math.max(20,a.elementWidth-c),y=Math.max(20,a.elementHeight+p),n.shiftKey&&(y=x/S),P=a.elementX+(a.elementWidth-x);break;case"w":x=Math.max(20,a.elementWidth-c),P=a.elementX+(a.elementWidth-x);break}P=Math.max(0,Math.min(d.width-x,P)),R=Math.max(0,Math.min(d.height-y,R)),x=Math.min(x,d.width-P),y=Math.min(y,d.height-R);const V={position:{x:h(P,d.width),y:h(R,d.height)},size:{width:h(x,d.width),height:h(y,d.height)}};i(V)}},[B,H,a,u,d,D,i,h]),L=s.useCallback(()=>{Z(!1),q(null),m(null)},[]),F=s.useCallback(n=>{n.stopPropagation();const c={width:200,height:200};i({size:{width:h(c.width,d.width),height:h(c.height,d.height)}})},[i,h,d]),G=s.useCallback(n=>{if(!t)return;const c=n.shiftKey?10:1;let p={};switch(n.key){case"ArrowLeft":n.preventDefault(),p.position={x:Math.max(0,h(w.x-c,d.width)),y:h(w.y,d.height)};break;case"ArrowRight":n.preventDefault(),p.position={x:Math.min(1,h(w.x+c,d.width)),y:h(w.y,d.height)};break;case"ArrowUp":n.preventDefault(),p.position={x:h(w.x,d.width),y:Math.max(0,h(w.y-c,d.height))};break;case"ArrowDown":n.preventDefault(),p.position={x:h(w.x,d.width),y:Math.min(1,h(w.y+c,d.height))};break;case"Delete":case"Backspace":n.preventDefault(),l();break;case"Escape":n.preventDefault(),r();break}Object.keys(p).length>0&&i(p)},[t,w,d,h,i,l,r]);s.useEffect(()=>{if(t)return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[t,G]),s.useEffect(()=>{if(B){const n=p=>z(p),c=()=>L();return document.addEventListener("mousemove",n),document.addEventListener("mouseup",c),()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",c)}}},[B,z,L]),s.useEffect(()=>{const n=c=>{T&&!c.target.closest(".context-menu")&&b(!1)};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[T]);const ee=s.useCallback(n=>{I.current=n,M(n)},[M]),te=n=>{n.preventDefault(),n.stopPropagation(),W({x:n.clientX,y:n.clientY}),b(!0)},ne=()=>{const n=document.createElement("input");n.type="file",n.accept="image/*",n.onchange=c=>{if(c.target.files&&c.target.files[0]){const p=new FileReader;p.onload=$=>{var S;(S=$.target)!=null&&S.result&&i({content:$.target.result})},p.readAsDataURL(c.target.files[0])}},n.click(),b(!1)},K=()=>{var c,p;const n={...JSON.parse(JSON.stringify(e)),id:`img-${Date.now()}`,position:{x:Math.min(.9,(((c=e.position)==null?void 0:c.x)||0)+.05),y:Math.min(.9,(((p=e.position)==null?void 0:p.y)||0)+.05)}};i(n,!0),b(!1)},we=()=>{if(B){if(H==="move")return"grabbing";if(H==="resize")return oe(u)}return t?"grab":"pointer"},oe=n=>({n:"n-resize",ne:"ne-resize",e:"e-resize",se:"se-resize",s:"s-resize",sw:"sw-resize",w:"w-resize",nw:"nw-resize"})[n]||"default";return o.jsxs("div",{ref:ee,"data-element-type":"image",className:`absolute ${t?"ring-2 ring-blue-500 ring-opacity-75":""} ${C?"opacity-50":"opacity-100"}`,style:{left:`${w.x}px`,top:`${w.y}px`,width:`${D.width}px`,height:`${D.height}px`,cursor:we(),zIndex:e.zIndex||5,transition:B?"none":"all 0.1s ease-out",pointerEvents:"all",userSelect:"none",transformOrigin:"center"},onClick:n=>{n.stopPropagation(),r()},onMouseDown:Q,onContextMenu:te,onDoubleClick:F,children:[o.jsxs("div",{className:"w-full h-full overflow-hidden relative bg-transparent image-element",style:{clipPath:e.mask==="circle"?"circle(50%)":e.mask==="rounded"||e.mask==="rounded-sm"?"inset(0 round 8%)":e.mask==="rounded-lg"?"inset(0 round 16%)":e.mask==="rounded-rect"?"inset(0 round 12%)":e.mask==="star"?"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)":e.mask==="hexagon"?"polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)":e.mask==="triangle"?"polygon(50% 0%, 0% 100%, 100% 100%)":e.mask==="diamond"?"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)":e.mask==="polaroid"?"inset(5% 5% 15% 5% round 2%)":e.mask==="vintage"?"inset(5% round 5% 5% 10% 5%)":e.mask==="diagonal"?"polygon(0 0, 100% 0, 100% 80%, 0 100%)":e.mask==="frame"?"inset(10% round 10%)":e.mask==="blob1"?'path("M10,0 C15,0 20,5 20,10 C20,15 15,20 10,20 C5,20 0,15 0,10 C0,5 5,0 10,0 Z")':e.mask==="blob2"?'path("M10,0 C15,5 20,10 15,15 C10,20 5,15 0,10 C5,5 5,5 10,0 Z")':e.mask==="blob3"?'path("M10,0 C15,0 20,5 15,10 C20,15 15,20 10,15 C5,20 0,15 5,10 C0,5 5,0 10,0 Z")':"none"},children:[o.jsx("img",{ref:A,src:e.content,alt:"Imagen editada",className:"w-full h-full object-cover select-none workspace-image",style:v,draggable:!1,onLoad:()=>{if(I.current&&(I.current.style.visibility="visible"),A.current&&e.filters){const n=A.current;n.style.filter=v.filter,n.style.transform=v.transform,n.style.mixBlendMode=v.mixBlendMode,n.style.opacity=v.opacity,n.style.zIndex=v.zIndex,n.style.willChange="filter, transform, opacity",setTimeout(()=>{n&&(n.style.willChange="auto")},100)}}}),"                ",t&&!C&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-nw-resize",style:{top:-8,left:-8,zIndex:9999},onMouseDown:n=>j(n,"nw"),title:"Redimensionar desde esquina superior izquierda"}),o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-ne-resize",style:{top:-8,right:-8,zIndex:9999},onMouseDown:n=>j(n,"ne"),title:"Redimensionar desde esquina superior derecha"}),o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-se-resize",style:{bottom:-8,right:-8,zIndex:9999},onMouseDown:n=>j(n,"se"),title:"Redimensionar desde esquina inferior derecha"}),o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-sw-resize",style:{bottom:-8,left:-8,zIndex:9999},onMouseDown:n=>j(n,"sw"),title:"Redimensionar desde esquina inferior izquierda"}),o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-n-resize",style:{top:-8,left:"calc(50% - 8px)",zIndex:9999},onMouseDown:n=>j(n,"n"),title:"Redimensionar verticalmente"}),o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-e-resize",style:{right:-8,top:"calc(50% - 8px)",zIndex:9999},onMouseDown:n=>j(n,"e"),title:"Redimensionar horizontalmente"}),o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-s-resize",style:{bottom:-8,left:"calc(50% - 8px)",zIndex:9999},onMouseDown:n=>j(n,"s"),title:"Redimensionar verticalmente"}),o.jsx("div",{className:"resize-control-handle absolute w-4 h-4 bg-blue-500 border-2 border-white rounded-full shadow-md hover:bg-blue-600 transition-colors cursor-w-resize",style:{left:-8,top:"calc(50% - 8px)",zIndex:9999},onMouseDown:n=>j(n,"w"),title:"Redimensionar horizontalmente"}),B&&o.jsx("div",{className:"resize-manipulation-indicator absolute -inset-2 border-2 border-blue-300 border-dashed rounded animate-pulse",style:{zIndex:9999}})]})]}),T&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0",style:{zIndex:9998},onClick:()=>b(!1)}),o.jsxs("div",{className:"fixed bg-white shadow-xl rounded-lg py-2 w-56 context-menu border border-gray-200",style:{left:`${Math.min(N.x,window.innerWidth-240)}px`,top:`${Math.min(N.y,window.innerHeight-200)}px`,zIndex:9999},onClick:n=>n.stopPropagation(),children:[o.jsx("button",{className:"absolute -top-2 -right-2 bg-white rounded-full p-1 shadow-md hover:bg-gray-100 text-gray-500 z-10",onClick:()=>b(!1),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),o.jsx("div",{className:"px-3 py-2 border-b border-gray-100",children:o.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Opciones de imagen"})}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-3 text-sm text-gray-700 hover:text-blue-700 transition-colors",onClick:ne,children:[o.jsx(Ae,{className:"h-4 w-4"}),"Reemplazar imagen"]}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-green-50 flex items-center gap-3 text-sm text-gray-700 hover:text-green-700 transition-colors",onClick:K,children:[o.jsx(Ee,{className:"h-4 w-4"}),"Duplicar elemento"]}),o.jsx("div",{className:"border-t border-gray-100 my-1"}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-yellow-50 flex items-center gap-3 text-sm text-gray-700 hover:text-yellow-700 transition-colors",onClick:()=>{var n;i({filters:{...e.filters,opacity:Math.max(0,(((n=e.filters)==null?void 0:n.opacity)||100)-20)}}),b(!1)},children:[o.jsx(Re,{className:"h-4 w-4"}),"Reducir opacidad"]}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-purple-50 flex items-center gap-3 text-sm text-gray-700 hover:text-purple-700 transition-colors",onClick:()=>{var n;i({filters:{...e.filters,scale:Math.max(.1,(((n=e.filters)==null?void 0:n.scale)||1)-.1)}}),b(!1)},children:[o.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})}),"Reducir escala"]}),o.jsx("div",{className:"border-t border-gray-100 my-1"}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-red-50 flex items-center gap-3 text-sm text-gray-700 hover:text-red-700 transition-colors",onClick:()=>{l(),b(!1)},children:[o.jsx(Pe,{className:"h-4 w-4"}),"Eliminar imagen"]})]})]})]})}function bt({element:e,isSelected:t,onSelect:r,onUpdate:i,onDelete:l,workspaceSize:f={width:800,height:600}}){var se,ae,le,ce,de,ue,ge,he,pe,fe,me,ye,xe,be;const[d,C]=s.useState(!1),M=s.useRef(null),I=s.useRef(null),[{isDragging:A},k]=He(()=>({type:"TEXT_ELEMENT",item:{id:e.id},collect:g=>({isDragging:!!g.isDragging()})})),[h,w]=s.useState(!1),[D,B]=s.useState({x:0,y:0}),[Z,H]=s.useState(!1),[q,u]=s.useState({x:0,y:0}),[m,a]=s.useState({x:0,y:0}),[O,T]=s.useState(!1),[b,N]=s.useState(0),[W,v]=s.useState(!1),[j,Q]=s.useState(0),z=()=>{C(!1)},L=g=>{i({content:g.target.value})},F=g=>{g.key==="Enter"&&C(!1)},G=g=>{if(!d){g.stopPropagation(),r(),N(Date.now()),v(!1),w(!0);const E=g.currentTarget.parentElement.getBoundingClientRect(),n=e.position.x<=1?e.position.x*E.width:e.position.x,c=e.position.y<=1?e.position.y*E.height:e.position.y;B({x:g.clientX-n,y:g.clientY-c}),a({x:n,y:c}),document.body.style.cursor="grabbing"}},ee=g=>{if(h&&I.current){const E=Date.now();if(E-j<16)return;Q(E),requestAnimationFrame(()=>{if(!I.current)return;const n=I.current.parentElement.getBoundingClientRect(),c=g.clientX-D.x,p=g.clientY-D.y,$=5;!W&&(Math.abs(c-m.x)>$||Math.abs(p-m.y)>$)&&v(!0);const S=n.width-I.current.offsetWidth,x=n.height-I.current.offsetHeight,y=5,P=Math.round(c/y)*y,R=Math.round(p/y)*y,V=Math.max(0,Math.min(P,S)),_=Math.max(0,Math.min(R,x));a({x:V,y:_});const U=V/n.width,X=_/n.height;i({position:{x:U,y:X}})})}},te=g=>{const n=Date.now()-b<200&&!W;w(!1),document.body.style.cursor="",n&&t&&setTimeout(()=>{C(!0),setTimeout(()=>{M.current&&(M.current.focus(),M.current.select())},0)},50)},ne=g=>{g.preventDefault(),g.stopPropagation(),u({x:g.clientX,y:g.clientY}),H(!0)},K=()=>{const g={...JSON.parse(JSON.stringify(e)),id:`text-${Date.now()}`,position:{x:e.position.x<=1?Math.min(e.position.x+.02,.9):e.position.x+10,y:e.position.y<=1?Math.min(e.position.y+.02,.9):e.position.y+10}};i(g,!0),H(!1)};s.useEffect(()=>(h&&(window.addEventListener("mousemove",ee),window.addEventListener("mouseup",te)),()=>{window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",te)}),[h,D]);const we=s.useCallback(g=>{I.current=g,k(g)},[k]),oe=(se=e.style)!=null&&se.textShadow?`${e.style.textShadowX||0}px ${e.style.textShadowY||0}px ${e.style.textShadowBlur||0}px ${e.style.textShadowColor||"rgba(0,0,0,0.5)"}`:"none",ve=(()=>{var E,n,c,p,$,S,x,y,P,R,V,_;const g={...e.style,position:"absolute",cursor:h?"grabbing":O&&!d?"grab":"pointer",textShadow:oe,zIndex:e.zIndex||10,fontFamily:((E=e.style)==null?void 0:E.fontFamily)||"Arial",color:((n=e.style)==null?void 0:n.color)||"#000000",fontWeight:((c=e.style)==null?void 0:c.fontWeight)||"normal",fontStyle:((p=e.style)==null?void 0:p.fontStyle)||"normal",textDecoration:(($=e.style)==null?void 0:$.textDecoration)||"none",textAlign:((S=e.style)==null?void 0:S.textAlign)||"left",backgroundColor:((x=e.style)==null?void 0:x.backgroundColor)||"transparent",padding:((y=e.style)==null?void 0:y.padding)||"8px",borderRadius:((P=e.style)==null?void 0:P.borderRadius)||"0px",border:((R=e.style)==null?void 0:R.border)||"none",opacity:((V=e.style)==null?void 0:V.opacity)!==void 0?e.style.opacity:1,transition:h?"none":"all 0.15s ease-out",willChange:h?"transform":"auto",transform:h?"scale(1.02)":"scale(1)"};if(e.position.x<=1&&e.position.y<=1?(g.left=`${e.position.x*100}%`,g.top=`${e.position.y*100}%`):(g.left=`${e.position.x}px`,g.top=`${e.position.y}px`),(_=e.style)!=null&&_.fontSize){const U=parseFloat(e.style.fontSize);if(U&&f.width){const X=U/800*f.width;g.fontSize=`${Math.max(12,X)}px`}else g.fontSize=e.style.fontSize}else{const U=.02*f.width;g.fontSize=`${Math.max(12,U)}px`}return g})();return s.useEffect(()=>{var E,n;const g=(n=(E=e.style)==null?void 0:E.fontFamily)==null?void 0:n.replace(/'/g,"");if(g&&!document.fonts.check(`12px ${g}`)){const c=new FontFace(g,`local(${g})`);c.load().then(()=>document.fonts.add(c))}},[(ae=e.style)==null?void 0:ae.fontFamily]),o.jsxs("div",{ref:we,"data-element-type":"text","data-element-id":e.id,className:`
                ${t?"ring-2 ring-purple-500 shadow-lg":""} 
                ${A?"opacity-50":"opacity-100"}
                ${h?"ring-2 ring-blue-400 shadow-xl select-none":""}
                ${O&&!d?"ring-1 ring-gray-300":""}
                transition-all duration-150 ease-in-out
            `,style:{...ve,userSelect:h?"none":"auto",pointerEvents:h?"none":"auto"},onClick:g=>{g.stopPropagation(),t||r()},onMouseDown:G,onContextMenu:ne,onMouseEnter:()=>T(!0),onMouseLeave:()=>T(!1),children:[d?o.jsx("input",{ref:M,type:"text",value:e.content,onChange:L,onBlur:z,onKeyDown:F,className:"w-full p-1 border border-gray-300 rounded bg-white",style:{fontFamily:(le=e.style)==null?void 0:le.fontFamily,fontSize:(ce=e.style)==null?void 0:ce.fontSize,fontWeight:(de=e.style)==null?void 0:de.fontWeight,fontStyle:(ue=e.style)==null?void 0:ue.fontStyle,textDecoration:(ge=e.style)==null?void 0:ge.textDecoration,color:(he=e.style)==null?void 0:he.color,textAlign:(pe=e.style)==null?void 0:pe.textAlign,minWidth:"100px"},autoFocus:!0}):o.jsx("div",{className:"p-2 rounded",style:{backgroundColor:((fe=e.style)==null?void 0:fe.backgroundColor)||"transparent",padding:((me=e.style)==null?void 0:me.padding)||"8px",borderRadius:((ye=e.style)==null?void 0:ye.borderRadius)||"0px",border:((xe=e.style)==null?void 0:xe.border)||"none",fontFamily:((be=e.style)==null?void 0:be.fontFamily)||"Arial"},children:e.content||"Editar texto"}),t&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"absolute top-0 left-0 transform translate-x-[-100%] translate-y-[-100%] bg-white rounded-md p-1 shadow-sm border",style:{zIndex:9999},children:o.jsx(Be,{className:"h-3 w-3 text-gray-500"})})}),Z&&o.jsxs("div",{className:"fixed bg-white shadow-lg rounded-md py-1 w-48",style:{left:`${q.x}px`,top:`${q.y}px`,zIndex:9999},onClick:g=>g.stopPropagation(),children:[o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{C(!0),H(!1)},children:[o.jsx(Xe,{className:"h-4 w-4"}),"Editar texto"]}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:K,children:[o.jsx(Ee,{className:"h-4 w-4"}),"Duplicar"]}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{var g;i({style:{...e.style,opacity:Math.max(0,(((g=e.style)==null?void 0:g.opacity)||1)-.1)}}),H(!1)},children:[o.jsx(Re,{className:"h-4 w-4"}),"Reducir opacidad"]}),o.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{l(),H(!1)},children:[o.jsx(Pe,{className:"h-4 w-4"}),"Eliminar"]})]})]})}function Rt({id:e,elements:t=[],selectedElement:r,onSelectElement:i,onAddElement:l,onUpdateElement:f,onDeleteElement:d,availableMasks:C=[],workspaceSize:M={width:800,height:600},cellSize:I="auto",cellStyle:A="",projectData:k=null}){const h={maxSizeBytes:10485760,maxSizeMB:10,allowedTypes:["image/jpeg","image/jpg","image/png","image/webp","image/gif"]},w=u=>{const m=[];if(h.allowedTypes.includes(u.type)||m.push(`❌ Tipo de archivo no permitido: ${u.type}. Solo se permiten: JPG, PNG, WebP, GIF`),u.size>h.maxSizeBytes){const a=(u.size/1048576).toFixed(2);m.push(`❌ Imagen muy pesada: ${a}MB (máximo ${h.maxSizeMB}MB). Por favor, reduce el tamaño de la imagen antes de subirla.`)}return{isValid:m.length===0,errors:m,fileSize:u.size,fileSizeMB:(u.size/(1024*1024)).toFixed(2)}},D=async u=>{if(!(k!=null&&k.id))return Y.error("Error: No se puede cargar la imagen sin un proyecto activo"),null;console.log(`📤 [UPLOAD] Iniciando upload de imagen: ${u.name} (${(u.size/(1024*1024)).toFixed(2)}MB)`);const{height:m,width:a,dpi:O}=k.canvas_preset,T=Math.max(m,a),b=Math.round(T*O/50.8),W=await(async z=>new Promise(L=>{const F=new Image;F.onload=()=>{const G=Math.max(F.width,F.height);if(G<=b){URL.revokeObjectURL(F.src),L(z);return}const ee=b/G,te=Math.round(F.width*ee),ne=Math.round(F.height*ee),K=document.createElement("canvas");K.width=te,K.height=ne,K.getContext("2d").drawImage(F,0,0,te,ne),K.toBlob(oe=>{URL.revokeObjectURL(F.src),L(new File([oe],z.name,{type:z.type}))},z.type)},F.src=URL.createObjectURL(z)}))(u),v=w(W);if(!v.isValid)return console.error("❌ [VALIDATION] Archivo inválido:",v.errors),v.errors.forEach(z=>{Y.error(z,{duration:5e3})}),null;const j=new FormData;j.append("image",W),j.append("projectId",k.id);const Q=Y.loading(`📤 Subiendo imagen (${v.fileSizeMB}MB)...`);try{const L=await(await fetch("/api/canvas/editor/upload-image",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:j})).json();return L.success?(Y.success("✅ Imagen subida correctamente",{id:Q}),console.log(`✅ [UPLOAD] Upload exitoso: ${L.url}`),L.url):(Y.error(L.message||"Error al subir la imagen",{id:Q}),console.error("❌ [UPLOAD] Error del servidor:",L),null)}catch(z){return console.error("❌ [UPLOAD] Error de red:",z),Y.error("Error de red al subir la imagen",{id:Q}),null}},[{isOver:B},Z]=yt(()=>({accept:["IMAGE_FILE","TEXT_ELEMENT","IMAGE_ELEMENT","PROJECT_IMAGE"],drop:async u=>{if(u.files){const m=Array.isArray(u.files)?u.files:[u.files[0]];console.log(`🎯 [DROP] Recibidos ${m.length} archivos por drag & drop`);for(let a=0;a<m.length;a++){const O=m[a],T=w(O);if(!T.isValid){T.errors.forEach(N=>Y.error(N,{duration:5e3}));continue}const b=await D(O);if(b){const N={id:`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:b,position:{x:.05,y:.05},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:t.length+a+1};l(N,e),console.log("[EditableCell] onAddElement via drop",{cellId:e,elementId:N.id}),i(N.id,e)}}}else if(u.type==="PROJECT_IMAGE"){const m={id:`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:u.imageUrl,position:{x:.05,y:.05},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:t.length+1};l(m,e),console.log("[EditableCell] onAddElement from gallery",{cellId:e,elementId:m.id}),i(m.id,e),Y.success("Imagen añadida desde la galería")}},collect:u=>({isOver:!!u.isOver({shallow:!0})})})),H=()=>{const u=document.createElement("input");u.type="file",u.accept=h.allowedTypes.join(","),u.multiple=!0,u.onchange=async m=>{if(m.target.files){const a=Array.from(m.target.files);console.log(`📁 [FILE-EXPLORER] Seleccionados ${a.length} archivos`),a.filter(b=>b.size>h.maxSizeBytes);let O=0,T=0;for(let b=0;b<a.length;b++){const N=a[b];console.log(`📤 [FILE-EXPLORER] Procesando archivo ${b+1}/${a.length}: ${N.name}`);const W=await D(N);if(W){const v={id:`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:W,position:{x:.05,y:.05},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:t.length+b+1};l(v,e),console.log("[EditableCell] onAddElement",{cellId:e,elementId:v.id}),i(v.id,e),O++}else T++;b<a.length-1&&await new Promise(v=>setTimeout(v,100))}a.length>1&&(T===0?Y.success(`✅ ${O} imágenes subidas exitosamente`):O===0?Y.error(`❌ Todas las imágenes fueron rechazadas (${T})`):Y.info(`📊 Resultado: ${O} exitosas, ${T} rechazadas`))}},u.click()},q=t.length>0;return o.jsx("div",{ref:Z,"data-cell-id":e,className:`relative w-full h-full ${A||"rounded-lg overflow-hidden"} ${B?"ring-2 ring-purple-500 bg-transparent":""} ${q?"bg-transparent":"border-2 border-dashed border-gray-300 bg-transparent hover:border-gray-400 hover:bg-transparent hover:text-white"}`,onClick:u=>{u.target===u.currentTarget&&i(null,e)},style:{isolation:"isolate",background:q?"transparent":void 0,minHeight:"120px"},children:t.length===0?o.jsxs("div",{className:"absolute group inset-0 flex flex-col items-center justify-center gap-2 cursor-pointer transition-colors",onClick:u=>{u.stopPropagation(),H()},children:[o.jsx(Fe,{className:"h-8 w-8 text-gray-300 group-hover:text-white transition-colors"}),o.jsx("p",{className:"text-sm text-gray-400 group-hover:text-white text-center transition-colors",children:"Haz clic o arrastra una imagen"}),o.jsxs("div",{className:"text-xs text-gray-500 group-hover:text-gray-300 text-center mt-1 transition-colors",children:[o.jsxs("p",{children:["Máximo ",h.maxSizeMB,"MB"]}),o.jsx("p",{className:"opacity-75",children:"JPG, PNG, WebP, GIF"})]}),B&&o.jsx("div",{className:"absolute inset-0 bg-purple-500/20 border-2 border-purple-500 border-dashed rounded-lg flex items-center justify-center",children:o.jsx("div",{className:"bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Suelta aquí la imagen"})})]}):t.map(u=>o.jsx("div",{className:"absolute inset-0",onClick:m=>m.stopPropagation(),children:u.type==="image"?o.jsx(xt,{element:u,isSelected:r===u.id,onSelect:()=>i(u.id,e),onUpdate:m=>f(u.id,m),onDelete:()=>d(u.id),availableMasks:C,workspaceSize:M}):o.jsx(bt,{element:u,workspaceSize:M,isSelected:r===u.id,onSelect:()=>i(u.id,e),onUpdate:m=>f(u.id,m),onDelete:()=>d(u.id)})},u.id))})}const wt=e=>{const t={maxSizeBytes:2097152,maxSizeMB:2,allowedTypes:["image/jpeg","image/jpg","image/png","image/webp","image/gif"]},r=(e.size/(1024*1024)).toFixed(2),i=e.size>t.maxSizeBytes,l=t.allowedTypes.includes(e.type);console.log("🔍 [DEBUG-VALIDATION] Información del archivo:",{name:e.name,type:e.type,sizeMB:r,isValidType:l,isValidSize:!i,status:l&&!i?"✅ VÁLIDO":"❌ RECHAZADO",reason:l?i?`Muy pesado (${r}MB > ${t.maxSizeMB}MB)`:"OK":"Tipo no permitido"})};typeof window<"u"&&(window.debugImageValidation=wt);export{Ye as D,Rt as E,Xe as T,J as a,ze as i,He as u};
