import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as n}from"./index-BH53Isel.js";import{c as D}from"./ReactAppend-DTVVXReZ.js";import{B as Y}from"./Base-Bzg5c0XG.js";import{C as R}from"./CreateReactScript-DERNRfBB.js";import{T}from"./Table-DitbKwtZ.js";import{D as d}from"./DxButton-DV0H-ZcL.js";import{R as u}from"./ReactAppend-D7S498fx.js";import{S as m}from"./ProductCard-CRhBSmWZ.js";import{P as B}from"./ProjectsRest-BkwGpyic.js";import{M as S}from"./Modal-B6PZ5H4-.js";import{i as F}from"./tippy-react.esm-BWiGTO87.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./Global-D6eBBAMK.js";/* empty css              */import"./Logout-TGKOqZqZ.js";import"./main-6DCdASTx.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-CY0sLPNq.js";import"./index.esm-POOiSFi2.js";import"./index-Dq7h7Pqt.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-rimy3MAc.js";const x=new B,I=({statuses:f=[]})=>{const o=n.useRef(),c=n.useRef(),p=n.useRef(),[a,M]=n.useState(null),[i,P]=n.useState(null),[l,b]=n.useState(""),g=async t=>{const{isConfirmed:s}=await m.fire({title:"Eliminar proyecto",text:"¿Estás seguro de eliminar este proyecto?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await x.delete(t)||$(o.current).dxDataGrid("instance").refresh()},j=t=>{const s=t.current;s&&(window.bootstrap?(window.bootstrap.Modal.getInstance(s)||new window.bootstrap.Modal(s)).show():window.$&&$(s).modal("show"))},h=t=>{const s=t.current;s&&(window.bootstrap?(window.bootstrap.Modal.getInstance(s)||new window.bootstrap.Modal(s)).hide():window.$&&$(s).modal("hide"))},N=async t=>{const s=await x.get(t);M(s.data),j(c)},y=t=>{window.open(`/canvas/editor?project=${t}`,"_blank")},w=async t=>{P(t),b(t.name||""),j(p)},v=async t=>{if(t&&t.preventDefault(),console.log("onSaveProjectName called with project:",i),console.log("onSaveProjectName called with projectName:",l),!i||!l.trim()){m.fire({title:"Error",text:"El nombre del proyecto no puede estar vacío",icon:"error"});return}try{console.log("Saving project with data:",{id:i.id,name:l.trim()});const s=await x.save({id:i.id,name:l.trim()});console.log("Save result:",s),s&&(m.fire({title:"Éxito",text:"Nombre del proyecto actualizado correctamente",icon:"success",timer:2e3}),h(p),$(o.current).dxDataGrid("instance").refresh())}catch(s){console.error("Error saving project:",s),m.fire({title:"Error",text:s.message||"No se pudo actualizar el nombre del proyecto",icon:"error"})}},C=t=>{const r={draft:{color:"#fbbf24",text:"Borrador"},completed:{color:"#10b981",text:"Completado"},exported:{color:"#3b82f6",text:"Exportado"},ordered:{color:"#8b5cf6",text:"Pedido realizado"}}[t]||{color:"#6b7280",text:"Desconocido"};return{backgroundColor:`${r.color}20`,color:r.color,text:r.text}},E=t=>t==="draft",k=x;return e.jsxs(e.Fragment,{children:[e.jsx(T,{gridRef:o,title:"Mis Proyectos",rest:k,toolBar:t=>{t.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),t.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Catálogo",onClick:()=>{window.location.href="/catalogo"}}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Proyecto",width:"300px",cellTemplate:(t,{data:s})=>{t.css("cursor","pointer"),t.on("click",()=>{N(s.id)}),u(t,e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx("img",{src:s.thumbnail||"/assets/img/backgrounds/resources/default-image.png",alt:s.name,className:"rounded",style:{width:"50px",height:"50px",objectFit:"cover"},onError:r=>{r.target.src="/assets/img/backgrounds/resources/default-image.png"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 fw-bold",children:s.name||"Proyecto sin título"}),e.jsx("small",{className:"text-muted",children:s.description||"Sin descripción"})]})]}))}},{dataField:"created_at",caption:"Fecha Creación",dataType:"date",sortOrder:"desc",cellTemplate:(t,{data:s})=>{t.text(moment(s.created_at).format("DD/MM/YYYY HH:mm"))}},{dataField:"updated_at",caption:"Última Modificación",dataType:"date",cellTemplate:(t,{data:s})=>{t.text(moment(s.updated_at).format("DD/MM/YYYY HH:mm"))}},{dataField:"status",caption:"Estado",cellTemplate:(t,{data:s})=>{const r=C(s.status);u(t,e.jsx("span",{className:"badge rounded-pill px-3 py-2",style:{backgroundColor:r.backgroundColor,color:r.color,fontSize:"12px"},children:r.text}))}},{caption:"Acciones",cellTemplate:(t,{data:s})=>{const r=E(s.status);t.append(d({className:"btn btn-xs btn-light me-1",title:"Ver proyecto",icon:"fa fa-eye",onClick:()=>N(s.id)})),r?(t.append(d({className:"btn btn-xs btn-success me-1",title:"Ir al editor",icon:"fa fa-palette",onClick:()=>y(s.id)})),t.append(d({className:"btn btn-xs btn-primary me-1",title:"Editar nombre",icon:"fa fa-edit",onClick:()=>w(s)})),t.append(d({className:"btn btn-xs btn-danger",title:"Eliminar proyecto",icon:"fa fa-trash",onClick:()=>g(s.id)}))):u(t,e.jsx(F,{content:"Los proyectos finalizados no se pueden editar o eliminar",children:e.jsx("span",{className:"badge bg-secondary ms-2",children:"Finalizado"})}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(S,{modalRef:c,title:`Detalles del proyecto: ${(a==null?void 0:a.name)||"Sin título"}`,size:"lg",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Información del Proyecto"})}),e.jsx("div",{className:"card-body p-3",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:"140px"},children:"Nombre:"}),e.jsx("td",{children:(a==null?void 0:a.name)||"Sin título"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Descripción:"}),e.jsx("td",{children:(a==null?void 0:a.description)||"Sin descripción"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Estado:"}),e.jsx("td",{children:(()=>{const t=C(a==null?void 0:a.status);return e.jsx("span",{className:"badge rounded-pill px-3 py-2",style:{backgroundColor:t.backgroundColor,color:t.color},children:t.text})})()})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Creado:"}),e.jsx("td",{children:a?moment(a.created_at).format("DD/MM/YYYY HH:mm"):"-"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Modificado:"}),e.jsx("td",{children:a?moment(a.updated_at).format("DD/MM/YYYY HH:mm"):"-"})]})]})})})]}),(a==null?void 0:a.configuration)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Configuración"})}),e.jsx("div",{className:"card-body p-3",children:e.jsx("pre",{className:"bg-light p-3 rounded",style:{fontSize:"12px"},children:JSON.stringify(JSON.parse(a.configuration||"{}"),null,2)})})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Vista Previa"})}),e.jsx("div",{className:"card-body p-3 text-center",children:e.jsx("img",{src:(a==null?void 0:a.thumbnail)||"/assets/img/backgrounds/resources/default-image.png",alt:"Vista previa",className:"img-fluid rounded shadow",style:{maxHeight:"200px"},onError:t=>{t.target.src="/assets/img/backgrounds/resources/default-image.png"}})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Acciones"})}),e.jsxs("div",{className:"card-body p-3 d-grid gap-2",children:[E(a==null?void 0:a.status)?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-success",onClick:()=>y(a==null?void 0:a.id),children:[e.jsx("i",{className:"fa fa-palette me-2"}),"Ir al Editor"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{h(c),w(a)},children:[e.jsx("i",{className:"fa fa-edit me-2"}),"Editar Nombre"]}),e.jsxs("button",{className:"btn btn-danger",onClick:()=>{h(c),g(a==null?void 0:a.id)},children:[e.jsx("i",{className:"fa fa-trash me-2"}),"Eliminar Proyecto"]})]}):e.jsxs("div",{className:"alert alert-info mb-0",children:[e.jsx("i",{className:"fa fa-info-circle me-2"}),"Este proyecto está finalizado y no se puede editar."]}),e.jsxs("a",{href:"/catalogo",className:"btn btn-success",children:[e.jsx("i",{className:"fa fa-plus me-2"}),"Ir a la web"]})]})]})]})]})}),e.jsxs(S,{modalRef:p,title:"Editar Nombre del Proyecto",size:"md",onSubmit:v,btnSubmitText:"Guardar Cambios",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"projectName",className:"form-label",children:["Nombre del Proyecto ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"projectName",value:l,onChange:t=>b(t.target.value),placeholder:"Ingresa el nombre del proyecto",maxLength:"255",onKeyPress:t=>{t.key==="Enter"&&v()}}),e.jsx("div",{className:"form-text",children:"Máximo 255 caracteres. Este nombre se mostrará en tu lista de proyectos."})]}),i&&e.jsx("div",{className:"alert alert-light",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Proyecto actual:"})," ",i.name||"Sin título",e.jsx("br",{}),e.jsx("strong",{children:"Creado:"})," ",moment(i.created_at).format("DD/MM/YYYY HH:mm")]})})]})]})};R((f,o)=>{D.createRoot(f).render(e.jsx(Y,{...o,title:"Mis Proyectos",children:e.jsx(I,{...o})}))});
