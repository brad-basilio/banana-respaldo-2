import{j as o}from"./AboutSimple-Cf8x2fCZ.js";import{r as _}from"./index-BH53Isel.js";import"./EditorLayout-BCylU6V-.js";import{M as ae}from"./PaymentModal-Bxx5p2o_.js";import{H as le}from"./index.es-p8wkj5I3.js";import{G as te}from"./Global-ErywZRdd.js";import{X as ne}from"./x-DBMwyD6F.js";import{C as se}from"./chevron-left-B2s3ZsB7.js";import{C as ce}from"./chevron-right-Ckt5D2ka.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./index-Chjiymov.js";import"./createLucideIcon-Cy5Ya80P.js";const ie={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"0",border:"none",background:"none",overflow:"visible"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:1e3}},de=`
    .stf__wrapper {
        margin: 0 !important;
        padding: 0 !important;
    }
    .stf__block {
        margin: 0 !important;
        padding: 0 !important;
    }
    .stf__page {
        margin: 0 !important;
        padding: 0 !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
    }
    .page-container img {
        display: block;
        margin: 0;
        padding: 0;
        border: none;
        outline: none;
        image-rendering: -webkit-optimize-contrast !important;
        image-rendering: high-quality !important;
        -webkit-backface-visibility: hidden !important;
        backface-visibility: hidden !important;
        -webkit-transform: translateZ(0) !important;
        transform: translateZ(0) !important;
        -ms-interpolation-mode: bicubic !important;
    }
    .page-container {
        -webkit-font-smoothing: subpixel-antialiased !important;
        -moz-osx-font-smoothing: auto !important;
    }
`;ae.setAppElement("#app");const Ne=({isOpen:j,onRequestClose:d,pages:x,pageThumbnails:I={},addAlbumToCart:O,workspaceDimensions:B={width:800,height:600},layouts:X=[],presetData:V=null})=>{const[Y,J]=_.useState(0),[H,Q]=_.useState(!1),[K,G]=_.useState({}),[q,Z]=_.useState(!1),F=_.useRef();function g(t,r,s,e,n,c){const a=r.width,h=r.height,f=n/c,y=a/h;let b=0,E=0,m=a,i=h;f>y?(i=a/f,E=(h-i)/2):(m=h*f,b=(a-m)/2),t.drawImage(r,b,E,m,i,s,e,n,c)}function N(t){const r=t.match(/grid-cols-(\d+)/),s=t.match(/grid-rows-(\d+)/),e=t.match(/gap-(\d+)/);return{cols:r?parseInt(r[1],10):1,rows:s?parseInt(s[1],10):1,gap:e?parseInt(e[1],10)*4:0}}function w(t,r,s=1){const e=t&&t.match(new RegExp(`${r}-span-(\\d+)`));return e?parseInt(e[1],10):s}function U(t,r,s){const{cols:e,rows:n,gap:c}=N(t.template),a=t.style&&t.style.padding?parseInt(t.style.padding):0,h=r.width-2*a,f=r.height-2*a,y=(h-c*(e-1))/e,b=(f-c*(n-1))/n,E=Array.from({length:n},()=>Array(e).fill(!1)),m={};for(let i=0;i<t.cells;i++){const M=t.cellStyles&&t.cellStyles[i]?t.cellStyles[i]:"",T=w(M,"col",1),$=w(M,"row",1);let ee=!1;for(let z=0;z<=n-$&&!ee;z++)for(let W=0;W<=e-T&&!ee;W++){let oe=!0;for(let L=z;L<z+$;L++){for(let D=W;D<W+T;D++)if(E[L][D]){oe=!1;break}if(!oe)break}if(oe){for(let D=z;D<z+$;D++)for(let re=W;re<W+T;re++)E[D][re]=!0;const L=s&&s[i]?s[i].id:i;m[L]={x:a+W*(y+c),y:a+z*(b+c),width:y*T+c*(T-1),height:b*$+c*($-1)},console.log(`[GRID-PLACEMENT] cellId:${L} col-span:${T} row-span:${$} => x:${m[L].x} y:${m[L].y} w:${m[L].width} h:${m[L].height}`),ee=!0}}if(!ee){const z=s&&s[i]?s[i].id:i;console.warn(`[GRID-PLACEMENT] No se pudo ubicar la celda ${z}`),m[z]={x:0,y:0,width:y,height:b}}}return m}const k=_.useCallback(async()=>{if(!x||x.length===0||!j)return;console.log("üöÄ Iniciando generaci√≥n de thumbnails para BookPreview..."),Z(!0),G({});const t={},r=4,s=(a,h,f,y)=>{if(!h||!h.image)return;const b=new Image;b.src=h.image,b.onload=()=>{const E=f.x+h.x*y,m=f.y+h.y*y,i=h.width*y,M=h.height*y;g(a,b,E,m,i,M)}},e=async(a,h)=>{const f=document.createElement("canvas"),y=f.getContext("2d");if(f.width=B.width*r,f.height=B.height*r,V&&V.final_layer_image){const i=new Image;i.src=V.final_layer_image,i.onload=()=>{y.drawImage(i,0,0,f.width,f.height)}}const b=X.find(i=>i.id===a.layoutId);if(!b)return;const E=U(b,B,a.cells);a.cells.forEach(i=>{const M=E[i.id];M&&i.elements.forEach(T=>{s(y,T,M,r)})});const m=f.toDataURL("image/jpeg",.9);return{[h]:m}},n=x.map((a,h)=>e(a,h));(await Promise.all(n)).forEach(a=>{Object.assign(t,a)}),G(t),Z(!1)},[x,j,B,X,V]);_.useEffect(()=>{j&&(Object.keys(I).length===0?k():G(I))},[j,I]),_.useEffect(()=>{j||G({})},[j]);const C=Object.keys(I).length>0?I:K;if(!x||!Array.isArray(x)||x.length===0)return o.jsx(ae,{isOpen:j,onRequestClose:d,style:ie,contentLabel:"Vista previa del √°lbum",ariaHideApp:!0,shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-description",children:o.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md mx-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h2",{id:"modal-title",className:"text-xl font-bold",children:"Vista previa del √°lbum"}),o.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700","aria-label":"Cerrar vista previa",children:o.jsx(ne,{size:24})})]}),o.jsx("p",{id:"modal-description",className:"text-gray-600",children:"No hay p√°ginas disponibles para mostrar."})]})});const P=()=>{F.current&&F.current.pageFlip().flipPrev()},A=()=>{F.current&&F.current.pageFlip().flipNext()},R=B.width/B.height,u=600,l=Math.round(u*R),p=(()=>{const t=[],r=[...x.filter(e=>e.type==="cover"),...x.filter(e=>e.type==="content"),...x.filter(e=>e.type==="final")];r.length>0&&(t.push(r[0]),t.push({...r[0],isBack:!0}));for(let e=1;e<r.length-1;e++)t.push(r[e]),e+1<r.length-1?(t.push(r[e+1]),e++):t.push({...r[e],isBack:!0,isEmpty:!0});const s=r.find(e=>e.type==="final");return s&&(t.push({...s,isBack:!0,isEmpty:!0}),t.push(s)),t})();return o.jsxs(ae,{isOpen:j,onRequestClose:d,style:ie,contentLabel:"Vista previa del √°lbum",ariaHideApp:!0,shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-description",children:[o.jsx("style",{dangerouslySetInnerHTML:{__html:de}}),q&&o.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl flex flex-col items-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mb-4"}),o.jsx("p",{className:"text-gray-700",children:"Generando vistas previas de alta calidad..."}),o.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Esto puede tomar unos segundos"})]})}),o.jsxs("div",{className:"relative flex flex-col items-center justify-center p-6 bg-white rounded-2xl shadow-2xl",children:[o.jsx("h2",{id:"modal-title",className:"sr-only",children:"Vista previa del √°lbum"}),o.jsx("p",{id:"modal-description",className:"sr-only",children:"Navegue por las p√°ginas de su √°lbum usando los controles de navegaci√≥n o teclado. Puede cerrar esta ventana presionando Escape o el bot√≥n de cerrar."}),o.jsx("button",{onClick:d,className:"absolute top-4 right-4 p-2 rounded-full bg-white/80 hover:bg-white text-gray-700 shadow z-10","aria-label":"Cerrar vista previa del √°lbum",children:o.jsx(ne,{className:"h-6 w-6"})}),o.jsxs("div",{className:"flex items-center justify-center gap-8 mb-6 mt-2",children:[o.jsx("button",{onClick:P,className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 shadow transition-colors","aria-label":"P√°gina anterior",children:o.jsx(se,{className:"h-6 w-6"})}),o.jsxs("span",{className:"flex items-center text-gray-700 text-base font-medium px-4 py-2 bg-gray-50 rounded-lg","aria-live":"polite",children:[(()=>{const t=p[Y];return t?t.isBack&&t.isEmpty?"Reverso":t.isBack?"Reverso de la p√°gina":t.type==="cover"?"Portada":t.type==="final"?"Contraportada":`P√°gina ${t.pageNumber||Math.ceil((Y+1)/2)}`:"Cargando..."})(),o.jsx("span",{className:"mx-2 text-gray-400",children:"‚Ä¢"}),Math.ceil((Y+1)/2)," / ",Math.ceil(p.length/2)," hojas"]}),o.jsx("button",{onClick:A,className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 shadow transition-colors","aria-label":"P√°gina siguiente",children:o.jsx(ce,{className:"h-6 w-6"})})]}),o.jsx("div",{className:"flex items-center justify-center",children:o.jsx(le,{ref:F,width:l,height:u,size:"stretch",minWidth:l*.7,maxWidth:l*1.3,minHeight:u*.7,maxHeight:u*1.3,maxShadowOpacity:.3,showCover:!0,mobileScrollSupport:!0,onFlip:t=>J(t.data),className:"shadow-xl",usePortrait:!1,startPage:0,drawShadow:!0,flippingTime:600,useMouseEvents:!0,swipeDistance:50,showPageCorners:!0,disableFlipByClick:!1,style:{margin:0,padding:0},children:p.map((t,r)=>o.jsx("div",{id:`page-${t.id}`,className:"page-container",style:{width:l,height:u,margin:0,padding:0,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#ffffff"},children:o.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:t.isEmpty||t.isBack?o.jsx("div",{className:"flex items-center justify-center text-gray-300 text-xs",style:{width:"100%",height:"100%",backgroundColor:"#ffffff",border:"1px solid #f0f0f0"},children:t.isBack?"Reverso":""}):C[t.id]?o.jsx("img",{src:C[t.id],alt:`${t.type==="cover"?"Portada":t.type==="final"?"Contraportada":`P√°gina ${t.pageNumber||r+1}`}`,style:{width:"100%",height:"100%",objectFit:"contain",margin:0,padding:0,border:"none",imageRendering:"auto",backgroundColor:"#ffffff",WebkitBackfaceVisibility:"hidden",backfaceVisibility:"hidden",WebkitTransform:"translateZ(0)",transform:"translateZ(0)"}}):o.jsx(ge,{page:t,pageIdx:r})})},`page-${r}`))})})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 w-full max-w-md mx-auto",children:[o.jsx("button",{className:`flex-1 py-3 px-4 rounded-lg font-semibold shadow transition flex items-center justify-center ${H?"bg-purple-400 text-white cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,onClick:async()=>{var t,r,s;if(!H){Q(!0);try{if(console.log("üöÄ Iniciando proceso de compra con generaci√≥n de PDF..."),typeof O!="function"){console.error("‚ùå addAlbumToCart no es una funci√≥n"),console.log("addAlbumToCart type:",typeof O),console.log("addAlbumToCart value:",O),alert("Error: Funci√≥n de carrito no disponible. Int√©ntelo nuevamente.");return}if(typeof window.finalizeAlbumDesign=="function"){console.log("üìÑ Finalizando dise√±o del √°lbum...");const e=await window.finalizeAlbumDesign();if(console.log("üìÑ Resultado de finalizeAlbumDesign:",e),e){if(console.log("üìÑ Generando PDF del √°lbum..."),typeof window.generateAlbumPDF=="function")try{const c=await window.generateAlbumPDF();console.log("üìÑ PDF generado exitosamente:",c),console.log("üíæ Guardando PDF en el servidor...");const a=window.currentAlbumUuid||window.albumUuid;if(!a)throw new Error("No se encontr√≥ el UUID del √°lbum");const h=await new Promise((b,E)=>{const m=new FileReader;m.onload=()=>{const i=m.result.split(",")[1];b(i)},m.onerror=E,m.readAsDataURL(c)}),f=await fetch(`/api/albums/${a}/generate-pdf`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},body:JSON.stringify({pdf_blob:h})});if(!f.ok){const b=await f.json();throw new Error(b.message||"Error al guardar el PDF en el servidor")}const y=await f.json();console.log("üíæ PDF guardado en servidor:",y)}catch(c){console.error("‚ùå Error generando/guardando PDF:",c),console.log("‚ö†Ô∏è Continuando sin PDF...")}else console.warn("‚ö†Ô∏è window.generateAlbumPDF no est√° disponible, continuando sin PDF...");console.log("üì¶ Agregando √°lbum al carrito...");const n=O();if(console.log("üì¶ Resultado de addAlbumToCart:",n),n){console.log("‚úÖ √Ålbum agregado al carrito exitosamente");try{await new Promise(h=>setTimeout(h,200));const c=JSON.parse(localStorage.getItem(`${((r=window.Global)==null?void 0:r.APP_CORRELATIVE)||"bananalab"}_cart`)||"[]");console.log("üîç Verificaci√≥n final del carrito:",c),console.log("üîç Longitud del carrito:",c.length),c.length===0&&console.error("‚ùå ADVERTENCIA: El carrito parece vac√≠o despu√©s de agregar");const a=`${te.APP_URL}/cart`;console.log("üîÑ Redirigiendo al carrito..."),console.log("üîÑ URL del carrito:",a),window.location.href=a}catch(c){console.error("‚ö†Ô∏è Error durante verificaci√≥n o redirecci√≥n:",c),console.log("üîÑ Intentando redirecci√≥n directa...");const a=`${te.APP_URL}/cart`;console.log("üîÑ Redirigiendo al carrito..."),console.log("üîÑ URL del carrito:",a),window.location.href=a}}else console.error("‚ùå No se pudo agregar al carrito"),alert("Error al agregar el √°lbum al carrito. Revise la consola para m√°s detalles.")}else console.error("‚ùå No se pudo finalizar el dise√±o del √°lbum"),alert("Error al finalizar el dise√±o del √°lbum. Int√©ntelo nuevamente.")}else console.error("‚ùå window.finalizeAlbumDesign no est√° disponible"),alert("Funcionalidad de finalizaci√≥n de dise√±o pendiente de implementar.")}catch(e){console.error("‚ùå === ERROR DURANTE PROCESO DE COMPRA ==="),console.error("Tipo de error:",e.name),console.error("Mensaje:",e.message),console.error("Stack trace:",e.stack),console.error("Error completo:",e);try{const n=JSON.parse(localStorage.getItem(`${((s=te)==null?void 0:s.APP_CORRELATIVE)||"bananalab"}_cart`)||"[]");if(console.log("üîç Verificando carrito despu√©s del error:",n.length>0?"HAY ITEMS":"VAC√çO"),n.length>0){console.log("‚úÖ El carrito tiene items, redirigiendo de todas formas...");const c=`${te.APP_URL}/cart`;console.log("üîÑ Redirigiendo al carrito..."),console.log("üîÑ URL del carrito:",c),window.location.href=c;return}}catch(n){console.error("‚ùå Error durante intento de recuperaci√≥n:",n)}alert(`Error durante el proceso: ${e.message}. Si el √°lbum se agreg√≥ al carrito, puede ir manualmente a la p√°gina del carrito.`)}finally{Q(!1)}}},disabled:H,children:H?o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Procesando..."]}):"Comprar ahora"}),o.jsx("button",{className:"flex-1 py-3 px-4 rounded-lg bg-gray-200 text-gray-700 font-semibold shadow hover:bg-gray-300 transition",onClick:d,disabled:H,children:"Continuar editando"})]}),"        "]})},ge=({page:j,pageIdx:d})=>{let x="",I="";switch(j.type){case"cover":x="Portada",I="üìö";break;case"final":x="Contraportada",I="üìñ";break;case"content":x=`P√°gina ${j.pageNumber||d+1}`,I="üìÑ";break;default:x=`P√°gina ${d+1}`,I="üìÑ"}return o.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full bg-gray-50 border-2 border-gray-200 rounded-lg",style:{minHeight:"400px"},children:[o.jsx("div",{className:"text-6xl mb-4",children:I}),o.jsx("div",{className:"text-lg font-semibold text-gray-700 mb-2",children:x}),o.jsx("div",{className:"text-sm text-gray-500",children:"Vista previa"}),j.layout&&o.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Layout: ",j.layout.name||"Personalizado"]})]})};async function Ee({pages:j,workspaceDimensions:d,presetData:x}){var B,X,V,Y,J,H,Q,K,G,q,Z,F;const I={};function O(g,N,w,U,k,C){if(!N||!g){console.warn("‚ö†Ô∏è No se puede dibujar: contexto o imagen no v√°lidos");return}const P=N.width,A=N.height;if(P===0||A===0){console.warn("‚ö†Ô∏è Imagen con dimensiones cero:",{sWidth:P,sHeight:A});return}if(k<=0||C<=0){console.warn("‚ö†Ô∏è Dimensiones de destino inv√°lidas:",{dWidth:k,dHeight:C});return}const R=k/C,S=P/A;let u,l,v,p;R>S?(v=P,p=v/R,u=0,l=(A-p)/2):(p=A,v=p*R,u=(P-v)/2,l=0);try{g.save(),g.imageSmoothingQuality="high",g.drawImage(N,Math.max(0,u),Math.max(0,l),Math.min(v,P-u),Math.min(p,A-l),w,U,k,C),g.restore()}catch(t){console.error("‚ùå Error al dibujar imagen:",t),console.error("Detalles:",{source:{x:u,y:l,width:v,height:p},dest:{x:w,y:U,width:k,height:C},imgSize:{width:P,height:A}})}}for(const g of j)try{const N=document.createElement("canvas"),w=N.getContext("2d",{willReadFrequently:!0});N.width=d.width,N.height=d.height,w.scale(1,1),w.imageSmoothingEnabled=!0,w.imageSmoothingQuality="high",w.textRendering="geometricPrecision",w.webkitImageSmoothingEnabled=!0,w.mozImageSmoothingEnabled=!0,w.msImageSmoothingEnabled=!0,console.log("üñºÔ∏è [THUMBNAIL] Generando miniatura para p√°gina:",g==null?void 0:g.type),console.log("üñºÔ∏è [THUMBNAIL] backgroundImage:",g==null?void 0:g.backgroundImage),console.log("üñºÔ∏è [THUMBNAIL] backgroundColor:",g==null?void 0:g.backgroundColor);let U=g.backgroundImage,k=g.backgroundColor||"#ffffff";if(console.log("üñºÔ∏è [THUMBNAIL] URL final:",U),console.log("üé® [THUMBNAIL] Color final:",k),w.fillStyle=k,w.fillRect(0,0,d.width,d.height),U){console.log("üñºÔ∏è [THUMBNAIL] Cargando imagen de fondo:",U);try{const u=new window.Image;u.crossOrigin="anonymous",u.src=U,await new Promise((l,v)=>{if(u.complete)return console.log("‚úÖ [THUMBNAIL] Imagen ya cargada"),l();u.onload=()=>{console.log("‚úÖ [THUMBNAIL] Imagen cargada exitosamente"),l()},u.onerror=p=>{console.error("‚ùå [THUMBNAIL] Error cargando imagen:",p),v(p)}}),O(w,u,0,0,d.width,d.height),console.log("‚úÖ [THUMBNAIL] Imagen de fondo dibujada")}catch(u){console.error("‚ùå [THUMBNAIL] Error procesando imagen de fondo:",u)}}else console.log("‚ÑπÔ∏è [THUMBNAIL] Sin imagen de fondo, usando solo color");if(g.cells&&Array.isArray(g.cells)){const u=[...g.cells].sort((l,v)=>{var r,s,e,n;const p=((r=l.position)==null?void 0:r.y)||0,t=((s=v.position)==null?void 0:s.y)||0;return p!==t?p-t:(((e=l.position)==null?void 0:e.x)||0)-(((n=v.position)==null?void 0:n.x)||0)});for(const l of u){if(!l||!l.elements)continue;const v=((B=l.size)==null?void 0:B.width)||d.width,p=((X=l.size)==null?void 0:X.height)||d.height,t=((V=l.position)==null?void 0:V.x)||0,r=((Y=l.position)==null?void 0:Y.y)||0;l.size||console.warn("‚ö†Ô∏è cell.size no definido, usando tama√±o workspace",l);const s=[...l.elements||[]].sort((e,n)=>(e.zIndex||0)-(n.zIndex||0));for(const e of s)if(!(e.type==="image"&&(e.id==="cover-base"||e.id==="final-base"||typeof e.id=="string"&&e.id.startsWith("content-base-")))&&!(!e||e.type!=="image"&&e.type!=="text"||!e.content)&&e.type==="image")try{const n=new Image;n.crossOrigin="anonymous",await new Promise((T,$)=>{n.onload=T,n.onerror=$,n.src=e.content});const c=((J=e.position)==null?void 0:J.x)!==void 0&&Math.abs(e.position.x)<=1,a=((H=e.position)==null?void 0:H.y)!==void 0&&Math.abs(e.position.y)<=1,h=((Q=e.size)==null?void 0:Q.width)!==void 0&&e.size.width<=1,f=((K=e.size)==null?void 0:K.height)!==void 0&&e.size.height<=1,y=c?e.position.x*v:((G=e.position)==null?void 0:G.x)||0,b=a?e.position.y*p:((q=e.position)==null?void 0:q.y)||0,E=h?e.size.width*v:((Z=e.size)==null?void 0:Z.width)||v,m=f?e.size.height*p:((F=e.size)==null?void 0:F.height)||p,i=t+y,M=r+b;console.log("üìê Renderizando elemento:",{elementId:e.id,cellId:l.id,cellPosition:{x:t,y:r,width:v,height:p},elementPosition:{x:y,y:b,width:E,height:m},finalPosition:{dx:i,dy:M},isRelative:{x:c,y:a,w:h,h:f},elementData:e}),O(w,n,i,M,E,m)}catch(n){console.error("Error al cargar imagen:",n,e)}}}const C=document.createElement("canvas"),P=C.getContext("2d"),A=900;let R,S;d.width>d.height?(R=Math.min(A,d.width),S=R/d.width*d.height):(S=Math.min(A,d.height),R=S/d.height*d.width),R=Math.round(R),S=Math.round(S),C.width=R,C.height=S,P.imageSmoothingEnabled=!0,P.imageSmoothingQuality="high",P.webkitImageSmoothingEnabled=!0,P.mozImageSmoothingEnabled=!0,P.msImageSmoothingEnabled=!0,P.drawImage(N,0,0,N.width,N.height,0,0,R,S),I[g.id]=C.toDataURL("image/png",.92)}catch(N){console.error(`‚ùå Error generando thumbnail para p√°gina ${g.id}:`,N),I[g.id]=null}return I}export{Ne as B,Ee as g};
