var fe=Object.defineProperty;var he=(n,t,m)=>t in n?fe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):n[t]=m;var H=(n,t,m)=>he(n,typeof t!="symbol"?t+"":t,m);import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BH53Isel.js";import{c as xe}from"./ReactAppend-DTVVXReZ.js";import{s as c}from"./server.browser-Bf4gQIc7.js";import{D as ge}from"./DeliveryPricesRest-DsSJrIMF.js";import"./main-6DCdASTx.js";import{B as ve}from"./BasicRest-C4m6wu80.js";import{S as be}from"./StoresRest-DHuUYjEd.js";import{C as je}from"./CreateReactScript-NWc2tE6o.js";import{S as ye}from"./ProductCard-CRhBSmWZ.js";import{B as Ne}from"./Base-Kpzb7ik-.js";import{D as J}from"./DxButton-CsjWvhyj.js";import{M as L}from"./Modal-DYPPCNUR.js";import{T as se}from"./Table-DitbKwtZ.js";import{I as v}from"./InputFormGroup-D5I6zpZc.js";import{S as Re}from"./SelectFormGroup-BmhC2uob.js";import{S as V}from"./SwitchFormGroup-CGYpv_4Q.js";import{T as ke}from"./TextareaFormGroup-DVzYJtLM.js";import{N as T}from"./Number2Currency-e57Tgsuk.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index-BZYhE2TF.js";import"./index-rimy3MAc.js";import"./index.esm-POOiSFi2.js";import"./index-Dq7h7Pqt.js";import"./Global-ErywZRdd.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./tippy-react.esm-BWiGTO87.js";import"./Logout-TGKOqZqZ.js";import"./MenuItemContainer-CY0sLPNq.js";class _e extends ve{constructor(){super(...arguments);H(this,"path","admin/types_delivery");H(this,"hasFiles",!0)}}const C=new ge,re=new _e,we=new be,Se=({ubigeo:n=[]})=>{const t=i.useRef(),m=i.useRef(),D=i.useRef(),K=i.useRef(),E=i.useRef(),F=i.useRef(),y=i.useRef(),A=i.useRef(),B=i.useRef(),b=i.useRef(),h=i.useRef(),o=i.useRef(),I=i.useRef(),G=i.useRef(),q=i.useRef(),[Q,W]=i.useState(!1),[ie,X]=i.useState(!1),[Te,le]=i.useState(!1),[a,z]=i.useState(!1),[N,R]=i.useState(!1),[k,x]=i.useState(!1),[Y,d]=i.useState(""),[Ce,De]=i.useState([]),[_,M]=i.useState([]),[p,u]=i.useState([]),Z=e=>{console.log(e),e!=null&&e.id?W(!0):W(!1),u([]),F.current.value=(e==null?void 0:e.id)??"",$(y.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),le((e==null?void 0:e.price)===null),b.current&&(b.current.checked=(e==null?void 0:e.is_free)??!1,z((e==null?void 0:e.is_free)??!1),e!=null&&e.is_free&&(o.current.checked=!0,x(!0),d("Delivery gratis incluye retiro en tienda automáticamente. Configure precio normal y express."),w(),e!=null&&e.selected_stores&&Array.isArray(e.selected_stores)&&u(e.selected_stores))),h.current&&(h.current.checked=(e==null?void 0:e.is_agency)??!1,R((e==null?void 0:e.is_agency)??!1),e!=null&&e.is_agency&&d("Este es un envío que se realizará por empresas de envío como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")),o.current&&(o.current.checked=(e==null?void 0:e.is_store_pickup)??!1,x((e==null?void 0:e.is_store_pickup)??!1),e!=null&&e.is_store_pickup&&(d("Retiro en tienda disponible. Los clientes podrán recoger sus pedidos en nuestras sucursales."),w(),e!=null&&e.selected_stores&&Array.isArray(e.selected_stores)&&u(e.selected_stores))),A.current.value=(e==null?void 0:e.price)??0,q.current.value=(e==null?void 0:e.price)??0,I.current.value=(e==null?void 0:e.express_price)??0,G.current.value=(e==null?void 0:e.agency_price)??0,B.current.value=(e==null?void 0:e.description)??"",$(D.current).modal("show")},w=async()=>{try{const e=await we.paginate({page:1,per_page:100,filters:JSON.stringify([{field:"status",operator:"=",value:1}])});console.log("Cargando todas las tiendas disponibles:",e),e&&e.data&&Array.isArray(e.data)?M(e.data):M([])}catch(e){console.error("Error loading stores:",e),M([])}},te=async e=>{e.preventDefault();const r=n.find(j=>j.reniec==y.current.value),l={id:F.current.value||void 0,name:`${r.distrito}, ${r.departamento}`.toTitleCase(),price:a?q.current.value:A.current.value,is_free:b.current.checked,is_agency:h.current.checked,is_store_pickup:o.current.checked,express_price:I.current.value,agency_price:G.current.value,description:B.current.value,ubigeo:y.current.value,selected_stores:o.current.checked&&p.length>0?p:null};console.log("Datos a enviar:",l),await C.save(l)&&(u([]),$(t.current).dxDataGrid("instance").refresh(),$(D.current).modal("hide"))},P=i.useRef(),O=i.useRef(),U=i.useRef(),[f,g]=i.useState([{value:""}]),ce=()=>{g([...f,{value:""}])},ne=(e,r)=>{const l=[...f];l[e].value=r,g(l)},oe=e=>{if(f.length<=1)return;const r=f.filter((l,S)=>S!==e);g(r)},ae=()=>{$(K.current).modal("show")},de=e=>{e!=null&&e.id?X(!0):X(!1),P.current.value=(e==null?void 0:e.id)??"",O.current.value=(e==null?void 0:e.name)??"",U.current.value=(e==null?void 0:e.description)??"",e!=null&&e.characteristics&&e.characteristics.length>0?g(e.characteristics.map(r=>({value:r}))):g([{value:""}]),$(E.current).modal("show")},me=async e=>{e.preventDefault();const r=new FormData;r.append("name",O.current.value),r.append("description",U.current.value),ie&&r.append("id",P.current.value);const l=f.map(j=>j.value.trim()).filter(j=>j.length>0);r.append("characteristics",JSON.stringify(l)),await re.save(r)&&($(m.current).dxDataGrid("instance").refresh(),$(E.current).modal("hide"),g([{value:""}]))},pe=async e=>{const{isConfirmed:r}=await ye.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!r||!await C.delete(e)||$(t.current).dxDataGrid("instance").refresh()},ee=e=>$(c.renderToString(s.jsxs("span",{children:[s.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),s.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]}))),ue=async e=>{const r=e.target.files[0];if(!r)return;e.target.value=null;const l=new FormData;l.append("excel",r),await C.upload(l)&&$(t.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx("input",{id:"file-input",type:"file",accept:".xlsx, .xls",style:{display:"none"},onChange:ue}),s.jsx(se,{gridRef:t,title:"Costos de envío",rest:C,exportable:!0,exportableName:"delivery.prices",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",hint:"Cargar archivo Excel",onClick:()=>document.getElementById("file-input").click()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>Z()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",text:"Actualizar datos de Delivery",hint:"Actualizar datos de Delivery",onClick:()=>ae()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"ubigeo",caption:"Ubigeo (RENIEC)",width:"150px"},{dataField:"name",caption:"Envío a",width:"200px",allowExporting:!1},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"is_free",dataType:"number",caption:"Tipo Envio",cellTemplate:(e,{data:r})=>{r.is_free?e.html(c.renderToString(s.jsxs("div",{className:"d-flex flex-column gap-1",children:[s.jsx("span",{className:"badge bg-success",children:"Delivery Gratis"}),s.jsx("span",{className:"badge bg-warning",children:"Delivery Express"}),s.jsx("span",{className:"badge bg-primary",children:"Retiro en Tienda"})]}))):r.is_agency?e.html(c.renderToString(s.jsx("span",{className:"badge bg-info",children:"Recojo en Agencia"}))):r.is_store_pickup?e.html(c.renderToString(s.jsx("span",{className:"badge bg-primary",children:"Retiro en Tienda"}))):e.html(c.renderToString(s.jsx("span",{className:"badge bg-secondary",children:"Delivery Normal"})))}},{dataField:"price",caption:"Precio",dataType:"number",width:"150px",cellTemplate:(e,{data:r})=>{r.is_free?e.html(c.renderToString(s.jsxs("div",{className:"d-flex flex-column",children:[s.jsx("span",{className:"text-success font-weight-bold",children:"Delivery Gratis (Condicional)"}),s.jsxs("small",{className:"text-muted",children:["Normal: S/ ",T(r.price)," | Express: S/ ",T(r.express_price)]}),s.jsx("small",{className:"text-primary",children:"+ Retiro en Tienda"})]}))):r.is_agency?e.html(c.renderToString(s.jsxs("div",{children:[s.jsx("span",{className:"text-muted font-italic",children:"Recojo en Agencia"}),s.jsx("br",{}),s.jsxs("small",{className:"text-muted",children:["S/ ",T(r.agency_price)]})]}))):r.is_store_pickup&&!r.is_free?e.html(c.renderToString(s.jsx("span",{className:"text-primary font-italic",children:"Solo Retiro en Tienda"}))):e.html(c.renderToString(s.jsxs("div",{children:[s.jsx("span",{className:"text-muted font-italic",children:"Delivery Normal"}),s.jsx("br",{}),s.jsxs("small",{className:"text-muted",children:["S/ ",T(r.price)]})]})))}},{dataField:"selected_stores",caption:"Tiendas",width:"200px",cellTemplate:(e,{data:r})=>{r.is_store_pickup||r.is_free?r.selected_stores&&Array.isArray(r.selected_stores)&&r.selected_stores.length>0?e.html(c.renderToString(s.jsx("div",{children:s.jsxs("span",{className:"badge bg-primary",children:[r.selected_stores.length," tienda",r.selected_stores.length>1?"s":""," específica",r.selected_stores.length>1?"s":""]})}))):e.html(c.renderToString(s.jsx("span",{className:"badge bg-success",children:"Todas las tiendas"}))):e.html(c.renderToString(s.jsx("span",{className:"text-muted font-italic",children:"No aplica"})))},allowFiltering:!1,allowExporting:!1},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(J({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>Z(r)})),e.append(J({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>pe(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsxs(L,{modalRef:D,title:Q?"Editar Costo de envío":"Agregar Costo de envío",onSubmit:te,size:"lg",children:[s.jsx("input",{ref:F,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsx(Re,{eRef:y,label:"Distrito/Ubigeo",templateResult:ee,templateSelection:ee,dropdownParent:"#form-container",required:!0,children:n.map((e,r)=>s.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},r))}),s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"form-label",children:"Tipo de Envío"}),s.jsxs("div",{className:"row",children:[s.jsx(V,{eRef:b,label:"¿Delivery gratis?",col:"col-4",onChange:e=>{z(e.target.checked),e.target.checked?(R(!1),x(!0),h.current.checked=!1,o.current.checked=!0,d("Delivery gratis incluye retiro en tienda automáticamente. Configure precio normal y express."),w()):(x(!1),o.current.checked=!1,d(""))},checked:a,refreshable:[a]}),s.jsx(V,{eRef:h,label:"¿Recojo en agencia?",col:"col-4",onChange:e=>{R(e.target.checked),e.target.checked?(z(!1),x(!1),b.current.checked=!1,o.current.checked=!1,d("Este es un envío que se realizará por empresas de envío como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")):d("")},checked:N,refreshable:[N]}),s.jsx(V,{eRef:o,label:"¿Retiro en tienda?",col:"col-4",onChange:e=>{x(e.target.checked),e.target.checked?(w(),a||(R(!1),h.current.checked=!1),d("Retiro en tienda disponible. Seleccione tiendas específicas o deje sin seleccionar para permitir retiro en cualquier tienda.")):(d(""),u([]))},checked:k,refreshable:[k]})]}),Y&&s.jsxs("div",{className:`alert ${a?"alert-success":"alert-info"} mt-2`,children:[s.jsx("i",{className:`fas ${a?"fa-check-circle":"fa-info-circle"} me-2`}),Y]})]}),a&&s.jsx("div",{className:"col-12 mb-3",children:s.jsxs("div",{className:"alert alert-info",children:[s.jsx("i",{className:"fas fa-info-circle me-2"}),s.jsx("strong",{children:"Delivery gratis incluye automáticamente retiro en tienda."}),s.jsx("br",{}),"Configure el precio normal (cuando no califica para envío gratuito) y el precio express."]})}),s.jsx("div",{className:"col-12",hidden:a||N||k,children:s.jsx(v,{eRef:A,label:"Costo de envío",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-12",hidden:!a,children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsx(v,{eRef:q,label:"Precio Normal (cuando no califica gratis)",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-md-6",children:s.jsx(v,{eRef:I,label:"Precio Express",col:"col-12",type:"number",step:.01,required:!0})})]})}),s.jsx("div",{className:"col-12",hidden:!N,children:s.jsx(v,{eRef:G,label:"Costo de envío a Agencia",col:"col-12",type:"number",step:.01,required:!0})}),k&&s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"form-label",children:"Tiendas disponibles para retiro"}),_.length>0?s.jsxs("div",{children:[s.jsxs("div",{className:"alert alert-info mb-3",children:[s.jsx("i",{className:"fas fa-info-circle me-2"}),s.jsx("strong",{children:"Instrucciones:"}),s.jsxs("ul",{className:"mb-0 mt-2",children:[s.jsxs("li",{children:["Si no selecciona ninguna tienda, el retiro estará disponible en ",s.jsx("strong",{children:"todas las tiendas"})," de esta ubicación."]}),s.jsx("li",{children:"Si selecciona tiendas específicas, el retiro solo estará disponible en las tiendas marcadas."})]})]}),s.jsx("div",{className:"row",children:_.map(e=>s.jsx("div",{className:"col-md-6 mb-3",children:s.jsx("div",{className:`card border ${p.includes(e.id)?"border-primary bg-light":""}`,children:s.jsx("div",{className:"card-body p-3",children:s.jsxs("div",{className:"form-check",children:[s.jsx("input",{className:"form-check-input",type:"checkbox",id:`store_${e.id}`,checked:p.includes(e.id),onChange:r=>{r.target.checked?u([...p,e.id]):u(p.filter(l=>l!==e.id))}}),s.jsx("label",{className:"form-check-label w-100",htmlFor:`store_${e.id}`,children:s.jsxs("div",{className:"d-flex",children:[s.jsx("div",{className:"flex-shrink-0",children:e.image?s.jsx("img",{src:`/storage/images/stores/${e.image}`,alt:e.name,className:"rounded",style:{width:"40px",height:"40px",objectFit:"cover"}}):s.jsx("div",{className:"bg-secondary rounded d-flex align-items-center justify-content-center text-white",style:{width:"40px",height:"40px"},children:s.jsx("i",{className:"fas fa-store"})})}),s.jsxs("div",{className:"flex-grow-1 ms-3",children:[s.jsx("h6",{className:"mb-1",children:e.name}),s.jsx("small",{className:"text-muted d-block",children:e.address}),e.phone&&s.jsxs("small",{className:"text-muted d-block",children:["📞 ",e.phone]})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:`badge ${e.status?"bg-success":"bg-danger"}`,children:e.status?"Activa":"Inactiva"})})]})})]})})})},e.id))}),s.jsx("div",{className:"mt-3",children:s.jsxs("small",{className:"text-muted",children:[s.jsx("strong",{children:"Tiendas seleccionadas:"}),p.length===0?s.jsxs("span",{className:"text-success",children:[" Todas las tiendas disponibles (",_.length,")"]}):s.jsxs("span",{className:"text-primary",children:[" ",p.length," de ",_.length," tiendas"]})]})})]}):s.jsxs("div",{className:"alert alert-warning",children:[s.jsx("i",{className:"fas fa-exclamation-triangle me-2"}),"No hay tiendas disponibles en esta ubicación.",s.jsx("a",{href:"/admin/stores",target:"_blank",className:"alert-link ms-1",children:"Administrar tiendas"})]})]}),s.jsx(ke,{eRef:B,label:"Descripción",rows:2})]})]}),s.jsx(L,{modalRef:K,title:"Tipos de Delivery",size:"lg",children:s.jsx(se,{gridRef:m,title:"Tipos de Delivery",rest:re,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",width:"150px",allowExporting:!1},{dataField:"description",caption:"Descripción",width:"300px",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"characteristics",caption:"Caracteristicas",width:"200px",cellTemplate:(e,{data:r})=>{r.characteristics&&r.characteristics.forEach(l=>{e.css("text-overflow","unset"),e.append(c.renderToString(s.jsx("li",{className:"d-flex gap-2",children:s.jsxs("i",{className:"text-muted font-italic d-block",children:["- ",l]})})))})}},{caption:"Acciones",width:"50px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(J({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>de(r)}))},allowFiltering:!1,allowExporting:!1}]})}),s.jsxs(L,{modalRef:E,title:Q?"Editar tipo de Delivery":"Agregar tipo de Delivery",onSubmit:me,size:"sm",children:[s.jsx("input",{ref:P,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsxs("div",{className:"col-12",children:[s.jsx(v,{eRef:O,label:"Nombre",col:"col-12",type:"string"}),s.jsx(v,{eRef:U,label:"descripcion",col:"col-12",type:"string",required:!0})]}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),f.map((e,r)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:l=>ne(r,l.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>oe(r),disabled:f.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},r)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:ce,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})})]})]})]})};je((n,t)=>{xe.createRoot(n).render(s.jsx(Ne,{...t,title:"Costos de envio",children:s.jsx(Se,{...t})}))});
