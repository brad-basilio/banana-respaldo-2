const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-D3plwuQr.js","assets/index-BH53Isel.js","assets/index-yBjzXJbu.js","assets/preload-helper-BfFHrpNk.js","assets/typeof-QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{_ as Js}from"./preload-helper-BfFHrpNk.js";import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as g,R as At}from"./index-BH53Isel.js";import{T as Ue,l as ce,i as Ms,a as $s,D as Xs,H as Ys,U as ks,R as Ss,B as ke,F as Qs,E as Cs}from"./EditableCell-Cu-5czkC.js";import{h as Es}from"./thumbnailGenerator-B4goYG9Y.js";import{L as It}from"./layers-6oegOx-p.js";import{C as Ls}from"./chevron-down-DS-mdh9v.js";import{C as Zs}from"./chevron-right-Ckt5D2ka.js";import{E as Ds}from"./eye-CKCH9ORv.js";import{c as G}from"./createLucideIcon-Cy5Ya80P.js";import{T as Pt}from"./trash-2-DK1wnsDn.js";import{S as ea}from"./star-wPQTHY_n.js";import{I as Se}from"./image-BEA0kkBS.js";import"./EditorLayout-CkCvwqGw.js";import"./jspdf.es.min-D3plwuQr.js";import{t as ie,T as ta}from"./index-BZYhE2TF.js";import{m as As}from"./main-6DCdASTx.js";import{X as sa}from"./x-DBMwyD6F.js";import{P as aa}from"./palette-DV_Vpyg9.js";import{M as Is}from"./minus-jyhodMPN.js";import{P as Be}from"./plus-Bot15Khs.js";import{B as ra}from"./V1Edit-CNtDxOEt.js";import{G as Ps}from"./Global-ErywZRdd.js";import{S as na,F as oa}from"./save-BfW-kI1U.js";import{C as ia}from"./clock-BTrEpQej.js";import{C as _s}from"./check-DQ7QoS0v.js";import{L as la}from"./loader-circle-CrvBvIt1.js";import"./dom-to-image-more.min-BAoslaO8.js";import{C as Ts}from"./chevron-left-B2s3ZsB7.js";import{U as ca}from"./user-BvYmyGTY.js";import{F as da}from"./filter-Ci9tsc_e.js";import{C as ma}from"./copy-6OEekgvq.js";import{C as ga}from"./circle-check-big-D6DM3vPb.js";import{u as ha}from"./useDrag-BaORhKlM.js";import"./index-yBjzXJbu.js";import"./sparkles-DeLUn6av.js";import"./sliders-vertical-C5ts4taK.js";import"./settings-BSPs3Zt8.js";import"./chevron-up-D78jyEhP.js";import"./TextElement-_pvTHO57.js";import"./upload-qgEr5bIl.js";import"./typeof-QjJsDpFa.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./PaymentModal-Bxx5p2o_.js";import"./index-Chjiymov.js";import"./download-Dh5rRDOT.js";import"./index-BSWw-p5k.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=G("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=G("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=G("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=G("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=G("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=G("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=G("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=G("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=G("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=G("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=G("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=G("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=G("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=G("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=G("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=G("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=G("Heading3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=G("Heading4",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17 10v4h4",key:"13sv97"}],["path",{d:"M21 10v8",key:"1kdml4"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=G("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=G("IndentDecrease",[["polyline",{points:"7 8 3 12 7 16",key:"2j60jr"}],["line",{x1:"21",x2:"11",y1:"12",y2:"12",key:"1fxxak"}],["line",{x1:"21",x2:"11",y1:"6",y2:"6",key:"asgu94"}],["line",{x1:"21",x2:"11",y1:"18",y2:"18",key:"13dsj7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=G("IndentIncrease",[["polyline",{points:"3 8 7 12 3 16",key:"f3rxhf"}],["line",{x1:"21",x2:"11",y1:"12",y2:"12",key:"1fxxak"}],["line",{x1:"21",x2:"11",y1:"6",y2:"6",key:"asgu94"}],["line",{x1:"21",x2:"11",y1:"18",y2:"18",key:"13dsj7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=G("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=G("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=G("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=G("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=G("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=G("PaintBucket",[["path",{d:"m19 11-8-8-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0L19 11Z",key:"irua1i"}],["path",{d:"m5 2 5 5",key:"1lls2c"}],["path",{d:"M2 13h15",key:"1hkzvu"}],["path",{d:"M22 20a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4 .3 1.6 2 2.4 2 4Z",key:"xk76lq"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=G("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=G("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=G("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=G("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=G("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=G("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=G("Sticker",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M14 3v4a2 2 0 0 0 2 2h4",key:"36rjfy"}],["path",{d:"M8 13h.01",key:"1sbv64"}],["path",{d:"M16 13h.01",key:"wip0gl"}],["path",{d:"M10 16s.8 1 2 1c1.3 0 2-1 2-1",key:"1vvgv3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=G("Strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=G("Subscript",[["path",{d:"m4 5 8 8",key:"1eunvl"}],["path",{d:"m12 5-8 8",key:"1ah0jp"}],["path",{d:"M20 19h-4c0-1.5.44-2 1.5-2.5S20 15.33 20 14c0-.47-.17-.93-.48-1.29a2.11 2.11 0 0 0-2.62-.44c-.42.24-.74.62-.9 1.07",key:"e8ta8j"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=G("Superscript",[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=G("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=G("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=G("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=G("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),Ya=({pages:s,currentPage:m,selectedCell:l,selectedElement:j,onSelectCell:o,onSelectElement:h,onUpdateElement:y,onDeleteElement:v,onMoveElement:I})=>{var d;if(!s||!s[m])return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(It,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No page data available"})]});const S=s[m],C=((d=S==null?void 0:S.cells)==null?void 0:d.filter(w=>w.elements&&w.elements.length>0))||[],[A,_]=g.useState(()=>{const w={};return C.forEach(O=>{w[O.id]=!0}),w}),X=w=>{_(O=>({...O,[w]:!O[w]}))},W=w=>{switch(w){case"image":return e.jsx(Se,{className:"h-4 w-4"});case"text":return e.jsx(Ue,{className:"h-4 w-4"});case"shape":return e.jsx(Fs,{className:"h-4 w-4"});case"sticker":return e.jsx(ea,{className:"h-4 w-4"});default:return e.jsx(Na,{className:"h-4 w-4"})}},B=(w,O)=>{switch(w.type){case"text":return w.content?w.content.substring(0,20)+"...":"Text Layer";case"image":return`Image ${O+1}`;case"shape":return w.shape||"Shape";case"sticker":return`Sticker ${O+1}`;default:return`Element ${O+1}`}},n=(w,O,ae)=>{y(w,O,{visible:ae})},H=(w,O)=>{o(w),h(O)};return e.jsx("div",{className:"space-y-2",children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(It,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No elements yet"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Add elements to see them here"})]}):C.map(w=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center p-3 cursor-pointer transition-colors ${l===w.id?"bg-purple-50 border-purple-200":"hover:bg-gray-50"}`,onClick:()=>{X(w.id),o(w.id)},children:[e.jsx("button",{className:"mr-2 text-gray-500 hover:text-gray-700",children:A[w.id]?e.jsx(Ls,{className:"h-4 w-4"}):e.jsx(Zs,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm text-gray-800",children:["Cell ",w.id]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[w.elements.length," element",w.elements.length!==1?"s":""]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[w.x,", ",w.y]})]}),A[w.id]&&e.jsx("div",{className:"border-t border-gray-100",children:w.elements.map((O,ae)=>e.jsxs("div",{className:`flex items-center p-2 mx-2 mb-2 rounded cursor-pointer transition-colors ${j===O.id?"bg-purple-100 border border-purple-200":"hover:bg-gray-50"}`,onClick:()=>H(w.id,O.id),children:[e.jsx("div",{className:"mr-2 text-gray-500",children:W(O.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm truncate",children:B(O,ae)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[O.type," • Layer ",ae+1]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:M=>{M.stopPropagation(),n(w.id,O.id,!O.visible)},className:"p-1 hover:bg-gray-200 rounded",title:O.visible?"Hide element":"Show element",children:O.visible!==!1?e.jsx(Ds,{className:"h-3 w-3 text-gray-500"}):e.jsx(Ca,{className:"h-3 w-3 text-gray-400"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),I(w.id,O.id,"up")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer up",disabled:ae===w.elements.length-1,children:e.jsx(ba,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),I(w.id,O.id,"down")},className:"p-1 hover:bg-gray-200 rounded",title:"Move layer down",disabled:ae===0,children:e.jsx(ya,{className:"h-3 w-3 text-gray-500"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),v(w.id,O.id)},className:"p-1 hover:bg-red-100 rounded text-red-500",title:"Delete element",children:e.jsx(Pt,{className:"h-3 w-3"})})]})]},O.id))})]},w.id))})};function Qa({currentLayoutId:s,onLayoutChange:m}){const[l,j]=g.useState("all"),o={all:{name:"Todos",layouts:ce},hero:{name:"Hero",layouts:ce.filter(h=>h.category==="hero")},editorial:{name:"Editorial",layouts:ce.filter(h=>h.category==="editorial")},storytelling:{name:"Historia",layouts:ce.filter(h=>h.category==="storytelling")},minimal:{name:"Minimal",layouts:ce.filter(h=>h.category==="minimal")},creative:{name:"Creativo",layouts:ce.filter(h=>h.category==="creative")},classic:{name:"Clásico",layouts:ce.filter(h=>h.category==="classic")}};return Object.keys(o).filter(h=>h==="all"||o[h].layouts.length>0),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"grid grid-cols-2  gap-3 overflow-x-hidden custom-scroll",children:o[l].layouts.map(h=>e.jsxs("div",{className:`relative group cursor-pointer transition-all duration-200 
                                 hover:shadow-md hover:scale-102
                        `,onClick:()=>m(h.id),children:[e.jsxs("div",{className:"aspect-square relative bg-white rounded-lg p-2 border border-gray-200",children:[e.jsx("div",{className:`w-full h-full grid ${h.template}`,style:{gap:"2px",padding:"4px"},children:Array.from({length:h.cells}).map((y,v)=>{var I,S;return e.jsx("div",{className:`bg-gradient-to-br from-purple-100 to-purple-200 ${(S=(I=h.cellStyles)==null?void 0:I[v])!=null&&S.includes("rounded")?"rounded":"rounded-sm"}`,style:{minHeight:"8px"}},v)})}),s===h.id&&e.jsx("div",{className:"absolute top-1/2 right-1/2 translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-900 truncate",children:h.name}),h.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:h.description}),e.jsx("div",{className:"flex items-center justify-center mt-1 space-x-2",children:e.jsxs("span",{className:"text-xs text-gray-400",children:[h.cells," ",h.cells===1?"celda":"celdas"]})})]})]},h.id))}),o[l].layouts.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"No hay layouts disponibles en esta categoría."})})]})}const Za=({selectedMask:s,onSelect:m,availableMasks:l=[],selectedImage:j})=>{var v,I;const[o,h]=g.useState("Básicas"),y={};return Ms.forEach(S=>{y[S.category]||(y[S.category]=[]),(l.includes(S.id)||S.id==="none")&&y[S.category].push(S)}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-1 bg-gray-100 p-1 rounded-lg",children:Object.keys(y).slice(0,2).map(S=>y[S].length>0&&e.jsx("button",{onClick:()=>h(S),className:`py-1.5 px-2 text-xs rounded-md transition font-medium ${o===S?"bg-white text-purple-700 shadow-sm":"text-gray-600 hover:text-purple-600"}`,children:S},S))}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(v=y[o])==null?void 0:v.slice(0,6).map(S=>e.jsxs("div",{onClick:()=>m(S.id),className:`cursor-pointer border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all ${s===S.id?"ring-2 ring-purple-500 border-purple-300":"border-gray-200"}`,children:[e.jsx("div",{className:"aspect-square bg-white flex items-center justify-center p-1",children:j!=null&&j.content?e.jsx("img",{src:j.content,alt:S.name,className:`w-full h-full object-cover ${S.class}`}):e.jsx("div",{className:`w-full h-full bg-gray-200 ${S.class}`})}),e.jsx("p",{className:"text-center text-[10px] text-gray-700 p-1 truncate",children:S.name})]},S.id))}),((I=y[o])==null?void 0:I.length)>6&&e.jsxs("button",{className:"w-full py-2 text-xs text-purple-600 hover:text-purple-700 border border-purple-200 rounded-lg hover:bg-purple-50 transition",children:["Ver más máscaras (",y[o].length-6," más)"]})]})},Da=[{name:"Arial",value:"Arial"},{name:"Times New Roman",value:"'Times New Roman'"},{name:"Helvetica",value:"Helvetica"},{name:"Courier New",value:"'Courier New'"},{name:"Georgia",value:"Georgia"},{name:"Verdana",value:"Verdana"},{name:"Impact",value:"Impact"},{name:"Roboto",value:"'Roboto', sans-serif"},{name:"Open Sans",value:"'Open Sans', sans-serif"},{name:"Lato",value:"'Lato', sans-serif"},{name:"Pacifico (Cursiva)",value:"'Pacifico', cursive"},{name:"Lobster (Estilo Poster)",value:"'Lobster', cursive"},{name:"Indie Flower (Manuscrita)",value:"'Indie Flower', cursive"},{name:"Permanent Marker (Rotulador)",value:"'Permanent Marker', cursive"},{name:"Dancing Script (Elegante)",value:"'Dancing Script', cursive"},{name:"Shadows Into Light (Dibujada)",value:"'Shadows Into Light', cursive"},{name:"Amatic SC (Minimalista)",value:"'Amatic SC', cursive"},{name:"Handlee (Natural)",value:"'Handlee', cursive"},{name:"Caveat (Caligráfica)",value:"'Caveat', cursive"},{name:"Kalam (Pincel)",value:"'Kalam', cursive"}],er=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","32px","36px","42px","48px","64px","72px"],tr=[{label:"Normal",value:"none"},{label:"MAYÚSCULAS",value:"uppercase"},{label:"minúsculas",value:"lowercase"},{label:"Capitalizado",value:"capitalize"}],sr=[{color:"#000000",name:"Negro"},{color:"#ffffff",name:"Blanco"},{color:"#f43f5e",name:"Rojo"},{color:"#22c55e",name:"Verde"},{color:"#3b82f6",name:"Azul"},{color:"#eab308",name:"Amarillo"},{color:"#06b6d4",name:"Cian"},{color:"#d946ef",name:"Magenta"},{color:"#6b7280",name:"Gris"},{color:"#a855f7",name:"Púrpura"},{color:"#ec4899",name:"Rosa"},{color:"#f97316",name:"Naranja"},{color:"#0f172a",name:"Azul oscuro"},{color:"#7c2d12",name:"Marrón"},{color:"#14532d",name:"Verde oscuro"},{color:"#4c1d95",name:"Violeta"},{color:"#1e293b",name:"Gris oscuro"},{color:"#fef3c7",name:"Crema"}],ar=[{color:"transparent",name:"Transparente"},{color:"#ffffff",name:"Blanco"},{color:"#f8fafc",name:"Gris claro"},{color:"#f1f5f9",name:"Plata"},{color:"#fef3c7",name:"Crema"},{color:"#ffedd5",name:"Melocotón"},{color:"#fee2e2",name:"Rosa claro"},{color:"#dbeafe",name:"Azul claro"},{color:"#dcfce7",name:"Verde claro"},{color:"#f3e8ff",name:"Lavanda"}],rr=[{label:"Ninguno",value:"none"},{label:"Sólido",value:"solid"},{label:"Punteado",value:"dotted"},{label:"Discontinuo",value:"dashed"},{label:"Doble",value:"double"},{label:"Acanalado",value:"groove"}],nr=({element:s,onUpdate:m,onClose:l})=>{var Ce,ee,te,$e,vt,Ee,Le,_e,qe,ze,rt,ye,Ge,$,Ke,Fe,be,We,xe,Je,pe,Oe,Xe,nt,ot,Ae,Ye,it,lt,Qe,ct,Ze,dt,mt,He,gt,ht,De,ut,et,Ie;const[j,o]=g.useState(!1),[h,y]=g.useState(!1),[v,I]=g.useState(!1),[S,C]=g.useState(!1),[A,_]=g.useState(!1),[X,W]=g.useState(!1),[B,n]=g.useState(!1),[H,d]=g.useState(!1),[w,O]=g.useState("basic"),[ae,M]=g.useState(((Ce=s==null?void 0:s.style)==null?void 0:Ce.color)||"#000000"),[Q,L]=g.useState(((ee=s==null?void 0:s.style)==null?void 0:ee.backgroundColor)||"transparent"),ge=g.useRef(null),F=g.useRef(null),le=g.useRef(null),fe=g.useRef(null),we=g.useRef(null),re=g.useRef(null),de=g.useRef(null);g.useEffect(()=>{function u(Y){ge.current&&!ge.current.contains(Y.target)&&o(!1),F.current&&!F.current.contains(Y.target)&&y(!1),le.current&&!le.current.contains(Y.target)&&C(!1),fe.current&&!fe.current.contains(Y.target)&&_(!1),we.current&&!we.current.contains(Y.target)&&W(!1),re.current&&!re.current.contains(Y.target)&&I(!1),de.current&&!de.current.contains(Y.target)&&n(!1)}return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[]);const f=(u,Y)=>{m({style:{...s==null?void 0:s.style,[u]:Y}})},V=(u,Y,he)=>{var je;m({style:{...s==null?void 0:s.style,[u]:((je=s==null?void 0:s.style)==null?void 0:je[u])===Y?he:Y}})},ne=(u,Y)=>{f(u,Y)};if(!s)return null;const D=({active:u,onClick:Y,icon:he,title:je,className:tt=""})=>e.jsx("button",{type:"button",className:`p-1.5 rounded-sm transition-colors ${u?"bg-gray-200 text-gray-900":"text-gray-700 hover:bg-gray-100"} ${tt}`,onClick:Y,title:je,children:he}),Ve=({onClick:u,icon:Y,text:he,isOpen:je,title:tt})=>e.jsxs("button",{type:"button",className:`flex items-center gap-1 px-2 py-1.5 rounded-md border ${je?"bg-gray-100 border-gray-300":"border-gray-200 hover:bg-gray-50"}`,onClick:u,title:tt,children:[Y&&e.jsx("span",{className:"flex-shrink-0",children:Y}),he&&e.jsx("span",{className:"text-sm truncate",children:he}),e.jsx(Ls,{className:"h-3.5 w-3.5 opacity-70"})]});return e.jsx("div",{className:"  bg-white  rounded-lg shadow-sm px-4  border-gray-200  z-50 transition-all duration-200",children:e.jsxs("div",{className:"w-full ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center gap-1.5",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Formato de texto"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 rounded-md hover:bg-gray-100",onClick:()=>d(!H),title:H?"Modo compacto":"Modo expandido",children:H?e.jsx(_a,{className:"h-4 w-4"}):e.jsx(La,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-1 rounded-md hover:bg-gray-100",onClick:l,title:"Cerrar",children:e.jsx(sa,{className:"h-4 w-4"})})]})]}),H&&e.jsxs("div",{className:"flex border-b mb-2",children:[e.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${w==="basic"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>O("basic"),children:"Básico"}),e.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${w==="paragraph"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>O("paragraph"),children:"Párrafo"}),e.jsx("button",{className:`px-3 py-1.5 text-sm font-medium ${w==="advanced"?"border-b-2 border-primary customtext-primary":"customtext-neutral-dark"}`,onClick:()=>O("advanced"),children:"Avanzado"})]}),(w==="basic"||!H)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 items-center",children:[e.jsx("div",{className:"relative",ref:le,children:e.jsx("select",{className:"px-2 py-1 border rounded-md text-sm",value:((te=s.style)==null?void 0:te.fontFamily)||"Arial",onChange:u=>{f("fontFamily",u.target.value)},children:Da.map(u=>e.jsx("option",{value:u.value,style:{fontFamily:u.value},children:u.name},u.value))})}),e.jsxs("div",{className:"relative",ref:fe,children:[e.jsx(Ve,{onClick:()=>_(!A),text:(($e=s.style)==null?void 0:$e.fontSize)||"16px",isOpen:A,title:"Tamaño de fuente"}),A&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] max-h-60 overflow-y-auto w-24",children:er.map(u=>e.jsx("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm",onClick:()=>{f("fontSize",u),_(!1)},children:u},u))})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((vt=s.style)==null?void 0:vt.fontWeight)==="bold",onClick:()=>V("fontWeight","bold","normal"),icon:e.jsx(va,{className:"h-4 w-4"}),title:"Negrita"}),e.jsx(D,{active:((Ee=s.style)==null?void 0:Ee.fontStyle)==="italic",onClick:()=>V("fontStyle","italic","normal"),icon:e.jsx(Ra,{className:"h-4 w-4"}),title:"Cursiva"}),e.jsx(D,{active:((Le=s.style)==null?void 0:Le.textDecoration)==="underline",onClick:()=>V("textDecoration","underline","none"),icon:e.jsx(Ja,{className:"h-4 w-4"}),title:"Subrayado"}),e.jsx(D,{active:((_e=s.style)==null?void 0:_e.textDecoration)==="line-through",onClick:()=>V("textDecoration","line-through","none"),icon:e.jsx(qa,{className:"h-4 w-4"}),title:"Tachado"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((qe=s.style)==null?void 0:qe.textAlign)==="left",onClick:()=>f("textAlign","left"),icon:e.jsx(pa,{className:"h-4 w-4"}),title:"Alinear a la izquierda"}),e.jsx(D,{active:((ze=s.style)==null?void 0:ze.textAlign)==="center",onClick:()=>f("textAlign","center"),icon:e.jsx(ua,{className:"h-4 w-4"}),title:"Centrar"}),e.jsx(D,{active:((rt=s.style)==null?void 0:rt.textAlign)==="right",onClick:()=>f("textAlign","right"),icon:e.jsx(fa,{className:"h-4 w-4"}),title:"Alinear a la derecha"}),e.jsx(D,{active:((ye=s.style)==null?void 0:ye.textAlign)==="justify",onClick:()=>f("textAlign","justify"),icon:e.jsx(xa,{className:"h-4 w-4"}),title:"Justificar"})]}),e.jsxs("div",{className:"relative",ref:ge,children:[e.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>o(!j),title:"Color de texto",children:[e.jsx("div",{className:"w-4 h-4 rounded-sm border",style:{backgroundColor:ae}}),e.jsx(aa,{className:"h-4 w-4"})]}),j&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium",children:"Color personalizado"}),e.jsx("div",{className:"w-6 h-6 rounded-md border",style:{backgroundColor:ae}})]}),e.jsx("input",{type:"color",value:ae,onChange:u=>{M(u.target.value),f("color",u.target.value)},className:"w-full h-8 cursor-pointer"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1.5",children:"Colores predefinidos"}),e.jsx("div",{className:"grid grid-cols-6 gap-1.5",children:sr.map(u=>e.jsx("button",{type:"button",className:`w-8 h-8 rounded-md cursor-pointer border transition-all hover:scale-110 ${ae===u.color?"ring-2 ring-offset-1 ring-blue-500":""}`,style:{backgroundColor:u.color},onClick:()=>{M(u.color),f("color",u.color)},title:u.name},u.color))})]})]})})]}),e.jsxs("div",{className:"relative",ref:F,children:[e.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>y(!h),title:"Color de fondo",children:[e.jsx("div",{className:"w-4 h-4 rounded-sm border",style:{backgroundColor:Q,backgroundImage:Q==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"}}),e.jsx(Fa,{className:"h-4 w-4"})]}),h&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium",children:"Color de fondo personalizado"}),e.jsx("div",{className:"w-6 h-6 rounded-md border",style:{backgroundColor:Q,backgroundImage:Q==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"}})]}),e.jsx("input",{type:"color",value:Q==="transparent"?"#ffffff":Q,onChange:u=>{L(u.target.value),f("backgroundColor",u.target.value)},className:"w-full h-8 cursor-pointer"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1.5",children:"Fondos predefinidos"}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:ar.map(u=>e.jsx("button",{type:"button",className:`w-10 h-10 rounded-md cursor-pointer border transition-all hover:scale-110 ${Q===u.color?"ring-2 ring-offset-1 ring-blue-500":""}`,style:{backgroundColor:u.color,backgroundImage:u.color==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 4px 4px"},onClick:()=>{L(u.color),f("backgroundColor",u.color)},title:u.name},u.color))})]})]})})]}),e.jsxs("div",{className:"relative",ref:we,children:[e.jsx("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>W(!X),title:"Transformación de texto",children:e.jsx(ja,{className:"h-4 w-4"})}),X&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] w-48",children:tr.map(u=>{var Y;return e.jsx("button",{className:`w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm ${((Y=s.style)==null?void 0:Y.textTransform)===u.value?"bg-gray-100":""}`,style:{textTransform:u.value},onClick:()=>{f("textTransform",u.value),W(!1)},children:u.label},u.value)})})]}),e.jsxs("div",{className:"relative",ref:de,children:[e.jsx("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>n(!B),title:"Encabezados",children:e.jsx(Ue,{className:"h-4 w-4"})}),B&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-10 w-48",children:[e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{f("fontSize","32px"),f("fontWeight","bold"),n(!1)},children:[e.jsx(Ea,{className:"h-4 w-4"})," ","Encabezado 1"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{f("fontSize","24px"),f("fontWeight","bold"),n(!1)},children:[e.jsx(Aa,{className:"h-4 w-4"})," ","Encabezado 2"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{f("fontSize","20px"),f("fontWeight","bold"),n(!1)},children:[e.jsx(Ia,{className:"h-4 w-4"})," ","Encabezado 3"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{f("fontSize","16px"),f("fontWeight","bold"),n(!1)},children:[e.jsx(Pa,{className:"h-4 w-4"})," ","Encabezado 4"]}),e.jsxs("button",{className:"w-full text-left px-3 py-1.5 hover:bg-gray-100 text-sm flex items-center gap-2",onClick:()=>{f("fontSize","16px"),f("fontWeight","normal"),n(!1)},children:[e.jsx(Ue,{className:"h-4 w-4"})," Párrafo normal"]})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((Ge=s.style)==null?void 0:Ge.verticalAlign)==="super",onClick:()=>V("verticalAlign","super","baseline"),icon:e.jsx(Ka,{className:"h-4 w-4"}),title:"Superíndice"}),e.jsx(D,{active:(($=s.style)==null?void 0:$.verticalAlign)==="sub",onClick:()=>V("verticalAlign","sub","baseline"),icon:e.jsx(Ga,{className:"h-4 w-4"}),title:"Subíndice"})]})]}),H&&w==="paragraph"&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((Ke=s.style)==null?void 0:Ke.listStyleType)==="disc",onClick:()=>{var u;return f("listStyleType",((u=s.style)==null?void 0:u.listStyleType)==="disc"?"none":"disc")},icon:e.jsx($a,{className:"h-4 w-4"}),title:"Lista con viñetas"}),e.jsx(D,{active:((Fe=s.style)==null?void 0:Fe.listStyleType)==="decimal",onClick:()=>{var u;return f("listStyleType",((u=s.style)==null?void 0:u.listStyleType)==="decimal"?"none":"decimal")},icon:e.jsx(Ma,{className:"h-4 w-4"}),title:"Lista numerada"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{onClick:()=>{var Y;const u=Number.parseInt(((Y=s.style)==null?void 0:Y.textIndent)||"0");f("textIndent",`${u+20}px`)},icon:e.jsx(Oa,{className:"h-4 w-4"}),title:"Aumentar sangría"}),e.jsx(D,{onClick:()=>{var Y;const u=Number.parseInt(((Y=s.style)==null?void 0:Y.textIndent)||"0");u>=20&&f("textIndent",`${u-20}px`)},icon:e.jsx(za,{className:"h-4 w-4"}),title:"Disminuir sangría"})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Altura de línea:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:"h-3 w-3 text-gray-500"}),e.jsx("input",{type:"range",min:"1",max:"3",step:"0.1",value:Number.parseFloat(((be=s.style)==null?void 0:be.lineHeight)||"1.5"),onChange:u=>ne("lineHeight",u.target.value),className:"w-24"}),e.jsx(Be,{className:"h-3 w-3 text-gray-500"})]}),e.jsx("span",{className:"text-xs",children:((We=s.style)==null?void 0:We.lineHeight)||"1.5"})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Espaciado:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:"h-3 w-3 text-gray-500"}),e.jsx("input",{type:"range",min:"-2",max:"10",step:"1",value:Number.parseInt(((xe=s.style)==null?void 0:xe.letterSpacing)||"0"),onChange:u=>ne("letterSpacing",`${u.target.value}px`),className:"w-24"}),e.jsx(Be,{className:"h-3 w-3 text-gray-500"})]}),e.jsx("span",{className:"text-xs",children:((Je=s.style)==null?void 0:Je.letterSpacing)||"0px"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md",children:[e.jsx(D,{active:((pe=s.style)==null?void 0:pe.fontStyle)==="italic"&&((Oe=s.style)==null?void 0:Oe.paddingLeft)==="20px"&&((Xe=s.style)==null?void 0:Xe.borderLeft)==="4px solid #ccc",onClick:()=>{var u,Y,he;((u=s.style)==null?void 0:u.fontStyle)==="italic"&&((Y=s.style)==null?void 0:Y.paddingLeft)==="20px"&&((he=s.style)==null?void 0:he.borderLeft)==="4px solid #ccc"?(f("fontStyle","normal"),f("paddingLeft","0"),f("borderLeft","none")):(f("fontStyle","italic"),f("paddingLeft","20px"),f("borderLeft","4px solid #ccc"))},icon:e.jsx(Ha,{className:"h-4 w-4"}),title:"Formato de cita"}),e.jsx(D,{active:((nt=s.style)==null?void 0:nt.fontFamily)==="'Courier New', monospace"&&((ot=s.style)==null?void 0:ot.backgroundColor)==="#f5f5f5"&&((Ae=s.style)==null?void 0:Ae.padding)==="2px 4px",onClick:()=>{var u,Y;((u=s.style)==null?void 0:u.fontFamily)==="'Courier New', monospace"&&((Y=s.style)==null?void 0:Y.backgroundColor)==="#f5f5f5"?(f("fontFamily","Arial, sans-serif"),f("backgroundColor","transparent"),f("padding","0")):(f("fontFamily","'Courier New', monospace"),f("backgroundColor","#f5f5f5"),f("padding","2px 4px"))},icon:e.jsx(ka,{className:"h-4 w-4"}),title:"Formato de código"})]})]}),H&&w==="advanced"&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-2",children:[e.jsxs("div",{className:"relative",ref:re,children:[e.jsxs("button",{className:"flex items-center gap-1 px-2 py-1.5 rounded-md border border-gray-200 hover:bg-gray-50",onClick:()=>I(!v),title:"Opciones de borde",children:[e.jsx(Fs,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Bordes"})]}),v&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-[9999] p-3 w-64",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Estilo de borde"}),e.jsx("select",{className:"w-full p-1.5 border rounded-md text-sm",value:((Ye=s.style)==null?void 0:Ye.borderStyle)||"none",onChange:u=>f("borderStyle",u.target.value),children:rr.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),((it=s.style)==null?void 0:it.borderStyle)&&((lt=s.style)==null?void 0:lt.borderStyle)!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Ancho de borde"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:Number.parseInt(((Qe=s.style)==null?void 0:Qe.borderWidth)||"1"),onChange:u=>f("borderWidth",`${u.target.value}px`),className:"flex-1"}),e.jsx("span",{className:"text-xs",children:((ct=s.style)==null?void 0:ct.borderWidth)||"1px"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Color de borde"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((Ze=s.style)==null?void 0:Ze.borderColor)||"#000000",onChange:u=>f("borderColor",u.target.value),className:"w-8 h-8"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 flex-1",children:["#000000","#cccccc","#ff0000","#0000ff","#00ff00"].map(u=>e.jsx("button",{type:"button",className:"w-6 h-6 rounded-sm border",style:{backgroundColor:u},onClick:()=>f("borderColor",u)},u))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Radio de borde"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:Number.parseInt(((dt=s.style)==null?void 0:dt.borderRadius)||"0"),onChange:u=>f("borderRadius",`${u.target.value}px`),className:"flex-1"}),e.jsx("span",{className:"text-xs",children:((mt=s.style)==null?void 0:mt.borderRadius)||"0px"})]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Sombra:"}),e.jsx("button",{className:`px-2 py-1 text-xs rounded ${(He=s.style)!=null&&He.textShadow?"bg-blue-100 text-blue-700":"bg-gray-100"}`,onClick:()=>{var u;(u=s.style)!=null&&u.textShadow?f("textShadow",""):f("textShadow","1px 1px 2px rgba(0,0,0,0.3)")},children:(gt=s.style)!=null&&gt.textShadow?"Quitar":"Añadir"}),((ht=s.style)==null?void 0:ht.textShadow)&&e.jsxs("select",{className:"text-xs p-1 border rounded",value:(De=s.style)==null?void 0:De.textShadow,onChange:u=>f("textShadow",u.target.value),children:[e.jsx("option",{value:"1px 1px 2px rgba(0,0,0,0.3)",children:"Suave"}),e.jsx("option",{value:"2px 2px 4px rgba(0,0,0,0.4)",children:"Medio"}),e.jsx("option",{value:"3px 3px 6px rgba(0,0,0,0.5)",children:"Fuerte"}),e.jsx("option",{value:"0 0 5px rgba(0,0,255,0.5)",children:"Resplandor azul"}),e.jsx("option",{value:"0 0 5px rgba(255,0,0,0.5)",children:"Resplandor rojo"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Opacidad:"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:Number.parseFloat(((ut=s.style)==null?void 0:ut.opacity)||"1"),onChange:u=>ne("opacity",u.target.value),className:"w-24"})}),e.jsxs("span",{className:"text-xs",children:[Math.round(Number.parseFloat(((et=s.style)==null?void 0:et.opacity)||"1")*100),"%"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("button",{className:`flex items-center gap-1 px-2 py-1.5 rounded-md border ${((Ie=s.style)==null?void 0:Ie.backgroundColor)==="#ffff00"?"bg-yellow-100":"bg-white hover:bg-gray-50"}`,onClick:()=>{var u;((u=s.style)==null?void 0:u.backgroundColor)==="#ffff00"?f("backgroundColor","transparent"):f("backgroundColor","#ffff00")},title:"Resaltar texto",children:[e.jsx(Ta,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Resaltar"})]})}),e.jsxs("div",{className:"flex items-center gap-0.5 border rounded-md ml-auto",children:[e.jsx(D,{onClick:()=>{alert("Función deshacer (implementar)")},icon:e.jsx($s,{className:"h-4 w-4"}),title:"Deshacer"}),e.jsx(D,{onClick:()=>{alert("Función rehacer (implementar)")},icon:e.jsx(Ua,{className:"h-4 w-4"}),title:"Rehacer"})]})]})]})})},or=({currentSize:s,onSizeChange:m,presetData:l,workspaceDimensions:j})=>((()=>{if(l!=null&&l.canvas_config){const h=typeof l.canvas_config=="string"?JSON.parse(l.canvas_config):l.canvas_config;let y=h.width,v=h.height;return{width:y,height:v,unit:"cm"}}return null})(),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 h-full items-center",children:j&&e.jsx("div",{className:"text-sm customtext-neutral-dark font-medium ml-2",children:j.originalWidth&&e.jsxs("div",{children:["Dimensiones: ",j.originalWidth," cm x",j.originalHeight," cm"]})})}));function ir(s,m){var A,_,X,W;const l=parseInt((_=(A=s.style)==null?void 0:A.gap)==null?void 0:_.replace("px",""))||16,j=parseInt((W=(X=s.style)==null?void 0:X.padding)==null?void 0:W.replace("px",""))||16,o=B=>{const n=B.match(/grid-cols-(\d+)/),H=B.match(/grid-rows-(\d+)/),d=n?parseInt(n[1]):1,w=H?parseInt(H[1]):1;return{cols:d,rows:w}},{cols:h,rows:y}=o(s.template),v=m.width-2*j,I=m.height-2*j,S=(v-l*(h-1))/h,C=(I-l*(y-1))/y;return console.log("🎯 [WORKSPACE REPLICA] Grid simulation:",{template:s.template,cols:h,rows:y,gap:l,padding:j,workspace:m,cellSize:{width:S,height:C}}),{cols:h,rows:y,gap:l,padding:j,cellWidth:S,cellHeight:C,contentX:j,contentY:j}}function Hs(s,m,l,j,o,h){if(!m||!s||o<=0||h<=0)return;const y=m.width/m.height,v=o/h;let I,S,C,A;y>v?(A=m.height,C=A*v,I=(m.width-C)/2,S=0):(C=m.width,A=C/v,I=0,S=(m.height-A)/2),s.save(),s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high";try{s.drawImage(m,Math.max(0,I),Math.max(0,S),Math.min(C,m.width-Math.max(0,I)),Math.min(A,m.height-Math.max(0,S)),l,j,o,h)}catch(_){console.error("Error dibujando imagen:",_)}s.restore()}function lr(s,m,l,j,o,h){return new Promise(async y=>{try{const v=new Image;v.crossOrigin="anonymous",v.onload=()=>{var n,H,d,w;const I=((n=m.position)==null?void 0:n.x)||0,S=((H=m.position)==null?void 0:H.y)||0,C=I>=0&&I<=1,A=S>=0&&S<=1,_=l+(C?I*o:I),X=j+(A?S*h:S),W=(d=m.size)!=null&&d.width?m.size.width<=1?m.size.width*o:m.size.width:o,B=(w=m.size)!=null&&w.height?m.size.height<=1?m.size.height*h:m.size.height:h;console.log("🖼️ [WORKSPACE REPLICA] Imagen:",{id:m.id,cellPos:{x:l,y:j,width:o,height:h},elementPos:{x:_,y:X,width:W,height:B},originalPos:{x:I,y:S},isRelative:{x:C,y:A}}),m.filters&&(s.filter=`
                        brightness(${(m.filters.brightness||100)/100})
                        contrast(${(m.filters.contrast||100)/100})
                        saturate(${(m.filters.saturation||100)/100})
                        blur(${m.filters.blur||0}px)
                        opacity(${(m.filters.opacity||100)/100})
                    `),Hs(s,v,_,X,W,B),s.filter="none",y()},v.onerror=()=>{console.error("Error cargando imagen:",m.content),y()},v.src=m.content}catch(v){console.error("Error en renderImageElement:",v),y()}})}function cr(s,m,l,j,o,h){var y,v,I,S;try{const C=((y=m.position)==null?void 0:y.x)||0,A=((v=m.position)==null?void 0:v.y)||0,_=C>=0&&C<=1,X=A>=0&&A<=1,W=l+(_?C*o:C),B=j+(X?A*h:A),n=(I=m.size)!=null&&I.width?m.size.width<=1?m.size.width*o:m.size.width:o*.8,H=(S=m.size)!=null&&S.height?m.size.height<=1?m.size.height*h:m.size.height:h*.2;console.log("📝 [WORKSPACE REPLICA] Texto:",{id:m.id,content:m.content,cellPos:{x:l,y:j,width:o,height:h},elementPos:{x:W,y:B,width:n,height:H}});const d=m.style||{},w=parseInt(d.fontSize)||16,O=d.fontFamily||"Arial, sans-serif",ae=d.fontWeight||"normal",M=d.fontStyle||"normal",Q=d.color||"#000000",L=d.textAlign||"left",ge=d.backgroundColor,F=parseInt(d.padding)||8;s.save(),s.font=`${ae} ${M} ${w}px ${O}`,s.fillStyle=Q,s.textBaseline="top",ge&&ge!=="transparent"&&(s.fillStyle=ge,s.fillRect(W,B,n,H),s.fillStyle=Q);const le=m.content.split(`
`),fe=w*1.2;le.forEach((we,re)=>{if(we.trim()){let de=W+F;const f=B+F+re*fe;L==="center"?(de=W+n/2,s.textAlign="center"):L==="right"?(de=W+n-F,s.textAlign="right"):s.textAlign="left",de>=0&&f>=0&&de<s.canvas.width&&f<s.canvas.height&&s.fillText(we,de,f)}}),s.restore()}catch(C){console.error("Error en renderTextElement:",C)}}async function dr({pages:s,workspaceDimensions:m,presetData:l}){var o;const j={};console.log("🎯 [WORKSPACE REPLICA] Iniciando generación IDÉNTICA al workspace..."),console.log("📐 [WORKSPACE REPLICA] Dimensiones:",m);for(const h of s)try{console.log(`🔄 [WORKSPACE REPLICA] Procesando página: ${h.id} (${h.type})`);const y=document.createElement("canvas"),v=y.getContext("2d",{willReadFrequently:!0});y.width=m.width,y.height=m.height,v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.textRendering="geometricPrecision",console.log("🎨 [WORKSPACE REPLICA] Renderizando background...");const I=h.backgroundColor||"#ffffff";if(v.fillStyle=I,v.fillRect(0,0,y.width,y.height),console.log("🎨 [WORKSPACE REPLICA] Background color aplicado:",I),h.backgroundImage)try{console.log("🖼️ [WORKSPACE REPLICA] Cargando background image:",h.backgroundImage);const B=new Image;B.crossOrigin="anonymous",await new Promise((n,H)=>{B.onload=n,B.onerror=H,B.src=h.backgroundImage}),Hs(v,B,0,0,y.width,y.height),console.log("✅ [WORKSPACE REPLICA] Background image aplicada")}catch(B){console.error("❌ [WORKSPACE REPLICA] Error con background image:",B)}console.log("🗂️ [WORKSPACE REPLICA] Renderizando grid layout...");const S=ce.find(B=>B.id===h.layout)||ce[0];console.log("📋 [WORKSPACE REPLICA] Layout actual:",S.name,S.template);const C=ir(S,m);if(h.cells&&Array.isArray(h.cells)){console.log(`📦 [WORKSPACE REPLICA] Renderizando ${h.cells.length} celdas...`);const B=[...h.cells].sort((n,H)=>{const d=h.cells.indexOf(n),w=h.cells.indexOf(H);return d-w});for(let n=0;n<B.length;n++){const H=B[n],d=Math.floor(n/C.cols),w=n%C.cols,O=C.contentX+w*(C.cellWidth+C.gap),ae=C.contentY+d*(C.cellHeight+C.gap);if(console.log(`📦 [WORKSPACE REPLICA] Celda ${n} (${H.id}):`,{gridPos:{row:d,col:w},realPos:{x:O,y:ae,width:C.cellWidth,height:C.cellHeight}}),v.save(),v.fillStyle="transparent",v.fillRect(O,ae,C.cellWidth,C.cellHeight),v.restore(),H.elements&&Array.isArray(H.elements)){const M=[...H.elements].sort((Q,L)=>(Q.zIndex||0)-(L.zIndex||0));console.log(`🔹 [WORKSPACE REPLICA] Renderizando ${M.length} elementos en celda ${H.id}`);for(const Q of M){if(Q.id==="cover-base"||Q.id==="final-base"||(o=Q.id)!=null&&o.startsWith("content-base-")){console.log("⏭️ [WORKSPACE REPLICA] Saltando elemento base:",Q.id);continue}console.log(`🔸 [WORKSPACE REPLICA] Renderizando elemento: ${Q.id} (${Q.type})`),Q.type==="image"&&Q.content?await lr(v,Q,O,ae,C.cellWidth,C.cellHeight):Q.type==="text"&&Q.content&&cr(v,Q,O,ae,C.cellWidth,C.cellHeight)}}}}console.log("🖼️ [WORKSPACE REPLICA] Generando thumbnail final...");const A=document.createElement("canvas"),_=A.getContext("2d"),X=1200,W=Math.min(X/y.width,X/y.height);A.width=Math.round(y.width*W),A.height=Math.round(y.height*W),_.imageSmoothingEnabled=!0,_.imageSmoothingQuality="high",_.drawImage(y,0,0,y.width,y.height,0,0,A.width,A.height),j[h.id]=A.toDataURL("image/png",.9),console.log(`✅ [WORKSPACE REPLICA] Thumbnail generado para ${h.id} (${h.type}): ${A.width}x${A.height}`),console.log(`📋 [WORKSPACE REPLICA] ID de la página: ${h.id}, Tipo: ${h.type}`)}catch(y){console.error(`❌ [WORKSPACE REPLICA] Error generando thumbnail para página ${h.id}:`,y),j[h.id]=null}return console.log("🎯 [WORKSPACE REPLICA] ¡Generación COMPLETADA! Thumbnails idénticos al workspace."),console.log("📋 [WORKSPACE REPLICA] Thumbnails generados:",Object.keys(j)),console.log("📊 [WORKSPACE REPLICA] Total de thumbnails:",Object.keys(j).length),j}const mr=async(s,m,l)=>{var j;try{console.log("📤 [SAVE] Subiendo imagen al backend:",m);const[o,h]=s.split(","),y=((j=o.match(/data:image\/(\w+)/))==null?void 0:j[1])||"png",v=new FormData,I=atob(h),S=new Array(I.length);for(let W=0;W<I.length;W++)S[W]=I.charCodeAt(W);const C=new Uint8Array(S),A=new Blob([C],{type:`image/${y}`});v.append("image",A,`element_${m}.${y}`),v.append("project_id",l),v.append("element_id",m);const _=await fetch("/api/canvas/projects/upload-image",{method:"POST",headers:{Accept:"application/json"},credentials:"include",body:v});if(!_.ok)throw new Error("Error al subir imagen al servidor");const X=await _.json();return console.log("✅ [SAVE] Imagen subida exitosamente:",X.url),X.url}catch(o){throw console.error("❌ [SAVE] Error subiendo imagen:",o),o}},gr=async(s,m)=>{var h,y;console.log("🔄 [SAVE] Procesando imágenes para guardado...");const l=[];let j=0,o=0;for(const v of s)for(const I of v.cells||[])for(const S of I.elements||[])S.type==="image"&&((h=S.content)!=null&&h.startsWith("data:image/"))&&j++;console.log(`📊 [SAVE] Total de imágenes base64 a procesar: ${j}`);for(const v of s){const I={...v};I.cells=[];for(const S of v.cells||[]){const C={...S};C.elements=[];for(const A of S.elements||[]){const _={...A};if(A.type==="image"&&((y=A.content)!=null&&y.startsWith("data:image/")))try{const X=await mr(A.content,A.id,m);_.content=X,_.isUploaded=!0,o++,console.log(`✅ [SAVE] Imagen ${o}/${j} procesada`)}catch(X){console.error("❌ [SAVE] Error procesando imagen:",A.id,X),_.uploadError=X.message}C.elements.push(_)}I.cells.push(C)}l.push(I)}return console.log(`✅ [SAVE] Procesamiento completado: ${o}/${j} imágenes subidas`),l},hr=async(s,m)=>{var l;try{console.log("🔍 [DEBUG] saveThumbnailsAsFiles llamada con:",{projectId:s,thumbnailsCount:Object.keys(m).length});const j=[];for(const[y,v]of Object.entries(m))console.log(`🔍 [DEBUG] Procesando thumbnail para página ${y}:`,{hasData:!!v,isBase64:v&&v.startsWith("data:image/"),dataLength:v?v.length:0}),v&&v.startsWith("data:image/")&&j.push({page_id:y,thumbnail_data:v});if(j.length===0){console.log("ℹ️ [THUMBNAILS] No hay thumbnails base64 para guardar");return}console.log(`🖼️ [THUMBNAILS] Guardando ${j.length} thumbnails como archivos...`),console.log(`🔍 [DEBUG] URL del endpoint: /api/thumbnails/${s}/save-as-files`);const o=await fetch(`/api/thumbnails/${s}/save-as-files`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)||""},credentials:"include",body:JSON.stringify({thumbnails:j})});if(console.log("🔍 [DEBUG] Respuesta del servidor:",{status:o.status,statusText:o.statusText,ok:o.ok}),!o.ok){const y=await o.text();throw console.error("❌ [THUMBNAILS] Error respuesta del servidor:",y),new Error(`Error al guardar thumbnails: ${o.status} ${o.statusText}`)}const h=await o.json();return console.log("✅ [THUMBNAILS] Thumbnails guardados como archivos:",h),h}catch(j){throw console.error("❌ [THUMBNAILS] Error guardando thumbnails:",j),j}},Rs=async(s,m,l,j,o,h,y=!1)=>{try{if(!(m!=null&&m.id))throw new Error("No se encontró el ID del proyecto");console.log(`💾 [SAVE] Iniciando ${y?"auto-guardado":"guardado manual"}...`);let v=s;y||(v=await gr(s,m.id));const I={pages:v,projectInfo:{id:m.id,item_id:l==null?void 0:l.id,title:l==null?void 0:l.title,preset_id:j==null?void 0:j.id},workspace:{width:o.width,height:o.height,scale:o.scale},meta:{savedAt:new Date().toISOString(),version:"2.0",isAutoSave:y,totalPages:s.length}},S=y?"save-progress":"save",C=await fetch(`/api/canvas/projects/${m.id}/${S}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({design_data:I,thumbnails:h})});if(!C.ok){const _=await C.json().catch(()=>({}));throw new Error(_.message||"Error al guardar el proyecto")}const A=await C.json();if(console.log(`✅ [SAVE] ${y?"Auto-guardado":"Guardado"} exitoso:`,A),!y&&h&&Object.keys(h).length>0){console.log("🖼️ [SAVE] Guardando thumbnails como archivos...");try{await hr(m.id,h),console.log("✅ [SAVE] Thumbnails guardados como archivos")}catch(_){console.warn("⚠️ [SAVE] Error guardando thumbnails como archivos:",_)}}return{success:!0,data:A}}catch(v){return console.error(`❌ [SAVE] Error en ${y?"auto-guardado":"guardado"}:`,v),{success:!1,error:v.message}}},ur=(s,m,l,j,o,h)=>{const[y,v]=g.useState("saved"),[I,S]=g.useState(null),[C,A]=g.useState(null),[_,X]=g.useState(null),[W,B]=g.useState(!1),[n,H]=g.useState(navigator.onLine),d=g.useRef(null),w=g.useRef(null),O=g.useRef(null),ae=g.useRef(!1),M=g.useRef(null),Q=15e3,L=2e3,ge=5e3,F=g.useCallback((f,V)=>{try{const ne={pages:f.map(D=>{var Ve;return{id:D.id,layout:D.layout,cells:((Ve=D.cells)==null?void 0:Ve.map(Ce=>{var ee;return{id:Ce.id,elements:((ee=Ce.elements)==null?void 0:ee.map(te=>{var $e;return{id:te.id,type:te.type,content:te.type==="image"&&(($e=te.content)!=null&&$e.startsWith("data:image/"))?`[IMAGE_${te.content.length}]`:te.content,position:te.position,size:te.size,style:te.style,filters:te.filters,rotation:te.rotation}}))||[]}}))||[]}})||[],workspace:{width:V==null?void 0:V.width,height:V==null?void 0:V.height}};return btoa(JSON.stringify(ne)).substring(0,32)}catch(ne){return console.warn("⚠️ [AUTO-SAVE] Error generando hash:",ne),Date.now().toString()}},[]),le=g.useCallback(()=>`album_editor_autosave_${(m==null?void 0:m.id)||"draft"}`,[m==null?void 0:m.id]),fe=g.useCallback(f=>{try{const V=le(),ne={...f,savedAt:Date.now(),version:"2.1"};return localStorage.setItem(V,JSON.stringify(ne)),console.log("💾 [AUTO-SAVE] Guardado en localStorage"),!0}catch(V){return console.error("❌ [AUTO-SAVE] Error guardando en localStorage:",V),!1}},[le]),we=g.useCallback(()=>{var f;try{const V=le(),ne=localStorage.getItem(V);if(ne){const D=JSON.parse(ne);return console.log("📂 [AUTO-SAVE] Datos encontrados en localStorage:",{pages:(f=D.pages)==null?void 0:f.length,savedAt:new Date(D.savedAt).toLocaleString()}),D}}catch(V){console.error("❌ [AUTO-SAVE] Error cargando desde localStorage:",V)}return null},[le]),re=g.useCallback(async(f=!1)=>{if(ae.current&&!f){console.log("⏳ [AUTO-SAVE] Guardado en progreso, saltando...");return}if(!(m!=null&&m.id)||!s||s.length===0){console.log("⚠️ [AUTO-SAVE] Datos insuficientes para guardar");return}const V=F(s,o);if(!f&&V===O.current){console.log("📊 [AUTO-SAVE] Sin cambios detectados, saltando guardado");return}try{ae.current=!0,v("saving"),X(null);const ne={pages:s,projectInfo:{id:m.id,item_id:l==null?void 0:l.id,title:l==null?void 0:l.title,preset_id:j==null?void 0:j.id},workspace:o,meta:{savedAt:new Date().toISOString(),version:"2.1",contentHash:V}};if(fe(ne),n){const D=await Rs(s,m,l,j,o,h,!0);if(D.success)O.current=V,A(new Date),v("saved"),B(!1),console.log("✅ [AUTO-SAVE] Guardado exitoso en base de datos");else throw new Error(D.error)}else console.log("� [AUTO-SAVE] Sin conexión, solo guardado en localStorage"),v("pending"),B(!0)}catch(ne){console.error("❌ [AUTO-SAVE] Error:",ne),X(ne.message),v("error"),n&&(M.current=setTimeout(()=>{console.log("🔄 [AUTO-SAVE] Reintentando guardado..."),re(!0)},ge))}finally{ae.current=!1}},[s,m,l,j,o,h,F,fe,n]),de=g.useCallback(async()=>{try{v("saving");const f=await Rs(s,m,l,j,o,h,!1);if(f.success){const V=F(s,o);O.current=V,S(new Date),v("saved"),B(!1),ie.success("💾 Proyecto guardado exitosamente"),console.log("✅ [MANUAL-SAVE] Guardado manual exitoso")}else X(f.error),v("error"),ie.error(`❌ Error al guardar: ${f.error}`);return f.success}catch(f){return console.error("❌ [MANUAL-SAVE] Error:",f),X(f.message),v("error"),ie.error(`❌ Error inesperado: ${f.message}`),!1}},[s,m,l,j,o,h,F]);return g.useEffect(()=>{if(!(m!=null&&m.id)||!s||s.length===0)return;const f=F(s,o);return O.current&&f!==O.current?(console.log("🔄 [AUTO-SAVE] Cambios detectados, programando guardado..."),B(!0),v("pending"),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{re()},L)):O.current||(O.current=f),()=>{w.current&&clearTimeout(w.current)}},[s,o,m==null?void 0:m.id,F,re]),g.useEffect(()=>{if(m!=null&&m.id)return d.current&&clearInterval(d.current),d.current=setInterval(()=>{W&&(console.log("⏰ [AUTO-SAVE] Auto-save periódico activado"),re())},Q),()=>{d.current&&clearInterval(d.current)}},[m==null?void 0:m.id,W,re]),g.useEffect(()=>{const f=()=>{console.log("🌐 [AUTO-SAVE] Conexión restaurada"),H(!0),W&&setTimeout(()=>re(!0),1e3)},V=()=>{console.log("📴 [AUTO-SAVE] Conexión perdida"),H(!1)};return window.addEventListener("online",f),window.addEventListener("offline",V),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",V)}},[W,re]),g.useEffect(()=>{const f=V=>{if(W){const ne={pages:s,projectInfo:{id:m.id},workspace:o,meta:{savedAt:new Date().toISOString()}};return fe(ne),V.preventDefault(),V.returnValue="¿Estás seguro de salir? Hay cambios sin guardar.","¿Estás seguro de salir? Hay cambios sin guardar."}};return window.addEventListener("beforeunload",f),()=>window.removeEventListener("beforeunload",f)},[W,s,m==null?void 0:m.id,o,fe]),g.useEffect(()=>()=>{w.current&&clearTimeout(w.current),d.current&&clearInterval(d.current),M.current&&clearTimeout(M.current)},[]),g.useEffect(()=>{_&&(_.includes("max_allowed_packet")||_.includes("data_too_large")?ie.error("❌ El proyecto es demasiado grande para guardar automáticamente. Reduce el número o tamaño de imágenes."):ie.error(`❌ Error de auto-guardado: ${_}`))},[_]),{saveStatus:y,lastSaved:I,lastAutoSaved:C,saveError:_,hasUnsavedChanges:W,isOnline:n,saveManually:de,performAutoSave:()=>re(!0),loadFromLocalStorage:we,getStorageKey:le,autoSaveInterval:Q,debounceDelay:L}},xr=({saveStatus:s,lastSaved:m,lastAutoSaved:l,hasUnsavedChanges:j,isOnline:o,saveError:h,onManualSave:y,className:v=""})=>{const I=A=>{if(!A)return null;const X=new Date-A,W=Math.floor(X/(1e3*60)),B=Math.floor(X/1e3);if(B<30)return"hace unos segundos";if(W<1)return`hace ${B}s`;if(W<60)return`hace ${W}m`;const n=Math.floor(W/60);return n<24?`hace ${n}h`:A.toLocaleDateString()},C=(()=>{if(!o)return{icon:e.jsx(Os,{className:"w-4 h-4"}),color:"text-orange-500",bg:"bg-orange-50 border-orange-200",text:"Sin conexión",detail:"Guardado local activo"};switch(s){case"saving":return{icon:e.jsx(la,{className:"w-4 h-4 animate-spin"}),color:"text-blue-500",bg:"bg-blue-50 border-blue-200",text:"Guardando...",detail:"Sincronizando cambios"};case"saved":return{icon:e.jsx(_s,{className:"w-4 h-4"}),color:"text-green-500",bg:"bg-green-50 border-green-200",text:"Guardado",detail:l?`Auto-guardado ${I(l)}`:"Todo sincronizado"};case"error":return{icon:e.jsx(Ws,{className:"w-4 h-4"}),color:"text-red-500",bg:"bg-red-50 border-red-200",text:"Error al guardar",detail:h||"Error desconocido"};case"pending":return{icon:e.jsx(ia,{className:"w-4 h-4"}),color:"text-yellow-600",bg:"bg-yellow-50 border-yellow-200",text:j?"Cambios pendientes":"Pendiente",detail:"Esperando a guardar..."};default:return{icon:e.jsx(na,{className:"w-4 h-4"}),color:"text-gray-500",bg:"bg-gray-50 border-gray-200",text:"Listo",detail:"Sistema de guardado activo"}}})();return e.jsxs("div",{className:`relative group ${v}`,children:[e.jsxs("div",{className:`
                    inline-flex items-center gap-2 px-3 py-2 rounded-lg border-2 
                    transition-all duration-200 cursor-pointer
                    ${C.bg} ${C.color}
                    hover:shadow-md
                `,onClick:()=>s!=="saving"&&(y==null?void 0:y()),children:[C.icon,e.jsx("span",{className:"text-sm font-medium",children:C.text}),j&&s!=="saving"&&e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),e.jsx("div",{className:"flex items-center",children:o?e.jsx(Xa,{className:"w-3 h-3 text-green-500"}):e.jsx(Os,{className:"w-3 h-3 text-orange-500"})})]}),e.jsxs("div",{className:`
                absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2
                bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg
                opacity-0 group-hover:opacity-100 pointer-events-none
                transition-opacity duration-200 z-50 whitespace-nowrap
            `,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:C.text}),e.jsx("div",{className:"text-gray-300",children:C.detail}),m&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Último guardado manual: ",I(m)]}),e.jsxs("div",{className:"text-gray-400 text-xs",children:[o?"🌐 En línea":"📴 Sin conexión",s!=="saving"&&" • Click para guardar"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]}),s==="saving"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-blue-200 rounded-b-lg overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 animate-pulse"})})]})},pr=({isOpen:s,onClose:m,savedProgress:l,onLoadProgress:j,onDiscardProgress:o})=>{var C;const[h,y]=g.useState(!1);if(!s||!l)return null;const v=async()=>{y(!0);try{await j(l),m()}catch(A){console.error("Error cargando progreso:",A)}finally{y(!1)}},I=async()=>{y(!0);try{await o(),m()}catch(A){console.error("Error descartando progreso:",A)}finally{y(!1)}},S=A=>{const _=new Date(A),W=new Date-_,B=Math.floor(W/(1e3*60)),n=Math.floor(B/60),H=Math.floor(n/24);return B<1?"hace unos segundos":B<60?`hace ${B} minutos`:n<24?`hace ${n} horas`:H===1?"ayer":H<7?`hace ${H} días`:_.toLocaleDateString()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 p-6 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx($s,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progreso Guardado Encontrado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Se encontró un trabajo sin finalizar"})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(wa,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Guardado automáticamente"}),e.jsx("div",{className:"text-xs text-gray-500",children:S(l.savedAt)})]})]}),l.pages&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oa,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[l.pages.length," páginas en progreso"]}),e.jsx("div",{className:"text-xs text-gray-500",children:((C=l.meta)==null?void 0:C.version)||"Versión no especificada"})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ws,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"¿Qué te gustaría hacer?"}),e.jsx("div",{className:"text-amber-700",children:"Puedes continuar desde donde lo dejaste o comenzar un nuevo diseño."})]})]})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[e.jsxs("button",{onClick:v,disabled:h,className:`flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[h?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(_s,{className:"w-4 h-4"}),"Continuar Editando"]}),e.jsxs("button",{onClick:I,disabled:h,className:`flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2.5 rounded-lg font-medium 
                                 flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[e.jsx(Pt,{className:"w-4 h-4"}),"Comenzar de Nuevo"]})]}),e.jsx("button",{onClick:m,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",disabled:h,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},Et=At.memo(({pageId:s,thumbnail:m,altText:l,type:j})=>m?e.jsx("img",{src:m,alt:l,className:"w-full h-full object-contain",loading:"lazy",style:{transition:"opacity 0.2s ease-in-out",imageRendering:"optimizeQuality"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center"})),fr=At.memo(({images:s,onImageSelect:m,isLoading:l})=>{const j=At.memo(({image:o})=>{const[h,y]=g.useState(!1),[v,I]=g.useState(!1),[{isDragging:S},C]=ha(()=>({type:"PROJECT_IMAGE",item:{type:"PROJECT_IMAGE",imageUrl:o.url},collect:X=>({isDragging:!!X.isDragging()})})),A=o.thumbnail_url||o.url,_=o.url;return e.jsxs("div",{ref:C,className:`relative group cursor-pointer bg-gray-50 rounded-lg overflow-hidden border-2 border-transparent hover:border-[#af5cb8] transition-all duration-200 ${S?"opacity-50 scale-95":""}`,onClick:()=>m(_),children:[e.jsxs("div",{className:"aspect-square relative",children:[!h&&!v&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 animate-pulse flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[#af5cb8] border-t-transparent rounded-full animate-spin"})}),v?e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(Se,{className:"h-6 w-6 mx-auto mb-1"}),e.jsx("p",{className:"text-xs",children:"Error al cargar"})]})}):e.jsx("img",{src:A,alt:o.filename||"Project image",className:`w-full h-full object-cover transition-opacity duration-300 ${h?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>y(!0),onError:()=>I(!0)})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("div",{className:"bg-white rounded-full p-2 shadow-md",children:e.jsx(Be,{className:"h-4 w-4 text-[#af5cb8]"})})})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:o.has_thumbnail?"Optimizada":"Arrastra o haz clic"}),o.has_thumbnail&&e.jsx("div",{className:"absolute top-2 left-2 bg-green-500 rounded-full w-2 h-2"})]})});return l?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:6}).map((o,h)=>e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg animate-pulse"},h))}):s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Se,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"No hay imágenes en este proyecto"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sube una imagen para empezar"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.map((o,h)=>e.jsx(j,{image:o},`${o.id||o.url}-${h}`))}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:[s.filter(o=>o.has_thumbnail).length," de ",s.length," imágenes optimizadas"]})})]})});function un(){var $t,Lt,_t,Ft,Wt,Ht,Ut,Bt,Vt,qt,Gt,Kt,Jt,Xt,Yt,Qt,Zt,Dt,es,ts,ss,as,rs,ns,os,is,ls,cs,ds,ms,gs,hs,us,xs,ps,fs,ys,bs,vs,ws;const[s,m]=g.useState(null),[l,j]=g.useState(null),[o,h]=g.useState(null),[y,v]=g.useState(null),[I,S]=g.useState(!0),[C,A]=g.useState(null),[_,X]=g.useState({hasUnsavedChanges:!1,lastEditTime:null,isSaving:!1});g.useEffect(()=>{(async()=>{var a;try{const i=new URLSearchParams(window.location.search).get("project");if(!i){A("No se encontró el ID del proyecto en la URL"),S(!1);return}const c=await fetch(`/api/canvas/projects/${i}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)||"","X-Requested-With":"XMLHttpRequest"}});if(!c.ok)throw new Error("Error al cargar el proyecto");const x=await c.json();m(x.project),j(x.item),h(x.canvasPreset),v(x.initialProject),S(!1)}catch(r){console.error("❌ Error cargando proyecto:",r),A(r.message),S(!1)}})()},[]);const[W,B]=g.useState(As.Local.get(`${Ps.APP_CORRELATIVE}_cart`)??[]);g.useEffect(()=>{As.Local.set(`${Ps.APP_CORRELATIVE}_cart`,W)},[W]);const[n,H]=g.useState([]),[d,w]=g.useState(0),[O,ae]=g.useState("preset"),[M,Q]=g.useState(null),[L,ge]=g.useState(null),[F,le]=g.useState("pages"),[fe,we]=g.useState("basic"),[re,de]=g.useState([JSON.stringify(n)]),[f,V]=g.useState(0),[ne,D]=g.useState(!1),[Ve,Ce]=g.useState(null),[ee,te]=g.useState({}),[$e,vt]=g.useState(!1),[Ee,Le]=g.useState([]),[_e,qe]=g.useState(!1),[ze,rt]=g.useState(new Map),ye=g.useRef(null),Ge=g.useRef(),[$,Ke]=g.useState({width:800,height:600}),Fe=g.useCallback(async()=>{if(s!=null&&s.id)try{const t=await fetch(`/api/thumbnails/${s.id}`);if(t.ok){const a=await t.json();if(a.success&&a.thumbnails&&a.thumbnails.length>0){const r={};a.thumbnails.forEach(i=>{i.page_id&&i.thumbnail_url&&(r[i.page_id]=i.thumbnail_url)}),Object.keys(r).length>0?(te(i=>({...i,...r})),console.log("✅ Thumbnails cargados desde storage:",Object.keys(r).length)):console.log("ℹ️ No hay thumbnails guardados, usando generación local")}else console.log("ℹ️ No hay thumbnails guardados para este proyecto")}}catch(t){console.warn("⚠️ Error cargando thumbnails guardados (usando locales):",t)}},[s==null?void 0:s.id]),be=g.useCallback(async()=>{if(!(!(n!=null&&n.length)||!$||!o))try{const t=await dr({pages:n,workspaceDimensions:$,presetData:o});t&&Object.keys(t).length>0&&(te(a=>({...a,...t})),console.log("✅ Thumbnails locales generados:",Object.keys(t).length))}catch(t){console.warn("⚠️ Error generando thumbnails locales:",t)}},[n,$,o]),We=g.useCallback(async()=>{var t;if(!(!(s!=null&&s.id)||!(n!=null&&n.length)))try{const a=await fetch(`/api/thumbnails/${s.id}/existing`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({pages:n})});if(a.ok){const r=await a.json();r&&Object.keys(r).length>0?(te(i=>({...i,...r})),console.log("✅ Thumbnails existentes cargados:",Object.keys(r).length)):(console.log("📸 No hay thumbnails existentes, generando nuevos..."),await be())}}catch(a){console.warn("⚠️ Error cargando thumbnails existentes:",a),await be()}},[s==null?void 0:s.id,n,be]);g.useCallback(async()=>{if(!(!(s!=null&&s.id)||!(n!=null&&n.length)))try{const t=n[d];if(!t)return;const a=await fetch(`/api/thumbnails/${s.id}/generate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({pages:[t],width:$.width,height:$.height,quality:95,scale:4,dpi:300})});if(a.ok){const r=await a.json();if(r.success&&r.thumbnails){const i={};r.thumbnails.forEach(c=>{c.page_id&&c.thumbnail_url&&(i[c.page_id]=c.thumbnail_url)}),te(c=>({...c,...i})),console.log("✅ Thumbnail generado y guardado en storage para página actual:",r.thumbnails.length)}}}catch(t){console.warn("⚠️ Error generando thumbnail:",t)}},[s==null?void 0:s.id,n,d,$]),g.useCallback(async()=>{if(!(!(s!=null&&s.id)||!(n!=null&&n.length)))try{const t=await fetch(`/api/thumbnails/${s.id}/generate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({pages:n,width:$.width,height:$.height,quality:95,scale:4,dpi:300})});if(t.ok){const a=await t.json();if(a.success&&a.thumbnails){const r={};a.thumbnails.forEach(i=>{i.page_id&&i.thumbnail_url&&(r[i.page_id]=i.thumbnail_url)}),te(i=>({...i,...r})),console.log("✅ Todos los thumbnails generados y guardados en storage:",a.thumbnails.length)}}}catch(t){console.warn("⚠️ Error generando todos los thumbnails:",t)}},[s==null?void 0:s.id,n,$]),g.useEffect(()=>{if(y&&l&&o){if(y.pages&&Array.isArray(y.pages)){const t=y.pages.map(a=>{let r=null,i=o.background_color||"#ffffff";return a.type==="cover"?l.cover_image&&(r=`/storage/images/item/${l.cover_image}`):a.type==="content"?l.content_image&&(r=`/storage/images/item/${l.content_image}`):(a.type==="final"||a.type==="contraportada")&&l.back_cover_image&&(r=`/storage/images/item/${l.back_cover_image}`),{...a,backgroundImage:r,backgroundColor:i}});H(t),de([JSON.stringify(t)]),V(0),setTimeout(()=>{Fe()},100)}else{const t=Tt(o,l);H(t),de([JSON.stringify(t)]),V(0),setTimeout(()=>{Fe()},100)}typeof y.currentPage=="number"&&w(y.currentPage),y.workspaceSize&&ae(y.workspaceSize)}},[y,l,o,Fe]);const xe=ur(n,s,l,o,$,ee),Je=()=>{if(o!=null&&o.width&&(o!=null&&o.height)){let p=o.width,N=o.height,P=p*37.8,R=N*37.8;if(P&&R){const T=window.innerWidth*.6,U=window.innerHeight*.7,k=T/P,E=U/R,z=Math.min(k,E,1);return{width:Math.round(P*z),height:Math.round(R*z),originalWidth:p,originalHeight:N,scale:z,unit:"cm",originalWidthPx:Math.round(P),originalHeightPx:Math.round(R)}}}if(o!=null&&o.extra_settings)try{const p=typeof o.extra_settings=="string"?JSON.parse(o.extra_settings):o.extra_settings;if(p!=null&&p.canvas_config){const N=p.canvas_config;let P=N.width,R=N.height,T=P*37.8,U=R*37.8;if(T&&U){const k=window.innerWidth*.6,E=window.innerHeight*.7,z=k/T,q=E/U,se=Math.min(z,q,1);return{width:Math.round(T*se),height:Math.round(U*se),originalWidth:P,originalHeight:R,scale:se,unit:"cm",originalWidthPx:Math.round(T),originalHeightPx:Math.round(U)}}}}catch(p){console.warn("Error parsing extra_settings:",p)}const t={square:{width:600,height:600},landscape:{width:1280,height:720},portrait:{width:600,height:800},wide:{width:1200,height:600},tall:{width:540,height:960},preset:{width:800,height:600}},a=t[O]||t.preset,r=window.innerWidth*.6,i=window.innerHeight*.7,c=r/a.width,x=i/a.height,b=Math.min(c,x,1);return{width:Math.round(a.width*b),height:Math.round(a.height*b),originalWidth:a.width,originalHeight:a.height,scale:b,unit:"px"}},pe=g.useCallback(async(t={type:"thumbnail"})=>{if(!n[d])return null;try{let a=document.querySelector(`#page-${n[d].id}`);if(!a)return console.warn("❌ THUMBNAIL: No se encontró el elemento de página específico"),null;const r=n[d],i=t.type==="pdf",c=i?11.81:3,x=1,b=getComputedStyle(a);let p=(r==null?void 0:r.backgroundColor)||"#ffffff";b.backgroundColor&&b.backgroundColor!=="rgba(0, 0, 0, 0)"&&(p=b.backgroundColor);const N={scale:c,useCORS:!0,allowTaint:!1,backgroundColor:p,width:$.width,height:$.height,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!!i,removeContainer:!1,logging:!1,imageTimeout:i?6e4:15e3,pixelRatio:i?3:window.devicePixelRatio||1,canvas:i?document.createElement("canvas"):null,windowWidth:i?$.width*c:null,windowHeight:i?$.height*c:null,onclone:async T=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(k=>{try{T.querySelectorAll(k).forEach(z=>z.remove())}catch(E){console.warn("Error removing selector:",k,E)}});try{const k=T.querySelector(`#page-${n[d].id}`);k&&(k.style.width=$.width+"px",k.style.height=$.height+"px",k.style.position="relative",k.style.overflow="hidden",r!=null&&r.backgroundImage&&(k.style.backgroundImage=`url(${r.backgroundImage})`,k.style.backgroundSize="cover",k.style.backgroundPosition="center",k.style.backgroundRepeat="no-repeat"),r!=null&&r.backgroundColor&&(k.style.backgroundColor=r.backgroundColor))}catch(k){console.error("❌ [THUMBNAIL-FIX] Error configurando elemento de página:",k)}try{const k=new Map;a.querySelectorAll('[data-element-type="image"] img, .workspace-image, img').forEach((J,Ne)=>{if(J.complete&&J.naturalWidth>0){const ue=(J.closest('[data-element-type="image"]')||J.parentElement).getBoundingClientRect(),ve=J.getBoundingClientRect();k.set(J.src,{src:J.src,naturalWidth:J.naturalWidth,naturalHeight:J.naturalHeight,containerWidth:ue.width,containerHeight:ue.height,objectFit:getComputedStyle(J).objectFit||"cover",objectPosition:getComputedStyle(J).objectPosition||"center",crossOrigin:J.crossOrigin})}});const z=async(J,Ne,me,ue,ve)=>new Promise(Re=>{try{const Me=Ne/me,jt=ue/ve;let ft,yt,Nt,kt,js,Ns;jt>Me?(Ns=me,js=me*jt,yt=ve,ft=ve*Me,Nt=(ue-ft)/2,kt=0):(js=Ne,Ns=Ne/jt,ft=ue,yt=ue/Me,Nt=0,kt=(ve-yt)/2);const bt=T.createElement("canvas");bt.width=Ne,bt.height=me;const Ks=bt.getContext("2d"),at=new Image;at.crossOrigin="anonymous",at.onload=()=>{try{Ks.drawImage(at,Nt,kt,ft,yt,0,0,Ne,me);const St=bt.toDataURL("image/png",1);J.src=St,J.style.objectFit="fill",J.style.objectPosition="center",J.style.width="100%",J.style.height="100%",Re()}catch(St){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en canvas processing:",St),Re()}},at.onerror=()=>{console.warn("⚠️ [ADVANCED-THUMBNAIL] Error cargando imagen temporal"),Re()},at.src=J.src}catch(Me){console.warn("⚠️ [ADVANCED-THUMBNAIL] Error en simulateObjectFitCover:",Me),Re()}}),q=T.querySelectorAll('[data-element-type="image"] img, .workspace-image, img'),se=[];q.forEach((J,Ne)=>{if(J.src&&k.has(J.src)){const me=k.get(J.src),ue=J.closest('[data-element-type="image"]')||J.parentElement;if(ue&&(ue.style.overflow="hidden",ue.style.position="relative"),me.objectFit==="cover"||J.classList.contains("object-cover")||J.classList.contains("workspace-image")){const ve=z(J,me.containerWidth,me.containerHeight,me.naturalWidth,me.naturalHeight);se.push(ve)}else J.style.width="100%",J.style.height="100%",J.style.objectFit="fill"}}),se.length>0&&await Promise.all(se);const K=T.createElement("style");K.textContent=`
                            /* CORRECCIÓN THUMBNAIL: Estructura del elemento de página */
                            #page-${n[d].id} {
                                width: ${$.width}px !important;
                                height: ${$.height}px !important;
                                position: relative !important;
                                overflow: hidden !important;
                                box-sizing: border-box !important;
                            }
                            
                            /* 🖨️ IMÁGENES PROFESIONALES: Optimizada para PDF vs Thumbnails */
                            img {
                                width: 100% !important;
                                height: 100% !important;
                                object-fit: fill !important; /* fill porque ya están recortadas */
                                object-position: center !important;
                                display: block !important;
                                ${i?`
                                /* 🖨️ IMPRESIÓN PROFESIONAL 300 DPI */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: -webkit-crisp-edges !important;
                                image-rendering: -moz-crisp-edges !important;
                                image-rendering: pixelated !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: optimizeQuality !important;
                                backface-visibility: hidden !important;
                                transform: translateZ(0) scale(1) !important;
                                will-change: transform !important;
                                filter: contrast(1.02) saturate(1.05) !important;
                                `:`
                                /* Thumbnails optimizados */
                                image-rendering: -webkit-optimize-contrast !important;
                                image-rendering: crisp-edges !important;
                                image-rendering: high-quality !important;
                                `}
                            }
                            
                            /* Contenedores de imagen */
                            [data-element-type="image"] {
                                overflow: hidden !important;
                                position: relative !important;
                            }
                            
                            [data-element-type="image"] > div {
                                width: 100% !important;
                                height: 100% !important;
                                overflow: hidden !important;
                            }
                            
                            /* Backgrounds de página */
                            #page-${n[d].id} {
                                background-size: cover !important;
                                background-position: center !important;
                                background-repeat: no-repeat !important;
                            }
                            
                            /* 🖨️ OPTIMIZACIONES GENERALES PARA PDF DE IMPRESIÓN */
                            ${i?`
                            * {
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                text-rendering: optimizeLegibility !important;
                                -webkit-backface-visibility: hidden !important;
                                backface-visibility: hidden !important;
                                -webkit-transform: translateZ(0) !important;
                                transform: translateZ(0) !important;
                            }
                            
                            /* Elementos de texto de alta calidad */
                            p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable] {
                                text-rendering: optimizeLegibility !important;
                                -webkit-font-smoothing: antialiased !important;
                                -moz-osx-font-smoothing: grayscale !important;
                                font-smooth: always !important;
                            }
                            
                            /* Elementos vectoriales de alta calidad */
                            svg, path, circle, rect, line {
                                shape-rendering: geometricPrecision !important;
                                vector-effect: non-scaling-stroke !important;
                            }
                            `:""}
                            
                            /* Resetear estilos que puedan interferir */
                            img {
                                max-width: none !important;
                                max-height: none !important;
                                border: none !important;
                                outline: none !important;
                            }
                        `,T.head.appendChild(K)}catch(k){console.error("❌ [ADVANCED-THUMBNAIL] Error en pre-procesamiento avanzado:",k);const E=T.createElement("style");E.textContent=`
                            img { object-fit: cover !important; object-position: center !important; }
                            [data-element-type="image"] { overflow: hidden !important; }
                        `,T.head.appendChild(E)}}},P=await Es(a,N);if(i&&P){const T=P.getContext("2d");if(T){T.imageSmoothingEnabled=!1,T.imageSmoothingQuality="high";const U=T.getImageData(0,0,P.width,P.height),k=U.data;for(let E=0;E<k.length;E+=4)k[E]=Math.min(255,k[E]*1.05),k[E+1]=Math.min(255,k[E+1]*1.05),k[E+2]=Math.min(255,k[E+2]*1.05);T.putImageData(U,0,0)}}if(!P)throw new Error("html2canvas no devolvió un canvas válido para el elemento de página");if(P.width===0||P.height===0)throw new Error("Canvas del elemento de página tiene dimensiones inválidas");const R=P.toDataURL("image/png",x);if(!R||R==="data:,")throw new Error("No se pudo generar dataURL del elemento de página");return i?P:R}catch(a){console.error("❌ [THUMBNAIL-FIX] Error capturando elemento de página:",a);try{const r=document.createElement("canvas"),i=t.type==="pdf"?11.81:1;r.width=$.width*i,r.height=$.height*i;const c=r.getContext("2d"),x=workspaceBackground||(currentPageData==null?void 0:currentPageData.backgroundColor)||"#ffffff";return c.fillStyle=x,c.fillRect(0,0,r.width,r.height),c.fillStyle=x==="#ffffff"||x.includes("white")?"#374151":"#666666",c.font=`${14*i}px Arial`,c.textAlign="center",c.fillText("Página "+(d+1),r.width/2,r.height/2),t.type==="pdf"?r:r.toDataURL("image/png",1)}catch{return null}}},[d,n]),Oe=g.useCallback(async()=>{if(!n[d])return;const t=await pe({type:"thumbnail"});t&&te(a=>({...a,[n[d].id]:t}))},[pe,d,n]);g.useCallback(()=>{clearTimeout(Ge.current),Ge.current=setTimeout(()=>{n[d]&&!ee[n[d].id]&&Oe()},1200)},[Oe,n,d,ee]);const Xe=g.useCallback(()=>{n[d]&&!ee[n[d].id]&&setTimeout(()=>{Oe()},300)},[Oe,n,d,ee]),nt=g.useCallback(async(t=d,a={width:800,height:600})=>{var r,i;if(!n[t])return null;try{const c=d;t!==d&&(w(t),await new Promise(N=>setTimeout(N,100)));const x=document.querySelector(`#page-${n[t].id}`);if(!x)return console.warn("Workspace element not found for page:",n[t].id),null;const b={scale:4,useCORS:!0,allowTaint:!1,backgroundColor:((r=n[t])==null?void 0:r.backgroundColor)||"#ffffff",width:x.offsetWidth,height:x.offsetHeight,removeContainer:!0,logging:!1,onclone:N=>{[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(k=>{N.querySelectorAll(k).forEach(z=>z.remove())});const R=N.querySelector(`#page-${n[t].id}`);if(R){const k=n[t];k!=null&&k.backgroundImage&&(R.style.backgroundImage=`url(${k.backgroundImage})`,R.style.backgroundSize="cover",R.style.backgroundPosition="center",R.style.backgroundRepeat="no-repeat"),k!=null&&k.backgroundColor&&(R.style.backgroundColor=k.backgroundColor)}try{const k=x.querySelectorAll("img"),E=new Map;k.forEach((q,se)=>{const K=getComputedStyle(q);E.set(se,{objectFit:K.objectFit,objectPosition:K.objectPosition,width:K.width,height:K.height,borderRadius:K.borderRadius,transform:K.transform})}),N.querySelectorAll("img").forEach((q,se)=>{const K=E.get(se);K&&(q.style.objectFit=K.objectFit||"cover",q.style.objectPosition=K.objectPosition||"center",q.style.width=K.width,q.style.height=K.height,q.style.borderRadius=K.borderRadius,q.style.transform=K.transform)})}catch(k){console.warn("Error preservando estilos de imágenes:",k),N.querySelectorAll("img").forEach(z=>{z.style.objectFit="cover",z.style.objectPosition="center",z.style.width||(z.style.width="100%"),z.style.height||(z.style.height="100%")})}N.querySelectorAll('[class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable]').forEach(k=>{const E=k.className;E&&(k.className=E);const z=getComputedStyle?getComputedStyle(k):null;z&&(z.fontFamily&&z.fontFamily!=="Arial"&&(k.style.fontFamily=z.fontFamily),z.fontSize&&(k.style.fontSize=z.fontSize),z.fontWeight&&(k.style.fontWeight=z.fontWeight),z.fontStyle&&(k.style.fontStyle=z.fontStyle))});const U=N.createElement("style");U.textContent=`
                        /* Preservar fuentes originales y NO forzar Arial */
                        * { 
                            -webkit-font-smoothing: antialiased !important;
                            -moz-osx-font-smoothing: grayscale !important;
                        }
                        
                        /* CRÍTICO: Asegurar que las imágenes mantengan cover + CALIDAD HD */
                        img {
                            object-fit: cover !important;
                            object-position: center !important;
                            image-rendering: -webkit-optimize-contrast !important;
                            image-rendering: crisp-edges !important;
                            image-rendering: high-quality !important;
                        }
                        
                        /* CRÍTICO: Asegurar que los backgrounds de página se mantengan en cover */
                        [id^="page-"] {
                            background-size: cover !important;
                            background-position: center !important;
                            background-repeat: no-repeat !important;
                        }
                        
                        /* Asegurar que los elementos de texto mantengan sus fuentes */
                        [class*="text-"], p, span, div, h1, h2, h3, h4, h5, h6 {
                            font-family: inherit !important;
                        }
                    `,N.head.appendChild(U)}},p=await Es(x,b);if(a.width!==p.width||a.height!==p.height){const N=document.createElement("canvas");N.width=a.width,N.height=a.height;const P=N.getContext("2d"),R=p.width/p.height,T=a.width/a.height;let U,k,E=0,z=0;R>T?(U=a.width,k=a.width/R,z=(a.height-k)/2):(k=a.height,U=a.height*R,E=(a.width-U)/2),P.fillStyle=((i=n[t])==null?void 0:i.backgroundColor)||"#ffffff",P.fillRect(0,0,a.width,a.height),P.drawImage(p,E,z,U,k);const q=N.toDataURL("image/png",1);return t!==c&&w(c),q}return t!==c&&w(c),p.toDataURL("image/png",1)}catch(c){return console.error("❌ Error generando thumbnail de alta calidad:",c),null}},[n,d,w]);g.useEffect(()=>{const t=Je();Ke(t)},[o,O]),g.useEffect(()=>{const t=()=>{const a=Je();Ke(a)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[o,O]),g.useEffect(()=>{if(n[d]&&!ee[n[d].id]){const t=setTimeout(()=>{Xe()},400);return()=>clearTimeout(t)}},[d]),g.useEffect(()=>{const t=n[d];t!=null&&t.backgroundImage&&fetch(t.backgroundImage,{method:"HEAD"}).then(a=>{a.ok?console.log("✅ [WORKSPACE] Imagen existe en el servidor"):console.error("❌ [WORKSPACE] Imagen NO existe en el servidor. Status:",a.status)}).catch(a=>{console.error("❌ [WORKSPACE] Error verificando imagen:",a)})},[d,($t=n[d])==null?void 0:$t.backgroundImage]),g.useEffect(()=>{const t=`${$.width}x${$.height}`,a=sessionStorage.getItem("lastWorkspaceDimensions");a&&a!==t&&n.length>0&&(te({}),setTimeout(()=>{n[d]&&Xe()},800)),sessionStorage.setItem("lastWorkspaceDimensions",t)},[$.width,$.height]),g.useEffect(()=>{if(!(s!=null&&s.id)||n.length===0)return;let t,a=Date.now(),r=!1;const i=()=>{r=!0,a=Date.now()},c=async()=>{if(r)try{console.log("🔄 [AUTO-SAVE] Iniciando guardado silencioso en segundo plano..."),setAutoSave(N=>({...N,saveStatus:"saving"}));const b=await fetch(`/api/projects/${s.id}/save`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({pages:n,force:!1})}),p=await b.json();if(b.ok&&p.success)r=!1,X(N=>({...N,saveStatus:"saved",lastAutoSaved:new Date,hasUnsavedChanges:!1})),console.log("✅ [AUTO-SAVE] Guardado silencioso completado");else throw new Error("Guardado falló")}catch(b){console.error("❌ [AUTO-SAVE] Error en guardado silencioso:",b),X(p=>({...p,saveStatus:"error",saveError:b.message}))}},x=()=>{t=setInterval(()=>{const b=Date.now()-a;r&&b>6e4&&(console.log("⏰ [AUTO-SAVE] Condiciones cumplidas para guardado automático"),c())},3*60*1e3)};return JSON.stringify(n),n[d],i(),x(),()=>{t&&clearInterval(t)}},[n,d,s==null?void 0:s.id]),g.useEffect(()=>{var a;if(!n[d])return;const t=((a=n[d].cells)==null?void 0:a.flatMap(r=>r.elements))||[];JSON.stringify(t),X(r=>({...r,hasUnsavedChanges:!0}))},[(Lt=n[d])==null?void 0:Lt.cells,d]);const[ot,Ae]=g.useState(!1),[Ye,it]=g.useState({elementId:null,cellId:null}),[lt,Qe]=g.useState(!1),[ct,Ze]=g.useState(!1),[dt,mt]=g.useState(null),He=g.useRef(null),gt=async t=>{const a=t.target.files[0];if(!a||!(s!=null&&s.id))return;const r=new FormData;r.append("image",a),r.append("projectId",s.id);try{const c=await(await fetch("/api/canvas/editor/upload-image",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:r})).json();if(c.success){const x={id:Date.now(),filename:a.name,url:c.url,thumbnail_url:c.thumbnail_url,has_thumbnail:c.has_thumbnail,size:a.size,last_modified:Date.now()/1e3,created_at:new Date().toISOString()};Le(b=>[x,...b]),ht(c.url),c.has_thumbnail?ie.success("Imagen subida y optimizada correctamente"):ie.success("Imagen subida correctamente"),ye.current=setTimeout(()=>{De(!0)},1e3)}else ie.error(c.message||"Error al subir la imagen")}catch(i){console.error("Error subiendo la imagen:",i),ie.error("Error de red al subir la imagen")}},ht=t=>{var i,c,x,b;const a=L||((c=(i=n[d])==null?void 0:i.cells[0])==null?void 0:c.id);if(!a)return;const r={id:`image-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:t,position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:(((b=(x=n[d].cells.find(p=>p.id===a))==null?void 0:x.elements)==null?void 0:b.length)||0)+1};Te(a,r),ie.success("Imagen añadida correctamente")},De=g.useCallback(async(t=!1)=>{if(s!=null&&s.id&&(ye.current&&clearTimeout(ye.current),!(!t&&ze.has(s.id)&&Ee.length>0)&&!(_e&&!t))){qe(!0);try{const r=await(await fetch(`/api/canvas/projects/${s.id}/images`,{method:"GET",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json"}})).json();if(r.success){const i=r.images||[];Le(i),rt(c=>{const x=new Map(c);return x.set(s.id,i),x})}else console.error("Error cargando imágenes:",r.message)}catch(a){console.error("Error cargando imágenes del proyecto:",a)}finally{qe(!1)}}},[s==null?void 0:s.id,ze,Ee.length,_e]);g.useEffect(()=>{if(s!=null&&s.id){const t=ze.get(s.id);if(t&&t.length>0){Le(t);return}return ye.current=setTimeout(()=>{De(!1)},150),()=>{ye.current&&clearTimeout(ye.current)}}},[s==null?void 0:s.id,ze]),g.useEffect(()=>()=>{ye.current&&clearTimeout(ye.current)},[]);const ut=t=>{var i,c,x,b;const a=L||((c=(i=n[d])==null?void 0:i.cells[0])==null?void 0:c.id);if(!a)return;const r={id:`image-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"image",content:t,position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none",zIndex:(((b=(x=n[d].cells.find(p=>p.id===a))==null?void 0:x.elements)==null?void 0:b.length)||0)+1};Te(a,r),ie.success("Imagen añadida desde la galería")},et=g.useCallback(async(t,a)=>{var c,x;const r=[],i=[];for(const b of t){const p={...b};if(b.cells){p.cells=[];for(const N of b.cells){const P={...N};if(N.elements){P.elements=[];for(const R of N.elements)if(R.type==="image"&&((c=R.content)!=null&&c.startsWith("data:image/"))){const T=`${R.id}_${Date.now()}`,U=R.content.match(/^data:image\/([^;]+);base64,(.+)$/);if(U){const k=U[1],E=U[2],q=`${T}.${k==="jpeg"?"jpg":k}`;i.push({filename:q,data:E,type:k,elementId:R.id}),P.elements.push({...R,content:R.content,_wasBase64:!0,_originalSize:R.content.length,_elementId:R.id})}else P.elements.push(R)}else P.elements.push(R)}p.cells.push(P)}}r.push(p)}if(i.length>0)try{const b=await fetch(`/api/canvas/projects/${a}/upload-images`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((x=document.querySelector('meta[name="csrf-token"]'))==null?void 0:x.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({images:i})});if(b.ok){const p=await b.json();if(p.uploadedImages){const N=new Map;p.uploadedImages.forEach(P=>{N.set(P.elementId,P.url)});for(const P of r)if(P.cells){for(const R of P.cells)if(R.elements)for(const T of R.elements)T._wasBase64&&T._elementId&&N.has(T._elementId)&&(T.content=N.get(T._elementId),delete T._elementId)}}}else{const p=await b.json().catch(()=>({message:"Error desconocido en upload"}));return console.error("❌ [IMAGE-UPLOAD] Error subiendo imágenes:",p),t}}catch(b){return console.error("❌ [IMAGE-UPLOAD] Error de red subiendo imágenes:",b),t}return r},[]),Ie=g.useCallback(async(t=n,a=!1)=>{var r;if(!(!(s!=null&&s.id)||!a&&t.length===0))try{const x={design_data:{pages:await et(t,s.id),currentPage:d,workspaceDimensions:$,workspaceSize:O,selectedElement:M,selectedCell:L,history:re.slice(-5),historyIndex:Math.min(f,4),timestamp:new Date().toISOString(),version:"2.0",project:{id:s.id,name:(l==null?void 0:l.name)||"Álbum Personalizado",item_id:l==null?void 0:l.id,preset_id:o==null?void 0:o.id}},thumbnails:ee},p=JSON.stringify(x).length/(1024*1024),N=await fetch(`/api/canvas/projects/${s.id}/save-progress`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},credentials:"include",body:JSON.stringify(x)});if(N.ok){const P=await N.json(),R=`editor_progress_project_${s.id}`;return localStorage.removeItem(R),n&&n.length>0&&be().catch(T=>{console.warn("⚠️ Error generando thumbnails locales:",T)}),!0}else{const P=await N.json().catch(()=>({message:"Error desconocido"}));return console.error("❌ [AUTO-SAVE] Error guardando en BD:",P),!1}}catch(i){return console.error("❌ [AUTO-SAVE] Error en auto-save con procesamiento de imágenes:",i),!1}},[n,d,$,O,M,L,re,f,s==null?void 0:s.id,l==null?void 0:l.name,l==null?void 0:l.id,o==null?void 0:o.id,ee,et,be]);g.useEffect(()=>{if(!(s!=null&&s.id))return;const t=setInterval(()=>{n.length>0&&Ie(n,!1)},5*60*1e3);return()=>clearInterval(t)},[Ie,n,s==null?void 0:s.id]),g.useCallback(async()=>{if(!n.length)return{};console.log("📸 [THUMBNAILS] Capturando thumbnails de todas las páginas...");const t={},a=d;try{for(let r=0;r<n.length;r++){const i=n[r];if(i!=null&&i.id)try{r!==d&&(w(r),await new Promise(x=>setTimeout(x,300)));const c=await pe({type:"thumbnail"});c&&(t[i.id]=c,console.log(`✅ [THUMBNAILS] Thumbnail capturado para página ${r+1}: ${i.id}`))}catch(c){console.warn(`⚠️ [THUMBNAILS] Error capturando thumbnail para página ${i.id}:`,c),ee[i.id]&&(t[i.id]=ee[i.id])}}return a!==d&&w(a),console.log(`✅ [THUMBNAILS] Capturados ${Object.keys(t).length} thumbnails de ${n.length} páginas`),t}catch(r){return console.error("❌ [THUMBNAILS] Error capturando thumbnails:",r),a!==d&&w(a),ee}},[n,d,w,pe,ee]);const u=g.useCallback(async()=>{if(!(s!=null&&s.id)||n.length===0)return ie.error("No hay datos para guardar"),!1;try{return console.log("📸 [SAVE] Generando thumbnails localmente..."),await be(),await We(),await Ie(n,!0)?(ie.success("Progreso guardado exitosamente"),!0):(ie.error("Error al guardar el progreso"),!1)}catch(t){return console.error("❌ [SAVE] Error al guardar el progreso:",t),ie.error("Error al guardar el progreso"),!1}},[Ie,n,s==null?void 0:s.id,$,o,be]),Y=g.useCallback(t=>{t!==d&&(w(t),console.log("📄 [PAGE-CHANGE] Página cambiada a:",t))},[d]),he=()=>`editor_progress_project_${s==null?void 0:s.id}`,je=g.useCallback(async()=>{var t,a,r,i;if(s!=null&&s.id)try{const c=xe.loadFromLocalStorage(),x=await fetch(`/api/canvas/projects/${s.id}/load-progress`,{headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});let b=null;if(x.ok){const N=await x.json();N.success&&((t=N.data)!=null&&t.design_data)&&(b=N.data)}let p=null;if(c&&b){const N=new Date(c.savedAt).getTime(),P=new Date(b.saved_at).getTime();p=N>P?c:b}else c?p=c:b&&(p=b);p&&(((a=p.pages)==null?void 0:a.length)>0||((i=(r=p.design_data)==null?void 0:r.pages)==null?void 0:i.length)>0)&&(mt(p),Ze(!0))}catch(c){console.error("❌ [RECOVERY] Error verificando progreso guardado:",c)}},[s==null?void 0:s.id,xe]),tt=g.useCallback(async t=>{var a;try{let r=[];if(t.pages?r=t.pages:(a=t.design_data)!=null&&a.pages&&(r=t.design_data.pages),r.length>0){H(r);const i=[JSON.stringify(r)];de(i),V(0),setTimeout(()=>{te({})},100),ie.success("✅ Progreso cargado exitosamente")}}catch(r){console.error("❌ [RECOVERY] Error cargando progreso:",r),ie.error("Error al cargar el progreso guardado")}},[H,de,V,te]),Us=g.useCallback(async()=>{try{const t=xe.getStorageKey();localStorage.removeItem(t),ie.success("Progreso anterior eliminado")}catch(t){console.error("❌ [RECOVERY] Error descartando progreso:",t)}},[xe]);g.useEffect(()=>{s&&l&&o&&(!(y!=null&&y.pages)||y.pages.length===0)&&Tt(o,l)},[s,l,o,y]),g.useEffect(()=>{s!=null&&s.id&&!I&&n.length===0&&setTimeout(()=>{je()},500)},[s==null?void 0:s.id,I,n.length,je]),g.useEffect(()=>{s!=null&&s.id&&n.length>0&&setTimeout(()=>{We()},100)},[s==null?void 0:s.id,n.length,We]);const Tt=(t,a)=>{try{const r=[],i=a.pages||t.pages||20,c=a.cover_image?`/storage/images/item/${a.cover_image}`:null,x=a.cover_image?null:t.background_color||"#ffffff",b={id:"page-cover",type:"cover",layout:"layout-1",backgroundImage:c,backgroundColor:x,cells:[{id:"cell-cover-1",elements:[{id:"cover-title",type:"text",content:a.name||"Mi Álbum Personalizado",position:{x:10,y:20},size:{width:80,height:15},style:{fontSize:"28px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",textAlign:"center",backgroundColor:"transparent",padding:"8px"},zIndex:2},...a.image?[{id:"cover-image",type:"image",content:`/storage/images/item/${a.image}`,position:{x:25,y:40},size:{width:50,height:40},filters:{},mask:"none",zIndex:1}]:[]]}]};r.push(b);const p=a.content_image?`/storage/images/item/${a.content_image}`:null,N=a.content_image?null:t.background_color||"#ffffff";for(let U=1;U<=i;U++){const k={id:`page-content-${U}`,type:"content",pageNumber:U,layout:"layout-1",backgroundImage:p,backgroundColor:N,cells:[{id:`cell-content-${U}-1`,elements:[]}]};r.push(k)}const P=a.back_cover_image?`/storage/images/item/${a.back_cover_image}`:null,R=a.back_cover_image?null:t.background_color||"#ffffff",T={id:"page-final",type:"final",layout:"layout-1",backgroundImage:P,backgroundColor:R,cells:[{id:"cell-final-1",elements:[]}]};r.push(T),H(r),w(0),t.width&&t.height&&ae("preset")}catch(r){console.error("❌ Error creating pages:",r),A(r.message)}},wt=g.useMemo(()=>({cover:n.filter(t=>t.type==="cover"),content:n.filter(t=>t.type==="content"),final:n.filter(t=>t.type==="final")}),[n]),Z=g.useCallback(()=>{if(!M||!L||n.length===0)return null;const t=n[d];if(!t)return null;const a=t.cells.find(r=>r.id===L);return a?a.elements.find(r=>r.id===M):null},[M,L,n,d]),zt=(t,a)=>{if(a){const r=n[d].cells.find(c=>c.id===a),i=r==null?void 0:r.elements.find(c=>c.id===t);if(i!=null&&i.locked){const c=document.createElement("div");c.className="fixed top-4 right-4 bg-amber-100 border border-amber-400 text-amber-700 px-4 py-2 rounded-lg z-50",c.textContent="Este elemento es parte del diseño base y no se puede editar",document.body.appendChild(c),setTimeout(()=>{document.body.contains(c)&&document.body.removeChild(c)},3e3);return}}if(a&&ge(a),Q(t),t){const r=n[d].cells.find(c=>c.id===(a||L)),i=r==null?void 0:r.elements.find(c=>c.id===t);(i==null?void 0:i.type)==="image"?Ce(i):(i==null?void 0:i.type)==="text"?(Ae(!0),it({elementId:t,cellId:a||L})):Ae(!1)}else Ae(!1),Ce(null)},Pe=()=>{if(n.length===0)return ce[0];const t=n[d];return t?ce.find(a=>a.id===t.layout)||ce[0]:ce[0]},st=g.useCallback(t=>{H(t);const a=[...re.slice(0,f+1),JSON.stringify(t)];de(a),V(a.length-1);try{const r=he(),i={pages:t,currentPage:d,savedAt:Date.now()},c=JSON.stringify(i),x=Math.round(c.length/1024);if(x<2048)localStorage.setItem(r,c);else{console.warn(`⚠️ Datos demasiado grandes para localStorage (${x} KB), saltando guardado local`);try{localStorage.removeItem(r)}catch(b){console.error("Error limpiando localStorage:",b)}}}catch(r){if(console.error("❌ Error guardando en localStorage:",r),r.name==="QuotaExceededError")try{const i=he();localStorage.removeItem(i)}catch(i){console.error("Error limpiando localStorage:",i)}}if(t[d]){const r=t[d].id;te(i=>{const c={...i};return delete c[r],c})}},[re,f,he,d]);g.useEffect(()=>{try{const t=he(),a={pages:n,currentPage:d,savedAt:Date.now()},r=JSON.stringify(a),i=Math.round(r.length/1024);i<2048?localStorage.setItem(t,r):console.warn(`⚠️ Datos demasiado grandes para localStorage (${i} KB), saltando guardado`)}catch(t){if(console.error("❌ Error guardando currentPage en localStorage:",t),t.name==="QuotaExceededError")try{const a=he();localStorage.removeItem(a)}catch(a){console.error("Error limpiando localStorage:",a)}}},[d,n,he]);const Bs=t=>{const a=ce.find(x=>x.id===t);if(!a)return;const r=[...n],i=r[d],c=Array.from({length:a.cells}).map((x,b)=>i.cells[b]||{id:`cell-${i.id}-${b+1}`,elements:[]});r[d]={...i,layout:t,cells:c},st(r),Q(null),ge(null)},Te=(t,a)=>{const r=[...n];for(let i=0;i<r[d].cells.length;i++)r[d].cells[i].id===t&&r[d].cells[i].elements.push(a);st(r),Q(a.id),ge(t)},oe=(t,a,r,i=!1)=>{const c=[...n],x=c[d].cells.findIndex(b=>b.id===t);if(x!==-1){if(i)c[d].cells[x].elements.push({...c[d].cells[x].elements.find(b=>b.id===a),...r});else{const b=c[d].cells[x].elements.findIndex(p=>p.id===a);b!==-1&&(c[d].cells[x].elements[b]={...c[d].cells[x].elements[b],...r})}st(c)}},xt=(t,a)=>{const r=[...n],i=r[d].cells.findIndex(c=>c.id===t);i!==-1&&(r[d].cells[i].elements=r[d].cells[i].elements.filter(c=>c.id!==a),st(r),M===a&&Q(null))},Vs=(t,a,r)=>{const i=[...n],c=i[d].cells.findIndex(x=>x.id===t);if(c!==-1){const x=i[d].cells[c].elements,b=x.findIndex(p=>p.id===a);if(b!==-1){const p=r==="up"?b+1:b-1;if(p>=0&&p<x.length){const N=x[b];x[b]=x[p],x[p]=N,st(i)}}}},Ot=()=>{f>0&&(V(f-1),H(JSON.parse(re[f-1])),Q(null),ge(null))},Rt=()=>{f<re.length-1&&(V(f+1),H(JSON.parse(re[f+1])),Q(null),ge(null))},pt=(t="body")=>{const a=`text-${Date.now()}`,r={heading:{fontSize:"32px",fontFamily:"Arial",color:"#000000",fontWeight:"bold",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"12px",borderRadius:"0px",border:"none",opacity:1},subheading:{fontSize:"24px",fontFamily:"Arial",color:"#333333",fontWeight:"600",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"10px",borderRadius:"0px",border:"none",opacity:1},body:{fontSize:"16px",fontFamily:"Arial",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1}},i={heading:"Título Principal",subheading:"Subtítulo",body:"Haz clic para editar"},c={heading:{width:.8,height:.2},subheading:{width:.6,height:.15},body:{width:.4,height:.15}},x={id:a,type:"text",content:i[t],position:{x:.05,y:.05},size:c[t],style:r[t]};L?Te(L,x):console.log("Selecciona una celda primero")},Mt=g.useMemo(()=>{var c;const t=n[d];if(!t)return null;const a=((c=t.cells)==null?void 0:c.flatMap(x=>x.elements||[]))||[],r=a.map(x=>({id:x.id,type:x.type,position:x.position,size:x.size}));return{pageId:t.id,elementsCount:a.length,contentHash:JSON.stringify(r).substring(0,100),backgroundImage:t.backgroundImage,backgroundColor:t.backgroundColor,layout:t.layout}},[n,d]);g.useEffect(()=>{if(n.length===0||I||!Mt)return;let t=!1;const a=async()=>{try{const i=n[d];if(!i||!i.id)return;const c=i.id;if(te(b=>{const p={...b};return delete p[c],p}),await new Promise(b=>setTimeout(b,100)),t)return;const x=await pe();x&&!t?te(b=>({...b,[c]:x})):console.warn("⚠️ [DEBUG] No se pudo generar miniatura para:",c)}catch(i){t||console.error("❌ [DEBUG] Error regenerando miniatura:",i)}},r=setTimeout(()=>{a()},500);return()=>{t=!0,clearTimeout(r)}},[d,Mt,I,pe]),g.useEffect(()=>{if(n.length===0||I)return;const t=async()=>{const r=n.filter(i=>!ee[i.id]);if(r.length!==0)for(const i of r)try{const c=document.createElement("canvas");c.width=200,c.height=150;const x=c.getContext("2d");if(x.fillStyle=i.backgroundColor||"#ffffff",x.fillRect(0,0,200,150),i.backgroundImage)try{const p=new Image;p.crossOrigin="anonymous",await new Promise((N,P)=>{p.onload=N,p.onerror=P,p.src=i.backgroundImage}),x.drawImage(p,0,0,200,150)}catch(p){console.warn("No se pudo cargar imagen de fondo para miniatura:",p)}i.cells&&i.cells.forEach(p=>{p.elements&&p.elements.forEach(N=>{var P;N.type==="text"&&N.content&&(x.fillStyle=((P=N.style)==null?void 0:P.color)||"#000000",x.font="12px Arial",x.fillText(N.content.substring(0,20)+(N.content.length>20?"...":""),10,30))})});const b=c.toDataURL("image/jpeg",.7);te(p=>({...p,[i.id]:b})),await new Promise(p=>setTimeout(p,300))}catch(c){console.error("❌ Error generando miniatura de fondo para:",i.id,c)}},a=setTimeout(()=>{t()},2e3);return()=>clearTimeout(a)},[n,ee,I]);const qs=async()=>{var t;try{if(!l||!o||!(s!=null&&s.id))return!1;await Ie(n,!0)||console.warn("⚠️ No se pudo guardar el progreso, pero continuando...");const r={design_data:{id:s.id,title:(l==null?void 0:l.name)||"Álbum Personalizado",pages:n,workspace_dimensions:$,created_at:new Date().toISOString()},item_data:{id:l==null?void 0:l.id,name:(l==null?void 0:l.name)||(l==null?void 0:l.title),price:l==null?void 0:l.price,user_id:l==null?void 0:l.user_id,width:l==null?void 0:l.width,height:l==null?void 0:l.height},preset_data:{id:o==null?void 0:o.id,width:o==null?void 0:o.width,height:o==null?void 0:o.height,cover_image:o==null?void 0:o.cover_image,content_layer_image:o==null?void 0:o.content_layer_image,final_layer_image:o==null?void 0:o.final_layer_image},dimensions:{width_mm:(o==null?void 0:o.width)||(l==null?void 0:l.width)||210,height_mm:(o==null?void 0:o.height)||(l==null?void 0:l.height)||297,workspace_width:($==null?void 0:$.width)||800,workspace_height:($==null?void 0:$.height)||600}};try{const R=await fetch("/api/canvas-projects/save",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"include",body:JSON.stringify({id:s.id,status:"ready_for_pdf",pdf_data:r,completed_at:new Date().toISOString()})});if(R.ok){const T=await R.json()}else console.warn("⚠️ Error marcando proyecto como completado")}catch(R){console.warn("⚠️ Error en marcado de completado:",R)}const i=Date.now(),c=s.id;window.currentProjectId=c,window.albumProjectId=c;let x=o.cover_image;ee&&ee["page-cover"]&&(x=ee["page-cover"]);let b=x;x&&x.startsWith("data:image/")&&x.length>1e5&&(b=o.cover_image||"/assets/img/default-album.jpg");const p={...l,project_id:c,canvas_project_id:s.id,quantity:1,type:"custom_album",pdf_metadata:{width_mm:o.width,height_mm:o.height,pages_count:n.length,workspace_dimensions:$,requires_pdf_generation:!0}},N=structuredClone(W),P=N.findIndex(R=>R.id==p.id);return P==-1?N.push({...p,quantity:1}):N[P].quantity++,B(N),ie.success("Álbum agregado al carrito",{description:`${p.name} se ha añadido al carrito. El PDF se generará en el backend.`,icon:e.jsx(ga,{className:"h-5 w-5 text-green-500"}),duration:4e3,position:"bottom-center"}),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{cart:N,action:"add",product:p}})),!0}catch(a){return console.error("❌ === ERROR EN addAlbumToCart ==="),console.error("Error completo:",a),console.error("Stack trace:",a.stack),console.error("Mensaje del error:",a.message),ie.error("Error al agregar al carrito",{description:`Error específico: ${a.message}`,duration:5e3,position:"bottom-center"}),!1}};window.finalizeAlbumDesign=async()=>{try{if(!n||n.length===0)throw new Error("No hay páginas para finalizar");const r={design_data:{pages:(T=>T.map(U=>({id:U.id,type:U.type,pageNumber:U.pageNumber,layout:U.layout,cells:U.cells.map(k=>({id:k.id,elements:k.elements.map(E=>{const z={id:E.id,type:E.type,position:E.position,zIndex:E.zIndex||1};if(E.type==="image"){if(E.content.startsWith("data:image/")){const q=btoa(E.content.substring(0,100)).substring(0,20);z.content=`[BASE64_IMAGE_${q}]`,z.contentType=E.content.split(";")[0].split(":")[1],z.originalSize=E.content.length}else z.content=E.content;if(E.filters){const q=Object.entries(E.filters).filter(([se,K])=>K!==0&&K!==!1&&K!==null).reduce((se,[K,J])=>(se[K]=J,se),{});Object.keys(q).length>0&&(z.filters=q)}E.mask&&E.mask!=="none"&&(z.mask=E.mask),E.size&&(z.size=E.size),E.locked&&(z.locked=E.locked)}else if(E.type==="text"&&(z.content=E.content,E.style)){const q=Object.entries(E.style).filter(([se,K])=>!(se==="fontSize"&&K==="16px"||se==="color"&&K==="#000000"||se==="fontFamily"&&K==="Arial")).reduce((se,[K,J])=>(se[K]=J,se),{});Object.keys(q).length>0&&(z.style=q)}return z})}))})))(n),projectInfo:{id:s==null?void 0:s.id,item_id:l==null?void 0:l.id,title:l==null?void 0:l.title,preset_id:o==null?void 0:o.id},presetInfo:{id:o==null?void 0:o.id,name:o==null?void 0:o.name,cover_image:o==null?void 0:o.cover_image,content_image:o==null?void 0:o.content_image,back_cover_image:o==null?void 0:o.back_cover_image},workspace:{width:$.width,height:$.height,scale:$.scale},meta:{finalizedAt:new Date().toISOString(),version:"1.3"}},thumbnails:Object.fromEntries(Object.entries(ee).map(([T,U])=>[T,U]))},i=JSON.stringify(r),c=Math.round(i.length/1024),x=Math.round(c/1024*100)/100;let b=0,p=0;n.forEach(T=>{var U;(U=T.cells)==null||U.forEach(k=>{var E;(E=k.elements)==null||E.forEach(z=>{z.type==="image"&&z.content&&z.content.startsWith("data:image/")&&(b++,p+=z.content.length)})})});const N=Math.round(p/(1024*1024)*100)/100;if(c>1024&&!confirm(`El diseño contiene ${b} imágenes (${N} MB en imágenes). Payload completo: ${x} MB. Esto podría causar problemas al guardarlo. ¿Desea continuar de todos modos?`))return!1;const P=await fetch(`/api/canvas/projects/${s.id}/save`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:i});if(!P.ok){let T="Error al finalizar el diseño";try{T=(await P.json()).message||T}catch{P.status===413?T="El diseño es demasiado grande para ser guardado. Intente simplificar las imágenes.":P.status>=500&&(T="Error del servidor. Intente nuevamente más tarde.")}throw new Error(T)}const R=await P.json();return!0}catch(t){console.error("Error al finalizar diseño:",t);let a=t.message;return t.message.includes("Failed to fetch")?a="Error de conexión. Verifique su conexión a internet e intente nuevamente.":(t.message.includes("NetworkError")||t.message.includes("net::"))&&(a="Error de red. Intente nuevamente más tarde."),alert("Error al finalizar el diseño: "+a),!1}};const Gs=g.useCallback(async()=>{try{const{jsPDF:t}=await Js(async()=>{const{jsPDF:q}=await import("./jspdf.es.min-D3plwuQr.js").then(se=>se.j);return{jsPDF:q}},__vite__mapDeps([0,1,2,3,4]));let a=(o==null?void 0:o.width)||21,r=(o==null?void 0:o.height)||29.7;const i=.3,c=a+i*2,x=r+i*2,b=c*28.35,p=x*28.35,N=new t({orientation:b>p?"landscape":"portrait",unit:"pt",format:[b,p],compress:!1}),P=n.length;let R=0;const T=document.createElement("div");T.id="pdf-progress",T.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",T.innerHTML=`
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Generando PDF de alta calidad...</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="pdf-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                        <span id="current-page">0</span> de ${P} páginas procesadas
                    </p>
                </div>
            `,document.body.appendChild(T);const U=q=>{const se=q/P*100;document.getElementById("pdf-progress-bar").style.width=`${se}%`,document.getElementById("current-page").textContent=q},k=d;for(let q=0;q<n.length;q++){const se=n[q];w(q),await new Promise(K=>setTimeout(K,500));try{const K=await pe({type:"pdf"});if(K){const J=K.width/K.height,Ne=b/p;let me,ue,ve=0,Re=0;J>Ne?(me=b,ue=b/J,Re=(p-ue)/2):(ue=p,me=p*J,ve=(b-me)/2);const Me=K.toDataURL("image/png",1);q>0&&N.addPage([b,p]),N.addImage(Me,"PNG",ve,Re,me,ue)}else console.warn(`⚠️ No se pudo capturar la página ${q+1}`),q>0&&N.addPage([b,p]),N.setFontSize(12),N.text(`Error al renderizar página ${q+1}`,b/2,p/2,{align:"center"})}catch(K){console.error(`❌ Error procesando página ${q+1}:`,K),q>0&&N.addPage([b,p]),N.setFontSize(12),N.text(`Error al procesar página ${q+1}`,b/2,p/2,{align:"center"})}R++,U(R),await new Promise(K=>setTimeout(K,200))}w(k);const E=`${(l==null?void 0:l.name)||"album"}_${new Date().toISOString().split("T")[0]}.pdf`;N.save(E),document.body.removeChild(T);const z=document.createElement("div");return z.className="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",z.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>PDF de alta calidad generado: ${E}</span>
                </div>
            `,document.body.appendChild(z),setTimeout(()=>{document.body.contains(z)&&document.body.removeChild(z)},5e3),E}catch(t){console.error("❌ Error generando PDF:",t);const a=document.getElementById("pdf-progress");a&&document.body.removeChild(a);const r=document.createElement("div");throw r.className="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",r.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Error al generar PDF: ${t.message}</span>
                </div>
            `,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},7e3),t}},[n,d,w,pe,o,l]);return window.generateAlbumPDF=Gs,window.generateHighQualityThumbnail=nt,window.captureCurrentWorkspace=pe,e.jsxs(Xs,{backend:Ys,className:"!h-screen !w-screen overflow-hidden",children:[I?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Cargando Editor"}),e.jsx("p",{className:"customtext-neutral-dark",children:"Preparando tu álbum personalizado..."})]})}):C?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:C}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Reintentar"}),e.jsx("button",{onClick:()=>window.history.back(),className:"w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Volver"})]})]})}):n.length===0?e.jsx("div",{className:"h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold customtext-neutral-dark mb-2",children:"Inicializando Editor"}),e.jsx("p",{className:"customtext-neutral-dark mb-4",children:"Generando páginas del álbum..."}),e.jsx("div",{className:"animate-pulse flex space-x-4",children:e.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-5/6"})]})]})})]})}):e.jsxs("div",{className:"h-screen w-screen overflow-hidden bg-[#141b34] font-sans",children:[e.jsx(ra,{isOpen:lt,onRequestClose:()=>Qe(!1),pages:n.map(t=>({...t,layout:ce.find(a=>a.id===t.layout)||ce[0]})),workspaceDimensions:$,getCurrentLayout:t=>t?ce.find(a=>a.id===t.layout)||ce[0]:ce[0],presetData:o,pageThumbnails:ee,addAlbumToCart:qs,projectData:s,itemData:l}),e.jsx("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white shadow-lg flex items-center px-6 z-20 border-b border-gray-200",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors text-[#040404]",children:[e.jsx(Ts,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Volver"})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:Ot,disabled:f<=0,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(ks,{className:"h-4 w-4 text-[#040404]"})}),e.jsx("button",{onClick:Rt,disabled:f>=re.length-1,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Ss,{className:"h-4 w-4 text-[#040404]"})})]})]}),e.jsx("div",{className:"flex-1 max-w-md mx-8",children:e.jsx("input",{type:"text",value:(s==null?void 0:s.name)||"Álbum Sin Título",onChange:t=>m({...s,name:t.target.value}),className:"w-full text-center text-lg font-bold text-[#040404] bg-transparent border-0 focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:bg-white rounded-lg px-4 py-2 transition-all",placeholder:"Nombre del diseño"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(xr,{saveStatus:xe.saveStatus,lastSaved:xe.lastSaved,lastAutoSaved:xe.lastAutoSaved,hasUnsavedChanges:_.hasUnsavedChanges,isOnline:xe.isOnline,saveError:xe.saveError,onManualSave:u}),e.jsx(ke,{variant:"secondary",size:"sm",onClick:()=>Qe(!0),icon:e.jsx(Ct,{className:"h-4 w-4"}),children:"Vista de Álbum"}),e.jsx("div",{className:"relative",children:e.jsx("button",{className:"h-8 w-8 rounded-full bg-[#af5cb8] flex items-center justify-center text-white font-medium",children:e.jsx(ca,{className:"h-4 w-4"})})})]})]})}),e.jsxs("div",{className:`flex h-full ${M?"pt-[60px]":"pt-16"}`,children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-20 bg-[#f7edfa] border-r border-gray-200 flex flex-col items-center py-6 space-y-2",children:[e.jsxs("button",{onClick:()=>le("pages"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="pages"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ct,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Páginas"})]}),e.jsxs("button",{onClick:()=>le("templates"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="templates"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(zs,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Diseños"})]}),e.jsxs("button",{onClick:()=>le("panel"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="panel"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(It,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Capas"})]}),e.jsxs("button",{onClick:()=>le("images"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="images"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Se,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Imagenes"})]}),e.jsxs("button",{onClick:()=>le("text"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="text"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ue,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Textos"})]}),e.jsxs("button",{onClick:()=>le("shapes"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="shapes"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Ba,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Formas"})]}),e.jsxs("button",{onClick:()=>le("stickers"),className:`flex flex-col items-center gap-1 p-3 rounded-xl transition-all w-16 h-16 ${F==="stickers"?"bg-[#af5cb8] text-white shadow-md":"text-[#040404] hover:bg-white hover:shadow-sm"}`,children:[e.jsx(Va,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Stickers"})]})]}),e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-[#040404] capitalize",children:[F==="templates"&&"Templates",F==="images"&&"Images",F==="text"&&"Text",F==="shapes"&&"Shapes",F==="stickers"&&"Stickers",F==="pages"&&"Pages",F==="panel"&&"Layers Panel"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[F==="templates"&&"Choose a template to get started",F==="images"&&"Search for images",F==="text"&&"Add and edit text",F==="shapes"&&"Add shapes and graphics",F==="stickers"&&"Add fun stickers",F==="pages"&&"Manage your pages",F==="panel"&&"Organize layers and z-index"]})]}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Sa,{className:"h-4 w-4 text-gray-500"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[F==="templates"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(zs,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Page Layouts"})]}),e.jsx(Qa,{currentLayoutId:(_t=n[d])==null?void 0:_t.layout,onLayoutChange:Bs})]}),F==="images"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Se,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Imágenes del Proyecto"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[Ee.length," imagen",Ee.length!==1?"s":""]})]}),e.jsx(fr,{images:Ee,onImageSelect:ut,isLoading:_e})]}),F==="text"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>pt("heading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-2xl leading-tight",children:"Título Principal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"32px, Bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(Be,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>pt("subheading"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-lg leading-tight",children:"Subtítulo"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"24px, Semi-bold"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(Be,{className:"h-4 w-4"})})]})}),e.jsx("button",{onClick:()=>pt("body"),className:"w-full p-3 bg-white border border-gray-200 rounded-lg hover:border-[#af5cb8] hover:bg-gray-50 transition-all duration-200 text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-normal text-gray-900 text-base leading-tight",children:"Texto Normal"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"16px, Normal"})]}),e.jsx("div",{className:"text-gray-400 group-hover:text-[#af5cb8] transition-colors",children:e.jsx(Be,{className:"h-4 w-4"})})]})})]}),F==="text"&&M&&((Ft=Z())==null?void 0:Ft.type)==="text"&&e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"h-10 w-10 bg-[#af5cb8] rounded-xl flex items-center justify-center",children:e.jsx(Wa,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-[#040404] text-lg",children:"Editar Texto"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Personaliza el formato y estilo"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Formato:"}),e.jsx("button",{onClick:()=>{const t=Z();oe(L,M,{style:{...t.style,fontWeight:t.style.fontWeight==="bold"?"normal":"bold"}})},className:`px-3 py-1.5 rounded-md text-sm font-bold transition-colors ${((Ht=(Wt=Z())==null?void 0:Wt.style)==null?void 0:Ht.fontWeight)==="bold"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"B"}),e.jsx("button",{onClick:()=>{const t=Z();oe(L,M,{style:{...t.style,fontStyle:t.style.fontStyle==="italic"?"normal":"italic"}})},className:`px-3 py-1.5 rounded-md text-sm italic transition-colors ${((Bt=(Ut=Z())==null?void 0:Ut.style)==null?void 0:Bt.fontStyle)==="italic"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"I"}),e.jsx("button",{onClick:()=>{const t=Z();oe(L,M,{style:{...t.style,textDecoration:t.style.textDecoration==="underline"?"none":"underline"}})},className:`px-3 py-1.5 rounded-md text-sm underline transition-colors ${((qt=(Vt=Z())==null?void 0:Vt.style)==null?void 0:qt.textDecoration)==="underline"?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:"U"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tipografía:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((Kt=(Gt=Z())==null?void 0:Gt.style)==null?void 0:Kt.fontFamily)||"Arial",onChange:t=>{const a=Z();oe(L,M,{style:{...a.style,fontFamily:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Impact",children:"Impact"}),e.jsx("option",{value:"Comic Sans MS",children:"Comic Sans MS"}),e.jsx("option",{value:"Trebuchet MS",children:"Trebuchet MS"}),e.jsx("option",{value:"Tahoma",children:"Tahoma"}),e.jsx("option",{value:"Palatino",children:"Palatino"}),e.jsx("option",{value:"Garamond",children:"Garamond"}),e.jsx("option",{value:"Bookman",children:"Bookman"}),e.jsx("option",{value:"Avant Garde",children:"Avant Garde"}),e.jsx("option",{value:"Calibri",children:"Calibri"}),e.jsx("option",{value:"Cambria",children:"Cambria"}),e.jsx("option",{value:"Candara",children:"Candara"}),e.jsx("option",{value:"Century Gothic",children:"Century Gothic"}),e.jsx("option",{value:"Franklin Gothic",children:"Franklin Gothic"}),e.jsx("option",{value:"Futura",children:"Futura"}),e.jsx("option",{value:"Gill Sans",children:"Gill Sans"}),e.jsx("option",{value:"Lucida Grande",children:"Lucida Grande"}),e.jsx("option",{value:"Optima",children:"Optima"}),e.jsx("option",{value:"Segoe UI",children:"Segoe UI"}),e.jsx("option",{value:"Roboto",children:"Roboto"}),e.jsx("option",{value:"Open Sans",children:"Open Sans"}),e.jsx("option",{value:"Lato",children:"Lato"}),e.jsx("option",{value:"Montserrat",children:"Montserrat"}),e.jsx("option",{value:"Poppins",children:"Poppins"}),e.jsx("option",{value:"Nunito",children:"Nunito"}),e.jsx("option",{value:"Inter",children:"Inter"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Tamaño:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((Xt=(Jt=Z())==null?void 0:Jt.style)==null?void 0:Xt.fontSize)||"16px",onChange:t=>{const a=Z();oe(L,M,{style:{...a.style,fontSize:t.target.value}})},className:"w-full p-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"8px",children:"8px"}),e.jsx("option",{value:"10px",children:"10px"}),e.jsx("option",{value:"12px",children:"12px"}),e.jsx("option",{value:"14px",children:"14px"}),e.jsx("option",{value:"16px",children:"16px"}),e.jsx("option",{value:"18px",children:"18px"}),e.jsx("option",{value:"20px",children:"20px"}),e.jsx("option",{value:"22px",children:"22px"}),e.jsx("option",{value:"24px",children:"24px"}),e.jsx("option",{value:"28px",children:"28px"}),e.jsx("option",{value:"32px",children:"32px"}),e.jsx("option",{value:"36px",children:"36px"}),e.jsx("option",{value:"40px",children:"40px"}),e.jsx("option",{value:"44px",children:"44px"}),e.jsx("option",{value:"48px",children:"48px"}),e.jsx("option",{value:"56px",children:"56px"}),e.jsx("option",{value:"64px",children:"64px"}),e.jsx("option",{value:"72px",children:"72px"}),e.jsx("option",{value:"80px",children:"80px"}),e.jsx("option",{value:"96px",children:"96px"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Color:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((Qt=(Yt=Z())==null?void 0:Yt.style)==null?void 0:Qt.color)||"#000000",onChange:t=>{const a=Z();oe(L,M,{style:{...a.style,color:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("span",{className:"text-xs text-gray-600 font-mono",children:((Dt=(Zt=Z())==null?void 0:Zt.style)==null?void 0:Dt.color)||"#000000"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Fondo:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:((ts=(es=Z())==null?void 0:es.style)==null?void 0:ts.backgroundColor)||"#ffffff",onChange:t=>{const a=Z();oe(L,M,{style:{...a.style,backgroundColor:t.target.value}})},className:"w-10 h-10 border border-gray-300 rounded-lg cursor-pointer hover:border-[#af5cb8] transition-colors"}),e.jsx("button",{onClick:()=>{const t=Z();oe(L,M,{style:{...t.style,backgroundColor:"transparent"}})},className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"🚫"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 w-20",children:"Alinear:"}),e.jsx("div",{className:"flex gap-1",children:["left","center","right","justify"].map(t=>{var a,r;return e.jsxs("button",{onClick:()=>{const i=Z();oe(L,M,{style:{...i.style,textAlign:t}})},className:`px-3 py-1.5 rounded-md text-sm transition-colors ${((r=(a=Z())==null?void 0:a.style)==null?void 0:r.textAlign)===t?"bg-[#af5cb8] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:[t==="left"&&"⬅",t==="center"&&"⬌",t==="right"&&"➡",t==="justify"&&"⬍"]},t)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Espaciado:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((as=(ss=Z())==null?void 0:ss.style)==null?void 0:as.lineHeight)||"1.5",onChange:t=>{const a=Z();oe(L,M,{style:{...a.style,lineHeight:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"1",children:"1.0"}),e.jsx("option",{value:"1.1",children:"1.1"}),e.jsx("option",{value:"1.2",children:"1.2"}),e.jsx("option",{value:"1.3",children:"1.3"}),e.jsx("option",{value:"1.4",children:"1.4"}),e.jsx("option",{value:"1.5",children:"1.5"}),e.jsx("option",{value:"1.6",children:"1.6"}),e.jsx("option",{value:"1.8",children:"1.8"}),e.jsx("option",{value:"2",children:"2.0"}),e.jsx("option",{value:"2.2",children:"2.2"}),e.jsx("option",{value:"2.5",children:"2.5"}),e.jsx("option",{value:"3",children:"3.0"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Letras:"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:((ns=(rs=Z())==null?void 0:rs.style)==null?void 0:ns.letterSpacing)||"normal",onChange:t=>{const a=Z();oe(L,M,{style:{...a.style,letterSpacing:t.target.value}})},className:"w-full p-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#af5cb8] focus:border-transparent appearance-none cursor-pointer hover:border-[#af5cb8] transition-colors",children:[e.jsx("option",{value:"-3px",children:"-3px"}),e.jsx("option",{value:"-2px",children:"-2px"}),e.jsx("option",{value:"-1px",children:"-1px"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"0.5px",children:"0.5px"}),e.jsx("option",{value:"1px",children:"1px"}),e.jsx("option",{value:"1.5px",children:"1.5px"}),e.jsx("option",{value:"2px",children:"2px"}),e.jsx("option",{value:"3px",children:"3px"}),e.jsx("option",{value:"4px",children:"4px"}),e.jsx("option",{value:"5px",children:"5px"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Efectos:"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>{const t=Z();oe(L,M,{style:{...t.style,textTransform:t.style.textTransform==="uppercase"?"none":"uppercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((is=(os=Z())==null?void 0:os.style)==null?void 0:is.textTransform)==="uppercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-black",children:"AA"}),"MAYÚS"]}),e.jsxs("button",{onClick:()=>{const t=Z();oe(L,M,{style:{...t.style,textTransform:t.style.textTransform==="lowercase"?"none":"lowercase"}})},className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${((cs=(ls=Z())==null?void 0:ls.style)==null?void 0:cs.textTransform)==="lowercase"?"bg-[#af5cb8] text-white shadow-sm":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-[#af5cb8]"}`,children:[e.jsx("span",{className:"text-xs font-normal",children:"aa"}),"minús"]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Opacidad:"}),e.jsxs("span",{className:"text-sm font-bold text-[#af5cb8]",children:[Math.round((((ms=(ds=Z())==null?void 0:ds.style)==null?void 0:ms.opacity)||1)*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:((hs=(gs=Z())==null?void 0:gs.style)==null?void 0:hs.opacity)||"1",onChange:t=>{const a=Z();oe(L,M,{style:{...a.style,opacity:t.target.value}})},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#af5cb8] slider",style:{background:`linear-gradient(to right, #af5cb8 0%, #af5cb8 ${(((xs=(us=Z())==null?void 0:us.style)==null?void 0:xs.opacity)||1)*100}%, #e5e7eb ${(((fs=(ps=Z())==null?void 0:ps.style)==null?void 0:fs.opacity)||1)*100}%, #e5e7eb 100%)`}})]})]})]})]}),F==="shapes"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Array.from({length:9}).map((t,a)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#af5cb8] rounded-lg"})},a))})}),F==="stickers"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:6}).map((t,a)=>e.jsx("button",{className:"aspect-square bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-[#f6a4b2] rounded-full"})},a))})}),F==="pages"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ct,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Pages"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[n.length," total"]})]}),n.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cargando páginas..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mr-1.5"}),"Cover"]}),wt.cover.map((t,a)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${d===n.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>Y(n.indexOf(t)),children:e.jsxs("div",{className:"relative bg-purple-50 overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(Et,{pageId:t.id,thumbnail:ee[t.id],altText:"Cover",type:"cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Cover"})})]})},t.id))]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mr-1.5"}),"Content Pages"]}),e.jsx("div",{className:"space-y-2",children:wt.content.map((t,a)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                    ${d===n.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                    mb-1`,onClick:()=>Y(n.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border aspect-[4/3] rounded-lg",children:[e.jsx(Et,{pageId:t.id,thumbnail:ee[t.id],altText:`Page ${t.pageNumber}`,type:"content"}),e.jsx("div",{className:"absolute top-1 left-1 bg-white/90 rounded-full h-5 w-5 flex items-center justify-center text-[10px] font-bold shadow-sm",children:t.pageNumber}),e.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-[9px] px-1.5 py-0.5 rounded-full opacity-80 group-hover:opacity-100",children:"Editable"})]})},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mr-1.5"}),"Back Cover"]}),wt.final.map((t,a)=>e.jsx("div",{className:`relative group flex flex-col cursor-pointer transition-all duration-200 transform 
                                                                ${d===n.indexOf(t)?"ring-2 ring-purple-400 scale-[1.02] shadow-md":"hover:bg-gray-50 border border-transparent hover:border-gray-200"}
                                                                mb-2`,onClick:()=>Y(n.indexOf(t)),children:e.jsxs("div",{className:"relative overflow-hidden border mb-1 aspect-[4/3] rounded-lg",children:[e.jsx(Et,{pageId:t.id,thumbnail:ee[t.id],altText:"Back Cover",type:"final"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 pt-6 group-hover:opacity-100 opacity-80 transition-opacity",children:e.jsx("span",{className:"text-[10px] text-white font-medium block",children:"Back Cover"})})]})},t.id))]})]})]}),F==="panel"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Ya,{pages:n,currentPage:d,selectedCell:L,selectedElement:M,onSelectCell:ge,onSelectElement:Q,onUpdateElement:(t,a,r)=>{oe(t,a,r)},onDeleteElement:(t,a)=>{xt(t,a)},onMoveElement:(t,a,r)=>{Vs(t,a,r)}})}),F==="filters"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(da,{className:"h-5 w-5 text-[#af5cb8]"}),e.jsx("h3",{className:"font-semibold text-[#040404]",children:"Filters"})]}),(()=>{const t=Z();return t?e.jsxs(e.Fragment,{children:[t.type==="image"&&e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"h-4 w-4 text-[#af5cb8]"}),e.jsx("span",{className:"text-sm font-medium",children:"Selected Image"})]}),e.jsx("div",{className:"w-full h-16 rounded-md overflow-hidden bg-gray-200",children:e.jsx("img",{src:t.content,alt:"",className:"w-full h-full object-cover"})})]}),t.type==="image"&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Masks"}),e.jsx(Za,{selectedMask:t.mask||"none",onSelect:a=>{oe(L,M,{mask:a})},availableMasks:Ms.map(a=>a.id),selectedImage:t})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-[#040404] mb-3",children:"Filters & Effects"}),e.jsx(Qs,{filters:t.filters||{},onFilterChange:a=>{oe(L,M,{filters:a})},selectedElement:t})]})]}):e.jsxs("div",{className:"text-center py-8 px-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg mb-3 inline-block",children:e.jsx(Se,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h4",{className:"text-sm font-medium text-[#040404] mb-2",children:"Select an element"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Choose an image or text element to apply filters and effects"})]})})()]})]})]})]}),e.jsxs("main",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"bg-white border-b px-4 py-2 flex items-center justify-between",children:ot?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{variant:"ghost",size:"sm",onClick:()=>Ae(!1),className:"h-8 px-2",icon:e.jsx(Ts,{className:"h-4 w-4"}),children:"Volver"}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"})]}),e.jsx("div",{className:"flex-1 flex justify-start",children:e.jsx(nr,{element:Z(),onUpdate:t=>{oe(Ye.cellId,Ye.elementId,t)},onClose:()=>Ae(!1)})})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(ke,{variant:"ghost",size:"sm",onClick:Ot,disabled:f<=0,className:"h-8 px-2",icon:e.jsx(ks,{className:"h-4 w-4"}),children:"Deshacer"}),e.jsx(ke,{variant:"ghost",size:"sm",onClick:Rt,disabled:f>=re.length-1,className:"h-8 px-2",icon:e.jsx(Ss,{className:"h-4 w-4"}),children:"Rehacer"})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(ke,{variant:"ghost",size:"sm",onClick:()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=a=>{if(a.target.files&&a.target.files[0]){const i={id:`img-${Date.now()}`,type:"image",content:"",position:{x:.1,y:.1},size:{width:.3,height:.3},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"},c=new FileReader;c.onload=x=>{var b,p;(b=x.target)!=null&&b.result&&(i.content=x.target.result,L?Te(L,i):(p=n[d])!=null&&p.cells[0]&&Te(n[d].cells[0].id,i))},c.readAsDataURL(a.target.files[0])}},t.click()},className:"h-8 px-2",icon:e.jsx(Se,{className:"h-4 w-4"}),children:"Imagen"}),e.jsx(ke,{variant:"ghost",tooltip:"Añadir Imagen",onClick:()=>He.current&&He.current.click(),children:e.jsx(Se,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",ref:He,onChange:gt,className:"hidden",accept:"image/*"}),e.jsx(ke,{variant:"ghost",tooltip:"Añadir Texto",onClick:pt,children:e.jsx(Ue,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),M&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(ke,{variant:"ghost",size:"sm",onClick:()=>{if(M&&L){const t=Z();if(t){const a={...t,id:`${t.type}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,position:{x:t.position.x+.05,y:t.position.y+.05}};Te(L,a)}}},className:"h-8 px-2",icon:e.jsx(ma,{className:"h-4 w-4"}),children:"Duplicar"}),e.jsx(ke,{variant:"ghost",size:"sm",onClick:()=>{M&&L&&xt(L,M)},className:"h-8 px-2 text-red-600 hover:text-white",icon:e.jsx(Pt,{className:"h-4 w-4"}),children:"Eliminar"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(or,{currentSize:O,onSizeChange:ae,presetData:o,workspaceDimensions:$})})]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 overflow-hidden bg-gray-100",children:ne?e.jsx("div",{className:"bg-white rounded-lg shadow-lg",children:e.jsx("div",{className:"overflow-hidden",style:{width:$.width,height:$.height},children:e.jsx("div",{id:`page-${n[d].id}`,className:`grid ${Pe().template} gap-6`,style:{width:"100%",height:"100%"},children:n[d].cells.map((t,a)=>{var r;return e.jsx(Cs,{id:t.id,elements:t.elements.filter(i=>!i.locked),workspaceSize:$,cellStyle:(r=Pe().cellStyles)==null?void 0:r[n[d].cells.indexOf(t)],selectedElement:L===t.id?M:null,onSelectElement:zt,onAddElement:(i,c)=>Te(c,i),onUpdateElement:(i,c,x)=>oe(t.id,i,c,x),onDeleteElement:i=>xt(t.id,i),availableMasks:Pe().maskCategories.flatMap(i=>i.masks),projectData:s},t.id)})})})}):e.jsxs("div",{id:`page-${n[d].id}`,className:" shadow-xl overflow-hidden",style:{width:$.width,height:$.height,position:"relative",backgroundColor:((ys=n[d])==null?void 0:ys.backgroundColor)||"#ffffff",backgroundImage:(bs=n[d])!=null&&bs.backgroundImage?`url(${n[d].backgroundImage})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:["                                        ",(()=>{const t=n[d];return t!=null&&t.backgroundImage?e.jsx("img",{src:t.backgroundImage,alt:"background",className:"absolute inset-0 w-full h-full object-cover pointer-events-none",style:{zIndex:1}}):t!=null&&t.backgroundColor?e.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{backgroundColor:t.backgroundColor,zIndex:1}}):null})(),e.jsx("div",{className:`grid ${Pe().template}`,style:{position:"relative",zIndex:10,width:"100%",height:"100%",boxSizing:"border-box",gap:((vs=Pe().style)==null?void 0:vs.gap)||"16px",padding:((ws=Pe().style)==null?void 0:ws.padding)||"16px"},children:n[d].cells.map(t=>{var a;return e.jsx(Cs,{id:t.id,elements:t.elements.filter(r=>!r.locked),workspaceSize:$,cellStyle:(a=Pe().cellStyles)==null?void 0:a[n[d].cells.indexOf(t)],selectedElement:L===t.id?M:null,onSelectElement:zt,onAddElement:(r,i)=>Te(i,r),onUpdateElement:(r,i,c)=>oe(t.id,r,i,c),onDeleteElement:r=>xt(t.id,r),availableMasks:Pe().maskCategories.flatMap(r=>r.masks),projectData:s},t.id)})})]})})]})]})]}),e.jsx(ta,{}),e.jsx(pr,{isOpen:ct,onClose:()=>Ze(!1),savedProgress:dt,onLoadProgress:tt,onDiscardProgress:Us})]})}export{un as default};
