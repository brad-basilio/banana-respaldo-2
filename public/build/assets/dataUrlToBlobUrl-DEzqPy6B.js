var _={exports:{}};/*! dom-to-image-more 08-08-2025 */var de=_.exports,Q;function he(){return Q||(Q=1,(function(v,h){(w=>{let r=(()=>{let u=0;return{escape:function(e){return e.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1")},isDataUrl:function(e){return e.search(/^(data:)/)!==-1},canvasToBlob:function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):(t=>new Promise(function(o){var s=ee(t.toDataURL().split(",")[1]),a=s.length,C=new Uint8Array(a);for(let L=0;L<a;L++)C[L]=s.charCodeAt(L);o(new Blob([C],{type:"image/png"}))}))(e)},resolveUrl:function(e,t){var o=document.implementation.createHTMLDocument(),s=o.createElement("base"),a=(o.head.appendChild(s),o.createElement("a"));return o.body.appendChild(a),s.href=t,a.href=e,a.href},getAndEncode:function(e){let t=f.impl.urlCache.find(function(o){return o.url===e});return t||(t={url:e,promise:null},f.impl.urlCache.push(t)),t.promise===null&&(f.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime()),t.promise=new Promise(function(o){let s=f.impl.options.httpTimeout,a=new XMLHttpRequest;if(a.onreadystatechange=function(){if(a.readyState===4)if(300<=a.status)L?o(L):y(`cannot fetch resource: ${e}, status: `+a.status);else{let b=new FileReader;b.onloadend=function(){o(b.result)},b.readAsDataURL(a.response)}},a.ontimeout=function(){L?o(L):y(`timeout of ${s}ms occured while fetching resource: `+e)},a.responseType="blob",a.timeout=s,0<f.impl.options.useCredentialsFilters.length&&(f.impl.options.useCredentials=0<f.impl.options.useCredentialsFilters.filter(b=>0<=e.search(b)).length),f.impl.options.useCredentials&&(a.withCredentials=!0),f.impl.options.corsImg&&e.indexOf("http")===0&&e.indexOf(window.location.origin)===-1){var C=(f.impl.options.corsImg.method||"GET").toUpperCase()==="POST"?"POST":"GET";a.open(C,(f.impl.options.corsImg.url||"").replace("#{cors}",e),!0);let b=!1,g=f.impl.options.corsImg.headers||{},S=(Object.keys(g).forEach(function(i){g[i].indexOf("application/json")!==-1&&(b=!0),a.setRequestHeader(i,g[i])}),(i=>{try{return JSON.parse(JSON.stringify(i))}catch(P){y("corsImg.data is missing or invalid:"+P.toString())}})(f.impl.options.corsImg.data||""));Object.keys(S).forEach(function(i){typeof S[i]=="string"&&(S[i]=S[i].replace("#{cors}",e))}),a.send(b?JSON.stringify(S):S)}else a.open("GET",e,!0),a.send();let L;function y(b){console.error(b),o("")}f.impl.options.imagePlaceholder&&(C=f.impl.options.imagePlaceholder.split(/,/))&&C[1]&&(L=C[1])})),t.promise},uid:function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+u++},delay:function(e){return function(t){return new Promise(function(o){setTimeout(function(){o(t)},e)})}},asArray:function(e){var t=[],o=e.length;for(let s=0;s<o;s++)t.push(e[s]);return t},escapeXhtml:function(e){return e.replace(/%/g,"%25").replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return e!=="data:,"?new Promise(function(t,o){let s=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=new Image;f.impl.options.useCredentials&&(a.crossOrigin="use-credentials"),a.onload=function(){document.body.removeChild(s),window&&window.requestAnimationFrame?window.requestAnimationFrame(function(){t(a)}):t(a)},a.onerror=C=>{document.body.removeChild(s),o(C)},s.appendChild(a),a.src=e,document.body.appendChild(s)}):Promise.resolve()},width:function(e){var t=c(e,"width");if(!isNaN(t))return t;var t=c(e,"border-left-width"),o=c(e,"border-right-width");return e.scrollWidth+t+o},height:function(e){var t=c(e,"height");if(!isNaN(t))return t;var t=c(e,"border-top-width"),o=c(e,"border-bottom-width");return e.scrollHeight+t+o},getWindow:n,isElement:m,isElementHostForOpenShadowRoot:function(e){return m(e)&&e.shadowRoot!==null},isShadowRoot:l,isInShadowRoot:d,isHTMLElement:function(e){return e instanceof n(e).HTMLElement},isHTMLCanvasElement:function(e){return e instanceof n(e).HTMLCanvasElement},isHTMLInputElement:function(e){return e instanceof n(e).HTMLInputElement},isHTMLImageElement:function(e){return e instanceof n(e).HTMLImageElement},isHTMLLinkElement:function(e){return e instanceof n(e).HTMLLinkElement},isHTMLScriptElement:function(e){return e instanceof n(e).HTMLScriptElement},isHTMLStyleElement:function(e){return e instanceof n(e).HTMLStyleElement},isHTMLTextAreaElement:function(e){return e instanceof n(e).HTMLTextAreaElement},isShadowSlotElement:function(e){return d(e)&&e instanceof n(e).HTMLSlotElement},isSVGElement:function(e){return e instanceof n(e).SVGElement},isSVGRectElement:function(e){return e instanceof n(e).SVGRectElement},isDimensionMissing:function(e){return isNaN(e)||e<=0}};function n(e){return e=e?e.ownerDocument:void 0,(e?e.defaultView:void 0)||window||w}function l(e){return e instanceof n(e).ShadowRoot}function d(e){return e!=null&&e.getRootNode!==void 0&&l(e.getRootNode())}function m(e){return e instanceof n(e).Element}function c(e,t){if(e.nodeType===J){let o=z(e).getPropertyValue(t);if(o.slice(-2)==="px")return o=o.slice(0,-2),parseFloat(o)}return NaN}})(),R=(()=>{let u=/url\(\s*(["']?)((?:\\.|[^\\)])+)\1\s*\)/gm;return{inlineAll:function(c,e,t){return n(c)?Promise.resolve(c).then(l).then(function(o){let s=Promise.resolve(c);return o.forEach(function(a){s=s.then(function(C){return m(C,a,e,t)})}),s}):Promise.resolve(c)},shouldProcess:n,impl:{readUrls:l,inline:m,urlAsRegex:d}};function n(c){return c.search(u)!==-1}function l(c){for(var e,t=[];(e=u.exec(c))!==null;)t.push(e[2]);return t.filter(function(o){return!r.isDataUrl(o)})}function d(c){return new RegExp(`url\\((["']?)(${r.escape(c)})\\1\\)`,"gm")}function m(c,e,t,o){return Promise.resolve(e).then(function(s){return t?r.resolveUrl(s,t):s}).then(o||r.getAndEncode).then(function(s){var a=d(e);return c.replace(a,`url($1${s}$1)`)})}})(),A={resolveAll:function(){return x().then(function(u){return Promise.all(u.map(function(n){return n.resolve()}))}).then(function(u){return u.join(`
`)})},impl:{readAll:x}};function x(){return Promise.resolve(r.asArray(document.styleSheets)).then(function(n){let l=[];return n.forEach(function(d){var m=Object.getPrototypeOf(d);if(Object.prototype.hasOwnProperty.call(m,"cssRules"))try{r.asArray(d.cssRules||[]).forEach(l.push.bind(l))}catch(c){console.error("domtoimage: Error while reading CSS rules from "+d.href,c.toString())}}),l}).then(function(n){return n.filter(function(l){return l.type===CSSRule.FONT_FACE_RULE}).filter(function(l){return R.shouldProcess(l.style.getPropertyValue("src"))})}).then(function(n){return n.map(u)});function u(n){return{resolve:function(){var l=(n.parentStyleSheet||{}).href;return R.inlineAll(n.cssText,l)},src:function(){return n.style.getPropertyValue("src")}}}}let U={inlineAll:function u(n){if(!r.isElement(n))return Promise.resolve(n);return l(n).then(function(){return r.isHTMLImageElement(n)?G(n).inline():Promise.all(r.asArray(n.childNodes).map(function(d){return u(d)}))});function l(d){let m=["background","background-image"],c=m.map(function(e){let t=d.style.getPropertyValue(e),o=d.style.getPropertyPriority(e);return t?R.inlineAll(t).then(function(s){d.style.setProperty(e,s,o)}):Promise.resolve()});return Promise.all(c).then(function(){return d})}},impl:{newImage:G}};function G(u){return{inline:function(n){return r.isDataUrl(u.src)?Promise.resolve():Promise.resolve(u.src).then(n||r.getAndEncode).then(function(l){return new Promise(function(d){u.onload=d,u.onerror=d,u.src=l})})}}}let O={copyDefaultStyles:!0,imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1,useCredentialsFilters:[],httpTimeout:3e4,styleCaching:"strict",corsImg:void 0},f={toSvg:X,toPng:function(u,n){return j(u,n).then(function(l){return l.toDataURL()})},toJpeg:function(u,n){return j(u,n).then(function(l){return l.toDataURL("image/jpeg",(n?n.quality:void 0)||1)})},toBlob:function(u,n){return j(u,n).then(r.canvasToBlob)},toPixelData:function(u,n){return j(u,n).then(function(l){return l.getContext("2d").getImageData(0,0,r.width(u),r.height(u)).data})},toCanvas:j,impl:{fontFaces:A,images:U,util:r,inliner:R,urlCache:[],options:{}}},J=(v.exports=f,(typeof Node<"u"?Node.ELEMENT_NODE:void 0)||1),z=(w!==void 0?w.getComputedStyle:void 0)||(typeof window<"u"?window.getComputedStyle:void 0)||globalThis.getComputedStyle,ee=(w!==void 0?w.atob:void 0)||(typeof window<"u"?window.atob:void 0)||globalThis.atob;function X(u,n){f.impl.util.getWindow(u);var l=n=n||{};l.copyDefaultStyles===void 0?f.impl.options.copyDefaultStyles=O.copyDefaultStyles:f.impl.options.copyDefaultStyles=l.copyDefaultStyles,f.impl.options.imagePlaceholder=(l.imagePlaceholder===void 0?O:l).imagePlaceholder,f.impl.options.cacheBust=(l.cacheBust===void 0?O:l).cacheBust,f.impl.options.corsImg=(l.corsImg===void 0?O:l).corsImg,f.impl.options.useCredentials=(l.useCredentials===void 0?O:l).useCredentials,f.impl.options.useCredentialsFilters=(l.useCredentialsFilters===void 0?O:l).useCredentialsFilters,f.impl.options.httpTimeout=(l.httpTimeout===void 0?O:l).httpTimeout,f.impl.options.styleCaching=(l.styleCaching===void 0?O:l).styleCaching;let d=[];return Promise.resolve(u).then(function(m){if(m.nodeType===J)return m;var c=m,e=m.parentNode,t=document.createElement("span");return e.replaceChild(t,c),t.append(m),d.push({parent:e,child:c,wrapper:t}),t}).then(function(m){return(function c(e,t,o,s){let a=t.filter;if(e===D||r.isHTMLScriptElement(e)||r.isHTMLStyleElement(e)||r.isHTMLLinkElement(e)||o!==null&&a&&!a(e))return Promise.resolve();return Promise.resolve(e).then(C).then(L).then(function(i){return g(i,b(e))}).then(y).then(function(i){return S(i,e)});function C(i){return r.isHTMLCanvasElement(i)?r.makeImage(i.toDataURL()):i.cloneNode(!1)}function L(i){return t.adjustClonedNode&&t.adjustClonedNode(e,i,!1),Promise.resolve(i)}function y(i){return t.adjustClonedNode&&t.adjustClonedNode(e,i,!0),Promise.resolve(i)}function b(i){return r.isElementHostForOpenShadowRoot(i)?i.shadowRoot:i}function g(i,P){let B=$(P),H=Promise.resolve();if(B.length!==0){let T=z(V(P));r.asArray(B).forEach(function(N){H=H.then(function(){return c(N,t,T).then(function(E){E&&i.appendChild(E)})})})}return H.then(function(){return i});function V(T){return r.isShadowRoot(T)?T.host:T}function $(T){if(r.isShadowSlotElement(T)){let N=T.assignedNodes();if(N&&0<N.length)return N}return T.childNodes}}function S(i,P){return!r.isElement(i)||r.isShadowSlotElement(P)?Promise.resolve(i):Promise.resolve().then(B).then(H).then(V).then($).then(function(){return i});function B(){function T(E,p){p.font=E.font,p.fontFamily=E.fontFamily,p.fontFeatureSettings=E.fontFeatureSettings,p.fontKerning=E.fontKerning,p.fontSize=E.fontSize,p.fontStretch=E.fontStretch,p.fontStyle=E.fontStyle,p.fontVariant=E.fontVariant,p.fontVariantCaps=E.fontVariantCaps,p.fontVariantEastAsian=E.fontVariantEastAsian,p.fontVariantLigatures=E.fontVariantLigatures,p.fontVariantNumeric=E.fontVariantNumeric,p.fontVariationSettings=E.fontVariationSettings,p.fontWeight=E.fontWeight}function N(E,p){let I=z(E);I.cssText?(p.style.cssText=I.cssText,T(I,p.style)):(oe(t,E,I,o,p),o===null&&(["inset-block","inset-block-start","inset-block-end"].forEach(F=>p.style.removeProperty(F)),["left","right","top","bottom"].forEach(F=>{p.style.getPropertyValue(F)&&p.style.setProperty(F,"0px")})))}N(P,i)}function H(){let T=r.uid();function N(E){let p=z(P,E),I=p.getPropertyValue("content");if(I!==""&&I!=="none"){let ie=function(){let le=`.${T}:`+E,se=(p.cssText?ae:ce)();return document.createTextNode(le+`{${se}}`);function ae(){return`${p.cssText} content: ${I};`}function ce(){return r.asArray(p).map(ue).join("; ")+";";function ue(K){let me=p.getPropertyValue(K),fe=p.getPropertyPriority(K)?" !important":"";return K+": "+me+fe}}},F=i.getAttribute("class")||"",Y=(i.setAttribute("class",F+" "+T),document.createElement("style"));Y.appendChild(ie()),i.appendChild(Y)}}[":before",":after"].forEach(function(E){N(E)})}function V(){r.isHTMLTextAreaElement(P)&&(i.innerHTML=P.value),r.isHTMLInputElement(P)&&i.setAttribute("value",P.value)}function $(){r.isSVGElement(i)&&(i.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.isSVGRectElement(i))&&["width","height"].forEach(function(T){let N=i.getAttribute(T);N&&i.style.setProperty(T,N)})}}})(m,n,null)}).then(n.disableEmbedFonts?Promise.resolve(u):te).then(ne).then(function(m){n.bgcolor&&(m.style.backgroundColor=n.bgcolor),n.width&&(m.style.width=n.width+"px"),n.height&&(m.style.height=n.height+"px"),n.style&&Object.keys(n.style).forEach(function(e){m.style[e]=n.style[e]});let c=null;return typeof n.onclone=="function"&&(c=n.onclone(m)),Promise.resolve(c).then(function(){return m})}).then(function(m){let c=n.width||r.width(m),e=n.height||r.height(m);return Promise.resolve(m).then(function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(t)}).then(r.escapeXhtml).then(function(t){var o=(r.isDimensionMissing(c)?' width="100%"':` width="${c}"`)+(r.isDimensionMissing(e)?' height="100%"':` height="${e}"`);return`<svg xmlns="http://www.w3.org/2000/svg"${(r.isDimensionMissing(c)?"":` width="${c}"`)+(r.isDimensionMissing(e)?"":` height="${e}"`)}><foreignObject${o}>${t}</foreignObject></svg>`}).then(function(t){return"data:image/svg+xml;charset=utf-8,"+t})}).then(function(m){for(;0<d.length;){var c=d.pop();c.parent.replaceChild(c.child,c.wrapper)}return m}).then(function(m){return f.impl.urlCache=[],D&&(document.body.removeChild(D),D=null),W&&clearTimeout(W),W=setTimeout(()=>{W=null,q={}},2e4),m})}function j(u,n){return X(u,n=n||{}).then(r.makeImage).then(function(l){var d=typeof n.scale!="number"?1:n.scale,m=((e,t)=>{let o=n.width||r.width(e),s=n.height||r.height(e);return r.isDimensionMissing(o)&&(o=r.isDimensionMissing(s)?300:2*s),r.isDimensionMissing(s)&&(s=o/2),(e=document.createElement("canvas")).width=o*t,e.height=s*t,n.bgcolor&&((t=e.getContext("2d")).fillStyle=n.bgcolor,t.fillRect(0,0,e.width,e.height)),e})(u,d),c=m.getContext("2d");return c.msImageSmoothingEnabled=!1,c.imageSmoothingEnabled=!1,l&&(c.scale(d,d),c.drawImage(l,0,0)),m})}let D=null;function te(u){return A.resolveAll().then(function(n){var l;return n!==""&&(l=document.createElement("style"),u.appendChild(l),l.appendChild(document.createTextNode(n))),u})}function ne(u){return U.inlineAll(u).then(function(){return u})}function oe(u,n,l,d,m){let c=f.impl.options.copyDefaultStyles?((t,o)=>{var s,a=(y=>(t.styleCaching!=="relaxed"?y:y.filter((b,g,S)=>g===0||g===S.length-1)).join(">"))(o=(y=>{var b=[];do if(y.nodeType===J){var g=y.tagName;if(b.push(g),re.includes(g))break}while(y=y.parentNode);return b})(o));{if(q[a])return q[a];o=((y,b)=>{let g=y.body;do{var S=b.pop(),S=y.createElement(S);g.appendChild(S),g=S}while(0<b.length);return g.textContent="​",g})((s=(()=>{if(D)return D.contentWindow;b=document.characterSet||"UTF-8",y=(y=document.doctype)?(`<!DOCTYPE ${H(y.name)} ${H(y.publicId)} `+H(y.systemId)).trim()+">":"",(D=document.createElement("iframe")).id="domtoimage-sandbox-"+r.uid(),D.style.visibility="hidden",D.style.position="fixed",document.body.appendChild(D);var y,b,g=D,S="domtoimage-sandbox";try{return g.contentWindow.document.write(y+`<html><head><meta charset='${b}'><title>${S}</title></head><body></body></html>`),g.contentWindow}catch{}var i=document.createElement("meta");i.setAttribute("charset",b);try{var P=document.implementation.createHTMLDocument(S),B=(P.head.appendChild(i),y+P.documentElement.outerHTML);return g.setAttribute("srcdoc",B),g.contentWindow}catch{}return g.contentDocument.head.appendChild(i),g.contentDocument.title=S,g.contentWindow;function H(V){var $;return V?(($=document.createElement("div")).innerText=V,$.innerHTML):""}})()).document,o),s=((y,b)=>{let g={},S=y.getComputedStyle(b);return r.asArray(S).forEach(function(i){g[i]=i==="width"||i==="height"?"auto":S.getPropertyValue(i)}),g})(s,o);var C=o;do{var L=C.parentElement;L!==null&&L.removeChild(C),C=L}while(C&&C.tagName!=="BODY");return q[a]=s}})(u,n):{},e=m.style;r.asArray(l).forEach(function(t){var o,s,a,C;u.filterStyles&&!u.filterStyles(n,t)||(s=l.getPropertyValue(t),a=c[t],o=d?d.getPropertyValue(t):void 0,e.getPropertyValue(t))||(s!==a||d&&s!==o)&&(a=l.getPropertyPriority(t),o=e,s=s,a=a,C=0<=["background-clip"].indexOf(t=t),a?(o.setProperty(t,s,a),C&&o.setProperty("-webkit-"+t,s,a)):(o.setProperty(t,s),C&&o.setProperty("-webkit-"+t,s)))})}let W=null,q={},re=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","SVG","TABLE","UL","math","svg","BODY","HEAD","HTML"]})(de)})(_)),_.exports}he();const M=new Map,k=new Map,Z=(v,h=null)=>{if(v.startsWith("blob:"))return v;if(h&&M.has(h)){const w=M.get(h);if(w.dataUrl===v&&pe(w.blobUrl))return console.log(`🔄 [CACHE-HIT] Usando Blob URL cacheado para ${h}`),w.blobUrl;M.delete(h),w.blobUrl&&URL.revokeObjectURL(w.blobUrl)}try{const[w,r]=v.split(","),R=w.match(/data:([^;]+)/),A=R?R[1]:"image/png",x=atob(r),U=new Uint8Array(x.length);for(let f=0;f<x.length;f++)U[f]=x.charCodeAt(f);const G=new Blob([U],{type:A}),O=URL.createObjectURL(G);return h&&(M.set(h,{dataUrl:v,blobUrl:O,timestamp:Date.now(),size:U.length}),k.set(h,O),console.log(`✅ [CONVERSION] Data URL convertido a Blob URL para ${h}`),console.log(`📊 [CONVERSION] Tamaño: ${(U.length/1024).toFixed(2)} KB`)),O}catch(w){return console.error("❌ [CONVERSION] Error convirtiendo data URL a Blob URL:",w),v}},pe=v=>{try{const h=new Image;return h.src=v,!0}catch{return!1}},ge=v=>{const h={};let w=0,r=0;return console.log("🔄 [BATCH-CONVERSION] Iniciando conversión masiva de thumbnails..."),Object.entries(v).forEach(([R,A])=>{if(A&&A.startsWith("data:image/")){const x=A.length,U=Z(A,R);U!==A?(h[R]=U,w+=x,r++):h[R]=A}else h[R]=A}),console.log("✅ [BATCH-CONVERSION] Conversión completada:"),console.log(`📊 [BATCH-CONVERSION] ${r} thumbnails convertidos`),console.log(`💾 [BATCH-CONVERSION] ~${(w/1024/1024).toFixed(2)} MB liberados de memoria`),h},ye=v=>{if(M.has(v)){const h=M.get(v);h.blobUrl&&(URL.revokeObjectURL(h.blobUrl),console.log(`🗑️ [CLEANUP] Blob URL liberado para ${v}`)),M.delete(v)}if(k.has(v)){const h=k.get(v);URL.revokeObjectURL(h),k.delete(v)}},ve=()=>{console.log("🧹 [CLEANUP] Limpiando todos los Blob URLs...");let v=0;M.forEach((h,w)=>{h.blobUrl&&(URL.revokeObjectURL(h.blobUrl),v++)}),M.clear(),k.forEach(h=>{URL.revokeObjectURL(h)}),k.clear(),console.log(`✅ [CLEANUP] ${v} Blob URLs liberados`)},be=()=>{const v=M.size,h=Array.from(M.values()).reduce((w,r)=>w+(r.size||0),0);return{totalCached:v,totalSize:h,totalSizeMB:(h/1024/1024).toFixed(2),cacheEntries:Array.from(M.entries()).map(([w,r])=>({pageId:w,size:r.size,timestamp:r.timestamp,age:Date.now()-r.timestamp}))}};typeof window<"u"&&(window.blobUrlConverter={convert:Z,convertMultiple:ge,cleanup:ye,cleanupAll:ve,getStats:be});export{ve as a,ge as c,Z as d,be as g,ye as r};
