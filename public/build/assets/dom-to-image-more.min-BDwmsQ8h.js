import{c as wt}from"./createLucideIcon-Cy5Ya80P.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=wt("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]),j=new Map,X=new Map,nt=typeof window<"u"&&!0,yt=nt?()=>{}:console.log;nt&&typeof setInterval<"u"&&setInterval(()=>{if(j.size>20){const o=Array.from(j.entries());o.slice(0,o.length-10).forEach(([t])=>{j.delete(t)})}if(X.size>30){const o=Array.from(X.entries());o.slice(0,o.length-15).forEach(([t])=>{X.delete(t)})}},3e5);function bt(o){if(nt||typeof document>"u"||document.getElementById("filter-emergency-button-"+o))return;yt(`üö® [EMERGENCIA] Creando bot√≥n espec√≠fico para p√°gina ${o}`);const t=document.createElement("button");t.id="filter-emergency-button-"+o,t.innerText="üé® Regenerar filtros",t.style.cssText=`
        position: fixed;
        bottom: 70px;
        right: 20px;
        background: linear-gradient(135deg, #8844ee 0%, #6366f1 100%);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        font-weight: bold;
        font-size: 12px;
        z-index: 9999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        cursor: pointer;
        transition: all 0.2s ease;
    `,t.onmouseover=()=>{t.style.transform="translateY(-2px)",t.style.boxShadow="0 6px 16px rgba(0,0,0,0.25)"},t.onmouseout=()=>{t.style.transform="translateY(0)",t.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)"},t.onclick=()=>{t.style.transform="scale(0.95)",setTimeout(()=>t.style.transform="scale(1)",150),t.innerText="‚öôÔ∏è Regenerando...",window.FORCE_FILTER_APPLICATION=!0,window.PRESERVE_FILTERS_FOR_PAGE=o,X.has(`${o}-300x300`)&&X.delete(`${o}-300x300`),setTimeout(()=>{try{console.log(`üîÑ [EMERGENCIA-FILTROS] Regenerando miniatura para p√°gina ${o}`),typeof window.regenerateCurrentThumbnailNow=="function"?window.regenerateCurrentThumbnailNow():typeof window.forceRegenerateThumbnail=="function"&&window.forceRegenerateThumbnail();const A=Date.now();window._lastFilterRegeneration=A,setTimeout(()=>{t.innerText="‚úÖ ¬°Filtros aplicados!",setTimeout(()=>{t.innerText="üé® Regenerar filtros",setTimeout(()=>{window.FORCE_FILTER_APPLICATION=!1,window.PRESERVE_FILTERS_FOR_PAGE=null},1e3)},2e3)},500)}catch(A){console.error("‚ùå [EMERGENCIA-FILTROS] Error regenerando miniatura:",A),t.innerText="‚ùå Error",setTimeout(()=>{t.innerText="üé® Regenerar filtros"},2e3)}},100)},document.body.appendChild(t)}function Rt(o,t,A,s,O,S){if(!t||!t.type)return;console.log("üé≠ [Mask] Aplicando m√°scara:",t.type),o.save(),o.beginPath();const x=A+O/2,a=s+S/2;switch(t.type){case"circle":const v=Math.min(O,S)/2;o.arc(x,a,v,0,2*Math.PI);break;case"ellipse":o.ellipse(x,a,O/2,S/2,0,0,2*Math.PI);break;case"star":const I=5,f=Math.min(O,S)/2,l=f*.4;for(let c=0;c<I*2;c++){const b=c*Math.PI/I,y=c%2===0?f:l,g=x+Math.cos(b)*y,$=a+Math.sin(b)*y;c===0?o.moveTo(g,$):o.lineTo(g,$)}o.closePath();break;case"hexagon":const w=Math.min(O,S)/2;for(let c=0;c<6;c++){const b=c*Math.PI/3,y=x+Math.cos(b)*w,g=a+Math.sin(b)*w;c===0?o.moveTo(y,g):o.lineTo(y,g)}o.closePath();break;case"triangle":o.moveTo(x,s),o.lineTo(A,s+S),o.lineTo(A+O,s+S),o.closePath();break;default:o.rect(A,s,O,S)}o.clip()}async function st(o){return j.has(o)?j.get(o):new Promise((t,A)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{j.set(o,s),t(s)},s.onerror=()=>{console.warn(`‚ö†Ô∏è No se pudo cargar imagen: ${o}`),t(null)},setTimeout(()=>{j.has(o)||(console.warn(`‚è∞ Timeout cargando imagen: ${o}`),t(null))},3e3),s.src=o})}function lt(o,t,A){var b,y,g,$;const{x:s,y:O,width:S,height:x}=A,a=((b=t.position)==null?void 0:b.x)||0,v=((y=t.position)==null?void 0:y.y)||0,I=s+(a<=1?a*S:a),f=O+(v<=1?v*x:v),l=(g=t.size)!=null&&g.width?t.size.width<=1?t.size.width*S:t.size.width:S,w=($=t.size)!=null&&$.height?t.size.height<=1?t.size.height*x:t.size.height:x,c=window.PRESERVE_FILTERS_FOR_PAGE===!0||window.PRESERVE_FILTERS_FOR_PAGE===t.pageId;if(console.log(`üé® [FastThumbnail] Renderizando elemento ${t.id}:`,{type:t.type,hasFilters:!!t.filters,hasMask:!!t.mask,filters:t.filters,mask:t.mask,preserveFilters:c}),t.type==="image"&&t.content){const n=j.get(t.content);if(n){if(o.save(),o.translate(I,f),t.filters){console.log("üé® [FastThumbnail] APLICANDO FILTROS COMPLETOS:",t.filters);const M=t.filters.brightness!==void 0&&t.filters.brightness!==100||t.filters.contrast!==void 0&&t.filters.contrast!==100||t.filters.saturation!==void 0&&t.filters.saturation!==100||t.filters.tint!==void 0&&t.filters.tint!==0||t.filters.hue!==void 0&&t.filters.hue!==0||t.filters.blur!==void 0&&t.filters.blur>0||t.filters.gaussianBlur!==void 0&&t.filters.gaussianBlur>0||t.filters.opacity!==void 0&&t.filters.opacity!==100||t.filters.scale!==void 0&&t.filters.scale!==1||t.filters.rotate!==void 0&&t.filters.rotate!==0||t.filters.flipHorizontal||t.filters.flipVertical;M&&(console.log("‚úÖ [FastThumbnail] Filtros reales detectados, aplicando..."),t._hasRealFilters=!0,t.pageId&&!window._pagesWithFilters&&(window._pagesWithFilters=new Set,window._pagesWithFilters.add(t.pageId)));const T=`
                    brightness(${(t.filters.brightness??100)/100})
                    contrast(${(t.filters.contrast??100)/100})
                    saturate(${(t.filters.saturation??100)/100})
                    sepia(${(t.filters.tint??0)/100})
                    hue-rotate(${t.filters.hue??0}deg)
                    blur(${Math.max(t.filters.blur??0,t.filters.gaussianBlur??0)}px)
                    opacity(${(t.filters.opacity??100)/100})
                `.replace(/\s+/g," ").trim();console.log("üé® [FastThumbnail] Filter string:",T);const p=M||window.FORCE_FILTER_APPLICATION;if(p&&t.type==="image"&&n){console.log("üöÄ [FastThumbnail] Usando m√©todo avanzado de dos pasos para filtros");try{const e=n.width/n.height,r=l/w;let u=0,d=0,E=n.width,_=n.height;e>r?(E=n.height*r,u=(n.width-E)/2):(_=n.width/r,d=(n.height-_)/2);const V=document.createElement("canvas");V.width=l,V.height=w;const H=V.getContext("2d",{alpha:!0});if(H.filter=T,H.drawImage(n,u,d,E,_,0,0,l,w),t.filters.scale!==1||t.filters.rotate!==0||t.filters.flipHorizontal||t.filters.flipVertical){console.log("‚öôÔ∏è [FastThumbnail] Aplicando transformaciones avanzadas");const N=document.createElement("canvas");N.width=l,N.height=w;const L=N.getContext("2d",{alpha:!0});L.save(),L.translate(l/2,w/2);const z=(t.filters.flipHorizontal?-1:1)*(t.filters.scale||1),R=(t.filters.flipVertical?-1:1)*(t.filters.scale||1);L.scale(z,R),t.filters.rotate&&L.rotate(t.filters.rotate*Math.PI/180),L.drawImage(V,-l/2,-w/2),L.restore(),o.drawImage(N,0,0)}else o.drawImage(V,0,0);console.log("‚úÖ [FastThumbnail] Filtros aplicados exitosamente con m√©todo avanzado");return}catch(e){console.error("‚ö†Ô∏è Error en m√©todo avanzado de filtros:",e)}}else try{if(o.filter=T,window.FORCE_FILTER_APPLICATION){console.log("üî• [FastThumbnail] Forzando aplicaci√≥n con m√©todo alternativo");const e=o.globalAlpha;o.globalAlpha=.9999,setTimeout(()=>{o&&(o.globalAlpha=e)},0)}}catch(e){console.error("‚ö†Ô∏è Error al aplicar filtros est√°ndar:",e)}if(!p&&t.type==="image"&&n){const e=t.filters.scale??1,r=t.filters.rotate??0,u=t.filters.flipHorizontal??!1,d=t.filters.flipVertical??!1;(e!==1||r!==0||u||d)&&(console.log("‚öôÔ∏è [FastThumbnail] Aplicando transformaciones est√°ndar"),o.translate(l/2,w/2),o.scale(e*(u?-1:1),e*(d?-1:1)),o.rotate(r*Math.PI/180),o.translate(-l/2,-w/2))}}t.mask&&(console.log("üé≠ [FastThumbnail] APLICANDO M√ÅSCARA:",t.mask),Rt(o,t.mask,I,f,l,w));const C=n.width/n.height,P=l/w;let F=0,D=0,h=n.width,i=n.height;if(C>P?(h=n.height*P,F=(n.width-h)/2):(i=n.width/P,D=(n.height-i)/2),(t._hasRealFilters||t.filters&&window.ENABLE_ADVANCED_FILTER_RENDERING||window.FORCE_FILTER_APPLICATION)&&typeof rt=="function"){console.log("üåü [M√âTODO ULTRA] Usando t√©cnica especializada para garantizar filtros");try{const M=document.createElement("canvas");M.width=l,M.height=w,M.getContext("2d",{alpha:!0}).drawImage(n,F,D,h,i,0,0,l,w);const p=rt(M,t.filters,l,w);o.drawImage(p,0,0,l,w),console.log("‚úÖ [FastThumbnail] Imagen procesada con m√©todo ultra garantizado"),window._successfulFilterRenderings||(window._successfulFilterRenderings={}),t.id&&(window._successfulFilterRenderings[t.id]={timestamp:Date.now(),method:"ultra",hasRealFilters:!!t._hasRealFilters})}catch(M){console.error("‚ö†Ô∏è Error en m√©todo ultra avanzado, usando fallback:",M);const T=document.createElement("canvas");T.width=l,T.height=w;const p=T.getContext("2d",{alpha:!0});if(o.filter)try{p.filter=o.filter}catch(e){console.warn("‚ö†Ô∏è Error copiando filtros al canvas temporal:",e)}p.drawImage(n,F,D,h,i,0,0,l,w),o.drawImage(T,0,0),console.log("üîÑ [FastThumbnail] Imagen procesada con m√©todo de fallback")}}else o.drawImage(n,F,D,h,i,0,0,l,w),console.log("üñºÔ∏è [FastThumbnail] Imagen dibujada con m√©todo est√°ndar");o.restore()}}else if(t.type==="text"&&t.content){o.save();const n=t.style||{},C=Math.max(8,parseInt(n.fontSize)||16),P=n.color||"#000000";o.font=`${C}px Arial, sans-serif`,o.fillStyle=P,o.textBaseline="top";let F=t.content.split(`
`)[0]||"";F.length>50&&(F=F.substring(0,50)+"..."),o.fillText(F,I+4,f+4),o.restore()}}function rt(o,t,A,s){if(console.log("üî• [FilterHelper] Aplicando filtros avanzados a imagen:",{sourceImgWidth:o.width,sourceImgHeight:o.height,targetWidth:A,targetHeight:s,filters:t}),!(t&&(t.brightness!==void 0&&t.brightness!==100||t.contrast!==void 0&&t.contrast!==100||t.saturation!==void 0&&t.saturation!==100||t.tint!==void 0&&t.tint!==0||t.hue!==void 0&&t.hue!==0||t.blur!==void 0&&t.blur>0||t.gaussianBlur!==void 0&&t.gaussianBlur>0||t.opacity!==void 0&&t.opacity!==100||t.scale!==void 0&&t.scale!==1||t.rotate!==void 0&&t.rotate!==0||t.flipHorizontal||t.flipVertical))&&!window.FORCE_FILTER_APPLICATION){console.log("‚è© [FilterHelper] No hay filtros reales que aplicar, retornando imagen simple");const v=document.createElement("canvas");return v.width=A,v.height=s,v.getContext("2d").drawImage(o,0,0,A,s),v}const S=document.createElement("canvas");S.width=A,S.height=s;const x=S.getContext("2d",{alpha:!0}),a=`
        brightness(${((t==null?void 0:t.brightness)??100)/100})
        contrast(${((t==null?void 0:t.contrast)??100)/100})
        saturate(${((t==null?void 0:t.saturation)??100)/100})
        sepia(${((t==null?void 0:t.tint)??0)/100})
        hue-rotate(${(t==null?void 0:t.hue)??0}deg)
        blur(${Math.max((t==null?void 0:t.blur)??0,(t==null?void 0:t.gaussianBlur)??0)}px)
        opacity(${((t==null?void 0:t.opacity)??100)/100})
    `.replace(/\s+/g," ").trim();console.log("üé® [FilterHelper] Aplicando filtro CSS:",a);try{x.filter=a}catch(v){console.error("‚ö†Ô∏è Error aplicando filtros CSS:",v)}if(x.drawImage(o,0,0,A,s),t&&(t.scale!==void 0&&t.scale!==1||t.rotate!==void 0&&t.rotate!==0||t.flipHorizontal||t.flipVertical)){console.log("üîÑ [FilterHelper] Aplicando transformaciones:",{scale:t.scale,rotate:t.rotate,flipH:t.flipHorizontal,flipV:t.flipVertical});const v=document.createElement("canvas");v.width=A,v.height=s;const I=v.getContext("2d",{alpha:!0});I.save(),I.translate(A/2,s/2);const f=(t.flipHorizontal?-1:1)*(t.scale??1),l=(t.flipVertical?-1:1)*(t.scale??1);return I.scale(f,l),t.rotate&&I.rotate(t.rotate*Math.PI/180),I.drawImage(S,-A/2,-s/2,A,s),I.restore(),console.log("‚úÖ [FilterHelper] Filtros y transformaciones aplicados exitosamente"),v}return console.log("‚úÖ [FilterHelper] Filtros aplicados exitosamente (sin transformaciones)"),S}async function At({page:o,workspaceDimensions:t,onProgress:A=null,preserveFilters:s=!1}){var I;console.log(`‚ö° Generando thumbnail para p√°gina: ${o.id}${s?" (CON PRESERVACI√ìN DE FILTROS)":""}`),window.ENABLE_ADVANCED_FILTER_RENDERING=!0;let S=!1,x=0;o.cells&&o.cells.forEach(f=>{f.elements&&f.elements.forEach(l=>{l.filters&&(l.filters.brightness!==void 0&&l.filters.brightness!==100||l.filters.contrast!==void 0&&l.filters.contrast!==100||l.filters.saturation!==void 0&&l.filters.saturation!==100||l.filters.tint!==void 0&&l.filters.tint!==0||l.filters.hue!==void 0&&l.filters.hue!==0||l.filters.blur!==void 0&&l.filters.blur>0||l.filters.gaussianBlur!==void 0&&l.filters.gaussianBlur>0||l.filters.opacity!==void 0&&l.filters.opacity!==100||l.filters.scale!==void 0&&l.filters.scale!==1||l.filters.rotate!==void 0&&l.filters.rotate!==0||l.filters.flipHorizontal||l.filters.flipVertical)&&(S=!0,x++,l._hasRealFilters=!0,l.pageId=o.id,console.log(`üîç [FILTROS] Detectado elemento ${l.id} con filtros:`,l.filters))})}),(s||S||window.FORCE_FILTER_APPLICATION)&&(console.log(`üé≠ [FILTROS] Activando preservaci√≥n de filtros para p√°gina ${o.id} (${x} elementos con filtros)`),window.PRESERVE_FILTERS_FOR_PAGE=o.id,window.FORCE_FILTER_APPLICATION=!0,window._pagesWithFiltersProtected||(window._pagesWithFiltersProtected=new Set),window._pagesWithFiltersProtected.add(o.id),S&&typeof document<"u"&&setTimeout(()=>{document.getElementById("filter-emergency-button-"+o.id)||bt(o.id)},500));const v=(f,l,w="")=>{const c=Math.round(f/l*100);console.log(`üìä Progreso p√°gina ${o.id}: ${f}/${l} (${c}%) ${w}`),A&&A({current:f,total:l,percentage:c,message:w,pageId:o.id})};try{const f=300/Math.max(t.width,t.height),l=Math.round(t.width*f),w=Math.round(t.height*f),c=`${o.id}-${l}x${w}`;if(X.has(c))return console.log(`üì¶ Thumbnail encontrado en cache: ${o.id}`),v(4,4,"Cargado desde cache"),X.get(c);v(1,4,"Iniciando generaci√≥n...");const b=new Set;o.backgroundImage&&b.add(o.backgroundImage),o.cells&&o.cells.forEach(C=>{C.elements&&C.elements.forEach(P=>{P.type==="image"&&P.content&&b.add(P.content)})}),v(2,4,"Cargando im√°genes...");const y=Array.from(b).map(async C=>{try{const P=new Promise((D,h)=>setTimeout(()=>h(new Error("Timeout")),3e3)),F=st(C);await Promise.race([F,P])}catch{console.warn(`‚ö†Ô∏è Error/timeout cargando imagen: ${C}`)}});await Promise.all(y),v(3,4,"Renderizando thumbnail...");const g=document.createElement("canvas"),$=g.getContext("2d",{alpha:!1,willReadFrequently:!1});if(g.width=l,g.height=w,$.fillStyle=o.backgroundColor||"#ffffff",$.fillRect(0,0,g.width,g.height),o.backgroundImage){const C=j.get(o.backgroundImage);C&&$.drawImage(C,0,0,g.width,g.height)}if(o.cells&&o.cells.length>0){const C=Math.ceil(Math.sqrt(Math.min(o.cells.length,9))),P=g.width/C,F=g.height/Math.ceil(Math.min(o.cells.length,9)/C);o.cells.slice(0,9).forEach((D,h)=>{const i=h%C,m=Math.floor(h/C),M=i*P,T=m*F;D.elements&&D.elements.filter(e=>e.type==="image"||e.type==="text").slice(0,3).forEach(e=>{lt($,e,{x:M,y:T,width:P,height:F})})})}v(4,4,"Guardando thumbnail...");const n=g.toDataURL("image/jpeg",.7);if(X.set(c,n),window.PRESERVE_FILTERS_FOR_PAGE===o.id){console.log("üîç [VERIFICACI√ìN] Comprobando si el thumbnail tiene los filtros aplicados...");let C=0,P=0;(I=o.cells)==null||I.forEach(F=>{var D;(D=F.elements)==null||D.forEach(h=>{h._hasRealFilters&&(C++,P++)})}),console.log(`üìä [RESULTADO] Elementos con filtros: ${C}`),console.log(`üßπ [FastThumbnail] Limpiando banderas de filtros para p√°gina ${o.id}`),window.PRESERVE_FILTERS_FOR_PAGE=null,window.FORCE_FILTER_APPLICATION=!1,window._filteredThumbnails||(window._filteredThumbnails={}),window._filteredThumbnails[o.id]={timestamp:Date.now(),elementsWithFilters:C},console.log(`üîí [PROTECCI√ìN] Thumbnail con filtros registrado y protegido: ${o.id}`)}return console.log(`‚úÖ Thumbnail generado para p√°gina: ${o.id}`),n}catch(f){return console.error(`‚ùå Error generando thumbnail para p√°gina ${o.id}:`,f),v(4,4,"Error en generaci√≥n"),null}}async function Lt({pages:o,workspaceDimensions:t,onProgress:A=null}){const s={};console.log(`‚ö° Generando ${o.length} thumbnails r√°pidos...`);const S=(w,c,b="")=>{const y=Math.round(w/c*100);console.log(`üìä Progreso: ${w}/${c} (${y}%) ${b}`),A&&A({current:w,total:c,percentage:y,message:b})},x=new Set;o.forEach(w=>{w.backgroundImage&&x.add(w.backgroundImage),w.cells&&w.cells.forEach(c=>{c.elements&&c.elements.forEach(b=>{b.type==="image"&&b.content&&x.add(b.content)})})});const a=Array.from(x),v=5;S(0,a.length,"Cargando im√°genes...");for(let w=0;w<a.length;w+=v){const c=a.slice(w,w+v);await Promise.all(c.map(st)),S(Math.min(w+v,a.length),a.length,"Cargando im√°genes...")}console.log(`üì∏ Im√°genes cargadas: ${j.size}`);const I=300/Math.max(t.width,t.height),f=Math.round(t.width*I),l=Math.round(t.height*I);S(0,o.length,"Generando thumbnails...");for(let w=0;w<o.length;w++){const c=o[w];try{const b=`${c.id}-${f}x${l}`;if(X.has(b)){s[c.id]=X.get(b),S(w+1,o.length,`Thumbnail ${c.id} (cached)`);continue}const y=document.createElement("canvas"),g=y.getContext("2d",{alpha:!1,willReadFrequently:!1});if(y.width=f,y.height=l,g.fillStyle=c.backgroundColor||"#ffffff",g.fillRect(0,0,y.width,y.height),c.backgroundImage){const n=j.get(c.backgroundImage);n&&g.drawImage(n,0,0,y.width,y.height)}if(c.cells&&c.cells.length>0){const n=Math.ceil(Math.sqrt(c.cells.length)),C=y.width/n,P=y.height/Math.ceil(c.cells.length/n);c.cells.forEach((F,D)=>{if(D>=9)return;const h=D%n,i=Math.floor(D/n),m=h*C,M=i*P;F.elements&&F.elements.filter(p=>p.type==="image"||p.type==="text").slice(0,3).forEach(p=>{lt(g,p,{x:m,y:M,width:C,height:P})})})}const $=y.toDataURL("image/jpeg",.7);s[c.id]=$,X.set(b,$),S(w+1,o.length,`Thumbnail ${c.id} generado`)}catch(b){console.error(`‚ùå Error generando thumbnail r√°pido para ${c.id}:`,b),s[c.id]=null,S(w+1,o.length,`Error en ${c.id}`)}}return console.log(`‚ö° ¬°${Object.keys(s).length} thumbnails generados en modo r√°pido!`),s}function xt(){j.clear(),X.clear(),console.log("üßπ Caches de thumbnails limpiados")}const ct=typeof window<"u"&&!0,tt=ct?()=>{}:console.log;tt("üî• [FORCE FILTER RENDERER] Sistema radical cargado"+(ct?" (VPS mode)":""));function Tt(o,t){const A=o.getContext("2d"),s=A.getImageData(0,0,o.width,o.height),O=s.data;tt("üé® [PIXEL MANIPULATION] Aplicando filtros directamente a p√≠xeles:",t),tt("üîç [DEBUGGING] Valores exactos recibidos:",{brightness:t.brightness,contrast:t.contrast,saturation:t.saturation,hue:t.hue,tint:t.tint,opacity:t.opacity});const S=Math.max(0,Math.min(10,(t.brightness??100)/100)),x=Math.max(0,Math.min(10,(t.contrast??100)/100)),a=Math.max(0,Math.min(10,(t.saturation??100)/100)),v=(t.hue??0)%360*Math.PI/180,I=Math.max(0,Math.min(1,(t.tint??0)/100)),f=Math.max(0,Math.min(1,(t.opacity??100)/100));tt("‚öôÔ∏è [NORMALIZED VALUES] Valores normalizados para aplicar:",{brightness:S,contrast:x,saturation:a,hue:v+" rad ("+(t.hue??0)+"¬∞)",tint:I,opacity:f});function l(c,b,y){c/=255,b/=255,y/=255;const g=Math.max(c,b,y),$=Math.min(c,b,y);let n,C,P=(g+$)/2;if(g===$)n=C=0;else{const F=g-$;switch(C=P>.5?F/(2-g-$):F/(g+$),g){case c:n=(b-y)/F+(b<y?6:0);break;case b:n=(y-c)/F+2;break;case y:n=(c-b)/F+4;break}n/=6}return[n,C,P]}function w(c,b,y){let g,$,n;if(b===0)g=$=n=y;else{const C=(D,h,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<.16666666666666666?D+(h-D)*6*i:i<.5?h:i<.6666666666666666?D+(h-D)*(.6666666666666666-i)*6:D),P=y<.5?y*(1+b):y+b-y*b,F=2*y-P;g=C(F,P,c+1/3),$=C(F,P,c),n=C(F,P,c-1/3)}return[Math.round(g*255),Math.round($*255),Math.round(n*255)]}for(let c=0;c<O.length;c+=4){let b=O[c],y=O[c+1],g=O[c+2],$=O[c+3];if(b=Math.min(255,Math.max(0,b*S)),y=Math.min(255,Math.max(0,y*S)),g=Math.min(255,Math.max(0,g*S)),b=Math.min(255,Math.max(0,((b/255-.5)*x+.5)*255)),y=Math.min(255,Math.max(0,((y/255-.5)*x+.5)*255)),g=Math.min(255,Math.max(0,((g/255-.5)*x+.5)*255)),a!==1||v!==0){const[n,C,P]=l(b,y,g);let F=n+v/(2*Math.PI);F>1&&(F-=1),F<0&&(F+=1);const D=Math.min(1,Math.max(0,C*a)),[h,i,m]=w(F,D,P);b=h,y=i,g=m}if(I>0){const n=.299*b+.587*y+.114*g;b=Math.min(255,n+I*100),y=Math.min(255,n+I*50),g=Math.min(255,n)}t.opacity!==void 0&&t.opacity!==100&&($=Math.min(255,Math.max(0,$*(t.opacity/100)))),O[c]=Math.round(b),O[c+1]=Math.round(y),O[c+2]=Math.round(g),O[c+3]=Math.round($)}A.putImageData(s,0,0),console.log("‚úÖ [PIXEL MANIPULATION] Filtros aplicados directamente a p√≠xeles")}function vt(o,t,A){console.log("üöÄ [FORCE RENDERER] Renderizando elemento con filtros forzados:",t.id),console.log("üîç [ELEMENT DEBUG] Datos completos del elemento:",{id:t.id,type:t.type,filters:t.filters,position:t.position,size:t.size});const{x:s,y:O,width:S,height:x}=A;if(t.type!=="image"||!t.content)return console.log("‚è© [FORCE RENDERER] Elemento no es imagen, saltando"),Promise.resolve(!1);const a=t.filters||{};console.log("üéõÔ∏è [FILTER ANALYSIS] Analizando filtros del elemento:",a);const v=a.brightness!==void 0&&a.brightness!==100&&a.brightness!==1||a.contrast!==void 0&&a.contrast!==100&&a.contrast!==1||a.saturation!==void 0&&a.saturation!==100&&a.saturation!==1||a.tint!==void 0&&a.tint!==0||a.hue!==void 0&&a.hue!==0||a.opacity!==void 0&&a.opacity!==100&&a.opacity!==1||a.blur!==void 0&&a.blur>0||a.scale!==void 0&&a.scale!==1||a.rotate!==void 0&&a.rotate!==0||a.flipHorizontal||a.flipVertical;if(console.log("üîç [FILTER CHECK] ¬øTiene filtros reales?",v),console.log("üîç [FILTER DETAILS] Detalles de cada filtro (predefinidos compatible):",{brightness:`${a.brightness} (¬ø‚â†100&‚â†1? ${a.brightness!==100&&a.brightness!==1})`,contrast:`${a.contrast} (¬ø‚â†100&‚â†1? ${a.contrast!==100&&a.contrast!==1})`,saturation:`${a.saturation} (¬ø‚â†100&‚â†1? ${a.saturation!==100&&a.saturation!==1})`,tint:`${a.tint} (¬ø‚â†0? ${a.tint!==0})`,hue:`${a.hue} (¬ø‚â†0? ${a.hue!==0})`,opacity:`${a.opacity} (¬ø‚â†100&‚â†1? ${a.opacity!==100&&a.opacity!==1})`,detectedFormat:a.brightness>2?"percentage (0-100)":"normalized (0-1)"}),!v)return console.log("‚è© [FORCE RENDERER] Sin filtros reales que aplicar"),Promise.resolve(!1);console.log("üéØ [FORCE RENDERER] Filtros detectados, aplicando m√©todo radical con valores:",a);const I=new Image;return I.crossOrigin="anonymous",new Promise(f=>{I.onload=()=>{try{const l=document.createElement("canvas");l.width=S,l.height=x;const w=l.getContext("2d",{alpha:!0}),c=I.width/I.height,b=S/x;let y=0,g=0,$=I.width,n=I.height;if(c>b?($=I.height*b,y=(I.width-$)/2):(n=I.width/b,g=(I.height-n)/2),w.drawImage(I,y,g,$,n,0,0,S,x),Tt(l,a),a.scale!==1||a.rotate!==0||a.flipHorizontal||a.flipVertical){const C=document.createElement("canvas");C.width=S,C.height=x;const P=C.getContext("2d",{alpha:!0});P.save(),P.translate(S/2,x/2);const F=(a.flipHorizontal?-1:1)*(a.scale||1),D=(a.flipVertical?-1:1)*(a.scale||1);P.scale(F,D),a.rotate&&P.rotate(a.rotate*Math.PI/180),P.drawImage(l,-S/2,-x/2),P.restore(),o.drawImage(C,s,O)}else o.drawImage(l,s,O);console.log("‚úÖ [FORCE RENDERER] Filtros aplicados exitosamente con manipulaci√≥n de p√≠xeles"),f(!0)}catch(l){console.error("‚ùå [FORCE RENDERER] Error aplicando filtros:",l),f(!1)}},I.onerror=()=>{console.error("‚ùå [FORCE RENDERER] Error cargando imagen:",t.content),f(!1)},setTimeout(()=>{console.warn("‚è∞ [FORCE RENDERER] Timeout cargando imagen"),f(!1)},5e3),I.src=t.content})}async function It(o,t){var f,l,w,c,b,y,g,$;console.log("üî• [GUARANTEED FILTERS] Generando thumbnail con filtros garantizados"),console.log("üì• [DATOS RECIBIDOS] Page data completa:",{pageId:o.id,totalElements:((f=o.elements)==null?void 0:f.length)||0,backgroundColor:o.backgroundColor});const A=((l=o.elements)==null?void 0:l.filter(n=>n.filters?n.filters.brightness!==void 0&&n.filters.brightness!==1||n.filters.contrast!==void 0&&n.filters.contrast!==1||n.filters.saturation!==void 0&&n.filters.saturation!==1||n.filters.tint!==void 0&&n.filters.tint!==0||n.filters.hue!==void 0&&n.filters.hue!==0||n.filters.opacity!==void 0&&n.filters.opacity!==1||n.filters.blur!==void 0&&n.filters.blur!==0||n.filters.scale!==void 0&&n.filters.scale!==1||n.filters.rotate!==void 0&&n.filters.rotate!==0||n.filters.flipHorizontal||n.filters.flipVertical:!1))||[];console.log("üé® [FILTROS ENCONTRADOS] Elementos con filtros reales:",A.map(n=>({id:n.id,type:n.type,exactFilters:{brightness:`${n.filters.brightness} (tipo: ${typeof n.filters.brightness})`,contrast:`${n.filters.contrast} (tipo: ${typeof n.filters.contrast})`,saturation:`${n.filters.saturation} (tipo: ${typeof n.filters.saturation})`,tint:`${n.filters.tint} (tipo: ${typeof n.filters.tint})`,hue:`${n.filters.hue} (tipo: ${typeof n.filters.hue})`,opacity:`${n.filters.opacity} (tipo: ${typeof n.filters.opacity})`,blur:`${n.filters.blur} (tipo: ${typeof n.filters.blur})`,scale:`${n.filters.scale} (tipo: ${typeof n.filters.scale})`,rotate:`${n.filters.rotate} (tipo: ${typeof n.filters.rotate})`,flipHorizontal:n.filters.flipHorizontal,flipVertical:n.filters.flipVertical}})));const O=300/Math.max(t.width,t.height),S=Math.round(t.width*O),x=Math.round(t.height*O),a=document.createElement("canvas");a.width=S,a.height=x;const v=a.getContext("2d",{alpha:!0});if(v.fillStyle=o.backgroundColor||"#ffffff",v.fillRect(0,0,a.width,a.height),o.backgroundImage)try{const n=new Image;n.crossOrigin="anonymous",await new Promise(C=>{n.onload=()=>{v.drawImage(n,0,0,a.width,a.height),C()},n.onerror=C,n.src=o.backgroundImage})}catch(n){console.warn("‚ö†Ô∏è Error cargando imagen de fondo:",n)}if(o.cells&&o.cells.length>0){const n=Math.ceil(Math.sqrt(o.cells.length)),C=a.width/n,P=a.height/Math.ceil(o.cells.length/n);for(let F=0;F<Math.min(o.cells.length,9);F++){const D=o.cells[F],h=F%n,i=Math.floor(F/n),m=h*C,M=i*P;if(D.elements){const T=D.elements.filter(e=>e.type==="image"&&e.content),p=D.elements.filter(e=>e.type==="text"&&e.content);for(const e of T.slice(0,2)){const r={x:m+(((w=e.position)==null?void 0:w.x)||0)*C,y:M+(((c=e.position)==null?void 0:c.y)||0)*P,width:(((b=e.size)==null?void 0:b.width)||1)*C,height:(((y=e.size)==null?void 0:y.height)||1)*P};if(!await vt(v,e,r)){console.log("üîÑ [FALLBACK] Usando m√©todo est√°ndar para imagen sin filtros especiales");try{const d=new Image;d.crossOrigin="anonymous",await new Promise(E=>{d.onload=()=>{const _=d.width/d.height,V=r.width/r.height;let H=0,N=0,L=d.width,z=d.height;_>V?(L=d.height*V,H=(d.width-L)/2):(z=d.width/V,N=(d.height-z)/2),v.drawImage(d,H,N,L,z,r.x,r.y,r.width,r.height),E()},d.onerror=E,d.src=e.content})}catch(d){console.warn("‚ö†Ô∏è Error renderizando imagen fallback:",d)}}}for(const e of p.slice(0,1))try{const r=e.style||{},u=Math.max(8,parseInt(r.fontSize)||14),d=r.color||"#000000";v.save(),v.font=`${u}px Arial, sans-serif`,v.fillStyle=d,v.textBaseline="top";let E=e.content.split(`
`)[0]||"";E.length>30&&(E=E.substring(0,30)+"...");const _=m+(((g=e.position)==null?void 0:g.x)||0)*C+4,V=M+((($=e.position)==null?void 0:$.y)||0)*P+4;v.fillText(E,_,V),v.restore()}catch(r){console.warn("‚ö†Ô∏è Error renderizando texto:",r)}}}}const I=a.toDataURL("image/jpeg",.85);return console.log("‚úÖ [GUARANTEED FILTERS] Thumbnail generado con filtros garantizados"),I}window.forceRegenerateWithGuaranteedFilters=async function(){console.log("üöÄ [GLOBAL FORCE] Regenerando con filtros garantizados");try{const o=window._currentPageData,t=window._workspaceDimensions;if(!o||!t)return console.error("‚ùå [GLOBAL FORCE] Datos de p√°gina no disponibles"),!1;const A=await It(o,t);return window._updateThumbnailInUI&&window._updateThumbnailInUI(o.id,A),console.log("‚úÖ [GLOBAL FORCE] Thumbnail regenerado con √©xito"),!0}catch(o){return console.error("‚ùå [GLOBAL FORCE] Error:",o),!1}};console.log("üî• [FORCE FILTER RENDERER] Sistema listo - Usa window.forceRegenerateWithGuaranteedFilters()");var et={exports:{}};/*! dom-to-image-more 08-05-2025 */var Ct=et.exports,at;function Ft(){return at||(at=1,function(o,t){(A=>{let s=(()=>{let h=0;return{escape:function(e){return e.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1")},isDataUrl:function(e){return e.search(/^(data:)/)!==-1},canvasToBlob:function(e){return e.toBlob?new Promise(function(r){e.toBlob(r)}):(r=>new Promise(function(u){var d=c(r.toDataURL().split(",")[1]),E=d.length,_=new Uint8Array(E);for(let V=0;V<E;V++)_[V]=d.charCodeAt(V);u(new Blob([_],{type:"image/png"}))}))(e)},resolveUrl:function(e,r){var u=document.implementation.createHTMLDocument(),d=u.createElement("base"),E=(u.head.appendChild(d),u.createElement("a"));return u.body.appendChild(E),d.href=r,E.href=e,E.href},getAndEncode:function(e){let r=f.impl.urlCache.find(function(u){return u.url===e});return r||(r={url:e,promise:null},f.impl.urlCache.push(r)),r.promise===null&&(f.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime()),r.promise=new Promise(function(u){let d=f.impl.options.httpTimeout,E=new XMLHttpRequest;if(E.onreadystatechange=function(){if(E.readyState===4)if(300<=E.status)V?u(V):H(`cannot fetch resource: ${e}, status: `+E.status);else{let N=new FileReader;N.onloadend=function(){u(N.result)},N.readAsDataURL(E.response)}},E.ontimeout=function(){V?u(V):H(`timeout of ${d}ms occured while fetching resource: `+e)},E.responseType="blob",E.timeout=d,0<f.impl.options.useCredentialsFilters.length&&(f.impl.options.useCredentials=0<f.impl.options.useCredentialsFilters.filter(N=>0<=e.search(N)).length),f.impl.options.useCredentials&&(E.withCredentials=!0),f.impl.options.corsImg&&e.indexOf("http")===0&&e.indexOf(window.location.origin)===-1){var _=(f.impl.options.corsImg.method||"GET").toUpperCase()==="POST"?"POST":"GET";E.open(_,(f.impl.options.corsImg.url||"").replace("#{cors}",e),!0);let N=!1,L=f.impl.options.corsImg.headers||{},z=(Object.keys(L).forEach(function(R){L[R].indexOf("application/json")!==-1&&(N=!0),E.setRequestHeader(R,L[R])}),(R=>{try{return JSON.parse(JSON.stringify(R))}catch(G){H("corsImg.data is missing or invalid:"+G.toString())}})(f.impl.options.corsImg.data||""));Object.keys(z).forEach(function(R){typeof z[R]=="string"&&(z[R]=z[R].replace("#{cors}",e))}),E.send(N?JSON.stringify(z):z)}else E.open("GET",e,!0),E.send();let V;function H(N){console.error(N),u("")}f.impl.options.imagePlaceholder&&(_=f.impl.options.imagePlaceholder.split(/,/))&&_[1]&&(V=_[1])})),r.promise},uid:function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+h++},delay:function(e){return function(r){return new Promise(function(u){setTimeout(function(){u(r)},e)})}},asArray:function(e){var r=[],u=e.length;for(let d=0;d<u;d++)r.push(e[d]);return r},escapeXhtml:function(e){return e.replace(/%/g,"%25").replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return e!=="data:,"?new Promise(function(r,u){let d=document.createElementNS("http://www.w3.org/2000/svg","svg"),E=new Image;f.impl.options.useCredentials&&(E.crossOrigin="use-credentials"),E.onload=function(){document.body.removeChild(d),window&&window.requestAnimationFrame?window.requestAnimationFrame(function(){r(E)}):r(E)},E.onerror=_=>{document.body.removeChild(d),u(_)},d.appendChild(E),E.src=e,document.body.appendChild(d)}):Promise.resolve()},width:function(e){var r=p(e,"width");if(!isNaN(r))return r;var r=p(e,"border-left-width"),u=p(e,"border-right-width");return e.scrollWidth+r+u},height:function(e){var r=p(e,"height");if(!isNaN(r))return r;var r=p(e,"border-top-width"),u=p(e,"border-bottom-width");return e.scrollHeight+r+u},getWindow:i,isElement:T,isElementHostForOpenShadowRoot:function(e){return T(e)&&e.shadowRoot!==null},isShadowRoot:m,isInShadowRoot:M,isHTMLElement:function(e){return e instanceof i(e).HTMLElement},isHTMLCanvasElement:function(e){return e instanceof i(e).HTMLCanvasElement},isHTMLInputElement:function(e){return e instanceof i(e).HTMLInputElement},isHTMLImageElement:function(e){return e instanceof i(e).HTMLImageElement},isHTMLLinkElement:function(e){return e instanceof i(e).HTMLLinkElement},isHTMLScriptElement:function(e){return e instanceof i(e).HTMLScriptElement},isHTMLStyleElement:function(e){return e instanceof i(e).HTMLStyleElement},isHTMLTextAreaElement:function(e){return e instanceof i(e).HTMLTextAreaElement},isShadowSlotElement:function(e){return M(e)&&e instanceof i(e).HTMLSlotElement},isSVGElement:function(e){return e instanceof i(e).SVGElement},isSVGRectElement:function(e){return e instanceof i(e).SVGRectElement},isDimensionMissing:function(e){return isNaN(e)||e<=0}};function i(e){return e=e?e.ownerDocument:void 0,(e?e.defaultView:void 0)||window||A}function m(e){return e instanceof i(e).ShadowRoot}function M(e){return e!=null&&e.getRootNode!==void 0&&m(e.getRootNode())}function T(e){return e instanceof i(e).Element}function p(e,r){if(e.nodeType===l){let u=w(e).getPropertyValue(r);if(u.slice(-2)==="px")return u=u.slice(0,-2),parseFloat(u)}return NaN}})(),O=(()=>{let h=/url\((["']?)((?:\\?.)*?)\1\)/gm;return{inlineAll:function(p,e,r){return i(p)?Promise.resolve(p).then(m).then(function(u){let d=Promise.resolve(p);return u.forEach(function(E){d=d.then(function(_){return T(_,E,e,r)})}),d}):Promise.resolve(p)},shouldProcess:i,impl:{readUrls:m,inline:T,urlAsRegex:M}};function i(p){return p.search(h)!==-1}function m(p){for(var e,r=[];(e=h.exec(p))!==null;)r.push(e[2]);return r.filter(function(u){return!s.isDataUrl(u)})}function M(p){return new RegExp(`url\\((["']?)(${s.escape(p)})\\1\\)`,"gm")}function T(p,e,r,u){return Promise.resolve(e).then(function(d){return r?s.resolveUrl(d,r):d}).then(u||s.getAndEncode).then(function(d){var E=M(e);return p.replace(E,`url($1${d}$1)`)})}})(),S={resolveAll:function(){return x().then(function(h){return Promise.all(h.map(function(i){return i.resolve()}))}).then(function(h){return h.join(`
`)})},impl:{readAll:x}};function x(){return Promise.resolve(s.asArray(document.styleSheets)).then(function(i){let m=[];return i.forEach(function(M){var T=Object.getPrototypeOf(M);if(Object.prototype.hasOwnProperty.call(T,"cssRules"))try{s.asArray(M.cssRules||[]).forEach(m.push.bind(m))}catch(p){console.error("domtoimage: Error while reading CSS rules from "+M.href,p.toString())}}),m}).then(function(i){return i.filter(function(m){return m.type===CSSRule.FONT_FACE_RULE}).filter(function(m){return O.shouldProcess(m.style.getPropertyValue("src"))})}).then(function(i){return i.map(h)});function h(i){return{resolve:function(){var m=(i.parentStyleSheet||{}).href;return O.inlineAll(i.cssText,m)},src:function(){return i.style.getPropertyValue("src")}}}}let a={inlineAll:function h(i){if(!s.isElement(i))return Promise.resolve(i);return m(i).then(function(){return s.isHTMLImageElement(i)?v(i).inline():Promise.all(s.asArray(i.childNodes).map(function(M){return h(M)}))});function m(M){let T=["background","background-image"],p=T.map(function(e){let r=M.style.getPropertyValue(e),u=M.style.getPropertyPriority(e);return r?O.inlineAll(r).then(function(d){M.style.setProperty(e,d,u)}):Promise.resolve()});return Promise.all(p).then(function(){return M})}},impl:{newImage:v}};function v(h){return{inline:function(i){return s.isDataUrl(h.src)?Promise.resolve():Promise.resolve(h.src).then(i||s.getAndEncode).then(function(m){return new Promise(function(M){h.onload=M,h.onerror=M,h.src=m})})}}}let I={copyDefaultStyles:!0,imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1,useCredentialsFilters:[],httpTimeout:3e4,styleCaching:"strict",corsImg:void 0},f={toSvg:b,toPng:function(h,i){return y(h,i).then(function(m){return m.toDataURL()})},toJpeg:function(h,i){return y(h,i).then(function(m){return m.toDataURL("image/jpeg",(i?i.quality:void 0)||1)})},toBlob:function(h,i){return y(h,i).then(s.canvasToBlob)},toPixelData:function(h,i){return y(h,i).then(function(m){return m.getContext("2d").getImageData(0,0,s.width(h),s.height(h)).data})},toCanvas:y,impl:{fontFaces:S,images:a,util:s,inliner:O,urlCache:[],options:{}}},l=(o.exports=f,(typeof Node<"u"?Node.ELEMENT_NODE:void 0)||1),w=(A!==void 0?A.getComputedStyle:void 0)||(typeof window<"u"?window.getComputedStyle:void 0)||globalThis.getComputedStyle,c=(A!==void 0?A.atob:void 0)||(typeof window<"u"?window.atob:void 0)||globalThis.atob;function b(h,i){f.impl.util.getWindow(h);var m=i=i||{};m.copyDefaultStyles===void 0?f.impl.options.copyDefaultStyles=I.copyDefaultStyles:f.impl.options.copyDefaultStyles=m.copyDefaultStyles,f.impl.options.imagePlaceholder=(m.imagePlaceholder===void 0?I:m).imagePlaceholder,f.impl.options.cacheBust=(m.cacheBust===void 0?I:m).cacheBust,f.impl.options.corsImg=(m.corsImg===void 0?I:m).corsImg,f.impl.options.useCredentials=(m.useCredentials===void 0?I:m).useCredentials,f.impl.options.useCredentialsFilters=(m.useCredentialsFilters===void 0?I:m).useCredentialsFilters,f.impl.options.httpTimeout=(m.httpTimeout===void 0?I:m).httpTimeout,f.impl.options.styleCaching=(m.styleCaching===void 0?I:m).styleCaching;let M=[];return Promise.resolve(h).then(function(T){if(T.nodeType===l)return T;var p=T,e=T.parentNode,r=document.createElement("span");return e.replaceChild(r,p),r.append(T),M.push({parent:e,child:p,wrapper:r}),r}).then(function(T){return function p(e,r,u,d){let E=r.filter;if(e===g||s.isHTMLScriptElement(e)||s.isHTMLStyleElement(e)||s.isHTMLLinkElement(e)||u!==null&&E&&!E(e))return Promise.resolve();return Promise.resolve(e).then(_).then(V).then(function(R){return L(R,N(e))}).then(H).then(function(R){return z(R,e)});function _(R){return s.isHTMLCanvasElement(R)?s.makeImage(R.toDataURL()):R.cloneNode(!1)}function V(R){return r.adjustClonedNode&&r.adjustClonedNode(e,R,!1),Promise.resolve(R)}function H(R){return r.adjustClonedNode&&r.adjustClonedNode(e,R,!0),Promise.resolve(R)}function N(R){return s.isElementHostForOpenShadowRoot(R)?R.shadowRoot:R}function L(R,G){let Z=J(G),Y=Promise.resolve();if(Z.length!==0){let U=w(q(G));s.asArray(Z).forEach(function(W){Y=Y.then(function(){return p(W,r,U).then(function(B){B&&R.appendChild(B)})})})}return Y.then(function(){return R});function q(U){return s.isShadowRoot(U)?U.host:U}function J(U){if(s.isShadowSlotElement(U)){let W=U.assignedNodes();if(W&&0<W.length)return W}return U.childNodes}}function z(R,G){return!s.isElement(R)||s.isShadowSlotElement(G)?Promise.resolve(R):Promise.resolve().then(Z).then(Y).then(q).then(J).then(function(){return R});function Z(){function U(B,k){k.font=B.font,k.fontFamily=B.fontFamily,k.fontFeatureSettings=B.fontFeatureSettings,k.fontKerning=B.fontKerning,k.fontSize=B.fontSize,k.fontStretch=B.fontStretch,k.fontStyle=B.fontStyle,k.fontVariant=B.fontVariant,k.fontVariantCaps=B.fontVariantCaps,k.fontVariantEastAsian=B.fontVariantEastAsian,k.fontVariantLigatures=B.fontVariantLigatures,k.fontVariantNumeric=B.fontVariantNumeric,k.fontVariationSettings=B.fontVariationSettings,k.fontWeight=B.fontWeight}function W(B,k){let K=w(B);K.cssText?(k.style.cssText=K.cssText,U(K,k.style)):(C(r,B,K,u,k),u===null&&(["inset-block","inset-block-start","inset-block-end"].forEach(Q=>k.style.removeProperty(Q)),["left","right","top","bottom"].forEach(Q=>{k.style.getPropertyValue(Q)&&k.style.setProperty(Q,"0px")})))}W(G,R)}function Y(){let U=s.uid();function W(B){let k=w(G,B),K=k.getPropertyValue("content");if(K!==""&&K!=="none"){let dt=function(){let ut=`.${U}:`+B,ht=(k.cssText?ft:gt)();return document.createTextNode(ut+`{${ht}}`);function ft(){return`${k.cssText} content: ${K};`}function gt(){return s.asArray(k).map(mt).join("; ")+";";function mt(ot){let pt=k.getPropertyValue(ot),Et=k.getPropertyPriority(ot)?" !important":"";return ot+": "+pt+Et}}},Q=R.getAttribute("class")||"",it=(R.setAttribute("class",Q+" "+U),document.createElement("style"));it.appendChild(dt()),R.appendChild(it)}}[":before",":after"].forEach(function(B){W(B)})}function q(){s.isHTMLTextAreaElement(G)&&(R.innerHTML=G.value),s.isHTMLInputElement(G)&&R.setAttribute("value",G.value)}function J(){s.isSVGElement(R)&&(R.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.isSVGRectElement(R))&&["width","height"].forEach(function(U){let W=R.getAttribute(U);W&&R.style.setProperty(U,W)})}}}(T,i,null)}).then(i.disableEmbedFonts?Promise.resolve(h):$).then(n).then(function(T){i.bgcolor&&(T.style.backgroundColor=i.bgcolor),i.width&&(T.style.width=i.width+"px"),i.height&&(T.style.height=i.height+"px"),i.style&&Object.keys(i.style).forEach(function(e){T.style[e]=i.style[e]});let p=null;return typeof i.onclone=="function"&&(p=i.onclone(T)),Promise.resolve(p).then(function(){return T})}).then(function(T){let p=i.width||s.width(T),e=i.height||s.height(T);return Promise.resolve(T).then(function(r){return r.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(r)}).then(s.escapeXhtml).then(function(r){var u=(s.isDimensionMissing(p)?' width="100%"':` width="${p}"`)+(s.isDimensionMissing(e)?' height="100%"':` height="${e}"`);return`<svg xmlns="http://www.w3.org/2000/svg"${(s.isDimensionMissing(p)?"":` width="${p}"`)+(s.isDimensionMissing(e)?"":` height="${e}"`)}><foreignObject${u}>${r}</foreignObject></svg>`}).then(function(r){return"data:image/svg+xml;charset=utf-8,"+r})}).then(function(T){for(;0<M.length;){var p=M.pop();p.parent.replaceChild(p.child,p.wrapper)}return T}).then(function(T){return f.impl.urlCache=[],g&&(document.body.removeChild(g),g=null),P&&clearTimeout(P),P=setTimeout(()=>{P=null,F={}},2e4),T})}function y(h,i){return b(h,i=i||{}).then(s.makeImage).then(function(m){var M=typeof i.scale!="number"?1:i.scale,T=((e,r)=>{let u=i.width||s.width(e),d=i.height||s.height(e);return s.isDimensionMissing(u)&&(u=s.isDimensionMissing(d)?300:2*d),s.isDimensionMissing(d)&&(d=u/2),(e=document.createElement("canvas")).width=u*r,e.height=d*r,i.bgcolor&&((r=e.getContext("2d")).fillStyle=i.bgcolor,r.fillRect(0,0,e.width,e.height)),e})(h,M),p=T.getContext("2d");return p.msImageSmoothingEnabled=!1,p.imageSmoothingEnabled=!1,m&&(p.scale(M,M),p.drawImage(m,0,0)),T})}let g=null;function $(h){return S.resolveAll().then(function(i){var m;return i!==""&&(m=document.createElement("style"),h.appendChild(m),m.appendChild(document.createTextNode(i))),h})}function n(h){return a.inlineAll(h).then(function(){return h})}function C(h,i,m,M,T){let p=f.impl.options.copyDefaultStyles?((r,u)=>{var d,E=(H=>(r.styleCaching!=="relaxed"?H:H.filter((N,L,z)=>L===0||L===z.length-1)).join(">"))(u=(H=>{var N=[];do if(H.nodeType===l){var L=H.tagName;if(N.push(L),D.includes(L))break}while(H=H.parentNode);return N})(u));{if(F[E])return F[E];u=((H,N)=>{let L=H.body;do{var z=N.pop(),z=H.createElement(z);L.appendChild(z),L=z}while(0<N.length);return L.textContent="‚Äã",L})((d=(()=>{if(g)return g.contentWindow;N=document.characterSet||"UTF-8",H=(H=document.doctype)?(`<!DOCTYPE ${Y(H.name)} ${Y(H.publicId)} `+Y(H.systemId)).trim()+">":"",(g=document.createElement("iframe")).id="domtoimage-sandbox-"+s.uid(),g.style.visibility="hidden",g.style.position="fixed",document.body.appendChild(g);var H,N,L=g,z="domtoimage-sandbox";try{return L.contentWindow.document.write(H+`<html><head><meta charset='${N}'><title>${z}</title></head><body></body></html>`),L.contentWindow}catch{}var R=document.createElement("meta");R.setAttribute("charset",N);try{var G=document.implementation.createHTMLDocument(z),Z=(G.head.appendChild(R),H+G.documentElement.outerHTML);return L.setAttribute("srcdoc",Z),L.contentWindow}catch{}return L.contentDocument.head.appendChild(R),L.contentDocument.title=z,L.contentWindow;function Y(q){var J;return q?((J=document.createElement("div")).innerText=q,J.innerHTML):""}})()).document,u),d=((H,N)=>{let L={},z=H.getComputedStyle(N);return s.asArray(z).forEach(function(R){L[R]=R==="width"||R==="height"?"auto":z.getPropertyValue(R)}),L})(d,u);var _=u;do{var V=_.parentElement;V!==null&&V.removeChild(_),_=V}while(_&&_.tagName!=="BODY");return F[E]=d}})(h,i):{},e=T.style;s.asArray(m).forEach(function(r){var u,d,E,_;h.filterStyles&&!h.filterStyles(i,r)||(d=m.getPropertyValue(r),E=p[r],u=M?M.getPropertyValue(r):void 0,e.getPropertyValue(r))||(d!==E||M&&d!==u)&&(E=m.getPropertyPriority(r),u=e,d=d,E=E,_=0<=["background-clip"].indexOf(r=r),E?(u.setProperty(r,d,E),_&&u.setProperty("-webkit-"+r,d,E)):(u.setProperty(r,d),_&&u.setProperty("-webkit-"+r,d)))})}let P=null,F={},D=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","SVG","TABLE","UL","math","svg","BODY","HEAD","HTML"]})(Ct)}(et)),et.exports}Ft();export{St as B,At as a,Lt as b,xt as c,It as g};
