import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as c}from"./index-BH53Isel.js";import{c as k}from"./ReactAppend-DTVVXReZ.js";import{B as D}from"./Base-C7GgKUqc.js";import{C as Y}from"./CreateReactScript-NWc2tE6o.js";import{T as M}from"./Table-DitbKwtZ.js";import{D as d}from"./DxButton-DV0H-ZcL.js";import{R as h}from"./ReactAppend-D7S498fx.js";import{S as m}from"./ProductCard-CRhBSmWZ.js";import{P as R}from"./ProjectsRest-BkwGpyic.js";import{M as w}from"./Modal-DYPPCNUR.js";import{i as T}from"./tippy-react.esm-BWiGTO87.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./Global-ErywZRdd.js";/* empty css              */import"./Logout-TGKOqZqZ.js";import"./main-6DCdASTx.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-CY0sLPNq.js";import"./index.esm-POOiSFi2.js";import"./index-Dq7h7Pqt.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-rimy3MAc.js";const x=new R,B=({statuses:u=[]})=>{const o=c.useRef(),n=c.useRef(),p=c.useRef(),[s,E]=c.useState(null),[i,S]=c.useState(null),[l,f]=c.useState(""),b=async t=>{const{isConfirmed:a}=await m.fire({title:"Eliminar proyecto",text:"¿Estás seguro de eliminar este proyecto?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!a||!await x.delete(t)||$(o.current).dxDataGrid("instance").refresh()},g=async t=>{const a=await x.get(t);E(a.data),$(n.current).modal("show")},j=t=>{window.open(`/canvas/editor?project=${t}`,"_blank")},N=async t=>{S(t),f(t.name||""),$(p.current).modal("show")},y=async t=>{if(t&&t.preventDefault(),console.log("onSaveProjectName called with project:",i),console.log("onSaveProjectName called with projectName:",l),!i||!l.trim()){m.fire({title:"Error",text:"El nombre del proyecto no puede estar vacío",icon:"error"});return}try{console.log("Saving project with data:",{id:i.id,name:l.trim()});const a=await x.save({id:i.id,name:l.trim()});console.log("Save result:",a),a&&(m.fire({title:"Éxito",text:"Nombre del proyecto actualizado correctamente",icon:"success",timer:2e3}),$(p.current).modal("hide"),$(o.current).dxDataGrid("instance").refresh())}catch(a){console.error("Error saving project:",a),m.fire({title:"Error",text:a.message||"No se pudo actualizar el nombre del proyecto",icon:"error"})}},v=t=>{const r={draft:{color:"#fbbf24",text:"Borrador"},completed:{color:"#10b981",text:"Completado"},exported:{color:"#3b82f6",text:"Exportado"},ordered:{color:"#8b5cf6",text:"Pedido realizado"}}[t]||{color:"#6b7280",text:"Desconocido"};return{backgroundColor:`${r.color}20`,color:r.color,text:r.text}},C=t=>t==="draft",P=x;return e.jsxs(e.Fragment,{children:[e.jsx(M,{gridRef:o,title:"Mis Proyectos",rest:P,toolBar:t=>{t.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),t.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Catálogo",onClick:()=>{window.location.href="/catalogo"}}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Proyecto",width:"300px",cellTemplate:(t,{data:a})=>{t.css("cursor","pointer"),t.on("click",()=>{g(a.id)}),h(t,e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx("img",{src:a.thumbnail||"/assets/img/backgrounds/resources/default-image.png",alt:a.name,className:"rounded",style:{width:"50px",height:"50px",objectFit:"cover"},onError:r=>{r.target.src="/assets/img/backgrounds/resources/default-image.png"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 fw-bold",children:a.name||"Proyecto sin título"}),e.jsx("small",{className:"text-muted",children:a.description||"Sin descripción"})]})]}))}},{dataField:"created_at",caption:"Fecha Creación",dataType:"date",sortOrder:"desc",cellTemplate:(t,{data:a})=>{t.text(moment(a.created_at).format("DD/MM/YYYY HH:mm"))}},{dataField:"updated_at",caption:"Última Modificación",dataType:"date",cellTemplate:(t,{data:a})=>{t.text(moment(a.updated_at).format("DD/MM/YYYY HH:mm"))}},{dataField:"status",caption:"Estado",cellTemplate:(t,{data:a})=>{const r=v(a.status);h(t,e.jsx("span",{className:"badge rounded-pill px-3 py-2",style:{backgroundColor:r.backgroundColor,color:r.color,fontSize:"12px"},children:r.text}))}},{caption:"Acciones",cellTemplate:(t,{data:a})=>{const r=C(a.status);t.append(d({className:"btn btn-xs btn-light me-1",title:"Ver proyecto",icon:"fa fa-eye",onClick:()=>g(a.id)})),r?(t.append(d({className:"btn btn-xs btn-success me-1",title:"Ir al editor",icon:"fa fa-palette",onClick:()=>j(a.id)})),t.append(d({className:"btn btn-xs btn-primary me-1",title:"Editar nombre",icon:"fa fa-edit",onClick:()=>N(a)})),t.append(d({className:"btn btn-xs btn-danger",title:"Eliminar proyecto",icon:"fa fa-trash",onClick:()=>b(a.id)}))):h(t,e.jsx(T,{content:"Los proyectos finalizados no se pueden editar o eliminar",children:e.jsx("span",{className:"badge bg-secondary ms-2",children:"Finalizado"})}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(w,{modalRef:n,title:`Detalles del proyecto: ${(s==null?void 0:s.name)||"Sin título"}`,size:"lg",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Información del Proyecto"})}),e.jsx("div",{className:"card-body p-3",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:"140px"},children:"Nombre:"}),e.jsx("td",{children:(s==null?void 0:s.name)||"Sin título"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Descripción:"}),e.jsx("td",{children:(s==null?void 0:s.description)||"Sin descripción"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Estado:"}),e.jsx("td",{children:(()=>{const t=v(s==null?void 0:s.status);return e.jsx("span",{className:"badge rounded-pill px-3 py-2",style:{backgroundColor:t.backgroundColor,color:t.color},children:t.text})})()})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Creado:"}),e.jsx("td",{children:s?moment(s.created_at).format("DD/MM/YYYY HH:mm"):"-"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Modificado:"}),e.jsx("td",{children:s?moment(s.updated_at).format("DD/MM/YYYY HH:mm"):"-"})]})]})})})]}),(s==null?void 0:s.configuration)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Configuración"})}),e.jsx("div",{className:"card-body p-3",children:e.jsx("pre",{className:"bg-light p-3 rounded",style:{fontSize:"12px"},children:JSON.stringify(JSON.parse(s.configuration||"{}"),null,2)})})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Vista Previa"})}),e.jsx("div",{className:"card-body p-3 text-center",children:e.jsx("img",{src:(s==null?void 0:s.thumbnail)||"/assets/img/backgrounds/resources/default-image.png",alt:"Vista previa",className:"img-fluid rounded shadow",style:{maxHeight:"200px"},onError:t=>{t.target.src="/assets/img/backgrounds/resources/default-image.png"}})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Acciones"})}),e.jsxs("div",{className:"card-body p-3 d-grid gap-2",children:[C(s==null?void 0:s.status)?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-success",onClick:()=>j(s==null?void 0:s.id),children:[e.jsx("i",{className:"fa fa-palette me-2"}),"Ir al Editor"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{$(n.current).modal("hide"),N(s)},children:[e.jsx("i",{className:"fa fa-edit me-2"}),"Editar Nombre"]}),e.jsxs("button",{className:"btn btn-danger",onClick:()=>{$(n.current).modal("hide"),b(s==null?void 0:s.id)},children:[e.jsx("i",{className:"fa fa-trash me-2"}),"Eliminar Proyecto"]})]}):e.jsxs("div",{className:"alert alert-info mb-0",children:[e.jsx("i",{className:"fa fa-info-circle me-2"}),"Este proyecto está finalizado y no se puede editar."]}),e.jsxs("a",{href:"/catalogo",className:"btn btn-success",children:[e.jsx("i",{className:"fa fa-plus me-2"}),"Ir a la web"]})]})]})]})]})}),e.jsxs(w,{modalRef:p,title:"Editar Nombre del Proyecto",size:"md",onSubmit:y,btnSubmitText:"Guardar Cambios",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"projectName",className:"form-label",children:["Nombre del Proyecto ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"projectName",value:l,onChange:t=>f(t.target.value),placeholder:"Ingresa el nombre del proyecto",maxLength:"255",onKeyPress:t=>{t.key==="Enter"&&y()}}),e.jsx("div",{className:"form-text",children:"Máximo 255 caracteres. Este nombre se mostrará en tu lista de proyectos."})]}),i&&e.jsx("div",{className:"alert alert-light",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Proyecto actual:"})," ",i.name||"Sin título",e.jsx("br",{}),e.jsx("strong",{children:"Creado:"})," ",moment(i.created_at).format("DD/MM/YYYY HH:mm")]})})]})]})};Y((u,o)=>{k.createRoot(u).render(e.jsx(D,{...o,title:"Mis Proyectos",children:e.jsx(B,{...o})}))});
